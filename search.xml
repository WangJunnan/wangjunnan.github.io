<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[SentinelÊ∫êÁ†ÅËß£ÊûêÂõõÔºàÊµÅÊéßÁ≠ñÁï•ÂíåÊµÅÊéßÊïàÊûúÔºâ]]></title>
    <url>%2F2019%2F11%2F18%2FSentinel%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E5%9B%9B%EF%BC%88%E6%B5%81%E6%8E%A7%E7%AD%96%E7%95%A5%E5%92%8C%E6%B5%81%E6%8E%A7%E6%95%88%E6%9E%9C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®ÂàÜÊûêSentinelÁöÑ‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠ÔºåÊàë‰ª¨Áü•ÈÅì‰∫ÜÂÆÉÊòØÂü∫‰∫éÊªëÂä®Á™óÂè£ÂÅöÁöÑÊµÅÈáèÁªüËÆ°ÔºåÈÇ£‰πàÂú®ÂΩìÊàë‰ª¨ËÉΩÂ§üÊ†πÊçÆÊµÅÈáèÁªüËÆ°ÁÆóÊ≥ïÊãøÂà∞ÊµÅÈáèÁöÑÂÆûÊó∂Êï∞ÊçÆÂêéÔºå‰∏ã‰∏ÄÊ≠•Ë¶ÅÂÅöÁöÑ‰∫ãÊÉÖËá™ÁÑ∂Â∞±ÊòØÂü∫‰∫éËøô‰∫õÊï∞ÊçÆÂÅöÊµÅÊéß„ÄÇÂú®‰ªãÁªçSentinelÁöÑÊµÅÊéßÊ®°Âûã‰πãÂâçÔºåÊàë‰ª¨ÂÖàÊù•ÁÆÄÂçïÁúã‰∏ã Sentinel ÂêéÂè∞ÊòØÂ¶Ç‰ΩïÂéªÂÆö‰πâ‰∏Ä‰∏™ÊµÅÊéßËßÑÂàôÁöÑ ÂØπ‰∫é‰∏äÂõæÁöÑÈÖçÁΩÆSentinelÊääÂÆÉÊäΩË±°Êàê‰∏Ä‰∏™FlowRuleÁ±ªÔºå‰∏éÂÖ∂Â±ûÊÄß‰∏Ä‰∏ÄÂØπÂ∫î resource ËµÑÊ∫êÂêç limitApp ÈôêÊµÅÊù•Ê∫êÔºåÈªòËÆ§‰∏∫default‰∏çÂå∫ÂàÜÊù•Ê∫ê grade ÈôêÊµÅÁ±ªÂûãÔºåÊúâQPSÂíåÂπ∂ÂèëÁ∫øÁ®ãÊï∞‰∏§ÁßçÁ±ªÂûã count ÈôêÊµÅÈòàÂÄº strategy ÊµÅÊéßÁ≠ñÁï• 1. Áõ¥Êé• 2. ÂÖ≥ËÅî 3.ÈìæË∑Ø controlBehavior ÊµÅÊéßÊïàÊûú 1.Âø´ÈÄüÂ§±Ë¥• 2.È¢ÑÁÉ≠ÂêØÂä® 3.ÊéíÈòüÁ≠âÂæÖ 4. È¢ÑÁÉ≠ÂêØÂä®ÊéíÈòüÁ≠âÂæÖ warmUpPeriodSec ÊµÅÊéßÊïàÊûú‰∏∫È¢ÑÁÉ≠ÂêØÂä®Êó∂ÁöÑÈ¢ÑÁÉ≠Êó∂ÈïøÔºàÁßíÔºâ maxQueueingTimeMs ÊµÅÊéßÊïàÊûú‰∏∫ÊéíÈòüÁ≠âÂæÖÊó∂ÁöÑÁ≠âÂæÖÊó∂Èïø ÔºàÊØ´ÁßíÔºâ ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãÈÄâÊã©ÊµÅÊéßÁ≠ñÁï•ÂíåÊµÅÊéßÊïàÊûúÁöÑÊ†∏ÂøÉ‰ª£Á†Å 123456789private static boolean passLocalCheck(FlowRule rule, Context context, DefaultNode node, int acquireCount,boolean prioritized) &#123;// Ê†πÊçÆÊµÅÊéßÁ≠ñÁï•ÈÄâÊã©ÈúÄË¶ÅÊµÅÊéßÁöÑNodeÁª¥Â∫¶ËäÇÁÇπ Node selectedNode = selectNodeByRequesterAndStrategy(rule, context, node); if (selectedNode == null) &#123; return true; &#125; // Ëé∑ÂèñÈÖçÁΩÆÁöÑÊµÅÊéßÊïàÊûú ÊéßÂà∂Âô® Ôºà1. Áõ¥Êé•ÊãíÁªù 2. È¢ÑÁÉ≠ÂêØÂä® 3. ÊéíÈòü 4. È¢ÑÁÉ≠ÂêØÂä®ÊéíÈòüÁ≠âÂæÖÔºâ return rule.getRater().canPass(selectedNode, acquireCount, prioritized);&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÊØîËæÉÁÆÄÂçïÊµÅÁ®ã‰πüÂæàÊ∏ÖÊô∞ÔºåÈ¶ñÂÖàÊ†πÊçÆÊàë‰ª¨ÈÖçÁΩÆÁöÑÊµÅÊéßÁ≠ñÁï•Ëé∑ÂèñÂà∞ÂêàÈÄÇÁª¥Â∫¶ÁöÑ Node ËäÇÁÇπÔºàNodeËäÇÁÇπÊòØSentinelÂÅöÊµÅÈáèÁªüËÆ°ÁöÑÂü∫Êú¨Âçï‰ΩçÔºâÔºåÁÑ∂ÂêéÂÜçËé∑ÂèñÂà∞ËßÑÂàô‰∏≠ÈÖçÁΩÆÁöÑÊµÅÊéßÊïàÊûúÊéßÂà∂Âô®Ôºà1. Áõ¥Êé•ÊãíÁªù 2. È¢ÑÁÉ≠ÂêØÂä® 3. ÊéíÈòüÁ≠âÂæÖ 4.È¢ÑÁÉ≠ÂêØÂä®ÊéíÈòüÁ≠âÂæÖÔºâ„ÄÇ ÊµÅÊéßÁ≠ñÁï•‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãÈÄâÊã©ÊµÅÊéßÁ≠ñÁï•ÁöÑÊ∫êÁ†ÅÂàÜÊûê 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667static Node selectNodeByRequesterAndStrategy(/*@NonNull*/ FlowRule rule, Context context, DefaultNode node) &#123; // Ëé∑ÂèñÈôêÊµÅÊù•Ê∫ê limitApp String limitApp = rule.getLimitApp(); // Ëé∑ÂèñÈôêÊµÅÁ≠ñÁï• int strategy = rule.getStrategy(); // Ëé∑ÂèñÂΩìÂâç ‰∏ä‰∏ãÊñáÁöÑ Êù•Ê∫ê String origin = context.getOrigin(); // Â¶ÇÊûúËßÑÂàôÈÖçÁΩÆÁöÑÈôêÊµÅÊù•Ê∫ê limitApp Á≠â‰∫é ÂΩìÂâç‰∏ä‰∏ãÊñáÊù•Ê∫ê if (limitApp.equals(origin) &amp;&amp; filterOrigin(origin)) &#123; // ‰∏îÈÖçÁΩÆÁöÑÊµÅÊéßÁ≠ñÁï•ÊòØ Áõ¥Êé•ÂÖ≥ËÅîÁ≠ñÁï• if (strategy == RuleConstant.STRATEGY_DIRECT) &#123; // Áõ¥Êé•ËøîÂõûÂΩìÂâçÊù•Ê∫ê origin ËäÇÁÇπ return context.getOriginNode(); &#125; // ÈÖçÁΩÆÁöÑÁ≠ñÁï•‰∏∫ÂÖ≥ËÅîÊàñÂàôÈìæË∑Ø return selectReferenceNode(rule, context, node); // Â¶ÇÊûúËßÑÂàôÈÖçÁΩÆÁöÑÈôêÊµÅÊù•Ê∫ê limitApp Á≠â‰∫é default &#125; else if (RuleConstant.LIMIT_APP_DEFAULT.equals(limitApp)) &#123; // ‰∏îÈÖçÁΩÆÁöÑÊµÅÊéßÁ≠ñÁï•ÊòØ Áõ¥Êé•ÂÖ≥ËÅîÁ≠ñÁï• if (strategy == RuleConstant.STRATEGY_DIRECT) &#123; // Áõ¥Êé•ËøîÂõûÂΩìÂâçËµÑÊ∫êÁöÑ clusterNode return node.getClusterNode(); &#125; // ÈÖçÁΩÆÁöÑÁ≠ñÁï•‰∏∫ÂÖ≥ËÅîÊàñÂàôÈìæË∑Ø return selectReferenceNode(rule, context, node); // Â¶ÇÊûúËßÑÂàôÈÖçÁΩÆÁöÑÈôêÊµÅÊù•Ê∫ê limitApp Á≠â‰∫é otherÔºå‰∏îÂΩìÂâç‰∏ä‰∏ãÊñáorigin‰∏çÂú®ÊµÅÊéßËßÑÂàôÁ≠ñÁï•‰∏≠ &#125; else if (RuleConstant.LIMIT_APP_OTHER.equals(limitApp) &amp;&amp; FlowRuleManager.isOtherOrigin(origin, rule.getResource())) &#123; // ‰∏îÈÖçÁΩÆÁöÑÊµÅÊéßÁ≠ñÁï•ÊòØ Áõ¥Êé•ÂÖ≥ËÅîÁ≠ñÁï• if (strategy == RuleConstant.STRATEGY_DIRECT) &#123; return context.getOriginNode(); &#125; // ÈÖçÁΩÆÁöÑÁ≠ñÁï•‰∏∫ÂÖ≥ËÅîÊàñÂàôÈìæË∑Ø return selectReferenceNode(rule, context, node); &#125; return null;&#125;static Node selectReferenceNode(FlowRule rule, Context context, DefaultNode node) &#123;// ÂÖ≥ËÅîËµÑÊ∫êÂêçÁß∞ ÔºàÂ¶ÇÊûúÁ≠ñÁï•ÊòØÂÖ≥ËÅî ÂàôÊòØÂÖ≥ËÅîÁöÑËµÑÊ∫êÂêçÁß∞ÔºåÂ¶ÇÊûúÁ≠ñÁï•ÊòØÈìæË∑Ø ÂàôÊòØ‰∏ä‰∏ãÊñáÂêçÁß∞Ôºâ String refResource = rule.getRefResource(); int strategy = rule.getStrategy(); if (StringUtil.isEmpty(refResource)) &#123; return null; &#125; // Á≠ñÁï•ÊòØÂÖ≥ËÅî if (strategy == RuleConstant.STRATEGY_RELATE) &#123; // ËøîÂõûÂÖ≥ËÅîÁöÑËµÑÊ∫êClusterNode return ClusterBuilderSlot.getClusterNode(refResource); &#125; // Á≠ñÁï•ÊòØÈìæË∑Ø if (strategy == RuleConstant.STRATEGY_CHAIN) &#123; // ÂΩìÂâç‰∏ä‰∏ãÊñáÂêçÁß∞‰∏çÊòØËßÑÂàôÈÖçÁΩÆÁöÑname Áõ¥Êé•ËøîÂõûnull if (!refResource.equals(context.getName())) &#123; return null; &#125; return node; &#125; // No node. return null;&#125; ËøôÊÆµ‰ª£Á†ÅÁöÑÈÄªËæëÂà§Êñ≠ÊØîËæÉÂ§öÔºåÊàë‰ª¨Á®çÂæÆÁêÜ‰∏Ä‰∏ãÊï¥‰∏™ËøáÁ®ã LimitAppÁöÑ‰ΩúÁî®ÂüüÂè™Âú®ÈÖçÁΩÆÁöÑÊµÅÊéßÁ≠ñÁï•‰∏∫RuleConstant.STRATEGY_DIRECTÔºàÁõ¥Êé•ÂÖ≥ËÅîÔºâÊó∂Ëµ∑‰ΩúÁî®„ÄÇÂÖ∂Êúâ‰∏âÁßçÈÖçÁΩÆÔºåÂàÜÂà´‰∏∫defaultÔºåorigin_nameÔºåother default Â¶ÇÊûúÈÖçÁΩÆ‰∏∫defaultÔºåË°®Á§∫ÁªüËÆ°‰∏çÂå∫ÂàÜÊù•Ê∫êÔºåÂΩìÂâçËµÑÊ∫êÁöÑ‰ªª‰ΩïÊù•Ê∫êÊµÅÈáèÈÉΩ‰ºöË¢´ÁªüËÆ°ÔºàÂÖ∂ÂÆûÂ∞±ÊòØÈÄâÊã© Node ‰∏∫ clusterNode Áª¥Â∫¶Ôºâ origin_name Â¶ÇÊûúÈÖçÁΩÆ‰∏∫ÊåáÂÆöÂêçÁß∞ÁöÑ origin_nameÔºåÂàôÂè™‰ºöÂØπÂΩìÂâçÈÖçÁΩÆÁöÑÊù•Ê∫êÊµÅÈáèÂÅöÁªüËÆ° other Â¶ÇÊûúÈÖçÁΩÆ‰∏∫other Âàô‰ºöÂØπÂÖ∂‰ªñÂÖ®ÈÉ®Êù•Ê∫êÁîüÊïà‰ΩÜ‰∏çÂåÖÊã¨Á¨¨‰∫åÊù°ÈÖçÁΩÆÁöÑÊù•Ê∫ê ÂΩìÁ≠ñÁï•ÈÖçÁΩÆ‰∏∫ RuleConstant.STRATEGY_RELATE Êàñ RuleConstant.STRATEGY_CHAIN Êó∂ STRATEGY_RELATE ÂÖ≥ËÅîÂÖ∂‰ªñÁöÑÊåáÂÆöËµÑÊ∫êÔºåÂ¶ÇËµÑÊ∫êAÊÉ≥‰ª•ËµÑÊ∫êBÁöÑÊµÅÈáèÁä∂ÂÜµÊù•ÂÜ≥ÂÆöÊòØÂê¶ÈúÄË¶ÅÈôêÊµÅÔºåËøôÊó∂ËµÑÊ∫êAËßÑÂàôÈÖçÁΩÆÂèØ‰ª•‰ΩøÁî® STRATEGY_RELATE Á≠ñÁï• STRATEGY_CHAIN ÂØπÊåáÂÆöÂÖ•Âè£ÁöÑÊµÅÈáèÈôêÊµÅÔºåÂõ†‰∏∫ÊµÅÈáèÂèØ‰ª•ÊúâÂ§ö‰∏™‰∏çÂêåÁöÑÂÖ•Âè£ÔºàEntranceNodeÔºâ ÂØπ‰∫é‰∏äÈù¢Âá†‰∏™ËäÇÁÇπ‰πãÈó¥ÁöÑÂÖ≥Á≥ª‰∏çÊ∏ÖÊ•öÁöÑÂèØ‰ª•ÂéªÁúãÊàëËøôÁØáÊñáÁ´†ÂºÄÂ§¥ÁöÑÊÄªËßàÂõæ SentinelÊ∫êÁ†ÅËß£Êûê‰∏ÄÔºàÊµÅÁ®ãÊÄªËßàÔºâ ÊµÅÊéßÊïàÊûúÂÖ≥‰∫éÊµÅÊéßÊïàÊûúÁöÑÈÖçÁΩÆÊúâÂõõÁßçÔºåÊàë‰ª¨Êù•Áúã‰∏ãÂÆÉ‰ª¨ÁöÑÂàùÂßãÂåñ‰ª£Á†Å 1234567891011121314151617181920212223242526/** * class com.alibaba.csp.sentinel.slots.block.flow.FlowRuleUtil */private static TrafficShapingController generateRater(/*@Valid*/ FlowRule rule) &#123;// Âè™ÊúâGrade‰∏∫ÁªüËÆ° QPSÊó∂ ÊâçÂèØ‰ª•ÈÄâÊã©Èô§ÈªòËÆ§ÊµÅÊéßÊïàÊûúÂ§ñÁöÑ ÂÖ∂‰ªñÊµÅÊéßÊïàÊûúÊéßÂà∂Âô® if (rule.getGrade() == RuleConstant.FLOW_GRADE_QPS) &#123; switch (rule.getControlBehavior()) &#123; // È¢ÑÁÉ≠ÂêØÂä® case RuleConstant.CONTROL_BEHAVIOR_WARM_UP: return new WarmUpController(rule.getCount(), rule.getWarmUpPeriodSec(), ColdFactorProperty.coldFactor); // Ë∂ÖËøá ÈòàÂÄº ÊéíÈòüÁ≠âÂæÖ ÊéßÂà∂Âô® case RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER: return new RateLimiterController(rule.getMaxQueueingTimeMs(), rule.getCount()); case RuleConstant.CONTROL_BEHAVIOR_WARM_UP_RATE_LIMITER: // ‰∏äÈù¢‰∏§‰∏™ÁöÑÁªìÂêà‰Ωì return new WarmUpRateLimiterController(rule.getCount(), rule.getWarmUpPeriodSec(), rule.getMaxQueueingTimeMs(), ColdFactorProperty.coldFactor); case RuleConstant.CONTROL_BEHAVIOR_DEFAULT: default: // Default mode or unknown mode: default traffic shaping controller (fast-reject). &#125; &#125; // ÈªòËÆ§ÊéßÂà∂Âô® Ë∂ÖËøá ÈòàÂÄº Áõ¥Êé•ÊãíÁªù return new DefaultController(rule.getCount(), rule.getGrade());&#125; ÂèØ‰ª•ÊØîËæÉÊ∏ÖÊô∞ÁöÑÁúãÂà∞ÊÄªÂÖ±ÂØπÂ∫îÊúâÂõõÁßçÊµÅÊéßÂô®ÁöÑÂàùÂßãÂåñ Áõ¥Êé•ÊãíÁªù12345678910111213141516171819202122232425@Overridepublic boolean canPass(Node node, int acquireCount, boolean prioritized) &#123;// Ëé∑ÂèñÂΩìÂâçqps int curCount = avgUsedTokens(node); // Âà§Êñ≠ÊòØÂê¶Â∑≤ÁªèÂ§ß‰∫éÈòàÂÄº if (curCount + acquireCount &gt; count) &#123; // Â¶ÇÊûúÂΩìÂâçÊµÅÈáèÂÖ∑Êúâ‰ºòÂÖàÁ∫ßÔºåÂàô‰ºöÊèêÂâçÂéªËé∑ÂèñÊú™Êù•ÁöÑÈÄöËøáËµÑÊ†º if (prioritized &amp;&amp; grade == RuleConstant.FLOW_GRADE_QPS) &#123; long currentTime; long waitInMs; currentTime = TimeUtil.currentTimeMillis(); waitInMs = node.tryOccupyNext(currentTime, acquireCount, count); if (waitInMs &lt; OccupyTimeoutProperty.getOccupyTimeout()) &#123; node.addWaitingRequest(currentTime + waitInMs, acquireCount); node.addOccupiedPass(acquireCount); sleep(waitInMs); // PriorityWaitException indicates that the request will pass after waiting for &#123;@link @waitInMs&#125;. throw new PriorityWaitException(waitInMs); &#125; &#125; return false; &#125; return true;&#125; Ê≠§ÁßçÁ≠ñÁï•ÊØîËæÉÁÆÄÂçïÁ≤óÊö¥ÔºåË∂ÖËøáÊµÅÈáèÈòàÂÄºÁöÑ‰ºöÁõ¥Êé•ÊãíÁªù„ÄÇ‰∏çËøáËøôÈáåÊúâ‰∏Ä‰∏™Â∞èÁªÜËäÇÔºåÂ¶ÇÊûúÂÖ•Âè£ÊµÅÈáèprioritized‰∏∫trueÔºå‰πüÂ∞±ÊòØ‰ºòÂÖàÁ∫ßÊØîËæÉÈ´òÔºåÂàô‰ºöÈÄöËøáÂç†Áî®Êú™Êù•Êó∂Èó¥Á™óÂè£ÁöÑÂêçÈ¢ùÊù•ÂÆûÁé∞„ÄÇËøô‰∏™Âú®‰∏ä‰∏ÄÁØáÊñáÁ´†Êúâ‰ªãÁªçÂà∞ È¢ÑÁÉ≠ÂêØÂä®WarmUpController ‰∏ªË¶ÅÊòØÁî®Êù•Èò≤Ê≠¢ÊµÅÈáèÁöÑÁ™ÅÁÑ∂‰∏äÂçáÔºå‰ΩøÁ≥ªÁªüÊú¨Âú®Á®≥ÂÆöÁä∂ÊÄÅ‰∏ãËÉΩÂ§ÑÁêÜÁöÑÔºå‰ΩÜÊòØÁî±‰∫éËÆ∏Â§öËµÑÊ∫êÊ≤°ÊúâÈ¢ÑÁÉ≠ÔºåÂØºËá¥Â§ÑÁêÜ‰∏ç‰∫Ü‰∫Ü„ÄÇÊ≥®ÊÑèËøôÈáåÁöÑÈ¢ÑÁÉ≠Âπ∂‰∏çÊòØÊåáÁ≥ªÁªüÂêØÂä®‰πãÂêéÁöÑ‰∏ÄÊ¨°ÊÄßÈ¢ÑÁÉ≠ÔºåËÄåÊòØÊåáÁ≥ªÁªüÂú®ËøêË°åÁöÑ‰ªª‰ΩïÊó∂ÂÄôÊµÅÈáè‰ªé‰ΩéÂ≥∞Âà∞Á™ÅÂ¢ûÁöÑÈ¢ÑÁÉ≠Èò∂ÊÆµ„ÄÇ ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãWarmUpControllerÁöÑÂÖ∑‰ΩìÂÆûÁé∞Á±ª 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354/** * WarmUpController ÊûÑÈÄ†ÊñπÊ≥ï * @param count ÂΩìÂâçqpsÈòàÂÄº * @param warmUpPeriodInSec È¢ÑÁÉ≠Êó∂Èïø Áßí * @param coldFactor ÂÜ∑ÂêØÂä®Á≥ªÊï∞ ÈªòËÆ§‰∏∫3 */private void construct(double count, int warmUpPeriodInSec, int coldFactor) &#123; if (coldFactor &lt;= 1) &#123; throw new IllegalArgumentException("Cold factor should be larger than 1"); &#125; this.count = count; this.coldFactor = coldFactor; // Ââ©‰ΩôTokenÁöÑË≠¶ÊàíÂÄºÔºåÂ∞è‰∫éË≠¶ÊàíÂÄºÁ≥ªÁªüÂ∞±ËøõÂÖ•Ê≠£Â∏∏ËøêË°åÊúü warningToken = (int)(warmUpPeriodInSec * count) / (coldFactor - 1); // Á≥ªÁªüÊúÄÂÜ∑Êó∂ÂÄôÁöÑÂâ©‰ΩôTokenÊï∞ maxToken = warningToken + (int)(2 * warmUpPeriodInSec * count / (1.0 + coldFactor)); // Á≥ªÁªüÈ¢ÑÁÉ≠ÁöÑÈÄüÁéá(ÊñúÁéá) slope = (coldFactor - 1.0) / count / (maxToken - warningToken);&#125;@Overridepublic boolean canPass(Node node, int acquireCount, boolean prioritized) &#123; long passQps = (long) node.passQps(); long previousQps = (long) node.previousPassQps(); // ËÆ°ÁÆóÂΩìÂâçÁöÑ Ââ©‰Ωô token Êï∞ syncToken(previousQps); // Â¶ÇÊûúËøõÂÖ•‰∫ÜË≠¶ÊàíÁ∫øÔºåÂºÄÂßãË∞ÉÊï¥‰ªñÁöÑqps long restToken = storedTokens.get(); if (restToken &gt;= warningToken) &#123; // ËÆ°ÁÆóÂâ©‰ΩôtokenË∂ÖÂá∫Ë≠¶ÊàíÂÄºÁöÑÂÄº long aboveToken = restToken - warningToken; // ËÆ°ÁÆóÂΩìÂâçÂÖÅËÆ∏ÈÄöËøáÁöÑÊúÄÂ§ß qps double warningQps = Math.nextUp(1.0 / (aboveToken * slope + 1.0 / count)); if (passQps + acquireCount &lt;= warningQps) &#123; return true; &#125; &#125; else &#123; // ‰∏çÂú®È¢ÑÁÉ≠Èò∂ÊÆµÔºåÂàôÁõ¥Êé•Âà§Êñ≠ÂΩìÂâçqpsÊòØÂê¶Â§ß‰∫éÈòàÂÄº if (passQps + acquireCount &lt;= count) &#123; return true; &#125; &#125; return false;&#125; È¶ñÂÖàÊòØÊûÑÈÄ†ÊñπÊ≥ïÔºå‰∏ªË¶ÅÂÖ≥Ê≥®2‰∏™ÈáçË¶ÅÂèÇÊï∞ warningToken Ââ©‰ΩôtokenÁöÑË≠¶ÊàíÂÄº maxToken Ââ©‰ΩôÁöÑÊúÄÂ§ßtokenÊï∞ÔºåÂ¶ÇÊûúÂâ©‰ΩôtokenÊï∞Á≠â‰∫émaxTokenÔºåÂàôËØ¥ÊòéÁ≥ªÁªüÂ§Ñ‰∫éÊúÄÂÜ∑Èò∂ÊÆµ Ë¶ÅÁêÜËß£Ëøô‰∏§‰∏™ÂèÇÊï∞ÁöÑÂê´‰πâÔºåÂèØ‰ª•ÂèÇËÄÉ‰ª§ÁâåÊ°∂ÁÆóÊ≥ïÔºåÊØèÈÄöËøá‰∏Ä‰∏™ËØ∑Ê±ÇÔºåÂ∞±‰ºö‰ªé‰ª§ÁâåÊ°∂‰∏≠ÂèñËµ∞‰∏Ä‰∏™‰ª§Áâå„ÄÇÈÇ£‰πàËØïÊÉ≥‰∏Ä‰∏ãÔºåÂΩì‰ª§ÁâåÊ°∂‰∏≠ÁöÑ‰ª§ÁâåËææÂà∞ÊúÄÂ§ßÂÄºÊòØÔºåÊòØ‰∏çÊòØÊÑèÂë≥ÁùÄÁ≥ªÁªüÁõÆÂâçÂ§Ñ‰∫éÊúÄÂÜ∑Èò∂ÊÆµÔºåÂõ†‰∏∫Ê°∂ÈáåÁöÑ‰ª§ÁâåÂßãÁªàÂ§Ñ‰∫é‰∏Ä‰∏™ÈùûÂ∏∏È•±ÂíåÁöÑÁä∂ÊÄÅ„ÄÇËøôÈáåÁöÑ‰ª§ÁâåÊúÄÂ§ßÂÄºÂØπÂ∫îÁöÑÂ∞±ÊòØmaxTokenÔºåËÄåwarningTokenÔºåÂàôÊòØÂØπÂ∫î‰∫Ü‰∏Ä‰∏™Ë≠¶ÊàíÂÄºÔºåÂΩìÊ°∂‰∏≠ÁöÑ‰ª§ÁâåÊï∞ÂáèÂ∞ëÂà∞‰∏Ä‰∏™ÊåáÂÆöÁöÑÂÄºÊó∂ÔºåËØ¥ÊòéÁ≥ªÁªüÂ∑≤ÁªèÂ∫¶Ëøá‰∫ÜÈ¢ÑÁÉ≠Èò∂ÊÆµ ÂΩì‰∏Ä‰∏™ËØ∑Ê±ÇËøõÊù•Êó∂ÔºåÈ¶ñÂÖàÈúÄË¶ÅËÆ°ÁÆóÂΩìÂâçÊ°∂‰∏≠Ââ©‰ΩôÁöÑtokenÊï∞ÔºåÂÖ∑‰ΩìÈÄªËæëÂú®syncTokenÊñπÊ≥ï‰∏≠ÂΩìÁ≥ªÁªüÂâ©‰ΩôTokenÂ§ß‰∫éwarningTokenÊó∂ÔºåËØ¥ÊòéÁ≥ªÁªü‰ªçÂ§Ñ‰∫éÈ¢ÑÁÉ≠Èò∂ÊÆµÔºåÊïÖÈúÄË¶ÅË∞ÉÊï¥ÂΩìÂâçÊâÄËÉΩÈÄöËøáÁöÑÊúÄÂ§ßqpsÈòàÂÄº 1234567891011121314151617181920212223protected void syncToken(long passQps) &#123; long currentTime = TimeUtil.currentTimeMillis(); // Ëé∑ÂèñÁßíÁ∫ßÂà´Êó∂Èó¥ÔºàÂéªÈô§ÊØ´ÁßíÔºâ currentTime = currentTime - currentTime % 1000; long oldLastFillTime = lastFilledTime.get(); if (currentTime &lt;= oldLastFillTime) &#123; return; &#125; long oldValue = storedTokens.get(); // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÂæÄÊ°∂‰∏≠Ê∑ªÂä†‰ª§Áâå long newValue = coolDownTokens(currentTime, passQps); // ËÆæÁΩÆÊñ∞ÁöÑtokenÊï∞ if (storedTokens.compareAndSet(oldValue, newValue)) &#123; // Â¶ÇÊûúËÆæÁΩÆÊàêÂäüÁöÑËØùÂàôÂáèÂéª‰∏äÊ¨°ÈÄöËøáÁöÑqpsÊï∞ÈáèÔºåÂ∞±ÂæóÂà∞ÂΩìÂâçÁöÑÂÆûÈôÖtokenÊï∞ long currentValue = storedTokens.addAndGet(0 - passQps); if (currentValue &lt; 0) &#123; storedTokens.set(0L); &#125; lastFilledTime.set(currentTime); &#125;&#125; Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥ coolDownTokens ÊñπÊ≥ï‰ºöÂà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÂæÄÊ°∂‰∏≠Êîæ tokenÔºåÂπ∂ËøîÂõûÊúÄÊñ∞ÁöÑtokenÊï∞ Â¶ÇÊûúËøîÂõû‰∫ÜÊúÄÊñ∞ÁöÑtokenÊï∞ÔºåÂàôÂ∞ÜÂΩìÂâçÂâ©‰ΩôÁöÑtokenÊï∞ÂáèÂéªÂ∑≤ÁªèÈÄöËøáÁöÑqpsÔºåÂæóÂà∞ÊúÄÊñ∞ÁöÑÂâ©‰ΩôtokenÊï∞ 1234567891011121314151617private long coolDownTokens(long currentTime, long passQps) &#123; long oldValue = storedTokens.get(); long newValue = oldValue; // Ê∑ªÂä†‰ª§ÁâåÁöÑÂá†ÁßçÊÉÖÂÜµ // 1. Á≥ªÁªüÂàùÂßãÂêØÂä®Èò∂ÊÆµÔºåoldvalue = 0ÔºålastFilledTime‰πüÁ≠â‰∫é0ÔºåÊ≠§Êó∂ÂæóÂà∞‰∏Ä‰∏™ÈùûÂ∏∏Â§ßÁöÑnewValueÔºå‰ºöÂèñmaxToken‰∏∫ÂΩìÂâçtokenÊï∞ÈáèÂÄº // 2. Á≥ªÁªüÂ§Ñ‰∫éÈ¢ÑÁÉ≠Èò∂ÊÆµ ‰∏î ÂΩìÂâçqpsÂ∞è‰∫é count / coldFactor // 3. Á≥ªÁªüÂ§Ñ‰∫éÂÆåÊàêÈ¢ÑÁÉ≠Èò∂ÊÆµ if (oldValue &lt; warningToken) &#123; newValue = (long)(oldValue + (currentTime - lastFilledTime.get()) * count / 1000); &#125; else if (oldValue &gt; warningToken) &#123; if (passQps &lt; (int)count / coldFactor) &#123; newValue = (long)(oldValue + (currentTime - lastFilledTime.get()) * count / 1000); &#125; &#125; return Math.min(newValue, maxToken);&#125; ËøôÈáåÁúã‰∏Ä‰∏ã‰ºöÊ∑ªÂä†‰ª§ÁâåÁöÑÂá†ÁßçÊÉÖÂÜµ Á≥ªÁªüÂàùÂßãÂêØÂä®Èò∂ÊÆµÔºåoldvalue = 0ÔºålastFilledTime‰πüÁ≠â‰∫é0ÔºåÊ≠§Êó∂ÂæóÂà∞‰∏Ä‰∏™ÈùûÂ∏∏Â§ßÁöÑnewValueÔºå‰ºöÂèñmaxToken‰∏∫ÂΩìÂâçtokenÊï∞ÈáèÂÄº Á≥ªÁªüÂ§Ñ‰∫éÂÆåÊàêÈ¢ÑÁÉ≠Èò∂ÊÆµÔºåÈúÄË¶ÅË°•ÂÖÖ token ‰ΩøÂÖ∂Á®≥ÂÆöÂú®‰∏Ä‰∏™ËåÉÂõ¥ÂÜÖ Á≥ªÁªüÂ§Ñ‰∫éÈ¢ÑÁÉ≠Èò∂ÊÆµ ‰∏î ÂΩìÂâçqpsÂ∞è‰∫é count / coldFactor Ââç2ÁßçÊÉÖÂÜµÊØîËæÉÂ•ΩÁêÜËß£ÔºåËøôÈáå‰∏ªË¶ÅËß£Èáä‰∏Ä‰∏ãÁ¨¨‰∏âÁßçÊÉÖÂÜµÔºå‰∏∫‰Ωï ÂΩìÂâçqpsÂ∞è‰∫écount / coldFactorÊó∂ÔºåÈúÄË¶ÅÂæÄÊ°∂‰∏≠Ê∑ªÂä†TokenÔºüËØïÊÉ≥‰∏Ä‰∏ãÂ¶ÇÊûúÊ≤°ÊúâËøô‰∏ÄÊ≠•‰ºöÊÄé‰πàÊ†∑ÔºåÂ¶ÇÊûúÊ≤°ÊúâËøô‰∏ÄÊ≠•Âú®ÊØîËæÉ‰ΩéÁöÑqpsÊÉÖÂÜµ‰∏ãË°•ÂÖÖTokenÔºåÁ≥ªÁªüÊúÄÁªà‰πü‰ºöÊÖ¢ÊÖ¢Â∫¶ËøáÈ¢ÑÁÉ≠Èò∂ÊÆµÔºå‰ΩÜÂÆûÈôÖ‰∏äËøô‰πà‰ΩéÁöÑqps(Â∞è‰∫é count / coldFactorÊó∂)‰∏çÂ∫îËØ•ÂÆåÊàêÈ¢ÑÁÉ≠„ÄÇÊâÄ‰ª•ËøôÈáåÊâç‰ºöÂú® qps‰Ωé‰∫écount / coldFactorÊó∂Ë°•ÂÖÖÂâ©‰ΩôtokenÊï∞ÔºåÊù•ËÆ©Á≥ªÁªüÂú®‰ΩéqpsÊÉÖÂÜµ‰∏ãÂßãÁªàÂ§Ñ‰∫éÈ¢ÑÁÉ≠Áä∂ÊÄÅ‰∏ã ÊéíÈòüÁ≠âÂæÖÊéíÈòüÁ≠âÂæÖÁöÑÂÆûÁé∞Áõ∏ÂØπÈ¢ÑÁÉ≠ÂêØÂä®ÂÆûÁé∞ÊØîËæÉÁÆÄÂçï È¶ñÂÖà‰ºöÈÄöËøáÊàë‰ª¨ÁöÑÈÖçÁΩÆÔºåËÆ°ÁÆóÂá∫Áõ∏ÈÇª‰∏§‰∏™ËØ∑Ê±ÇÂÖÅËÆ∏ÈÄöËøáÁöÑÊúÄÂ∞èÊó∂Èó¥ÔºåÁÑ∂Âêé‰ºöËÆ∞ÂΩïÊúÄËøë‰∏Ä‰∏™ÈÄöËøáÁöÑÊó∂Èó¥„ÄÇ‰∏§ËÄÖÁõ∏Âä†Âç≥ÊòØ‰∏ã‰∏ÄÊ¨°ËØ∑Ê±ÇÂÖÅËÆ∏ÈÄöËøáÁöÑÊúÄÂ∞èÊó∂Èó¥„ÄÇ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public boolean canPass(Node node, int acquireCount, boolean prioritized) &#123; if (acquireCount &lt;= 0) &#123; return true; &#125; if (count &lt;= 0) &#123; return false; &#125; long currentTime = TimeUtil.currentTimeMillis(); // ËÆ°ÁÆóÁõ∏Èöî‰∏§‰∏™ËØ∑Ê±Ç ÈúÄË¶ÅÁõ∏ÈöîÂ§öÈïøÊó∂Èó¥ long costTime = Math.round(1.0 * (acquireCount) / count * 1000); // Êú¨Ê¨°ÊúüÊúõÈÄöËøáÁöÑÊúÄÂ∞èÊó∂Èó¥ long expectedTime = costTime + latestPassedTime.get(); // Â¶ÇÊûúÂΩìÂâçÊó∂Èó¥Â§ß‰∫éÊúüÊúõÊó∂Èó¥ÔºåËØ¥ÊòéqpsËøòÊú™Ë∂ÖËøáÈòàÂÄºÔºåÁõ¥Êé•ÈÄöËøá if (expectedTime &lt;= currentTime) &#123; latestPassedTime.set(currentTime); return true; &#125; else &#123; // ÂΩìÂâçÊó∂Èó¥Â∞è‰∫é‰∫éÊúüÊúõÊó∂Èó¥ÔºåËØ∑Ê±ÇËøáÂø´‰∫ÜÔºåÈúÄË¶ÅÊéíÈòüÁ≠âÂæÖÊåáÂÆöÊó∂Èó¥ // ËÆ°ÁÆóÁ≠âÂæÖÊó∂Èó¥ long waitTime = costTime + latestPassedTime.get() - TimeUtil.currentTimeMillis(); // Á≠âÂæÖÊó∂ÈïøÂ§ß‰∫éÊàë‰ª¨ËÆæÁΩÆÁöÑÊúÄÂ§ßÊó∂ÈïøÔºåÂàô‰∏çÈÄöËøá if (waitTime &gt; maxQueueingTimeMs) &#123; return false; &#125; else &#123; // Âê¶ÂàôÂàôÊéíÈòüÁ≠âÂæÖÔºåÂç†Áî®‰∏ãÈÄöËøáÊó∂Èó¥ long oldTime = latestPassedTime.addAndGet(costTime); try &#123; waitTime = oldTime - TimeUtil.currentTimeMillis(); // Âà§Êñ≠Á≠âÂæÖÊó∂Èó¥ÊòØÂê¶Â∑≤ÁªèÂ§ß‰∫éÊúÄÂ§ßÂÄº if (waitTime &gt; maxQueueingTimeMs) &#123; // Â§ß‰∫éÂàôÂ∞Ü‰∏ä‰∏ÄÊ≠•Âä†ÁöÑÂÄºÈáçÊñ∞ÂáèÂéª latestPassedTime.addAndGet(-costTime); return false; &#125; // in race condition waitTime may &lt;= 0 // Âç†Áî®Á≠âÂæÖÊó∂Èó¥ÊàêÂäüÔºåÁõ¥Êé•sleep costTime if (waitTime &gt; 0) &#123; Thread.sleep(waitTime); &#125; return true; &#125; catch (InterruptedException e) &#123; &#125; &#125; &#125; return false;&#125; ÊéíÈòüÁ≠âÂæÖÊéßÂà∂Âô®ÁöÑÊ†∏ÂøÉÁ≠ñÁï•ÂÖ∂ÂÆûÂ∞±ÊòØÂõ¥Áªï‰∫ÜlatestPassedTimeËøõË°åÁöÑÔºålatestPassedTimeÊåáÁöÑÊòØ‰∏ä‰∏ÄÊ¨°ËØ∑Ê±ÇÈÄöËøáÁöÑÊó∂Èó¥ÔºåÈÄöËøálatestPassedTime + costTimeÊù•‰∏éÂΩìÂâçÊó∂Èó¥ÂÅöÊØîËæÉÔºåÊù•Âà§Êñ≠ÂΩìÂâçËØ∑Ê±ÇÊòØÂê¶ÂèØ‰ª•ÈÄöËøáÔºåÊó†Ê≥ïÈÄöËøáÁöÑËØ∑Ê±ÇÂàô‰ºö‰ºòÂÖàÂç†Áî®latestPassedTimeÊó∂Èó¥ÔºåÁõ¥Âà∞sleepÂà∞ÂèØ‰ª•ÈÄöËøáÁöÑÊó∂Èó¥„ÄÇÂΩìÁÑ∂Êàë‰ª¨‰πüÂèØ‰ª•ÈÖçÁΩÆÊéíÈòüÁ≠âÂæÖÁöÑÊúÄÂ§ßÊó∂Èó¥ÔºåÊù•ÈôêÂà∂ÁõÆÂâçÊéíÈòüÁ≠âÂæÖÈÄöËøáÁöÑËØ∑Ê±ÇÊï∞Èáè„ÄÇ È¢ÑÁÉ≠ÂêØÂä®ÊéíÈòüÁ≠âÂæÖÈ¢ÑÁÉ≠ÊéíÈòüÁ≠âÂæÖÔºåWarmUpRateLimiterControllerÂÆûÁé∞Á±ªÊàë‰ª¨ÂèëÁé∞ÂÖ∂ÁªßÊâø‰∫ÜWarmUpControllerÔºåËøôÊòØSentinelÂú®1.4ÁâàÊú¨ÂêéÊñ∞Âä†ÁöÑ‰∏ÄÁßçÊéßÂà∂Âô®ÔºåÂÖ∂ÂÆûÂ∞±ÊòØÈ¢ÑÁÉ≠ÂêØÂä®ÂíåÊéíÈòüÁ≠âÂæÖÁöÑÁªìÂêà‰ΩìÔºåÂÖ∑‰ΩìÊ∫êÁ†ÅÊàë‰ª¨Â∞±‰∏çÂÅöÂàÜÊûê„ÄÇ Â∞æË®ÄSentinelÁöÑÊµÅÊéßÁ≠ñÁï•ÂíåÊµÅÊéßÊïàÊûúÁöÑÁõ∏ÁªìÂêà‰ΩøÁî®ËøòÊòØÈùûÂ∏∏Â∑ßÂ¶ôÁöÑÔºåÂΩì‰∏≠ÁöÑ‰∏Ä‰∫õËÆæËÆ°ÊÄùÊÉ≥ËøòÊòØÈùûÂ∏∏ÊúâÂÄüÈâ¥ÊÑè‰πâÁöÑ SentinelÁ≥ªÂàó SentinelÊ∫êÁ†ÅËß£Êûê‰∏ÄÔºàÊµÅÁ®ãÊÄªËßàÔºâ SentinelÊ∫êÁ†ÅËß£Êûê‰∫åÔºàslotÊÄªËßàÔºâ SentinelÊ∫êÁ†ÅËß£Êûê‰∏âÔºàÊªëÂä®Á™óÂè£ÊµÅÈáèÁªüËÆ°Ôºâ SentinelÊ∫êÁ†ÅËß£ÊûêÂõõÔºàÊµÅÊéßÁ≠ñÁï•ÂíåÊµÅÊéßÊïàÊûúÔºâ]]></content>
      <categories>
        <category>Sentinel</category>
        <category>Âπ∂Âèë</category>
      </categories>
      <tags>
        <tag>Sentinel</tag>
        <tag>‰∏≠Èó¥‰ª∂</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ëá™ÂÆö‰πâmavenËÑöÊâãÊû∂]]></title>
    <url>%2F2019%2F11%2F08%2F%E8%87%AA%E5%AE%9A%E4%B9%89maven%E8%84%9A%E6%89%8B%E6%9E%B6%2F</url>
    <content type="text"><![CDATA[ÂÜôÂú®ÂâçÈù¢ÂºÄÂèëÊñ∞È°πÁõÆÂ∞±ÈúÄË¶ÅÊê≠Âª∫Êñ∞Â∑•Á®ãÔºå‰ΩÜÊòØÊê≠Âª∫Êñ∞Â∑•Á®ãÁöÑËøô‰∏™ËøáÁ®ãÊòØÈùûÂ∏∏ÁπÅÁêêÊµ™Ë¥πÊó∂Èó¥ÁöÑÔºåÂπ∂‰∏î‰∏çÂèØÈÅøÂÖçÁöÑÈúÄË¶ÅË∏©Âùë„ÄÇÊõ¥ÂèØÊÄïÁöÑÊòØÔºåÂ¶ÇÊûúÊòØÂú®‰∏Ä‰∏™Âõ¢Èòü‰∏≠ÔºåÊØèÊñ∞Ëµ∑‰∏Ä‰∏™È°πÁõÆÈÉΩÁî±‰∏çÂêåÁöÑÂºÄÂèë‰∫∫ÂëòÂéªËá™ÂÆö‰πâÁöÑÊê≠Âª∫Â∑•Á®ãÁªìÊûÑÔºåÈÇ£‰πàÂØπÂêéÁª≠ÁöÑÁªü‰∏ÄÁÆ°ÁêÜÔºåÁõëÊéßÔºåËøêÁª¥ÁÆÄÁõ¥ÊòØÁÅæÈöæ„ÄÇÂü∫‰∫é‰ª•‰∏äÂá†ÁÇπÔºåÂõ¢ÈòüÂÜÖÈÉ®ÂÖ∂ÂÆûÊòØÈùûÂ∏∏ÊúâÂøÖË¶ÅÊê≠Âª∫‰∏Ä‰∏™Áªü‰∏ÄÁöÑËÑöÊâãÊû∂Êù•‰æõÁªü‰∏Ä‰ΩøÁî® Âà∂‰Ωú‰∏Ä‰∏™ËÑöÊâãÊû∂‰∏ãÈù¢Êàë‰ª¨Â∞±Êù•ËØ¶ÁªÜÁöÑ‰ªãÁªçÂ¶Ç‰ΩïÊê≠Âª∫‰∏Ä‰∏™mavenÂ∑•Á®ãÁöÑËÑöÊâãÊû∂ Ë¶ÅÊê≠Âª∫ËÑöÊâãÊû∂ÔºåÈ¶ñÂÖàÊàë‰ª¨ÈúÄË¶Å‰∏Ä‰∏™Ê®°ÊùøÂ∑•Á®ãÔºåËøô‰∏™Ê®°ÊùøÂ∑•Á®ã‰∏ÄËà¨Êù•ËØ¥‰ºöÈõÜÊàê‰∏Ä‰∫õÂ∑•ÂÖ∑Á±ªÔºåÂ∫ïÂ±Ç‰∏≠Èó¥‰ª∂ÔºåÈÄöÁî®ÈÖçÁΩÆÔºåÂπ∂‰∏îË¶ÅÊúâËâØÂ•ΩÁöÑÂàÜÂ±ÇÁªìÊûÑÁ≠â„ÄÇÈúÄË¶ÅËÉΩÂ§üËææÂà∞ÂºÄÁÆ±Âç≥Áî®ÁöÑÁ®ãÂ∫¶„ÄÇ ‰ª•‰∏ãÊòØ‰∏Ä‰∏™Ê®°ÊùøÂ∑•Á®ãÁöÑÁõÆÂΩïÁªìÊûÑÔºå‰πüÊòØÁõÆÂâçÊàë‰ª¨Âõ¢ÈòüÂÜÖÈÉ®ÁöÑÊ†áÂáÜÂåñÁªìÊûÑ1234567891011121314151617.‚îú‚îÄ‚îÄ example-client‚îÇ ‚îú‚îÄ‚îÄ pom.xml‚îÇ ‚îî‚îÄ‚îÄ src‚îú‚îÄ‚îÄ example-core‚îÇ ‚îú‚îÄ‚îÄ pom.xml‚îÇ ‚îî‚îÄ‚îÄ src‚îú‚îÄ‚îÄ example-server‚îÇ ‚îú‚îÄ‚îÄ pom.xml‚îÇ ‚îî‚îÄ‚îÄ src‚îú‚îÄ‚îÄ example-test‚îÇ ‚îú‚îÄ‚îÄ pom.xml‚îÇ ‚îî‚îÄ‚îÄ src‚îú‚îÄ‚îÄ Jenkinsfile‚îú‚îÄ‚îÄ README.md‚îú‚îÄ‚îÄ .gitignore‚îî‚îÄ‚îÄ pom.xml ÂÆåÊàêÊ®°ÊùøÂ∑•Á®ãÁöÑÊê≠Âª∫ÂêéÔºåÈúÄË¶ÅÂú®Ê®°ÊùøÂ∑•Á®ãÁöÑÊúÄÂ§ñÂ±Ç pom Êñá‰ª∂Âä†ÂÖ•‰ª•‰∏ãÈÖçÁΩÆ 12345678910111213141516171819202122232425262728&lt;build&gt; &lt;pluginManagement&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-archetype-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.1&lt;/version&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.6.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.2&lt;/version&gt; &lt;configuration&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/pluginManagement&gt; &lt;/build&gt; ÂÆåÊàê‰πãÂêéÂú®Ê†πÁõÆÂΩï‰∏ãÊâßË°å 1mvn archetype:create-from-project Âà∑Êñ∞È°πÁõÆÂêéÔºå‰ºöÂèëÁé∞Âú® ./target/generated-sources/archetypeÁõÆÂΩï‰∏ãÁîüÊàê‰∫ÜËÑöÊâãÊû∂Â∑•Á®ãÔºåÁîüÊàêÁöÑËÑöÊâãÊû∂Â∑•Á®ãÂèØ‰ª•ÂΩìÊàêÊòØ‰∏Ä‰∏™Áã¨Á´ãÁöÑÈ°πÁõÆÔºåÁõÆÂΩïÁªìÊûÑÂ¶Ç‰∏ãÂõæ 1234567891011121314151617181920212223242526272829303132333435.‚îú‚îÄ‚îÄ pom.xml‚îú‚îÄ‚îÄ src‚îÇ ‚îú‚îÄ‚îÄ main‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ resources‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ META-INF‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ maven‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ archetype-metadata.xml‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ archetype-resources‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ Jenkinsfile‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ README.md‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __artifactId__.iml‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __rootArtifactId__-client‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __parentArtifactId__-client.iml‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ pom.xml‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ src‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __rootArtifactId__-core‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __parentArtifactId__-core.iml‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ pom.xml‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ src‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __rootArtifactId__-server‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __parentArtifactId__-server.iml‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ pom.xml‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ src‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __rootArtifactId__-test‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ __parentArtifactId__-test.iml‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ pom.xml‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ src‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ pom.xml‚îÇ ‚îî‚îÄ‚îÄ test‚îÇ ‚îî‚îÄ‚îÄ resources‚îÇ ‚îî‚îÄ‚îÄ projects‚îÇ ‚îî‚îÄ‚îÄ basic‚îÇ ‚îú‚îÄ‚îÄ archetype.properties‚îÇ ‚îî‚îÄ‚îÄ goal.txt Âú®ËÑöÊâãÊû∂Â∑•Á®ãÁõÆÂΩï‰∏ãÊâßË°å mvn install Â∞±ÂÆåÊàê‰∫ÜËÑöÊâãÊû∂ÁöÑÊú¨Âú∞ÂÆâË£ÖÔºåÂÆâË£ÖÂÆåÊàê‰πãÂêéÔºåËøô‰∏™ËÑöÊâãÊû∂Âú®Êú¨Âú∞Â∞±ÂèØ‰ª•‰ΩøÁî®‰∫ÜÂèØ‰ª•ÊâßË°å‰ª•‰∏ãËÑöÊú¨Êù•ÈÄöËøáÊ≠§ËÑöÊâãÊû∂ÂàõÂª∫È°πÁõÆ 1mvn archetype:generate -DgroupId=com.xxx.example -DartifactId=xxxx -Dpackage=com.xxx.example -DarchetypeGroupId=com.demo.archetype -DarchetypeArtifactId=demo-archetype -DarchetypeVersion=1.0.0-SNAPSHOT -DinteractiveMode=false Êâ´Âùë‰∏çËøáÂ¶ÇÊûúÊàë‰ª¨Áõ¥Êé•ËøôÊ†∑‰ΩøÁî®ÁöÑËØùÔºå‰ºöÂèëÁé∞ÁîüÊàê‰∫ÜÂæàÂ§öÊàë‰ª¨Âπ∂‰∏çÊÉ≥Ë¶ÅÂÆÉÂá∫Áé∞ÁöÑÊñá‰ª∂ÔºåÊØîÂ¶Ç .idea .iml Êñá‰ª∂Á≠âÁ≠âÔºåÂπ∂‰∏î .gitignore Êñá‰ª∂‰πüËØ°ÂºÇÁöÑÊ∂àÂ§±‰∫ÜÔºà‰∏çÁü•‰∏∫‰Ωï‰ºöÂøΩÁï•Ëøô‰∏™Êñá‰ª∂ÔºüÔºüÔºâ‚Ä¶ ËøôÊòæÁÑ∂‰∏çÊòØÊàêÁÜüÁöÑËÑöÊâãÊû∂‰∫Ü„ÄÇÈÇ£‰πàÂ∞±ÈúÄË¶ÅÂØπÂÆÉÂÅö‰∏Ä‰∫õÈ¢ùÂ§ñÁöÑÈÖçÁΩÆ‰∫Ü Êúâ‰∏§ÁßçÊñπÂºèÂèØ‰ª•Ëß£ÂÜ≥‰∏äÈù¢Âá∫Áé∞ÁöÑÈóÆÈ¢ò Â∞Ü .gitignoreÊñá‰ª∂ÈáçÂëΩÂêç‰∏∫ gitignoreÔºåÁÑ∂ÂêéÂú®Ê®°ÊùøÂ∑•Á®ãÊ†πÁõÆÂΩï‰∏ãÊñ∞Âª∫ archetype.properties Êñá‰ª∂ÔºåÂπ∂Â°´ÂÖ•‰ª•‰∏ãÂÜÖÂÆπ 1234## generate for archetype-metadata.xmlexcludePatterns=archetype.properties,*.iml,.idea/,.idea/libraries,logs/,build.sh## generate .gitignore filegitignore=.gitignore ÂÆåÊàê‰∏äËø∞ÈÖçÁΩÆÂêéÔºåÈáçÊñ∞ÊâßË°å mvn archetype:create-from-project ÁîüÊàêËÑöÊâãÊû∂Â∑•Á®ã„ÄÇÂÜçÂÆåÊàêÊú¨Âú∞ÂÆâË£ÖÔºå‰∏äÈù¢Âá∫Áé∞ÁöÑÈóÆÈ¢òÂ∞±‰ºöËß£ÂÜ≥ Á¨¨‰∫åÁßçÊñπÂºèÊú¨Ë¥®‰∏äÂíåÁ¨¨‰∏ÄÁßçÊñπÂºèÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂè™ÊòØÁ¨¨‰∫åÁßçÊñπÂºèÊòØÁõ¥Êé•‰øÆÊîπËÑöÊâãÊû∂Â∑•Á®ãÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÇÁ¨¨‰∏ÄÁßçÊñπÂºèÁõ∏ÂΩì‰∫éÊòØÊâßË°å mvn archetype:create-from-project Êó∂ËØªÂèñ‰∫Ü archetype.properties Â∏ÆÊàë‰ª¨ÂÅö‰∫ÜÈÖçÁΩÆÊñá‰ª∂ÁöÑ‰øÆÊîπ„ÄÇ mavenÁöÑËÑöÊâãÊû∂Â∑•Á®ã‰∏ãÊúâ‰∏§‰∏™ÈáçË¶ÅÁöÑÈÖçÁΩÆÊñá‰ª∂ ./src/test/resources/projects/basic/archetype.properties ËøôÈáåÂèØ‰ª•Âä†ÂÖ•Ëá™ÂÆö‰πâÂèòÈáèÔºåÂ¶Ç gitignore ÂèòÈáè ./src/main/resources/META-INF/maven/archetype-metadata.xml ‰∏ãÈù¢ÊòØ‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑarchetype-metadata.xmlÊñá‰ª∂ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;archetype-descriptor xsi:schemaLocation="http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0 http://maven.apache.org/xsd/archetype-descriptor-1.0.0.xsd" name="example" xmlns="http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt; &lt;requiredProperties&gt; &lt;requiredProperty key="gitignore"&gt; &lt;defaultValue&gt;.gitignore&lt;/defaultValue&gt; &lt;/requiredProperty&gt; &lt;requiredProperty key="port"&gt; &lt;defaultValue&gt;8888&lt;/defaultValue&gt; &lt;/requiredProperty&gt; &lt;/requiredProperties&gt; &lt;fileSets&gt; &lt;fileSet encoding="UTF-8" filtered="true"&gt; &lt;directory&gt;&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;__gitignore__&lt;/include&gt; &lt;include&gt;README.md&lt;/include&gt; &lt;include&gt;Jenkinsfile&lt;/include&gt; &lt;include&gt;pom.xml&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;/fileSets&gt; &lt;modules&gt; &lt;module id="$&#123;rootArtifactId&#125;-client" dir="__rootArtifactId__-client" name="$&#123;rootArtifactId&#125;-client"&gt; &lt;fileSets&gt; &lt;fileSet filtered="true" packaged="true" encoding="UTF-8"&gt; &lt;directory&gt;src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.java&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;/fileSets&gt; &lt;/module&gt; &lt;module id="$&#123;rootArtifactId&#125;-core" dir="__rootArtifactId__-core" name="$&#123;rootArtifactId&#125;-core"&gt; &lt;fileSets&gt; &lt;fileSet filtered="true" packaged="true" encoding="UTF-8"&gt; &lt;directory&gt;src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.java&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;fileSet filtered="true" encoding="UTF-8"&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;/fileSets&gt; &lt;/module&gt; &lt;module id="$&#123;rootArtifactId&#125;-server" dir="__rootArtifactId__-server" name="$&#123;rootArtifactId&#125;-server"&gt; &lt;fileSets&gt; &lt;fileSet filtered="true" packaged="true" encoding="UTF-8"&gt; &lt;directory&gt;src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.java&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;fileSet filtered="true" encoding="UTF-8"&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;fileSet filtered="true" encoding="UTF-8"&gt; &lt;directory&gt;src/main/resources/META-INF/dubbo&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;*&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;fileSet filtered="true" encoding="UTF-8"&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.yml&lt;/include&gt; &lt;/includes&gt; &lt;/fileSet&gt; &lt;/fileSets&gt; &lt;/module&gt; &lt;module id="$&#123;rootArtifactId&#125;-test" dir="__rootArtifactId__-test" name="$&#123;rootArtifactId&#125;-test"&gt; &lt;fileSets&gt; &lt;/fileSets&gt; &lt;/module&gt; &lt;/modules&gt;&lt;/archetype-descriptor&gt; archetype-metadata.xml ÁªìÊûÑÁÆÄÂçï‰ªãÁªçarchetype-metadata.xmlÊñá‰ª∂ÁöÑÂü∫Êú¨ÁªìÊûÑ &lt;requiredProperties&gt;ÊòØÂ±ûÊÄßÂèòÈáèÂÆö‰πâÂ±ÇÔºåÂú®ËøôÈáåÂÆö‰πâÁöÑÂèòÈáèÂèØ‰ª•Âú®archetypeÂ∑•Á®ãÊñá‰ª∂‰∏≠ÈÄöËøá ${xxx} Êù•ËøõË°åÂºïÁî®ÔºåÊñá‰ª∂ÂêçÂàôÂèØ‰ª•ÈÄöËøá __xxx__Êù•ÂºïÁî®ÂèòÈáèÔºàËøôÂ∞±ÊòØ‰∏∫‰ªÄ‰πàË¶ÅÊää.gitignoreÈáçÂëΩÂêç‰∏∫__gitignore__Ôºâ„ÄÇÂèòÈáèÂú®ÊâßË°å mvn archetype:generateÊó∂ÊâçÂΩïÂÖ•ÁúüÊ≠£ÂÜÖÂÆπ ÂÜçÂæÄ‰∏ãÂÖ∂ÂÆûÂ∞±ÊòØÂÆö‰πâÂ∞ÜË¶ÅÁîüÊàêÁöÑÂ∑•Á®ãÁõÆÂΩïÁªìÊûÑÔºåÈ¶ñÂÖàÊòØ‰∏Ä‰∏™ fileSets ÔºàÂåÖÂê´Â§ö‰∏™ fileSetÊ†áÁ≠æÔºâÊ†áÁ≠æÂÆö‰πâ‰∫ÜÊ†πÁõÆÂΩïÈúÄË¶ÅÁîüÊàêÂì™‰∫õÊñá‰ª∂ÔºåÂÜçÈÄöËøáÂ§ö‰∏™modules Ê†áÁ≠æÊù•ÂÆö‰πâÂ§ö‰∏™Â≠êÊ®°ÂùóÔºàÂ¶ÇÊûúÊòØÂ§öÊ®°ÂùóÂ∑•Á®ãÁöÑËØùÔºâ„ÄÇËøôÂÖ∂‰∏≠ÊØîËæÉÈáçË¶ÅÁöÑÂÖ∂ÂÆûËøòÊòØ fileSetÊ†áÁ≠æÔºåfileSetÊúâ‰∏§‰∏™ÈáçË¶ÅÁöÑÂ±ûÊÄß filtered = true Â¶ÇÊûú‰∏∫trueÔºåÂàôËØ• fileSetÂåÖÂê´ÁöÑÊñá‰ª∂‰∏≠ÁöÑ${} Âç†‰ΩçÁ¨¶‰ºöË¢´ÊõøÊç¢ÊàêÁõ∏Â∫îÁöÑÂèòÈáè packaged = true Â¶ÇÊûú‰∏∫trueÔºåÂàô src/main/java ‰∏ãÂæóÊñá‰ª∂ÂÜÖÂÆπ‰ºöË¢´Âä†ÂÖ• ÊåáÂÆöÂåÖË∑ØÂæÑ‰∏ã ÊÄªÁªì‰∏Ä‰∏™‰ºòÁßÄÂ∞ëÂùëÁöÑËÑöÊâãÊû∂ËøòÊòØËÉΩÊûÅÂ§ßÁöÑÊèêÂçáÁîü‰∫ßÂäõÁöÑÔºåÊØïÁ´üËøôÁßçÈáçÂ§ç‰∏îÊó†‰ª∑ÂÄºÁöÑÂä≥Âä®Êàë‰ª¨ËøòÊòØ‰∫§ÁªôÂ∑•ÂÖ∑Âêß]]></content>
      <categories>
        <category>maven</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SentinelÊ∫êÁ†ÅËß£Êûê‰∏âÔºàÊªëÂä®Á™óÂè£ÊµÅÈáèÁªüËÆ°Ôºâ]]></title>
    <url>%2F2019%2F10%2F25%2FSentinel%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%89%EF%BC%88%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%B5%81%E9%87%8F%E7%BB%9F%E8%AE%A1%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂâçË®ÄSentinelÁöÑÊ†∏ÂøÉÂäüËÉΩ‰πã‰∏ÄÊòØÊµÅÈáèÁªüËÆ°Ôºå‰æãÂ¶ÇÊàë‰ª¨Â∏∏Áî®ÁöÑÊåáÊ†áQPSÔºåÂΩìÂâçÁ∫øÁ®ãÊï∞Á≠â„ÄÇ‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠Êàë‰ª¨Â∑≤ÁªèÂ§ßËá¥ÊèêÂà∞‰∫ÜÊèê‰æõÊï∞ÊçÆÁªüËÆ°ÂäüËÉΩÁöÑSlotÔºàStatisticSlotÔºâÔºåStatisticSlotÂú®SentinelÁöÑÊï¥‰∏™‰ΩìÁ≥ª‰∏≠ÊâÆÊºî‰∫Ü‰∏Ä‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑËßíËâ≤ÔºåÂêéÁª≠ÁöÑ‰∏ÄÁ≥ªÂàóÊìç‰ΩúÔºàÈôêÊµÅÔºåÁÜîÊñ≠ÔºâÁ≠âÈÉΩ‰æùËµñ‰∫éStatisticSlotÊâÄÁªüËÆ°Âá∫ÁöÑÊï∞ÊçÆ„ÄÇ Êú¨ÊñáÊâÄË¶ÅËÆ®ËÆ∫ÁöÑÈáçÁÇπÂ∞±ÊòØStatisticSlotÊòØÂ¶Ç‰ΩïÂÅöÁöÑÊµÅÈáèÁªüËÆ°Ôºü ÂÖ∂ÂÆûÂú®‰πãÂâç‰ªãÁªçÂ∏∏Áî®ÈôêÊµÅÁÆóÊ≥ïÂ∏∏Áî®ÈôêÊµÅÁÆóÊ≥ïÁöÑÊó∂ÂÄôÂ∑≤ÁªèÊúâÊèêÂà∞Ëøá‰∏Ä‰∏™ÁÆóÊ≥ïÊªëÂä®Á™óÂè£ÈôêÊµÅÔºåËØ•ÁÆóÊ≥ïÁöÑÊªëÂä®Á™óÂè£ÂéüÁêÜÂÖ∂ÂÆûË∑üSentinelÊâÄÊèê‰æõÁöÑÊµÅÈáèÁªüËÆ°ÂéüÁêÜÊòØ‰∏ÄÊ†∑ÁöÑÔºåÈÉΩÊòØÂü∫‰∫éÊó∂Èó¥Á™óÂè£ÁöÑÊªëÂä®ÁªüËÆ° ÂõûÂà∞StatisticSlot12345678910public void entry(Context context, ResourceWrapper resourceWrapper, DefaultNode node, int count, boolean prioritized, Object... args) throws Throwable &#123; ... // ÂΩìÂâçËØ∑Ê±ÇÁ∫øÁ®ãÊï∞Âä†‰∏Ä node.increaseThreadNum(); // Êñ∞Â¢ûËØ∑Ê±ÇÊï∞ node.addPassRequest(count); ...&#125; ÂèØ‰ª•ÁúãÂà∞StatisticSlot‰∏ªË¶ÅÁªüËÆ°‰∫Ü‰∏§ÁßçÁ±ªÂûãÁöÑÊï∞ÊçÆ Á∫øÁ®ãÊï∞ ËØ∑Ê±ÇÊï∞ÔºàQPSÔºâ ÂØπ‰∫éÁ∫øÁ®ãÊï∞ÁöÑÁªüËÆ°ÊØîËæÉÁÆÄÂçïÔºåÈÄöËøáÂÜÖÈÉ®Áª¥Êä§‰∏Ä‰∏™LongAdderÊù•ËøõË°åÂΩìÂâçÁ∫øÁ®ãÊï∞ÁöÑÁªüËÆ°ÔºåÊØèËøõÂÖ•‰∏Ä‰∏™ËØ∑Ê±ÇÂä†1ÔºåÊØèÈáäÊîæ‰∏Ä‰∏™ËØ∑Ê±ÇÂáè1Ôºå‰ªéËÄåÂæóÂà∞ÂΩìÂâçÁöÑÁ∫øÁ®ãÊï∞ ÂØπ‰∫éËØ∑Ê±ÇÊï∞QPSÁöÑÁªüËÆ°ÂàôÁõ∏ÂØπÊØîËæÉÂ§çÊùÇÔºåÂÖ∂‰∏≠ÊúâÁî®Âà∞ÊªëÂä®Á™óÂè£ÂéüÁêÜÔºà‰πüÊòØÊú¨ÊñáÁöÑÈáçÁÇπÔºâÔºå‰∏ãÈù¢Ê†πÊçÆÊ∫êÁ†ÅÊù•Ê∑±ÂÖ•ÁöÑÂàÜÊûê DefaultNode Âíå StatisticNode123456public void addPassRequest(int count) &#123; // Ë∞ÉÁî®Áà∂Á±ªÔºàStatisticNodeÔºâÊù•ËøõË°åÁªüËÆ° super.addPassRequest(count); // Ê†πÊçÆclusterNode Ê±áÊÄªÁªüËÆ°ÔºàËÉåÂêé‰πüÊòØË∞ÉÁî®Áà∂Á±ªStatisticNodeÔºâ this.clusterNode.addPassRequest(count);&#125; ÊúÄÁªàÈÉΩÊòØË∞ÉÁî®‰∫ÜÁà∂Á±ªStatisticNodeÁöÑaddPassRequestÊñπÊ≥ï 123456789101112131415/** * ÊåâÁßíÁªüËÆ°ÔºåÂàÜÊàê‰∏§‰∏™Á™óÂè£ÔºåÊØè‰∏™Á™óÂè£500msÔºåÁî®Êù•ÁªüËÆ°QPS */private transient volatile Metric rollingCounterInSecond = new ArrayMetric(SampleCountProperty.SAMPLE_COUNT, IntervalProperty.INTERVAL);/** * ÊåâÂàÜÈíüÁªüËÆ°ÔºåÂàÜÊàê60‰∏™Á™óÂè£ÔºåÊØè‰∏™Á™óÂè£ 1000ms */private transient Metric rollingCounterInMinute = new ArrayMetric(60, 60 * 1000, false);public void addPassRequest(int count) &#123; rollingCounterInSecond.addPass(count); rollingCounterInMinute.addPass(count);&#125; ‰ª£Á†ÅÊØîËæÉÁÆÄÂçïÔºåÂèØ‰ª•Áü•ÈÅìÂÜÖÈÉ®ÊòØË∞ÉÁî®‰∫ÜArrayMetricÁöÑaddPassÊñπÊ≥ïÊù•ÁªüËÆ°ÁöÑÔºåÂπ∂‰∏îÁªüËÆ°‰∫Ü‰∏§Áßç‰∏çÂêåÊó∂Èó¥Áª¥Â∫¶ÁöÑÊï∞ÊçÆ(ÁßíÁ∫ßÂíåÂàÜÈíüÁ∫ß) ArrayMetric1234567891011121314151617181920private final LeapArray&lt;MetricBucket&gt; data;public ArrayMetric(int sampleCount, int intervalInMs) &#123; this.data = new OccupiableBucketLeapArray(sampleCount, intervalInMs);&#125;public ArrayMetric(int sampleCount, int intervalInMs, boolean enableOccupy) &#123; if (enableOccupy) &#123; this.data = new OccupiableBucketLeapArray(sampleCount, intervalInMs); &#125; else &#123; this.data = new BucketLeapArray(sampleCount, intervalInMs); &#125;&#125;public void addPass(int count) &#123; // 1. Ëé∑ÂèñÂΩìÂâçÁ™óÂè£ WindowWrap&lt;MetricBucket&gt; wrap = data.currentWindow(); // 2. ÂΩìÂâçÁ™óÂè£Âä†1 wrap.value().addPass(count);&#125; ArrayMetricÂÖ∂ÂÆû‰πüÊòØ‰∏Ä‰∏™ÂåÖË£ÖÁ±ªÔºåÂÜÖÈÉ®ÈÄöËøáÂÆû‰æãÂåñLeapArrayÁöÑÂØπÂ∫îÂÆûÁé∞Á±ªÔºåÊù•ÂÆûÁé∞ÂÖ∑‰ΩìÁöÑÁªüËÆ°ÈÄªËæëÔºåLeapArrayÊòØ‰∏Ä‰∏™ÊäΩË±°Á±ªÔºåOccupiableBucketLeapArrayÂíåBucketLeapArrayÈÉΩÊòØÂÖ∂ÂÖ∑‰ΩìÁöÑÂÆûÁé∞Á±ªOccupiableBucketLeapArrayÂú®1.5ÁâàÊú¨‰πãÂêéÊâçË¢´ÂºïÂÖ•Ôºå‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜËß£ÂÜ≥‰∏Ä‰∫õÈ´ò‰ºòÂÖàÁ∫ßÁöÑËØ∑Ê±ÇÂú®ÈôêÊµÅËß¶ÂèëÁöÑÊó∂ÂÄô‰πüËÉΩÈÄöËøá(ÈÄöËøáÂç†Áî®Êú™Êù•Êó∂Èó¥Á™óÂè£ÁöÑÂêçÈ¢ùÊù•ÂÆûÁé∞) ‰πüÊòØÈªòËÆ§‰ΩøÁî®ÁöÑLeapArrayÂÆûÁé∞Á±ª ËÄåÁªüËÆ°ÁöÑÈÄªËæë‰πüÊØîËæÉÊ∏ÖÊ•öÔºåÂàÜÊàê‰∫Ü‰∏§Ê≠•Ôºö ÂÆö‰ΩçÂà∞ÂΩìÂâçÁ™óÂè£ Ëé∑ÂèñÂà∞ÂΩìÂâçÁ™óÂè£WindowWrapÁöÑMetricBucketÂπ∂ÊâßË°åaddPassÈÄªËæë ËøôÈáåÊàë‰ª¨ÂÖàÁúã‰∏ãÁ¨¨‰∫åÊ≠•‰∏≠ÁöÑMetricBucketÁ±ªÔºåÁúãÁúãÂÆÉÂÅö‰∫ÜÂì™‰∫õ‰∫ãÊÉÖ MetricBucket1234567891011121314151617181920212223242526272829/** * Â≠òÊîæÂΩìÂâçÁ™óÂè£ÂêÑÁßçÁ±ªÂûãÁöÑÁªüËÆ°ÂÄº(Á±ªÂûãÂåÖÊã¨ PASS BLOCK EXCEPTION Á≠â) */private final LongAdder[] counters;public MetricBucket() &#123; MetricEvent[] events = MetricEvent.values(); this.counters = new LongAdder[events.length]; for (MetricEvent event : events) &#123; counters[event.ordinal()] = new LongAdder(); &#125; initMinRt();&#125;// ÁªüËÆ°passÊï∞public void addPass(int n) &#123; add(MetricEvent.PASS, n);&#125;// ÁªüËÆ°ÂèØÂç†Áî®ÁöÑpassÊï∞public void addOccupiedPass(int n) &#123; add(MetricEvent.OCCUPIED_PASS, n);&#125;// ÁªüËÆ°ÂºÇÂ∏∏Êï∞public void addException(int n) &#123; add(MetricEvent.EXCEPTION, n);&#125;// ÁªüËÆ°blockÊï∞public void addBlock(int n) &#123; add(MetricEvent.BLOCK, n);&#125;.... MetricBucketÈÄöËøáÂÆö‰πâ‰∫Ü‰∏Ä‰∏™LongAdderÊï∞ÁªÑÊù•Â≠òÂÇ®‰∏çÂêåÁ±ªÂûãÁöÑÊµÅÈáèÁªüËÆ°ÂÄºÔºåÂÖ∑‰ΩìÁöÑÁ±ªÂûãÂàôÈÉΩÂÆö‰πâÂú®MetricEventÊûö‰∏æ‰∏≠„ÄÇÊâßË°åaddPassÊñπÊ≥ïÂØπÂ∫îLongAdderÊï∞ÁªÑÁ¥¢Âºï‰∏ãË°®‰∏∫0ÁöÑÂÄºÈÄíÂ¢û ‰∏ãÈù¢ÂÜçÊù•Áúã‰∏ãdata.currentWindow()ÁöÑÂÜÖÈÉ®ÈÄªËæë OccupiableBucketLeapArrayOccupiableBucketLeapArrayÁªßÊâø‰∫ÜÊäΩË±°Á±ªLeapArrayÔºåÊ†∏ÂøÉÈÄªËæë‰πüÊòØÂú®LeapArray‰∏≠ 12345678910111213141516171819202122232425262728293031323334353637383940/** * Êó∂Èó¥Á™óÂè£Â§ßÂ∞è Âçï‰Ωçms */protected int windowLengthInMs;/** * ÂàáÂàÜÁöÑÁ™óÂè£Êï∞ */protected int sampleCount;/** * ÁªüËÆ°ÁöÑÊó∂Èó¥Èó¥Èöî intervalInMs = windowLengthInMs * sampleCount */ protected int intervalInMs;/** * Á™óÂè£Êï∞ÁªÑ Êï∞ÁªÑÂ§ßÂ∞è = sampleCount */protected final AtomicReferenceArray&lt;WindowWrap&lt;T&gt;&gt; array;/** * update lock Êõ¥Êñ∞Á™óÂè£Êó∂ÈúÄË¶Å‰∏äÈîÅ */private final ReentrantLock updateLock = new ReentrantLock();/** * @param sampleCount ÈúÄË¶ÅÂàíÂàÜÁöÑÁ™óÂè£Êï∞ * @param intervalInMs Èó¥ÈöîÁöÑÁªüËÆ°Êó∂Èó¥ */public LeapArray(int sampleCount, int intervalInMs) &#123; this.windowLengthInMs = intervalInMs / sampleCount; this.intervalInMs = intervalInMs; this.sampleCount = sampleCount; this.array = new AtomicReferenceArray&lt;&gt;(sampleCount);&#125;/** * Ëé∑ÂèñÂΩìÂâçÁ™óÂè£ */public WindowWrap&lt;T&gt; currentWindow() &#123; return currentWindow(TimeUtil.currentTimeMillis());&#125; ‰ª•‰∏äÈúÄË¶ÅÁùÄÈáçÁêÜËß£ÁöÑÊòØÂá†‰∏™ÂèÇÊï∞ÁöÑÂê´‰πâÔºö sampleCount ÂÆö‰πâÁöÑÁ™óÂè£ÁöÑÊï∞ intervalInMs ÁªüËÆ°ÁöÑÊó∂Èó¥Èó¥Èöî windowLengthInMs ÊØè‰∏™Á™óÂè£ÁöÑÊó∂Èó¥Â§ßÂ∞è = intervalInMs / sampleCount sampleCount ÊØîËæÉÂ•ΩÁêÜËß£ÔºåÂ∞±ÊòØÈúÄË¶ÅÂÆö‰πâÂá†‰∏™Á™óÂè£ÔºàÈªòËÆ§ÁßíÁ∫ßÁªüËÆ°Áª¥Â∫¶ÁöÑËØùÊòØ‰∏§‰∏™Á™óÂè£ÔºâÔºåintervalInMs ÊåáÁöÑÂ∞±ÊòØÊàë‰ª¨ÈúÄË¶ÅÁªüËÆ°ÁöÑÊó∂Èó¥Èó¥ÈöîÔºå‰æãÂ¶ÇÊàë‰ª¨ÁªüËÆ°QPSÁöÑËØùÈÇ£Â∞±ÊòØ1000msÔºåwindowLengthInMs ÊåáÁöÑÊØè‰∏™Á™óÂè£ÁöÑÂ§ßÂ∞èÔºåÊòØÁî±intervalInMsÈô§‰ª•sampleCountÂæóÊù• Á±ª‰ºº‰∏ãÂõæÔøº ÁêÜËß£‰∫Ü‰∏äËØâÂá†‰∏™ÂèÇÊï∞ÁöÑÂê´‰πâÂêéÔºåÊàë‰ª¨Áõ¥Êé•ËøõÂÖ•Âà∞LeapArrayÁöÑcurrentWindow(long time)ÊñπÊ≥ï‰∏≠ÂéªÁúãÁúãÂÖ∑‰ΩìÁöÑÂÆûÁé∞ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public WindowWrap&lt;T&gt; currentWindow(long timeMillis) &#123; if (timeMillis &lt; 0) &#123; return null; &#125; // Ê†πÊçÆÂΩìÂâçÊó∂Èó¥Êà≥ËÆ°ÁÆóÂΩìÂâçÊâÄÂ±ûÁöÑÁ™óÂè£Êï∞ÁªÑÁ¥¢Âºï‰∏ãÊ†á int idx = calculateTimeIdx(timeMillis); // ËÆ°ÁÆóÂΩìÂâçÁ™óÂè£ÁöÑÂºÄÂßãÊó∂Èó¥Êà≥ long windowStart = calculateWindowStart(timeMillis); /* * ‰ªéÁ™óÂè£Êï∞ÁªÑ‰∏≠Ëé∑ÂèñÂΩìÂâçÁ™óÂè£È°πÔºåÂàÜ‰∏∫‰∏âÁßçÊÉÖÂÜµ * * (1) ÂΩìÂâçÁ™óÂè£‰∏∫Á©∫ËøòÊú™ÂàõÂª∫ÔºåÂàôÂàùÂßãÂåñ‰∏Ä‰∏™ * (2) ÂΩìÂâçÁ™óÂè£ÁöÑÂºÄÂßãÊó∂Èó¥Âíå‰∏äÈù¢ËÆ°ÁÆóÂá∫ÁöÑÁ™óÂè£ÂºÄÂßãÊó∂Èó¥‰∏ÄËá¥ÔºåË°®ÊòéÂΩìÂâçÁ™óÂè£ËøòÊú™ËøáÊúüÔºåÁõ¥Êé•ËøîÂõûÂΩìÂâçÁ™óÂè£ * (3) ÂΩìÂâçÁ™óÂè£ÁöÑÂºÄÂßãÊó∂Èó¥ Â∞è‰∫é ‰∏äÈù¢ËÆ°ÁÆóÂá∫ÁöÑÁ™óÂè£ÂºÄÂßãÊó∂Èó¥ÔºåË°®ÊòéÂΩìÂâçÁ™óÂè£Â∑≤ËøáÊúüÔºåÈúÄË¶ÅÊõøÊç¢ÂΩìÂâçÁ™óÂè£ */ while (true) &#123; WindowWrap&lt;T&gt; old = array.get(idx); if (old == null) &#123; /* * Á¨¨‰∏ÄÁßçÊÉÖÂÜµÔºåÊñ∞Âª∫‰∏Ä‰∏™Á™óÂè£È°π */ WindowWrap&lt;T&gt; window = new WindowWrap&lt;T&gt;(windowLengthInMs, windowStart, newEmptyBucket(timeMillis)); if (array.compareAndSet(idx, null, window)) &#123; // Successfully updated, return the created bucket. return window; &#125; else &#123; // Contention failed, the thread will yield its time slice to wait for bucket available. Thread.yield(); &#125; &#125; else if (windowStart == old.windowStart()) &#123; /* * Á¨¨‰∫åÁßçÊÉÖÂÜµ Áõ¥Êé•ËøîÂõû */ return old; &#125; else if (windowStart &gt; old.windowStart()) &#123; /* * Á¨¨‰∏âÁßçÊÉÖÂÜµ ÊõøÊç¢Á™óÂè£ */ if (updateLock.tryLock()) &#123; try &#123; // Successfully get the update lock, now we reset the bucket. return resetWindowTo(old, windowStart); &#125; finally &#123; updateLock.unlock(); &#125; &#125; else &#123; // Contention failed, the thread will yield its time slice to wait for bucket available. Thread.yield(); &#125; &#125; else if (windowStart &lt; old.windowStart()) &#123; // Á¨¨ÂõõÁßçÊÉÖÂÜµÔºåËÆ≤ÈÅìÁêÜ‰∏ç‰ºöËµ∞Âà∞ËøôÈáå return new WindowWrap&lt;T&gt;(windowLengthInMs, windowStart, newEmptyBucket(timeMillis)); &#125; &#125;&#125;/** * Ê†πÊçÆÂΩìÂâçÊó∂Èó¥Êà≥ËÆ°ÁÆóÂΩìÂâçÊâÄÂ±ûÁöÑÁ™óÂè£Êï∞ÁªÑÁ¥¢Âºï‰∏ãÊ†á */private int calculateTimeIdx(/*@Valid*/ long timeMillis) &#123; long timeId = timeMillis / windowLengthInMs; return (int)(timeId % array.length());&#125;/** * ËÆ°ÁÆóÂΩìÂâçÁ™óÂè£ÁöÑÂºÄÂßãÊó∂Èó¥Êà≥ */protected long calculateWindowStart(/*@Valid*/ long timeMillis) &#123; return timeMillis - timeMillis % windowLengthInMs;&#125; ‰∏äÈù¢ÁöÑÊñπÊ≥ïÂ∞±ÊòØÊï¥‰∏™ÊªëÂä®Á™óÂè£ÈÄªËæëÁöÑÊ†∏ÂøÉ‰ª£Á†ÅÔºåÊ≥®ÈáäÂÖ∂ÂÆû‰πüÂÜôÁöÑÊØîËæÉÊ∏ÖÊô∞‰∫ÜÔºåÁÆÄÂçïÊ¶ÇÊã¨‰∏ãÂèØ‰ª•ÂàÜ‰∏∫‰ª•‰∏ãÂá†Ê≠•Ôºö Ê†πÊçÆÂΩìÂâçÊó∂Èó¥Êà≥ Âíå Á™óÂè£Êï∞ÁªÑÂ§ßÂ∞è Ëé∑ÂèñÂà∞ÂΩìÂâçÁöÑÁ™óÂè£Êï∞ÁªÑÁ¥¢Âºï‰∏ãÊ†áidxÔºåÂ¶ÇÊûúÁ™óÂè£Êï∞ÊòØ2ÔºåÈÇ£ÂÖ∂ÂÆûidxÂè™Êúâ‰∏§ÁßçÂÄº(0 Êàñ 1) Ê†πÊçÆÂΩìÂâçÊó∂Èó¥Êà≥ÔºàwindowStartÔºâ ËÆ°ÁÆóÂæóÂà∞ÂΩìÂâçÁ™óÂè£ÁöÑÂºÄÂßãÊó∂Èó¥Êà≥ÂÄº„ÄÇÈÄöËøácalculateWindowStartËÆ°ÁÆóÊù•ÂæóÂà∞ÔºåËøô‰∏™ÊñπÊ≥ïËøòËõÆÊúâÊÑèÊÄùÁöÑÔºåÈÄöËøáÂΩìÂâçÊó∂Èó¥Êà≥ÂíåÁ™óÂè£Êó∂Èó¥Â§ßÂ∞èÂèñ‰ΩôÊù•ÂæóÂà∞ ‰∏éÂΩìÂâçÁ™óÂè£ÂºÄÂßãÊó∂Èó¥ÁöÑ ÂÅèÁßªÈáè„ÄÇÊØîÊàëÁî®ÂÆöÊó∂‰ªªÂä°ÂÆûÁé∞È´òÁ∫ßÂ§ö‰∫Ü ‚Ä¶ üòÜ ÂèØ‰ª•ÂéªÂØπÊØî‰∏Ä‰∏ãÊàë‰πãÂâçÊñáÁ´†‰∏≠ÁöÑË†¢ÂÆûÁé∞ ÊªëÂä®Á™óÂè£ÁÆóÊ≥ïÂÆöÊó∂‰ªªÂä°ÂÆûÁé∞ ÁÑ∂ÂêéÂ∞±ÊòØÊ†πÊçÆ‰∏äÈù¢ÂæóÂà∞ÁöÑ‰∏§‰∏™ÂÄº Êù•Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥Á™óÂè£ÔºåËøôÈáåÂÖ∂ÂÆûÂèàÂàÜ‰∏∫‰∏âÁßçÊÉÖÂÜµ ÂΩìÂâçÁ™óÂè£‰∏∫Á©∫ËøòÊú™ÂàõÂª∫ÔºåÂàôÂàùÂßãÂåñ‰∏Ä‰∏™ ÂΩìÂâçÁ™óÂè£ÁöÑÂºÄÂßãÊó∂Èó¥Âíå‰∏äÈù¢ËÆ°ÁÆóÂá∫ÁöÑÁ™óÂè£ÂºÄÂßãÊó∂Èó¥(windowStart)‰∏ÄËá¥ÔºåË°®ÊòéÂΩìÂâçÁ™óÂè£ËøòÊú™ËøáÊúüÔºåÁõ¥Êé•ËøîÂõûÂΩìÂâçÁ™óÂè£ ÂΩìÂâçÁ™óÂè£ÁöÑÂºÄÂßãÊó∂Èó¥ Â∞è‰∫é ‰∏äÈù¢ËÆ°ÁÆóÂá∫ÁöÑÁ™óÂè£(windowStart)ÂºÄÂßãÊó∂Èó¥ÔºåË°®ÊòéÂΩìÂâçÁ™óÂè£Â∑≤ËøáÊúüÔºåÈúÄË¶ÅÊõøÊç¢ÂΩìÂâçÁ™óÂè£ ÊÄªÁªìÊÄªÁöÑÊù•ËØ¥ÔºåcurrentWindowÊñπÊ≥ïÁöÑÂÆûÁé∞ËøòÊòØÈùûÂ∏∏Â∑ßÂ¶ôÁöÑÔºåÂõ†‰∏∫ÊàëÂú®ÁúãSentinelÁöÑÊ∫êÁ†ÅÂâç‰πüÂÜôËøá‰∏ÄÁØáÈôêÊµÅÁÆóÊ≥ïÁöÑÊñáÁ´†ÔºåÊÅ∞Â•ΩÂÖ∂‰∏≠‰πüÂÆûÁé∞Ëøá‰∏Ä‰∏™ÊªëÂä®Á™óÂè£ÈôêÊµÅÁÆóÊ≥ïÔºå‰∏çËøáÁõ∏ÊØî‰∫éSentinelÁöÑÂÆûÁé∞ÔºåÊàëÁî®‰∫ÜÂÆöÊó∂‰ªªÂä°ÂéªÂÅöÁ™óÂè£ÁöÑÂàáÊç¢Êõ¥Êñ∞ÔºåÊòæÁÑ∂ÊÄßËÉΩ‰∏äÊõ¥Â∑ÆÔºåÂÆûÁé∞ÁöÑ‰πü‰∏ç‰ºòÈõÖÔºåÂ§ßÂÆ∂‰πüÂèØ‰ª•ÂéªÂØπÊØî‰∏Ä‰∏ã„ÄÇÂ∏∏Áî®ÈôêÊµÅÁÆóÊ≥ï SentinelÁ≥ªÂàó SentinelÊ∫êÁ†ÅËß£Êûê‰∏Ä SentinelÊ∫êÁ†ÅËß£Êûê‰∫åÔºàslotÊÄªËßàÔºâ SentinelÊ∫êÁ†ÅËß£Êûê‰∫åÔºàÊªëÂä®Á™óÂè£ÊµÅÈáèÁªüËÆ°Ôºâ]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Sentinel</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SentinelÊ∫êÁ†ÅËß£Êûê‰∫åÔºàslotÊÄªËßàÔºâ]]></title>
    <url>%2F2019%2F10%2F16%2FSentinel%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%BA%8C%EF%BC%88slot%E6%80%BB%E8%A7%88%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂÜôÂú®ÂâçÈù¢Êú¨ÊñáÁªßÁª≠Êù•ÂàÜÊûêSentinelÁöÑÊ∫êÁ†ÅÔºå‰∏äÁØáÊñáÁ´†ÂØπSentinelÁöÑË∞ÉÁî®ËøáÁ®ãÂÅö‰∫ÜÊ∑±ÂÖ•ÂàÜÊûêÔºå‰∏ªË¶ÅÊ∂âÂèäÂà∞‰∫Ü‰∏§‰∏™Ê¶ÇÂøµÔºöÊèíÊßΩÈìæÂíåNodeËäÇÁÇπ„ÄÇÈÇ£‰πàÊé•‰∏ãÊù•Êàë‰ª¨Â∞±Ê†πÊçÆÊèíÊßΩÈìæÁöÑË∞ÉÁî®ÂÖ≥Á≥ªÊù•‰æùÊ¨°ÂàÜÊûêÊØè‰∏™ÊèíÊßΩÔºàslotÔºâÁöÑÊ∫êÁ†Å„ÄÇ ÈªòËÆ§ÊèíÊßΩÈìæÁöÑË∞ÉÁî®È°∫Â∫èÔºå‰ª•ÂèäÊØèÁßçÁ±ªÂûãNodeËäÇÁÇπÁöÑÂÖ≥Á≥ªÈÉΩÂú®‰∏äÈù¢ÊñáÁ´†ÂºÄÂ§¥ÂàÜÊûêËøá NodeSelectorSlot123456789101112131415161718192021222324252627282930/** * Áõ∏ÂêåÁöÑËµÑÊ∫ê‰ΩÜÊòØContext‰∏çÂêåÔºåÂàÜÂà´Êñ∞Âª∫ DefaultNodeÔºåÂπ∂‰ª•ContextName‰∏∫key */private volatile Map&lt;String, DefaultNode&gt; map = new HashMap&lt;String, DefaultNode&gt;(10);public void entry(Context context, ResourceWrapper resourceWrapper, Object obj, int count, boolean prioritized, Object... args) throws Throwable &#123; // Ê†πÊçÆContextNameÂ∞ùËØïËé∑ÂèñDefaultNode DefaultNode node = map.get(context.getName()); if (node == null) &#123; synchronized (this) &#123; node = map.get(context.getName()); if (node == null) &#123; // ÂàùÂßãÂåñDefaultNodeÔºåÊØè‰∏™ContextÂØπÂ∫î‰∏Ä‰∏™ node = new DefaultNode(resourceWrapper, null); HashMap&lt;String, DefaultNode&gt; cacheMap = new HashMap&lt;String, DefaultNode&gt;(map.size()); cacheMap.putAll(map); cacheMap.put(context.getName(), node); map = cacheMap; &#125; // ÊûÑÂª∫ Node tree ((DefaultNode)context.getLastNode()).addChild(node); &#125; &#125; context.setCurNode(node); // Âî§ÈÜíÊâßË°å‰∏ã‰∏Ä‰∏™ÊèíÊßΩ fireEntry(context, resourceWrapper, node, count, prioritized, args);&#125; NodeSelectorSlotÈ°æÂêçÊÄù‰πâÊòØÁî®Êù•ÊûÑÂª∫NodeÁöÑ„ÄÇÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞NodeSelectorSlotÂØπ‰∫é‰∏çÂêåÁöÑ‰∏ä‰∏ãÊñáÈÉΩ‰ºöÁîüÊàê‰∏Ä‰∏™DefaultNode„ÄÇËøôÈáåËøòÊúâ‰∏Ä‰∏™Ë¶ÅÊ≥®ÊÑèÁöÑÁÇπÔºöÁõ∏ÂêåÁöÑËµÑÊ∫ê({@link ResourceWrapper#equals(Object)})Â∞ÜÂÖ®Â±ÄÂÖ±‰∫´Áõ∏ÂêåÁöÑ{@link ProcessorSlotChain}ÔºåÊó†ËÆ∫Âú®Âì™‰∏™‰∏ä‰∏ãÊñá‰∏≠ÔºåÂõ†Ê≠§‰∏çÂêåÁöÑ‰∏ä‰∏ãÊñáÂèØ‰ª•ËøõÂÖ•Âà∞Âêå‰∏Ä‰∏™ÂØπË±°ÁöÑNodeSelectorSlot.entryÊñπÊ≥ï‰∏≠ÔºåÈÇ£‰πàËøôÈáåË¶ÅÊÄé‰πàÂå∫ÂàÜ‰∏çÂêåÁöÑ‰∏ä‰∏ãÊñáÊâÄÂàõÂª∫ÁöÑËµÑÊ∫êNodeÂë¢ÔºüÊòæÁÑ∂ÂèØ‰ª•‰ΩøÁî®‰∏ä‰∏ãÊñáÂêçÁß∞‰Ωú‰∏∫Êò†Â∞ÑÈîÆ‰ª•Âå∫ÂàÜÁõ∏ÂêåÁöÑËµÑÊ∫êNode„ÄÇ ÁÑ∂ÂêéËøôÈáåË¶ÅËÄÉËôëÂè¶‰∏Ä‰∏™ÈóÆÈ¢ò„ÄÇ‰∏Ä‰∏™ËµÑÊ∫êÊúâÂèØËÉΩÂàõÂª∫Â§ö‰∏™DefaultNodeÔºàÊúâÂ§ö‰∏™‰∏ä‰∏ãÊñáÊó∂ÔºâÔºåÈÇ£‰πàÊàë‰ª¨Â∫îËØ•Â¶Ç‰ΩïÂø´ÈÄüÁöÑËé∑ÂèñÊÄªÁöÑÁªüËÆ°Êï∞ÊçÆÂë¢Ôºü Á≠îÊ°àÂ∞±Âú®‰∏ã‰∏Ä‰∏™Slot(ClusterBuilderSlot)‰∏≠Ë¢´Ëß£ÂÜ≥‰∫Ü„ÄÇ ClusterBuilderSlot‰∏äÈù¢ÊúâÊèêÂà∞‰∏Ä‰∏™ÈóÆÈ¢òÔºåÊàë‰ª¨Ë¶ÅÂ¶Ç‰ΩïÁªüËÆ°‰∏çÂêå‰∏ä‰∏ãÊñáÁõ∏ÂêåËµÑÊ∫êÁöÑÊÄªÈáèÊï∞ÊçÆ„ÄÇClusterBuilderSlotÁªô‰∫ÜÂæàÂ•ΩÁöÑËß£ÂÜ≥ÊñπÊ°àÔºöÂÖ∑ÊúâÁõ∏ÂêåËµÑÊ∫êÂêçÁß∞ÁöÑÂÖ±‰∫´‰∏Ä‰∏™ClusterNode„ÄÇ 1234567891011121314151617181920212223242526272829303132333435363738// Áõ∏ÂêåÁöÑËµÑÊ∫êÂÖ±‰∫´‰∏Ä‰∏™ ClusterNodeprivate static volatile Map&lt;ResourceWrapper, ClusterNode&gt; clusterNodeMap = new HashMap&lt;&gt;();private static final Object lock = new Object();private volatile ClusterNode clusterNode = null;@Overridepublic void entry(Context context, ResourceWrapper resourceWrapper, DefaultNode node, int count, boolean prioritized, Object... args) throws Throwable &#123; // Âà§Êñ≠Êú¨ËµÑÊ∫êÊòØÂê¶Â∑≤ÁªèÂàùÂßãÂåñËøáclusterNode if (clusterNode == null) &#123; synchronized (lock) &#123; if (clusterNode == null) &#123; // Ê≤°ÊúâÂàùÂßãÂåñÂàôÂàùÂßãÂåñclusterNode clusterNode = new ClusterNode(resourceWrapper.getName(), resourceWrapper.getResourceType()); HashMap&lt;ResourceWrapper, ClusterNode&gt; newMap = new HashMap&lt;&gt;(Math.max(clusterNodeMap.size(), 16)); newMap.putAll(clusterNodeMap); newMap.put(node.getId(), clusterNode); clusterNodeMap = newMap; &#125; &#125; &#125; // ÁªôÁõ∏ÂêåËµÑÊ∫êÁöÑDefaultNodeËÆæÁΩÆ‰∏ÄÊ†∑ÁöÑClusterNode node.setClusterNode(clusterNode); /* * Â¶ÇÊûúÊúâÊù•Ê∫êÂàôÊñ∞Âª∫‰∏Ä‰∏™Êù•Ê∫êNode */ if (!"".equals(context.getOrigin())) &#123; Node originNode = node.getClusterNode().getOrCreateOriginNode(context.getOrigin()); context.getCurEntry().setOriginNode(originNode); &#125; fireEntry(context, resourceWrapper, node, count, prioritized, args);&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÂÖ∂ÂÆûÂ∞±ÊòØÂÅö‰∫Ü‰∏Ä‰ª∂‰∫ãÊÉÖÔºå‰∏∫ËµÑÊ∫êÂàõÂª∫CluserNode„ÄÇËøôÈáåÊàëÂèàË¶ÅÊèê‰∏ÄÂò¥ Áõ∏ÂêåÁöÑËµÑÊ∫ê({@link ResourceWrapper#equals(Object)})Â∞ÜÂÖ®Â±ÄÂÖ±‰∫´Áõ∏ÂêåÁöÑ{@link ProcessorSlotChain}ÔºåÊó†ËÆ∫Âú®Âì™‰∏™‰∏ä‰∏ãÊñá‰∏≠„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåËÉΩËøõÂÖ•Âà∞Âêå‰∏Ä‰∏™ClusterBuilderSlotÂØπË±°ÁöÑentryÊñπÊ≥ïÁöÑËØ∑Ê±ÇÈÉΩÊòØÊù•Ëá™Âêå‰∏Ä‰∏™ËµÑÊ∫êÁöÑÔºåÊâÄ‰ª•Ëøô‰∫õÁõ∏ÂêåËµÑÊ∫êÈúÄË¶ÅÂàùÂßãÂåñ‰∏Ä‰∏™Áªü‰∏ÄÁöÑCluserNodeÁî®Êù•ÂÅöÊµÅÈáèÁöÑÊ±áÊÄªÁªüËÆ°„ÄÇ LogSlot‰ª£Á†ÅÊØîËæÉÁÆÄÂçïÔºåÈÄªËæëÂ∞±ÊòØÊâìÂç∞ÂºÇÂ∏∏Êó•ÂøóÔºåÂ∞±‰∏çÂàÜÊûê‰∫Ü StatisticSlotStatisticSlot ÊòØ Sentinel ÁöÑÊ†∏ÂøÉÂäüËÉΩÊèíÊßΩ‰πã‰∏ÄÔºåÁî®‰∫éÁªüËÆ°ÂÆûÊó∂ÁöÑË∞ÉÁî®Êï∞ÊçÆ„ÄÇ 12345678910111213141516171819202122232425public void entry(Context context, ResourceWrapper resourceWrapper, DefaultNode node, int count, boolean prioritized, Object... args) throws Throwable &#123; try &#123; // ÂÖàËøõË°åÂêéÁª≠ÁöÑcheckÔºåÂåÖÊã¨ËßÑÂàôÁöÑcheckÔºåÈªëÁôΩÂêçÂçïcheck fireEntry(context, resourceWrapper, node, count, prioritized, args); // ÁªüËÆ°ÈªòËÆ§qps Á∫øÁ®ãÊï∞ node.increaseThreadNum(); node.addPassRequest(count); if (context.getCurEntry().getOriginNode() != null) &#123; // Ê†πÊçÆÊù•Ê∫êÁªüËÆ°qps Á∫øÁ®ãÊï∞ context.getCurEntry().getOriginNode().increaseThreadNum(); context.getCurEntry().getOriginNode().addPassRequest(count); &#125; if (resourceWrapper.getEntryType() == EntryType.IN) &#123; // ÁªüËÆ°ÂÖ•Âè£ qps Á∫øÁ®ãÊï∞ Constants.ENTRY_NODE.increaseThreadNum(); Constants.ENTRY_NODE.addPassRequest(count); &#125; .... ÁúÅÁï•ÂÖ∂‰ªñ‰ª£Á†Å &#125;&#125; StatisticSlot‰∏ªË¶ÅÂÅö‰∫Ü4Áßç‰∏çÂêåÁª¥Â∫¶ÁöÑÊµÅÈáèÁªüËÆ° ËµÑÊ∫êÂú®‰∏ä‰∏ãÊñáÁª¥Â∫¶ÔºàDefaultNodeÔºâÁöÑÁªüËÆ° clusterNode Áª¥Â∫¶ÁöÑÁªüËÆ° Origin Êù•Ê∫êÁª¥Â∫¶ÁöÑÁªüËÆ° ÂÖ•Âè£ÂÖ®Â±ÄÊµÅÈáèÁöÑÁªüËÆ° ÂÖ≥‰∫éÊµÅÈáèÁöÑÁªüËÆ°ÂéüÁêÜÁöÑÊú¨ÊñáÂ∞±‰∏çÊ∑±ÂÖ•ÂàÜÊûê‰∫ÜÔºåÊé•‰∏ãÊù•ÁöÑÊñáÁ´†‰∏≠‰ºöÂçïÁã¨ÂàÜÊûê SystemSlotSystemSlotÊØîËæÉÁÆÄÂçïÔºåÂÖ∂ÂÆûÂ∞±ÊòØÊ†πÊçÆStatisticSlotÊâÄÁªüËÆ°ÁöÑÂÖ®Â±ÄÂÖ•Âè£ÊµÅÈáèËøõË°åÈôêÊµÅ„ÄÇ AuthoritySlot123456789101112131415161718192021222324public void entry(Context context, ResourceWrapper resourceWrapper, DefaultNode node, int count, boolean prioritized, Object... args) throws Throwable &#123; checkBlackWhiteAuthority(resourceWrapper, context); fireEntry(context, resourceWrapper, node, count, prioritized, args);&#125;void checkBlackWhiteAuthority(ResourceWrapper resource, Context context) throws AuthorityException &#123; Map&lt;String, Set&lt;AuthorityRule&gt;&gt; authorityRules = AuthorityRuleManager.getAuthorityRules(); if (authorityRules == null) &#123; return; &#125; // Ê†πÊçÆËµÑÊ∫êËé∑ÂèñÈªëÁôΩÂêçÂçïËßÑÂàô Set&lt;AuthorityRule&gt; rules = authorityRules.get(resource.getName()); if (rules == null) &#123; return; &#125; // ÂØπËßÑÂàôËøõË°åÊ†°È™åÔºåÂè™Ë¶ÅÊúâ‰∏ÄÊù°‰∏çÈÄöËøá Â∞±ÊäõÂºÇÂ∏∏ for (AuthorityRule rule : rules) &#123; if (!AuthorityRuleChecker.passCheck(rule, context)) &#123; throw new AuthorityException(context.getOrigin(), rule); &#125; &#125;&#125; AuthoritySlot‰ºöÂØπËµÑÊ∫êÁöÑÈªëÁôΩÂêçÂçïÂÅöÊ£ÄÊü•ÔºåÂπ∂‰∏îÂè™Ë¶ÅÊúâ‰∏ÄÊù°‰∏çÈÄöËøáÂ∞±ÊäõÂºÇÂ∏∏„ÄÇ FlowSlot12345678910111213@Overridepublic void entry(Context context, ResourceWrapper resourceWrapper, DefaultNode node, int count, boolean prioritized, Object... args) throws Throwable &#123; checkFlow(resourceWrapper, context, node, count, prioritized); fireEntry(context, resourceWrapper, node, count, prioritized, args);&#125;void checkFlow(ResourceWrapper resource, Context context, DefaultNode node, int count, boolean prioritized) throws BlockException &#123; // Ê£ÄÊü•ÈôêÊµÅËßÑÂàô checker.checkFlow(ruleProvider, resource, context, node, count, prioritized);&#125; Ëøô‰∏™slot‰∏ªË¶ÅÊ†πÊçÆÈ¢ÑËÆæÁöÑËµÑÊ∫êÁöÑÁªüËÆ°‰ø°ÊÅØÔºåÊåâÁÖßÂõ∫ÂÆöÁöÑÊ¨°Â∫èÔºå‰æùÊ¨°ÁîüÊïà„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™ËµÑÊ∫êÂØπÂ∫î‰∏§Êù°ÊàñËÄÖÂ§öÊù°ÊµÅÊéßËßÑÂàôÔºåÂàô‰ºöÊ†πÊçÆÂ¶Ç‰∏ãÊ¨°Â∫è‰æùÊ¨°Ê£ÄÈ™åÔºåÁõ¥Âà∞ÂÖ®ÈÉ®ÈÄöËøáÊàñËÄÖÊúâ‰∏Ä‰∏™ËßÑÂàôÁîüÊïà‰∏∫Ê≠¢:Âπ∂‰∏îÂêåÊ†∑‰πü‰ºöÊ†πÊçÆ‰∏âÁßç‰∏çÂêåÁöÑÁª¥Â∫¶Êù•ËøõË°åÈôêÊµÅÔºö ËµÑÊ∫êÂú®‰∏ä‰∏ãÊñáÁª¥Â∫¶ÔºàDefaultNodeÔºâÁöÑÁªüËÆ° clusterNode Áª¥Â∫¶ÁöÑÁªüËÆ° Origin Êù•Ê∫êÁª¥Â∫¶ÁöÑÁªüËÆ° ÂÖ≥‰∫éÊµÅÊéßËßÑÂàôÊ∫êÁ†ÅÁöÑÊ∑±ÂÖ•ÂàÜÊûêÂ∞±‰∏çÂú®Êú¨ÁØáÊñáÁ´†ËµòËø∞‰∫Ü DegradeSlotËøô‰∏™slot‰∏ªË¶ÅÈíàÂØπËµÑÊ∫êÁöÑÂπ≥ÂùáÂìçÂ∫îÊó∂Èó¥ÔºàRTÔºâ‰ª•ÂèäÂºÇÂ∏∏ÊØîÁéáÔºåÊù•ÂÜ≥ÂÆöËµÑÊ∫êÊòØÂê¶Âú®Êé•‰∏ãÊù•ÁöÑÊó∂Èó¥Ë¢´Ëá™Âä®ÁÜîÊñ≠Êéâ„ÄÇ ÊÄªÁªì Áõ∏ÂêåÁöÑËµÑÊ∫ê({@link ResourceWrapper#equals(Object)})Â∞ÜÂÖ®Â±ÄÂÖ±‰∫´Áõ∏ÂêåÁöÑ{@link ProcessorSlotChain}ÔºåÊó†ËÆ∫Âú®Âì™‰∏™‰∏ä‰∏ãÊñá‰∏≠ ÊµÅÊéßÊúâÂ§ö‰∏™Áª¥Â∫¶ÔºåÂàÜÂà´ÂåÖÊã¨Ôºö1.‰∏çÂêå‰∏ä‰∏ãÊñá‰∏≠ÁöÑËµÑÊ∫ê 2.Áõ∏ÂêåËµÑÊ∫ê 3.ÂÖ•Âè£ÊµÅÈáè 3.Áõ∏ÂêåÁöÑÊù•Ê∫ê SentinelÁ≥ªÂàó SentinelÊ∫êÁ†ÅËß£Êûê‰∏Ä SentinelÊ∫êÁ†ÅËß£Êûê‰∫åÔºàslotÊÄªËßàÔºâ SentinelÊ∫êÁ†ÅËß£Êûê‰∫åÔºàÊªëÂä®Á™óÂè£ÊµÅÈáèÁªüËÆ°Ôºâ]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Sentinel</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
        <tag>Sentinel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SentinelÊ∫êÁ†ÅËß£Êûê‰∏Ä]]></title>
    <url>%2F2019%2F10%2F11%2FSentinel%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%80%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄSentinel‰Ωú‰∏∫aliÂºÄÊ∫êÁöÑ‰∏ÄÊ¨æËΩªÈáèÁ∫ßÊµÅÊéßÊ°ÜÊû∂Ôºå‰∏ªË¶Å‰ª•ÊµÅÈáè‰∏∫ÂàáÂÖ•ÁÇπÔºå‰ªéÊµÅÈáèÊéßÂà∂„ÄÅÁÜîÊñ≠ÈôçÁ∫ß„ÄÅÁ≥ªÁªüË¥üËΩΩ‰øùÊä§Á≠âÂ§ö‰∏™Áª¥Â∫¶Êù•Â∏ÆÂä©Áî®Êà∑‰øùÊä§ÊúçÂä°ÁöÑÁ®≥ÂÆöÊÄß„ÄÇÁõ∏ÊØî‰∫éHystrixÔºåSentinelÁöÑËÆæËÆ°Êõ¥Âä†ÁÆÄÂçïÔºåÂú® Sentinel‰∏≠ËµÑÊ∫êÂÆö‰πâÂíåËßÑÂàôÈÖçÁΩÆÊòØÂàÜÁ¶ªÁöÑÔºå‰πüÂ∞±ÊòØËØ¥Áî®Êà∑ÂèØ‰ª•ÂÖàÈÄöËøáSentinel APIÁªôÂØπÂ∫îÁöÑ‰∏öÂä°ÈÄªËæëÂÆö‰πâËµÑÊ∫êÔºàÂüãÁÇπÔºâÔºåÁÑ∂ÂêéÂú®ÈúÄË¶ÅÁöÑÊó∂ÂÄôÂÜçÈÖçÁΩÆËßÑÂàôÔºåÈÄöËøáËøôÁßçÁªÑÂêàÊñπÂºèÔºåÊûÅÂ§ßÁöÑÂ¢ûÂä†‰∫ÜSentinelÊµÅÊéßÁöÑÁÅµÊ¥ªÊÄß„ÄÇ ÂºïÂÖ•SentinelÂ∏¶Êù•ÁöÑÊÄßËÉΩÊçüËÄóÈùûÂ∏∏Â∞è„ÄÇÂè™ÊúâÂú®‰∏öÂä°ÂçïÊú∫ÈáèÁ∫ßË∂ÖËøá25W QPSÁöÑÊó∂ÂÄôÊâç‰ºöÊúâ‰∏Ä‰∫õÊòæËëóÁöÑÂΩ±ÂìçÔºà5% - 10% Â∑¶Âè≥ÔºâÔºåÂçïÊú∫QPS‰∏çÂ§™Â§ßÁöÑÊó∂ÂÄôÊçüËÄóÂá†‰πéÂèØ‰ª•ÂøΩÁï•‰∏çËÆ°„ÄÇ SentinelÊèê‰æõ‰∏§ÁßçÂüãÁÇπÊñπÂºè: try-catch ÊñπÂºèÔºàÈÄöËøá SphU.entry(...)ÔºâÔºåÁî®Êà∑Âú® catch Âùó‰∏≠ÊâßË°åÂºÇÂ∏∏Â§ÑÁêÜ / fallback if-else ÊñπÂºèÔºàÈÄöËøá SphO.entry(...)ÔºâÔºåÂΩìËøîÂõû false Êó∂ÊâßË°åÂºÇÂ∏∏Â§ÑÁêÜ / fallback ÂÜôÂú®ÂâçÈù¢Âú®Ê≠§‰πãÂâçÔºåÈúÄË¶ÅÂÖà‰∫ÜËß£‰∏Ä‰∏ãSentinelÁöÑÂ∑•‰ΩúÊµÅÁ®ãÂú® Sentinel ÈáåÈù¢ÔºåÊâÄÊúâÁöÑËµÑÊ∫êÈÉΩÂØπÂ∫î‰∏Ä‰∏™ËµÑÊ∫êÂêçÁß∞ÔºàresourceNameÔºâÔºåÊØèÊ¨°ËµÑÊ∫êË∞ÉÁî®ÈÉΩ‰ºöÂàõÂª∫‰∏Ä‰∏™ Entry ÂØπË±°„ÄÇEntry ÂèØ‰ª•ÈÄöËøáÂØπ‰∏ªÊµÅÊ°ÜÊû∂ÁöÑÈÄÇÈÖçËá™Âä®ÂàõÂª∫Ôºå‰πüÂèØ‰ª•ÈÄöËøáÊ≥®Ëß£ÁöÑÊñπÂºèÊàñË∞ÉÁî® SphU API ÊòæÂºèÂàõÂª∫„ÄÇEntry ÂàõÂª∫ÁöÑÊó∂ÂÄôÔºåÂêåÊó∂‰πü‰ºöÂàõÂª∫‰∏ÄÁ≥ªÂàóÂäüËÉΩÊèíÊßΩÔºàslot chainÔºâÔºåËøô‰∫õÊèíÊßΩÊúâ‰∏çÂêåÁöÑËÅåË¥£Ôºå‰æãÂ¶ÇÈªòËÆ§ÊÉÖÂÜµ‰∏ã‰ºöÂàõÂª∫‰∏Ä‰∏ã7‰∏™ÊèíÊßΩÔºö NodeSelectorSlot Ë¥üË¥£Êî∂ÈõÜËµÑÊ∫êÁöÑË∑ØÂæÑÔºåÂπ∂Â∞ÜËøô‰∫õËµÑÊ∫êÁöÑË∞ÉÁî®Ë∑ØÂæÑÔºå‰ª•Ê†ëÁä∂ÁªìÊûÑÂ≠òÂÇ®Ëµ∑Êù•ÔºåÁî®‰∫éÊ†πÊçÆË∞ÉÁî®Ë∑ØÂæÑÊù•ÈôêÊµÅÈôçÁ∫ßÔºõ ClusterBuilderSlot ÂàôÁî®‰∫éÂ≠òÂÇ®ËµÑÊ∫êÁöÑÁªüËÆ°‰ø°ÊÅØ‰ª•ÂèäË∞ÉÁî®ËÄÖ‰ø°ÊÅØÔºå‰æãÂ¶ÇËØ•ËµÑÊ∫êÁöÑ RT, QPS, thread count Á≠âÁ≠âÔºåËøô‰∫õ‰ø°ÊÅØÂ∞ÜÁî®‰Ωú‰∏∫Â§öÁª¥Â∫¶ÈôêÊµÅÔºåÈôçÁ∫ßÁöÑ‰æùÊçÆÔºõ StatisticSlot ÂàôÁî®‰∫éËÆ∞ÂΩï„ÄÅÁªüËÆ°‰∏çÂêåÁ∫¨Â∫¶ÁöÑ runtime ÊåáÊ†áÁõëÊéß‰ø°ÊÅØÔºõ FlowSlot ÂàôÁî®‰∫éÊ†πÊçÆÈ¢ÑËÆæÁöÑÈôêÊµÅËßÑÂàô‰ª•ÂèäÂâçÈù¢ slot ÁªüËÆ°ÁöÑÁä∂ÊÄÅÔºåÊù•ËøõË°åÊµÅÈáèÊéßÂà∂Ôºõ AuthoritySlot ÂàôÊ†πÊçÆÈÖçÁΩÆÁöÑÈªëÁôΩÂêçÂçïÂíåË∞ÉÁî®Êù•Ê∫ê‰ø°ÊÅØÔºåÊù•ÂÅöÈªëÁôΩÂêçÂçïÊéßÂà∂Ôºõ DegradeSlot ÂàôÈÄöËøáÁªüËÆ°‰ø°ÊÅØ‰ª•ÂèäÈ¢ÑËÆæÁöÑËßÑÂàôÔºåÊù•ÂÅöÁÜîÊñ≠ÈôçÁ∫ßÔºõ SystemSlot ÂàôÈÄöËøáÁ≥ªÁªüÁöÑÁä∂ÊÄÅÔºå‰æãÂ¶Ç load1 Á≠âÔºåÊù•ÊéßÂà∂ÊÄªÁöÑÂÖ•Âè£ÊµÅÈáè Ê≥®ÊÑèÔºöËøôÈáåÁöÑÊèíÊßΩÈìæÈÉΩÊòØ‰∏Ä‰∏ÄÂØπÂ∫îËµÑÊ∫êÂêçÁß∞ÁöÑ ‰∏äÈù¢ÁöÑÊâÄ‰ªãÁªçÁöÑÊèíÊßΩÔºàslot chainÔºâÊòØSentinelÈùûÂ∏∏ÈáçË¶ÅÁöÑÊ¶ÇÂøµ„ÄÇÂêåÊó∂ËøòÊúâ‰∏Ä‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑÊ¶ÇÂøµÈÇ£Â∞±ÊòØNodeÔºå‰∏∫‰∫ÜÂ∏ÆÂä©ÁêÜËß£ÔºåÂ∞ΩÊàëÊâÄËÉΩÁîª‰∫Ü‰∏ãÈù¢ËøôÂº†ÂõæÔºåÂèØ‰ª•ÁúãÂà∞Êï¥‰∏™ÁªìÊûÑÈùûÂ∏∏ÁöÑÂÉè‰∏ÄÊ£µÊ†ëÔºö ÁÆÄÂçïËß£Èáä‰∏ã‰∏äÂõæÔºö È°∂ÈÉ®ËìùËâ≤ÁöÑnodeËäÇÁÇπ‰∏∫Ê†πËäÇÁÇπÔºåÂÖ®Â±ÄÂîØ‰∏Ä ‰∏ãÈù¢ÈªÑËâ≤ÁöÑËäÇÁÇπ‰∏∫ÂÖ•Âè£ËäÇÁÇπÔºåÊØè‰∏™CentextName(‰∏ä‰∏ãÊñáÂêçÁß∞)‰∏Ä‰∏ÄÂØπÂ∫î‰∏Ä‰∏™ ÂèØ‰ª•ÊúâÂ§ö‰∏™Â≠êËäÇÁÇπÔºàÂØπÂ∫îÂ§öÁßçËµÑÊ∫êÔºâ ‰∏≠Èó¥ÁªøËâ≤Ê°ÜÊ°Ü‰∏≠ÁöÑËäÇÁÇπÈÉΩÊòØÂ±û‰∫éÂêå‰∏Ä‰∏™ËµÑÊ∫êÁöÑ(Áõ∏ÂêåÁöÑResourceName) ÊúÄÂ∫ï‰∏ãÁ¥´Ëâ≤ÁöÑËäÇÁÇπÊòØÈõÜÁæ§ËäÇÁÇπÔºåÂèØ‰ª•ÁêÜËß£ÊàêÁªøËâ≤Ê°ÜÊ°Ü‰∏≠NodeËµÑÊ∫êÁöÑÊï¥Âêà ‰ª•‰∏ä2‰∏™Ê¶ÇÂøµÂä°ÂøÖË¶ÅÁêÜÊ∏ÖÊ•öÔºå‰πãÂêéÂÜç‰∏ÄÊ≠•‰∏ÄÊ≠•ÁúãÊ∫êÁ†Å‰ºöÊØîËæÉÊ∏ÖÊô∞ ‰∏ãÈù¢Êàë‰ª¨Â∞Ü‰ªéÂÖ•Âè£Ê∫êÁ†ÅÂºÄÂßã‰∏ÄÊ≠•‰∏ÄÊ≠•ÂàÜÊûêÊï¥‰∏™Ë∞ÉÁî®ËøáÁ®ãÔºö Ê∫êÁ†ÅÂàÜÊûê‰∏ãÈù¢ÁöÑÊòØ‰∏Ä‰∏™Sentinel‰ΩøÁî®ÁöÑÁ§∫‰æã‰ª£Á†ÅÔºåÊàë‰ª¨Â∞±‰ªéËøôÈáåÂàáÂÖ•ÂºÄÂßãÂàÜÊûê 123456789// ÂàõÂª∫‰∏Ä‰∏™ÂêçÁß∞‰∏∫entrance1ÔºåÊù•Ê∫ê‰∏∫appA ÁöÑ‰∏ä‰∏ãÊñáContextContextUtil.enter("entrance1", "appA");// ÂàõÂª∫‰∏Ä‰∏™ËµÑÊ∫êÂêçÁß∞nodeAÁöÑEntry Entry nodeA = SphU.entry("nodeA"); if (nodeA != null) &#123; nodeA.exit(); &#125; // Ê∏ÖÈô§‰∏ä‰∏ãÊñá ContextUtil.exit(); ContextUtil.enter(‚Äúentrance1‚Äù, ‚ÄúappA‚Äù)12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public static Context enter(String name, String origin) &#123; // Âà§Êñ≠‰∏ä‰∏ãÊñáÂêçÁß∞ÊòØÂê¶‰∏∫ÈªòËÆ§ÁöÑÂêçÁß∞Ôºàsentinel_default_contextÔºâ ÊòØÁöÑËØùÁõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏ if (Constants.CONTEXT_DEFAULT_NAME.equals(name)) &#123; throw new ContextNameDefineException( "The " + Constants.CONTEXT_DEFAULT_NAME + " can't be permit to defined!"); &#125; return trueEnter(name, origin);&#125;protected static Context trueEnter(String name, String origin) &#123; // ÂÖà‰ªéThreadLocal‰∏≠Â∞ùËØïËé∑ÂèñÔºåËé∑ÂèñÂà∞ÂàôÁõ¥Êé•ËøîÂõû Context context = contextHolder.get(); if (context == null) &#123; Map&lt;String, DefaultNode&gt; localCacheNameMap = contextNameNodeMap; // Â∞ùËØï‰ªéÁºìÂ≠ò‰∏≠Ëé∑ÂèñËØ•‰∏ä‰∏ãÊñáÂêçÁß∞ÂØπÂ∫îÁöÑ ÂÖ•Âè£ËäÇÁÇπ DefaultNode node = localCacheNameMap.get(name); if (node == null) &#123; // Âà§Êñ≠ÁºìÂ≠ò‰∏≠ÂÖ•Âè£ËäÇÁÇπÊï∞ÈáèÊòØÂê¶Â§ß‰∫é2000 if (localCacheNameMap.size() &gt; Constants.MAX_CONTEXT_NAME_SIZE) &#123; setNullContext(); return NULL_CONTEXT; &#125; else &#123; try &#123; // Âä†ÈîÅ LOCK.lock(); // ÂèåÈáçÊ£ÄÊü•ÈîÅ node = contextNameNodeMap.get(name); if (node == null) &#123; // Âà§Êñ≠ÁºìÂ≠ò‰∏≠ÂÖ•Âè£ËäÇÁÇπÊï∞ÈáèÊòØÂê¶Â§ß‰∫é2000 if (contextNameNodeMap.size() &gt; Constants.MAX_CONTEXT_NAME_SIZE) &#123; setNullContext(); return NULL_CONTEXT; &#125; else &#123; // Ê†πÊçÆ‰∏ä‰∏ãÊñáÂêçÁß∞ÁîüÊàêÂÖ•Âè£ËäÇÁÇπÔºàentranceNodeÔºâ node = new EntranceNode(new StringResourceWrapper(name, EntryType.IN), null); // Âä†ÂÖ•Ëá≥ÂÖ®Â±ÄÊ†πËäÇÁÇπ‰∏ã Constants.ROOT.addChild(node); // Âä†ÂÖ•ÁºìÂ≠ò‰∏≠ Map&lt;String, DefaultNode&gt; newMap = new HashMap&lt;&gt;(contextNameNodeMap.size() + 1); newMap.putAll(contextNameNodeMap); newMap.put(name, node); contextNameNodeMap = newMap; &#125; &#125; &#125; finally &#123; LOCK.unlock(); &#125; &#125; &#125; // ÂàùÂßãÂåñ‰∏ä‰∏ãÊñáÂØπË±° context = new Context(node, name); context.setOrigin(origin); // ËÆæÁΩÆÂà∞ÂΩìÂâçÁ∫øÁ®ã‰∏≠ contextHolder.set(context); &#125; return context;&#125; ‰∏ªË¶ÅÂÅö‰∫Ü2‰ª∂‰∫ãÊÉÖ Ê†πÊçÆContextNameÁîüÊàêentranceNodeÔºåÂπ∂Âä†ÂÖ•ÁºìÂ≠òÔºåÊØè‰∏™ContextNameÂØπÂ∫î‰∏Ä‰∏™ÂÖ•Âè£ËäÇÁÇπentranceNode Ê†πÊçÆContextNameÂíåentranceNodeÂàùÂßãÂåñ‰∏ä‰∏ãÊñáÂØπË±°ÔºåÂπ∂Â∞Ü‰∏ä‰∏ãÊñáÂØπË±°ËÆæÁΩÆÂà∞ÂΩìÂâçÁ∫øÁ®ã‰∏≠ ËøôÈáåÊúâÂá†ÁÇπÈúÄË¶ÅÊ≥®ÊÑèÔºö ÂÖ•Âè£ËäÇÁÇπÊï∞Èáè‰∏çËÉΩÂ§ß‰∫é2000ÔºåÂ§ß‰∫é‰ºöÁõ¥Êé•ÊäõÂºÇÂ∏∏ ÊØè‰∏™ContextNameÂØπÂ∫î‰∏Ä‰∏™ÂÖ•Âè£ËäÇÁÇπentranceNode ÊØè‰∏™entranceNodeÈÉΩÊúâÂÖ±ÂêåÁöÑÁà∂ËäÇÁÇπ„ÄÇ‰πüÂ∞±ÊòØÊ†πËäÇÁÇπ Entry nodeA = SphU.entry(‚ÄúnodeA‚Äù)123456789101112131415// SphU.classpublic static Entry entry(String name) throws BlockException &#123; // ÈªòËÆ§‰∏∫ Âá∫Âè£ÊµÅÈáèÁ±ªÂûãÔºåÂçï‰ΩçÁªüËÆ°Êï∞‰∏∫1 return Env.sph.entry(name, EntryType.OUT, 1, OBJECTS0);&#125;// CtSph.classpublic Entry entry(String name, EntryType type, int count, Object... args) throws BlockException &#123; // ÁîüÊàêËµÑÊ∫êÂØπË±° StringResourceWrapper resource = new StringResourceWrapper(name, type); return entry(resource, count, args);&#125;public Entry entry(ResourceWrapper resourceWrapper, int count, Object... args) throws BlockException &#123; return entryWithPriority(resourceWrapper, count, false, args);&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÊØîËæÉÁÆÄÂçïÔºå‰∏çÊåáÂÆöEntryTypeÁöÑËØùÔºåÂàôÈªòËÆ§‰∏∫Âá∫Âè£ÊµÅÈáèÁ±ªÂûãÔºåÊúÄÁªà‰ºöË∞ÉÁî®entryWithPriorityÊñπÊ≥ïÔºå‰∏ªË¶Å‰∏öÂä°ÈÄªËæë‰πüÈÉΩÂú®Ëøô‰∏™ÊñπÊ≥ï‰∏≠ entryWithPriorityÊñπÊ≥ï 123456789101112131415161718192021222324252627282930313233343536373839404142private Entry entryWithPriority(ResourceWrapper resourceWrapper, int count, boolean prioritized, Object... args) throws BlockException &#123; // Ëé∑ÂèñÂΩìÂâçÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂØπË±° Context context = ContextUtil.getContext(); // ‰∏ä‰∏ãÊñáÂêçÁß∞ÂØπÂ∫îÁöÑÂÖ•Âè£ËäÇÁÇπÊòØÂê¶Â∑≤ÁªèË∂ÖËøáÈòàÂÄº2000ÔºåË∂ÖËøáÂàô‰ºöËøîÂõûÁ©∫ CtEntry if (context instanceof NullContext) &#123; return new CtEntry(resourceWrapper, null, context); &#125; if (context == null) &#123; // Â¶ÇÊûúÊ≤°ÊúâÊåáÂÆö‰∏ä‰∏ãÊñáÂêçÁß∞ÔºåÂàô‰ΩøÁî®ÈªòËÆ§ÂêçÁß∞Ôºå‰πüÂ∞±ÊòØÈªòËÆ§ÂÖ•Âè£ËäÇÁÇπ context = InternalContextUtil.internalEnter(Constants.CONTEXT_DEFAULT_NAME); &#125; // ÂÖ®Â±ÄÂºÄÂÖ≥ if (!Constants.ON) &#123; return new CtEntry(resourceWrapper, null, context); &#125; // ÁîüÊàêÊèíÊßΩÈìæ ProcessorSlot&lt;Object&gt; chain = lookProcessChain(resourceWrapper); /* * Ë°®Á§∫ËµÑÊ∫ê(ÊèíÊßΩÈìæ)Ë∂ÖËøá6000ÔºåÂõ†Ê≠§‰∏ç‰ºöËøõË°åËßÑÂàôÊ£ÄÊü•„ÄÇ */ if (chain == null) &#123; return new CtEntry(resourceWrapper, null, context); &#125; // ÁîüÊàê Entry ÂØπË±° Entry e = new CtEntry(resourceWrapper, chain, context); try &#123; // ÂºÄÂßãÊâßË°åÊèíÊßΩÈìæ Ë∞ÉÁî®ÈÄªËæë chain.entry(context, resourceWrapper, null, count, prioritized, args); &#125; catch (BlockException e1) &#123; // Ê∏ÖÈô§‰∏ä‰∏ãÊñá e.exit(count, args); throw e1; &#125; catch (Throwable e1) &#123; // Èô§ÈùûSentinelÂÜÖÈÉ®Â≠òÂú®ÈîôËØØÔºåÂê¶Âàô‰∏çÂ∫îÂèëÁîüËøôÁßçÊÉÖÂÜµ„ÄÇ RecordLog.info("Sentinel unexpected exception", e1); &#125; return e;&#125; Ëøô‰∏™ÊñπÊ≥ïÂèØ‰ª•ËØ¥ÊòØÊ∂µÁõñ‰∫ÜÊï¥‰∏™SentinelÁöÑÊ†∏ÂøÉÈÄªËæë Ëé∑Âèñ‰∏ä‰∏ãÊñáÂØπË±°ÔºåÂ¶ÇÊûú‰∏ä‰∏ãÊñáÂØπË±°ËøòÊú™ÂàùÂßãÂåñÔºåÂàô‰ΩøÁî®ÈªòËÆ§ÂêçÁß∞ÂàùÂßãÂåñ„ÄÇÂàùÂßãÂåñÈÄªËæëÂú®‰∏äÊñáÂ∑≤ÁªèÂàÜÊûêËøá Âà§Êñ≠ÂÖ®Â±ÄÂºÄÂÖ≥ Ê†πÊçÆÁªôÂÆöÁöÑËµÑÊ∫êÁîüÊàêÊèíÊßΩÈìæÔºåÊèíÊßΩÈìæÊòØË∑üËµÑÊ∫êÁõ∏ÂÖ≥ÁöÑÔºåSentinelÊúÄÂÖ≥ÈîÆÁöÑÈÄªËæë‰πüÈÉΩÂú®ÂêÑ‰∏™ÊèíÊßΩ‰∏≠„ÄÇÂàùÂßãÂåñÁöÑÈÄªËæëÂú®lookProcessChain(resourceWrapper);‰∏≠Ôºå‰∏ãÊñá‰ºöÂàÜÊûê ‰æùÈ°∫Â∫èÊâßË°åÊØè‰∏™ÊèíÊßΩÈÄªËæë lookProcessChain(resourceWrapper)ÊñπÊ≥ïlookProcessChainÊñπÊ≥ï‰∏∫ÊåáÂÆöËµÑÊ∫êÁîüÊàêÊèíÊßΩÈìæÔºå‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãÂÆÉÁöÑÂàùÂßãÂåñÈÄªËæë 123456789101112131415161718192021222324ProcessorSlot&lt;Object&gt; lookProcessChain(ResourceWrapper resourceWrapper) &#123; // Ê†πÊçÆËµÑÊ∫êÂ∞ùËØï‰ªéÂÖ®Â±ÄÁºìÂ≠ò‰∏≠Ëé∑Âèñ ProcessorSlotChain chain = chainMap.get(resourceWrapper); if (chain == null) &#123; // ÈùûÂ∏∏Â∏∏ËßÅÁöÑÂèåÈáçÊ£ÄÊü•ÈîÅ synchronized (LOCK) &#123; chain = chainMap.get(resourceWrapper); if (chain == null) &#123; // Âà§Êñ≠ËµÑÊ∫êÊï∞ÊòØÂê¶Â§ß‰∫é6000 if (chainMap.size() &gt;= Constants.MAX_SLOT_CHAIN_SIZE) &#123; return null; &#125; // ÂàùÂßãÂåñÊèíÊßΩÈìæ chain = SlotChainProvider.newSlotChain(); Map&lt;ResourceWrapper, ProcessorSlotChain&gt; newMap = new HashMap&lt;ResourceWrapper, ProcessorSlotChain&gt;( chainMap.size() + 1); newMap.putAll(chainMap); newMap.put(resourceWrapper, chain); chainMap = newMap; &#125; &#125; &#125; return chain;&#125; Ê†πÊçÆËµÑÊ∫êÂ∞ùËØï‰ªéÂÖ®Â±ÄÁºìÂ≠ò‰∏≠Ëé∑ÂèñÊèíÊßΩÈìæ„ÄÇÊØè‰∏™ËµÑÊ∫êÂØπÂ∫î‰∏Ä‰∏™ÊèíÊßΩÈìæÔºàËµÑÊ∫êÂò¥Â§öÂè™ËÉΩÂÆö‰πâ6000‰∏™Ôºâ ÂàùÂßãÂåñÊèíÊßΩÈìæ‰∏äÁöÑÊèíÊßΩÔºàSlotChainProvider.newSlotChain()ÊñπÊ≥ï‰∏≠Ôºâ ‰∏ãÈù¢Êàë‰ª¨Áúã‰∏ãÂàùÂßãÂåñÊèíÊßΩÈìæ‰∏äÁöÑÊèíÊßΩÁöÑÈÄªËæë SlotChainProvider.newSlotChain()123456789101112131415161718192021222324252627282930313233343536373839public static ProcessorSlotChain newSlotChain() &#123; // Âà§Êñ≠ÊòØÂê¶Â∑≤ÁªèÂàùÂßãÂåñËøá if (builder != null) &#123; return builder.build(); &#125; // Âä†ËΩΩ SlotChain resolveSlotChainBuilder(); // Âä†ËΩΩÂ§±Ë¥•Âàô‰ΩøÁî®ÈªòËÆ§ ÊèíÊßΩÈìæ if (builder == null) &#123; RecordLog.warn("[SlotChainProvider] Wrong state when resolving slot chain builder, using default"); builder = new DefaultSlotChainBuilder(); &#125; // ÊûÑÂª∫ÂÆåÊàê return builder.build();&#125;/** * javaËá™Â∏¶ SPIÊú∫Âà∂ Âä†ËΩΩ slotChain */private static void resolveSlotChainBuilder() &#123; List&lt;SlotChainBuilder&gt; list = new ArrayList&lt;SlotChainBuilder&gt;(); boolean hasOther = false; // Â∞ùËØïËé∑ÂèñËá™ÂÆö‰πâSlotChainBuilderÔºåÈÄöËøáJAVA SPIÊú∫Âà∂Êâ©Â±ï for (SlotChainBuilder builder : LOADER) &#123; if (builder.getClass() != DefaultSlotChainBuilder.class) &#123; hasOther = true; list.add(builder); &#125; &#125; if (hasOther) &#123; builder = list.get(0); &#125; else &#123; // Êú™Ëé∑ÂèñÂà∞Ëá™ÂÆö‰πâ SlotChainBuilder Âàô‰ΩøÁî®ÈªòËÆ§ÁöÑ builder = new DefaultSlotChainBuilder(); &#125; RecordLog.info("[SlotChainProvider] Global slot chain builder resolved: " + builder.getClass().getCanonicalName());&#125; È¶ñÂÖà‰ºöÂ∞ùËØïËé∑ÂèñËá™ÂÆö‰πâÁöÑSlotChainBuilderÊù•ÊûÑÂª∫ÊèíÊßΩÈìæÔºåËá™ÂÆö‰πâÁöÑSlotChainBuilderÂèØ‰ª•ÈÄöËøáJAVA SPIÊú∫Âà∂Êù•Êâ©Â±ï Â¶ÇÊûúÊú™ÈÖçÁΩÆËá™ÂÆö‰πâÁöÑSlotChainBuilderÔºåÂàô‰ºö‰ΩøÁî®ÈªòËÆ§ÁöÑDefaultSlotChainBuilderÊù•ÊûÑÂª∫ÊèíÊßΩÈìæÔºåDefaultSlotChainBuilderÊâÄÊûÑÂª∫ÁöÑÊèíÊßΩÂ∞±ÊòØÊñáÁ´†ÂºÄÂ§¥Êàë‰ª¨ÊèêÂà∞ÁöÑ7ÁßçSlot„ÄÇÊØè‰∏™ÊèíÊßΩÈÉΩÊúâÂÖ∂ÂØπÂ∫îÁöÑËÅåË¥£ÔºåÂêÑÂè∏ÂÖ∂ËÅåÔºåÂêéÈù¢Êàë‰ª¨‰ºöËØ¶ÁªÜÂàÜÊûêËøôÂá†‰∏™ÊèíÊßΩÁöÑÊ∫êÁ†ÅÔºåÂèäÊâÄÊâøÊãÖÁöÑËÅåË¥£„ÄÇ ÊÄªÁªìÊñáÁ´†ÂºÄÂ§¥ÁöÑÊèêÂà∞ÁöÑ‰∏§‰∏™ÁÇπ(ÊèíÊßΩÈìæÂíåNode)ÔºåËøôÊòØSentinelÁöÑÈáçÁÇπÔºåÁêÜËß£Ëøô‰∏§ÁÇπÂØπ‰∫éÈòÖËØªÊ∫êÁ†ÅÊù•ËØ¥‰∫ãÂçäÂäüÂÄç SentinelÁ≥ªÂàó SentinelÊ∫êÁ†ÅËß£Êûê‰∏Ä SentinelÊ∫êÁ†ÅËß£Êûê‰∫åÔºàslotÊÄªËßàÔºâ SentinelÊ∫êÁ†ÅËß£Êûê‰∫åÔºàÊªëÂä®Á™óÂè£ÊµÅÈáèÁªüËÆ°Ôºâ]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Sentinel</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
        <tag>Sentinel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊµÖË∞àÂ∏∏Áî®ÁöÑÈôêÊµÅÁÆóÊ≥ï]]></title>
    <url>%2F2019%2F10%2F09%2F%E6%B5%85%E8%B0%88%E5%B8%B8%E7%94%A8%E7%9A%84%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®ÂºÄÂèëÈ´òÂπ∂ÂèëÁ≥ªÁªüÊó∂Êúâ‰∏âÊääÂà©Âô®Áî®Êù•‰øùÊä§Á≥ªÁªüÔºöÁºìÂ≠ò„ÄÅÈôçÁ∫ßÂíåÈôêÊµÅ„ÄÇ‰ªäÂ§©Êàë‰ª¨Ë¶ÅËÅäÁöÑÂ∞±ÊòØÈôêÊµÅÔºàRate LimitÔºâÔºåÈôêÊµÅÁöÑÁõÆÁöÑÂæàÁÆÄÂçïÔºåÂ∞±ÊòØ‰∏∫‰∫Ü‰øùÊä§Á≥ªÁªü‰∏çË¢´Áû¨Êó∂Â§ßÊµÅÈáèÂÜ≤ÂûÆÔºåÈôêÊµÅËøô‰∏™Ê¶ÇÂøµÊàëÂÖ∂ÂÆûÂæàÊó©‰πãÂâçÂ∞±ÊúâÂéª‰∫ÜËß£ËøáÔºå‰∏çËøáÊó†Â•à‰πãÂâçÂ∑•‰ΩúÊâÄÊé•Ëß¶‰∏öÂä°ÁöÑÂπ∂ÂèëÈáèÂÆûÂú®ÊòØË∞à‰∏ç‰∏äÈôêÊµÅ„ÄÇÁõÆÂâçÂÖ¨Âè∏Â§ß‰øÉÂ≥∞ÂÄºQPSÂú®2wÂæÄ‰∏äÔºåËá™ÁÑ∂ËÄåÁÑ∂ÈúÄË¶ÅÁî®Âà∞ÈôêÊµÅÔºåÁâπÂà´ÊòØÁ±ª‰ººÁßíÊùÄËøôÁßçÁû¨Êó∂ÊµÅÈáèÈùûÂ∏∏Â§ß‰ΩÜÂÆûÈôÖÊàêÂçïÁéá‰ΩéÁöÑ‰∏öÂä°Âú∫ÊôØ„ÄÇ ÁõÆÂâçÊØîËæÉÂ∏∏Áî®ÁöÑÈôêÊµÅÁÆóÊ≥ïÊúâ‰∏âÁßç ËÆ°Êï∞Âô®Âõ∫ÂÆöÁ™óÂè£ÁÆóÊ≥ï ËÆ°Êï∞Âô®ÊªëÂä®Á™óÂè£ÁÆóÊ≥ï ÊºèÊ°∂ÁÆóÊ≥ï ‰ª§ÁâåÊ°∂ÁÆóÊ≥ï ËÆ°Êï∞Âô®Âõ∫ÂÆöÁ™óÂè£ÁÆóÊ≥ïËÆ°Êï∞Âô®Âõ∫ÂÆöÁ™óÂè£ÁÆóÊ≥ïÊòØÊúÄÁÆÄÂçïÁöÑÈôêÊµÅÁÆóÊ≥ïÔºåÂÆûÁé∞ÊñπÂºè‰πüÊØîËæÉÁÆÄÂçï„ÄÇÂ∞±ÊòØÈÄöËøáÁª¥Êä§‰∏Ä‰∏™Âçï‰ΩçÊó∂Èó¥ÂÜÖÁöÑËÆ°Êï∞ÂÄºÔºåÊØèÂΩì‰∏Ä‰∏™ËØ∑Ê±ÇÈÄöËøáÊó∂ÔºåÂ∞±Â∞ÜËÆ°Êï∞ÂÄºÂä†1ÔºåÂΩìËÆ°Êï∞ÂÄºË∂ÖËøáÈ¢ÑÂÖàËÆæÂÆöÁöÑÈòàÂÄºÊó∂ÔºåÂ∞±ÊãíÁªùÂçï‰ΩçÊó∂Èó¥ÂÜÖÁöÑÂÖ∂‰ªñËØ∑Ê±Ç„ÄÇÂ¶ÇÊûúÂçï‰ΩçÊó∂Èó¥Â∑≤ÁªèÁªìÊùüÔºåÂàôÂ∞ÜËÆ°Êï∞Âô®Ê∏ÖÈõ∂ÔºåÂºÄÂêØ‰∏ã‰∏ÄËΩÆÁöÑËÆ°Êï∞„ÄÇ ‰ΩÜÊòØËøôÁßçÂÆûÁé∞‰ºöÊúâ‰∏Ä‰∏™ÈóÆÈ¢òÔºå‰∏æ‰∏™‰æãÂ≠ê: ÂÅáËÆæÊàë‰ª¨ËÆæÂÆö1ÁßíÂÜÖÂÖÅËÆ∏ÈÄöËøáÁöÑËØ∑Ê±ÇÈòàÂÄºÊòØ200ÔºåÂ¶ÇÊûúÊúâÁî®Êà∑Âú®Êó∂Èó¥Á™óÂè£ÁöÑÊúÄÂêéÂá†ÊØ´ÁßíÂèëÈÄÅ‰∫Ü200‰∏™ËØ∑Ê±ÇÔºåÁ¥ßÊé•ÁùÄÂèàÂú®‰∏ã‰∏Ä‰∏™Êó∂Èó¥Á™óÂè£ÂºÄÂßãÊó∂ÂèëÈÄÅ‰∫Ü200‰∏™ËØ∑Ê±ÇÔºåÈÇ£‰πàËøô‰∏™Áî®Êà∑ÂÖ∂ÂÆûÂú®‰∏ÄÁßíÂÜÖÊàêÂäüËØ∑Ê±Ç‰∫Ü400Ê¨°ÔºåÊòæÁÑ∂Ë∂ÖËøá‰∫ÜÈòàÂÄº‰ΩÜÂπ∂‰∏ç‰ºöË¢´ÈôêÊµÅ„ÄÇÂÖ∂ÂÆûËøôÂ∞±ÊòØ‰∏¥ÁïåÂÄºÈóÆÈ¢òÔºåÈÇ£‰πà‰∏¥ÁïåÂÄºÈóÆÈ¢òË¶ÅÊÄé‰πàËß£ÂÜ≥Âë¢Ôºü ‰ª£Á†ÅÂÆûÁé∞ ‚Äì CounterRateLimit.java ËÆ°Êï∞Âô®ÊªëÂä®Á™óÂè£ÁÆóÊ≥ïËÆ°Êï∞Âô®ÊªëÂä®Á™óÂè£Ê≥ïÂ∞±ÊòØ‰∏∫‰∫ÜËß£ÂÜ≥‰∏äËø∞Âõ∫ÂÆöÁ™óÂè£ËÆ°Êï∞Â≠òÂú®ÁöÑÈóÆÈ¢òËÄåËØûÁîüÔºåÂ≠¶ËøáTCPÂçèËÆÆÁöÑÂêåÂ≠¶Â∫îËØ•ÂØπÊªëÂä®Á™óÂè£‰∏çÈôåÁîüÔºåÂÖ∂ÂÆûËøòÊòØ‰∏çÂ§™‰∏ÄÊ†∑ÁöÑÔºå‰∏ãÊñáÊàë‰ª¨Ë¶ÅËØ¥ÁöÑÊªëÂä®Á™óÂè£ÊòØÂü∫‰∫éÊó∂Èó¥Êù•ÂàíÂàÜÁ™óÂè£ÁöÑ„ÄÇËÄåTCPÁöÑÊªëÂä®Á™óÂè£ÊåáÁöÑÊòØËÉΩÂ§üÊé•ÂèóÁöÑÂ≠óËäÇÊï∞ÔºåÂπ∂‰∏îÂ§ßÂ∞èÊòØÂèØÂèòÁöÑÔºàÊã•Â°ûÊéßÂà∂Ôºâ ÊªëÂä®Á™óÂè£ÊòØÊÄé‰πàÂÅöÁöÑÔºü ÂâçÈù¢ËØ¥‰∫ÜÂõ∫ÂÆöÁ™óÂè£Â≠òÂú®‰∏¥ÁïåÂÄºÈóÆÈ¢òÔºåË¶ÅËß£ÂÜ≥ËøôÁßç‰∏¥ÁïåÂÄºÈóÆÈ¢òÔºåÊòæÁÑ∂Âè™Áî®‰∏Ä‰∏™Á™óÂè£ÊòØËß£ÂÜ≥‰∏ç‰∫ÜÈóÆÈ¢òÁöÑ„ÄÇÂÅáËÆæÊàë‰ª¨‰ªçÁÑ∂ËÆæÂÆö1ÁßíÂÜÖÂÖÅËÆ∏ÈÄöËøáÁöÑËØ∑Ê±ÇÊòØ200‰∏™Ôºå‰ΩÜÊòØÂú®ËøôÈáåÊàë‰ª¨ÈúÄË¶ÅÊää1ÁßíÁöÑÊó∂Èó¥ÂàÜÊàêÂ§öÊ†ºÔºåÂÅáËÆæÂàÜÊàê5Ê†ºÔºàÊ†ºÊï∞Ë∂äÂ§öÔºåÊµÅÈáèËøáÊ∏°Ë∂äÂπ≥ÊªëÔºâÔºåÊØèÊ†ºÁ™óÂè£ÁöÑÊó∂Èó¥Â§ßÂ∞èÊòØ200ÊØ´ÁßíÔºåÊØèËøá200ÊØ´ÁßíÔºåÂ∞±Â∞ÜÁ™óÂè£ÂêëÂâçÁßªÂä®‰∏ÄÊ†º„ÄÇ‰∏∫‰∫Ü‰æø‰∫éÁêÜËß£ÔºåÂèØ‰ª•Áúã‰∏ãÂõæ Âõæ‰∏≠Â∞ÜÁ™óÂè£Âàí‰∏∫5‰ªΩÔºåÊØè‰∏™Â∞èÁ™óÂè£‰∏≠ÁöÑÊï∞Â≠óË°®Á§∫Âú®Ëøô‰∏™Á™óÂè£‰∏≠ËØ∑Ê±ÇÊï∞ÔºåÊâÄ‰ª•ÈÄöËøáËßÇÂØü‰∏äÂõæÔºåÂèØÁü•Âú®ÂΩìÂâçÊó∂Èó¥Âø´Ôºà200ÊØ´ÁßíÔºâÂÖÅËÆ∏ÈÄöËøáÁöÑËØ∑Ê±ÇÊï∞Â∫îËØ•ÊòØ20ËÄå‰∏çÊòØ200ÔºàÂè™Ë¶ÅË∂ÖËøá20Â∞±‰ºöË¢´ÈôêÊµÅÔºâÔºåÂõ†‰∏∫Êàë‰ª¨ÊúÄÁªàÁªüËÆ°ËØ∑Ê±ÇÊï∞Êó∂ÊòØÈúÄË¶ÅÊääÂΩìÂâçÁ™óÂè£ÁöÑÂÄºËøõË°åÁ¥ØÂä†ÔºåËøõËÄåÂæóÂà∞ÂΩìÂâçËØ∑Ê±ÇÊï∞Êù•Âà§Êñ≠ÊòØ‰∏çÊòØÈúÄË¶ÅËøõË°åÈôêÊµÅ„ÄÇ ÈÇ£‰πàÊªëÂä®Á™óÂè£ÈôêÊµÅÊ≥ïÊòØÂÆåÁæéÁöÑÂêóÔºüÁªÜÂøÉËßÇÂØüÁöÑÊàë‰ª¨Â∫îËØ•ËÉΩÈ©¨‰∏äÂèëÁé∞ÈóÆÈ¢òÔºåÊªëÂä®Á™óÂè£ÈôêÊµÅÊ≥ïÂÖ∂ÂÆûÂ∞±ÊòØËÆ°Êï∞Âô®Âõ∫ÂÆöÁ™óÂè£ÁÆóÊ≥ïÁöÑ‰∏Ä‰∏™ÂèòÁßç„ÄÇÊµÅÈáèÁöÑËøáÊ∏°ÊòØÂê¶Âπ≥Êªë‰æùËµñ‰∫éÊàë‰ª¨ËÆæÁΩÆÁöÑÁ™óÂè£Ê†ºÊï∞‰πüÂ∞±ÊòØÁªüËÆ°Êó∂Èó¥Èó¥ÈöîÔºåÊ†ºÊï∞Ë∂äÂ§öÔºåÁªüËÆ°Ë∂äÁ≤æÁ°ÆÔºå‰ΩÜÊòØÂÖ∑‰ΩìË¶ÅÂàÜÂ§öÂ∞ëÊ†ºÊàë‰ª¨‰πüËØ¥‰∏ç‰∏äÊù•ÂëÄ‚Ä¶ ‰ª£Á†ÅÂÆûÁé∞ ‚Äì SlidingWindowRateLimit.java ÊºèÊ°∂ÁÆóÊ≥ï‰∏äÈù¢ÊâÄ‰ªãÁªçÁöÑ‰∏§ÁßçÁÆóÊ≥ïÈÉΩ‰∏çËÉΩÈùûÂ∏∏Âπ≥ÊªëÁöÑËøáÊ∏°Ôºå‰∏ãÈù¢Â∞±ÊòØÊºèÊ°∂ÁÆóÊ≥ïÁôªÂú∫‰∫Ü‰ªÄ‰πàÊòØÊºèÊ°∂ÁÆóÊ≥ïÔºüÊºèÊ°∂ÁÆóÊ≥ï‰ª•‰∏Ä‰∏™Â∏∏ÈáèÈôêÂà∂‰∫ÜÂá∫Âè£ÊµÅÈáèÈÄüÁéáÔºåÂõ†Ê≠§ÊºèÊ°∂ÁÆóÊ≥ïÂèØ‰ª•Âπ≥ÊªëÁ™ÅÂèëÁöÑÊµÅÈáè„ÄÇÂÖ∂‰∏≠ÊºèÊ°∂‰Ωú‰∏∫ÊµÅÈáèÂÆπÂô®Êàë‰ª¨ÂèØ‰ª•ÁúãÂÅö‰∏Ä‰∏™FIFOÁöÑÈòüÂàóÔºåÂΩìÂÖ•Âè£ÊµÅÈáèÈÄüÁéáÂ§ß‰∫éÂá∫Âè£ÊµÅÈáèÈÄüÁéáÊó∂ÔºåÂõ†‰∏∫ÊµÅÈáèÂÆπÂô®ÊòØÊúâÈôêÁöÑÔºåÂΩìË∂ÖÂá∫ÊµÅÈáèÂÆπÂô®Â§ßÂ∞èÊó∂ÔºåË∂ÖÂá∫ÁöÑÊµÅÈáè‰ºöË¢´‰∏¢ÂºÉ„ÄÇ‰∏ãÂõæÊØîËæÉÂΩ¢Ë±°ÁöÑËØ¥Êòé‰∫ÜÊºèÊ°∂ÁÆóÊ≥ïÁöÑÂéüÁêÜÔºåÂÖ∂‰∏≠Ê∞¥ÈæôÂ§¥ÊòØÂÖ•Âè£ÊµÅÈáèÔºåÊºèÊ°∂ÊòØÊµÅÈáèÂÆπÂô®ÔºåÂåÄÈÄüÊµÅÂá∫ÁöÑÊ∞¥ÊòØÂá∫Âè£ÊµÅÈáè„ÄÇ ÊºèÊ°∂ÁÆóÊ≥ïÁöÑÁâπÁÇπ ÊºèÊ°∂ÂÖ∑ÊúâÂõ∫ÂÆöÂÆπÈáèÔºåÂá∫Âè£ÊµÅÈáèÈÄüÁéáÊòØÂõ∫ÂÆöÂ∏∏ÈáèÔºàÊµÅÂá∫ËØ∑Ê±ÇÔºâ ÂÖ•Âè£ÊµÅÈáèÂèØ‰ª•‰ª•‰ªªÊÑèÈÄüÁéáÊµÅÂÖ•Âà∞ÊºèÊ°∂‰∏≠ÔºàÊµÅÂÖ•ËØ∑Ê±ÇÔºâ Â¶ÇÊûúÂÖ•Âè£ÊµÅÈáèË∂ÖÂá∫‰∫ÜÊ°∂ÁöÑÂÆπÈáèÔºåÂàôÊµÅÂÖ•ÊµÅÈáè‰ºöÊ∫¢Âá∫ÔºàÊñ∞ËØ∑Ê±ÇË¢´ÊãíÁªùÔºâ ‰ª£Á†ÅÂÆûÁé∞ ‚Äì LeakyBucketRateLimit.java ‰∏çËøáÂõ†‰∏∫ÊºèÊ°∂ÁÆóÊ≥ïÈôêÂà∂‰∫ÜÊµÅÂá∫ÈÄüÁéáÊòØ‰∏Ä‰∏™Âõ∫ÂÆöÂ∏∏ÈáèÂÄºÔºåÊâÄ‰ª•ÊºèÊ°∂ÁÆóÊ≥ï‰∏çÊîØÊåÅÂá∫Áé∞Á™ÅÂèëÊµÅÂá∫ÊµÅÈáè„ÄÇ‰ΩÜÊòØÂú®ÂÆûÈôÖÊÉÖÂÜµ‰∏ãÔºåÊµÅÈáèÂæÄÂæÄÊòØÁ™ÅÂèëÁöÑ„ÄÇ ‰ª§ÁâåÊ°∂ÁÆóÊ≥ï‰ª§ÁâåÊ°∂ÁÆóÊ≥ïÊòØÊºèÊ°∂ÁÆóÊ≥ïÁöÑÊîπËøõÁâàÔºåÂèØ‰ª•ÊîØÊåÅÁ™ÅÂèëÊµÅÈáè„ÄÇ‰∏çËøá‰∏éÊºèÊ°∂ÁÆóÊ≥ï‰∏çÂêåÁöÑÊòØÔºå‰ª§ÁâåÊ°∂ÁÆóÊ≥ïÁöÑÊºèÊ°∂‰∏≠Â≠òÊîæÁöÑÊòØ‰ª§ÁâåËÄå‰∏çÊòØÊµÅÈáè„ÄÇÈÇ£‰πà‰ª§ÁâåÊ°∂ÁÆóÊ≥ïÊòØÊÄé‰πàÁ™ÅÂèëÊµÅÈáèÁöÑÂë¢ÔºüÊúÄÂºÄÂßãÔºå‰ª§ÁâåÊ°∂ÊòØÁ©∫ÁöÑÔºåÊàë‰ª¨‰ª•ÊÅíÂÆöÈÄüÁéáÂæÄ‰ª§ÁâåÊ°∂ÈáåÂä†ÂÖ•‰ª§ÁâåÔºå‰ª§ÁâåÊ°∂Ë¢´Ë£ÖÊª°Êó∂ÔºåÂ§ö‰ΩôÁöÑ‰ª§Áâå‰ºöË¢´‰∏¢ÂºÉ„ÄÇÂΩìËØ∑Ê±ÇÂà∞Êù•Êó∂Ôºå‰ºöÂÖàÂ∞ùËØï‰ªé‰ª§ÁâåÊ°∂Ëé∑Âèñ‰ª§ÁâåÔºàÁõ∏ÂΩì‰∫é‰ªé‰ª§ÁâåÊ°∂ÁßªÈô§‰∏Ä‰∏™‰ª§ÁâåÔºâÔºåËé∑ÂèñÊàêÂäüÂàôËØ∑Ê±ÇË¢´ÊîæË°åÔºåËé∑ÂèñÂ§±Ë¥•ÂàôÈòªÂ°ûÊ¥ªÊãíÁªùËØ∑Ê±Ç„ÄÇ ‰ª§ÁâåÊ°∂ÁÆóÊ≥ïÁöÑÁâπÁÇπ ÊúÄÂ§öÂèØ‰ª•Â≠òÂèëb‰∏™‰ª§Áâå„ÄÇÂ¶ÇÊûú‰ª§ÁâåÂà∞ËææÊó∂‰ª§ÁâåÊ°∂Â∑≤ÁªèÊª°‰∫ÜÔºåÈÇ£‰πàËøô‰∏™‰ª§Áâå‰ºöË¢´‰∏¢ÂºÉ ËØ∑Ê±ÇÂà∞Êù•Êó∂ÔºåÂ¶ÇÊûú‰ª§ÁâåÊ°∂‰∏≠Â∞ë‰∫én‰∏™‰ª§ÁâåÔºåÈÇ£‰πà‰∏ç‰ºöÂà†Èô§‰ª§Áâå„ÄÇËØ•ËØ∑Ê±Ç‰ºöË¢´ÈôêÊµÅÔºàÈòªÂ°ûÊ¥ªÊãíÁªùÔºâ ÁÆóÊ≥ïÂÖÅËÆ∏ÊúÄÂ§ßb(‰ª§ÁâåÊ°∂Â§ßÂ∞è)‰∏™ËØ∑Ê±ÇÁöÑÁ™ÅÂèë ‰ª§ÁâåÊ°∂ÁÆóÊ≥ïÈôêÂà∂ÁöÑÊòØÂπ≥ÂùáÊµÅÈáèÔºåÂõ†Ê≠§ÂÖ∂ÂÖÅËÆ∏Á™ÅÂèëÊµÅÈáèÔºàÂè™Ë¶Å‰ª§ÁâåÊ°∂‰∏≠Êúâ‰ª§ÁâåÔºåÂ∞±‰∏ç‰ºöË¢´ÈôêÊµÅÔºâ ‰ª£Á†ÅÂÆûÁé∞ ‚Äì TokenBucketRateLimit.java ÊÄªÁªìËá≥Ê≠§ÔºåÂü∫Êú¨Êää‰ª•‰∏ä4ÁßçÈôêÊµÅÁÆóÊ≥ïÁöÑÂéüÁêÜÈÉΩËß£ÈáäÊ∏ÖÊ•ö‰∫Ü„ÄÇÊØèÁßçÈôêÊµÅÁÆóÊ≥ïÈÉΩÊúâÂÖ∂Âõ∫ÂÆöÁâπÁÇπÔºåÂèäÂêÑËá™ÈÄÇÁî®ÁöÑÂú∫ÊôØÔºåÂÖ∂‰∏≠ËÆ°Êï∞Âô®ÁÆóÊ≥ïÊòØÂÖ∂‰∏≠ÊúÄÁÆÄÂçïÁöÑÔºåÁõ∏ÂΩì‰∫éÊªëÂä®Á™óÂè£ÁÆóÊ≥ïÁöÑÁÆÄÂåñÁâàÔºå‰ª§ÁâåÊ°∂ÁÆóÊ≥ïÁõ∏ÊØîÊºèÊ°∂ÁÆóÊ≥ïÂØπËµÑÊ∫êÁöÑÂà©Áî®ÁéáÊõ¥È´òÔºàÂÖÅËÆ∏Á™ÅÂèëÊµÅÈáèÔºâ]]></content>
      <categories>
        <category>ÁÆóÊ≥ï</category>
        <category>ÂàÜÂ∏ÉÂºè</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
        <tag>ÁÆóÊ≥ï</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVA‰∏≠Êó∂Èó¥ÁöÑË°®Áé∞ÂΩ¢Âºè]]></title>
    <url>%2F2019%2F09%2F26%2FJAVA%E4%B8%AD%E6%97%B6%E9%97%B4%E7%9A%84%E8%A1%A8%E7%8E%B0%E5%BD%A2%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂ§ßÂ§öÊï∞Êó∂ÂÄôÊàë‰ª¨Âú®Ë°®Á§∫Êó∂Èó¥ÁöÑÊ¶ÇÂøµÊó∂ÔºåÂèØËÉΩÂπ∂‰∏ç‰ºöÂéªÁâπÊÑèÂÖ≥Ê≥®Êó∂Âå∫Ëøô‰∏™Ê¶ÇÂøµÔºåÊØïÁ´üÂú®ÂõΩÂÜÖÊó∂Âå∫ÈÉΩÊòØÁªü‰∏ÄÁöÑÔºåÊàë‰ª¨Âè™ÈúÄË¶Å‰ΩøÁî®ÈªòËÆ§Êó∂Âå∫ Âåó‰∫¨Êó∂Èó¥ Â∞±ÂèØ‰ª•‰∫Ü„ÄÇÊòØÁöÑÔºåÂú®ÂÜôËøôÁØáÊñáÁ´†‰πãÂâçÔºåÊàë‰πüÊ≤°ÊúâËøáÂ§öÁöÑÂéªÂÖ≥Ê≥®Êó∂Âå∫ÁöÑÊ¶ÇÂøµÔºå‰ª•ÂèäÂú®JAVA‰∏≠ÁöÑË°®Áé∞ÂΩ¢Âºè„ÄÇ‰ΩÜÊòØÂõ†‰∏∫ÁõÆÂâçÊâÄÂú®ÁöÑÂÖ¨Âè∏ÊòØË∑®Â¢ÉÂÖ¨Âè∏ÔºåÂÖ¨Âè∏‰∏ªË¶Å‰∏öÂä°Âú®Âç∞Â∫¶ÔºåÂç∞Â∫¶Êó∂Èó¥Ë∑üÂåó‰∫¨Êó∂Èó¥ÊòæÁÑ∂ÊòØ‰∏çÂêåÁöÑ„ÄÇ Êó∂Âå∫ÁöÑÊ¶ÇÂøµÂú®Ëøô‰πãÂâçÂÖàËØ¥‰∏Ä‰∏ãÊó∂Âå∫ÁöÑÊ¶ÇÂøµÔºå‰ª•ÂèäËß£ÈáäÂá†‰∏™‰∏ìÊúâÂêçËØç„ÄÇÊó∂Âå∫ÊòØÂú∞ÁêÉ‰∏äÁöÑÂå∫Âüü‰ΩøÁî®Âêå‰∏Ä‰∏™Êó∂Èó¥ÂÆö‰πâÔºåÊï¥‰∏™ÂÖ®ÁêÉË¢´ÂàÜÊàê24‰∏™Êó∂Âå∫„ÄÇÊâÄ‰ª•ÊØèÂ∑Æ‰∏Ä‰∏™Êó∂Âå∫ÔºåÂå∫Êó∂Áõ∏Â∑Æ‰∏Ä‰∏™Â∞èÊó∂ÔºåÁõ∏Â∑ÆÂ§öÂ∞ë‰∏™Êó∂Âå∫ÔºåÂ∞±Áõ∏Â∑ÆÂ§öÂ∞ë‰∏™Â∞èÊó∂„ÄÇ‰∏úËæπÁöÑÊó∂Âå∫Êó∂Èó¥ÊØîË•øËæπÁöÑÊó∂Âå∫Êó∂Èó¥Êó©„ÄÇÂåó‰∫¨Êó∂Èó¥ÊåáÁöÑÂ∞±ÊòØ‰∏úÂÖ´Âå∫ÁöÑÊó∂Èó¥„ÄÇ UTCÊó∂Èó¥ÂíåÊú¨Âú∞Êó∂Èó¥UTCÊó∂Èó¥ÂèàÁß∞ÂçèË∞É‰∏ñÁïåÊó∂ÔºåÊòØÊúÄ‰∏ªË¶ÅÁöÑ‰∏ñÁïåÊó∂Èó¥Ê†áÂáÜÔºåÂÖ∂‰ª•ÂéüÂ≠êÊó∂ÁßíÈïø‰∏∫Âü∫Á°ÄÔºåÂú®Êó∂Âàª‰∏äÂ∞ΩÈáèÊé•Ëøë‰∫éÊ†ºÊûóÂ∞ºÊ≤ªÊ†áÂáÜÊó∂Èó¥(GMT)„ÄÇÂØπ‰∫éÂ§ßÂ§öÊï∞Áî®ÈÄîÊù•ËØ¥ÔºåUTCÊó∂Èó¥Ë¢´ËÆ§‰∏∫ËÉΩ‰∏éGMTÊó∂Èó¥‰∫íÊç¢Ôºå‰ΩÜGMTÊó∂Èó¥Â∑≤‰∏çÂÜçË¢´ÁßëÂ≠¶ÁïåÊâÄÁ°ÆÂÆö„ÄÇÂ¶ÇÊûúÊó∂Èó¥ÊòØ‰ª•ÂçèË∞É‰∏ñÁïåÊó∂ÔºàUTCÔºâË°®Á§∫ÔºåÂàôÂú®Êó∂Èó¥ÂêéÈù¢Áõ¥Êé•Âä†‰∏ä‰∏Ä‰∏™‚ÄúZ‚ÄùÔºà‰∏çÂä†Á©∫Ê†ºÔºâ„ÄÇ‚ÄúZ‚ÄùÊòØÂçèË∞É‰∏ñÁïåÊó∂‰∏≠0Êó∂Âå∫ÁöÑÊ†áÂøó„ÄÇ UTCÂÅèÁßªÈáèÂíåÊú¨Âú∞Êó∂Èó¥‰æãÂ¶ÇÂåó‰∫¨Êó∂Èó¥ÁöÑUTCÂÅèÁßªÈáèÊòØ +8ÔºåÂàôÂΩìUTCÊó∂Èó¥ÊòØ 2:00 Êó∂ÔºåÂåó‰∫¨Êó∂Èó¥ÁöÑ 10:00„ÄÇÊâÄ‰ª•ÂÄüÂä©‰∫éUTCÊó∂Èó¥ÔºåÊàë‰ª¨ÂèØ‰ª•ÊääÂÖ®ÁêÉÁöÑÊó∂Èó¥ÈÉΩÁªü‰∏ÄËµ∑Êù•„ÄÇ Êó∂Èó¥Êà≥Êó∂Âå∫ÂèØ‰ª•ÂæàÂ•ΩÁöÑË°®Á§∫ÂêÑÂú∞ÁöÑÊó∂Èó¥Ôºå‰ΩÜÂêÑ‰∏™Êó∂Âå∫ÁöÑÂ≠óÈù¢Êó∂Èó¥ÊòæÁ§∫‰ªçÁÑ∂ËøòÊòØ‰∏çÂêåÁöÑÔºåÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶Å‰∏ÄÁßçÊñπÂºèÂú®Êù•ËÆ©‰∏ñÁïåÂêÑ‰∏™ËßíËêΩÁöÑÊó∂Èó¥ÈÉΩÊúâ‰∏ÄÊ†∑ÁöÑË°®Áé∞ÂΩ¢Âºè„ÄÇËøôÂºïÁî≥Âá∫‰∫ÜÊó∂Èó¥Êà≥Ôºå‰πüË¢´Áß∞‰∏∫UnixÊó∂Èó¥(Unix time)ÔºåÂÆö‰πâ‰∏∫‰ªéÊ†ºÊûóÂ®ÅÊ≤ªÊó∂Èó¥1970Âπ¥01Êúà01Êó•00Êó∂00ÂàÜ00ÁßíËµ∑Ëá≥Áé∞Âú®ÁöÑÊÄªÁßíÊï∞„ÄÇ Java8‰∏≠ÁöÑÊó∂Èó¥Á±ªÂûãÂú®JAVA8‰∏≠ÔºåÊèê‰æõ‰∫ÜÊñ∞ÁöÑÊó∂Èó¥Êó•ÊúüÊìç‰ΩúÁ±ªÔºåÁõ∏ÂØπ‰∫é‰πãÂâçÁöÑ Date Á±ªÔºåÂèØ‰ª•ËØ¥‰ΩøÁî®Ëµ∑Êù•Êñπ‰æø‰∫ÜËÆ∏Â§öÔºå‰∏ãÈù¢‰æùÊ¨°Êù•‰ªãÁªçÂá†‰∏™ÂÖ≥ÈîÆÁ±ª„ÄÇ Instant Áî®Êù•Ë°®Á§∫Êó∂Èó¥Êà≥ LocalDateTime ÂçïÁ∫ØË°®Á§∫Â≠óÈù¢Êó∂Èó¥Ôºå‰∏çÂ∏¶Êó∂Âå∫‰ø°ÊÅØ„ÄÇ‰πüÂ∞±ÊòØËØ¥ LocalDateTime = 2019-09-25 00:00:00ÔºåËøô‰∏™Êó∂Èó¥Êàë‰ª¨Âπ∂‰∏çÁü•ÈÅìÊòØÂåó‰∫¨Êó∂Èó¥ËøòÊòØ‰∏ú‰∫¨Êó∂Èó¥Ôºå‰ªÖ‰ªÖÁî®‰ΩúÂ≠óÈù¢Êó∂Èó¥ ZonedDateTime Âê´ÊúâÊó∂Âå∫‰ø°ÊÅØÁöÑÊó∂Èó¥ÔºåÁ±ª‰ºº‰∫éÂåó‰∫¨Êó∂Èó¥ÔºåUTC+8 ÂÆÉ‰ª¨Â¶Ç‰ΩïË°®Á§∫Êó∂Èó¥12345678System.out.println(LocalDateTime.now());System.out.println(Instant.now());System.out.println(ZonedDateTime.now());ËæìÂá∫2019-09-26T14:50:43.7412019-09-26T06:50:43.742Z2019-09-26T14:50:43.803+08:00[Asia/Shanghai] ÂèØ‰ª•ÁúãÂà∞LocalDateTime ‰ºöÊ†πÊçÆUTCÊó∂Èó¥Ëé∑ÂèñÂà∞Êú¨Âú∞Êó∂Èó¥ÊòæÁ§∫Ôºå‰ΩÜÊòØ‰ºöÊääÊó∂Âå∫‰ø°ÊÅØ‰∏¢ÂºÉInstant ÂàôÁõ¥Êé•Ë°®Á§∫ÁöÑUTC‰∏ñÁïåÊ†áÂáÜÊó∂Èó¥ZonedDateTime ‰ºöÊ†πÊçÆUTCÊó∂Èó¥Ëé∑ÂèñÂà∞Êú¨Âú∞Êó∂Èó¥ÊòæÁ§∫ÔºåÂêåÊó∂‰πü‰ºöÊòæÁ§∫ÂΩìÂâçÁöÑÊó∂Âå∫‰ø°ÊÅØ ÂÖ∂ÂÆûZonedDateTime ÊòØÁî± Instant Âä†‰∏äÊó∂Âå∫‰ø°ÊÅØÁªìÂêàËÄåÊù•ÔºåÈÄöËøáZonedDateTimeÂèØ‰ª•Áõ¥Êé•Ëé∑ÂèñÂà∞InstantÊó∂Èó¥Êà≥‰ø°ÊÅØ Â¶Ç‰ΩïËΩ¨Êç¢ËΩ¨Êç¢ÁöÑÊ†∏ÂøÉÂÖ∂ÂÆûÈÉΩÊòØÂæÄÊó∂Èó¥Êà≥Ôºà‰∏ñÁïåÊ†áÂáÜÊó∂Èó¥ÔºâÈù†Êã¢ÔºåËØïÊÉ≥ÊòØ‰∏çÊòØËøôÊ†∑ÔºüÂè™ÊúâËΩ¨Êàê‰∫ÜÊ†áÂáÜÊó∂Èó¥ÊâçËÉΩËΩ¨ÊàêÂÖ∂‰ªñÊó∂Âå∫ÁöÑÊó∂Èó¥ ZonedDateTime Instant 1234567// zonedDateTime -&gt; instantZonedDateTime zonedDateTime = ZonedDateTime.now();Instant instant = zonedDateTime.toInstant();// instant -&gt; zonedDateTime Ë¶ÅÊåáÂÆöÊó∂Âå∫‰ø°ÊÅØZoneId DEFAULT_ZONE_ID = ZoneId.of("Asia/Shanghai");zonedDateTime = instant.atZone(DEFAULT_ZONE_ID); LocalDateTime Instant 12345678// LocalDateTime -&gt; InstantLocalDateTime localDateTime = LocalDateTime.now();Instant instant = localDateTime.toInstant(ZoneOffset.of("+08:00"));// Instant -&gt; ZonedDateTime -&gt; LocalDateTime// Instant ÈúÄË¶ÅÂÖàËΩ¨Êç¢Êàê ZonedDateTime ÂÜçËΩ¨Êç¢ÊàêÊú¨Âú∞Êó∂Èó¥ZonedDateTime zonedDateTime = instant.atZone(ZoneId.of("Asia/Shanghai"));localDateTime = zonedDateTime.toLocalDateTime(); LocalDateTime ZonedDateTime 123456// LocalDateTime -&gt; ZonedDateTime ÈúÄË¶ÅÊåáÂÆöÊú¨Âú∞ÊâÄÂú®Êó∂Âå∫LocalDateTime localDateTime = LocalDateTime.now();ZonedDateTime zonedDateTime = localDateTime.atZone(ZoneId.of("Asia/Shanghai"));// Áõ¥Êé•ËΩ¨Êç¢ÊàêÊú¨Âú∞Êó∂Èó¥localDateTime = zonedDateTime.toLocalDateTime(); ÂèØ‰ª•ÁúãÂà∞ÔºåÂú®ËΩ¨Êç¢ËøáÁ®ã‰∏≠Ôºå‰ºöÈ¢ëÁπÅÁöÑÊâãÂä®ÊåáÂÆöÊó∂Âå∫Ôºå‰∏ªË¶ÅÂéüÂõ†ÊòØLocalDateTimeÂπ∂‰∏çÂ∏¶ÊúâÊó∂Âå∫‰ø°ÊÅØÔºåÂ¶ÇÊûúÊàë‰ª¨Ë¶ÅËΩ¨Êç¢ÊàêÊ†áÂáÜÊó∂Èó¥ÔºåÂ∞±ÈúÄË¶ÅÊâãÂä®ÊåáÂÆöÊó∂Âå∫„ÄÇÊâÄ‰ª•‰∏∫‰∫ÜÈÅøÂÖçËΩ¨Êç¢ËøáÁ®ã‰∏≠ÁöÑÈîôËØØÔºåÊàë‰ª¨Â∫îËØ•Â∞ΩÈáè‰ΩøÁî®Êó∂Èó¥Êà≥Êù•Êù•‰º†ËæìÊó∂Èó¥„ÄÇ ‰∏éÂÖ∂‰ªñapiÁöÑËΩ¨Êç¢ Timestamp LocalDateTime 123456789// Timestamp -&gt; LocalDateTimeTimestamp timestamp = Timestamp.from(Instant.now());LocalDateTime localDateTime = timestamp.toLocalDateTime();// LocalDateTime -&gt; Timestamp Êúâ‰∏§ÁßçÊñπÂºè// 1. Áõ¥Êé•ÊåâÊú¨Âú∞ÈªòËÆ§Êó∂Âå∫ËΩ¨Êó∂Âå∫timestamp = Timestamp.valueOf(localDateTime);// 2. ÊåáÂÆöÊó∂Âå∫ËΩ¨timestamp = Timestamp.from(localDateTime.toInstant(ZoneOffset.of(&quot;+08:00&quot;))); Date LocalDateTime 123456// Date -&gt; LocalDateTimeDate date = new Date();LocalDateTime localDateTime = date.toInstant().atZone(ZoneId.of("Asia/Shanghai")).toLocalDateTime();// LocalDateTime -&gt; Datedate = Date.from(localDateTime.toInstant(ZoneOffset.of("+08:00"))); Êõ¥Â§ö‰æãÂ≠êDateTimeUtils.java ÊÄªÁªìÊúÄÂêéËøòÊòØÂª∫ËÆÆÊìç‰ΩúÊó∂Èó¥Êó∂‰ΩøÁî®Êó∂Èó¥Êà≥ÔºåËøôÊ†∑Â≠êÊ≤°ÊúâÊó∂Âå∫ÁöÑÊ¶ÇÂøµÔºå‰πüÂ∞±‰∏ç‰ºö‰∫ßÁîüÊ≠ß‰πâ„ÄÇ]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
      </categories>
      <tags>
        <tag>javaÂü∫Á°Ä</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringÁöÑ@Configuration @BeanÊ≥®Ëß£]]></title>
    <url>%2F2019%2F09%2F03%2FSpring%E7%9A%84-Configuration-Bean%E6%B3%A8%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰πãÂâçSpring ‰∏ÄÁõ¥Áî®ÁöÑxmlÈÖçÁΩÆÊñá‰ª∂ÊØîËæÉÂ§öÔºåÁé∞Âú®ÂèëÁé∞Êñ∞ÂÖ¨Âè∏Áî®ÁöÑÊ≥®Ëß£ÊØîËæÉÂ§ö„ÄÇ‰πüÂ∞±ÊòØÈÄöËøáÂÆö‰πâ‰∏Ä‰∏™ÈÖçÁΩÆÁ±ª(‰ª•@ConfigurationÊ≥®Ëß£ÁöÑÁ±ª)ÂÜÖÈÉ®Âú®ÊñπÊ≥ï‰∏äÊ≥®Ëß£ @Bean Ê≥®Ëß£Êù•ÂÆåÊàêBeanÁöÑ‰æùËµñÊ≥®ÂÖ•SpringÂÆπÂô®„ÄÇÁî®Ê≥®Ëß£Êù•ÈÖçÁΩÆÁöÑËØùÔºåÂÖ∂ÂÆûÂ∞±ÊòØÂáèÂ∞ë‰∫ÜÈÖçÁΩÆÊñá‰ª∂ÁöÑÂ∑•‰ΩúÔºå‰ΩÜÊÄª‰ΩìÊù•ËØ¥‰ª£Á†ÅÂèØËØªÊÄßÂÖ∂ÂÆûÊòØ‰ºö‰∏ãÈôçÁöÑ„ÄÇ‰∏çËøá‰πüÁúÅÂéª‰∫Ü‰∏ÄÂ§ßÂ†ÜÁöÑxmlÈÖçÁΩÆÊñá‰ª∂ Áõ¥Êé•ÁúãÊ∫êÁ†Å‰∏ãÈù¢Â∞±‰ªéÊ∫êÁ†ÅÂ±ÇÈù¢Êù•ÁúãÁúã ÈÄöËøáÊ≥®Ëß£ÈÖçÁΩÆÊúâ‰ªÄ‰πà‰∏çÂêå ‰πãÂâçÊúâÂàÜÊûêËøáSpringÂØπBeanÁöÑËß£ÊûêÔºåÊòØÈÄöËøáÊääÊàë‰ª¨ÈÖçÁΩÆÁöÑBean‰ø°ÊÅØÊäΩË±°Êàê‰∫Ü‰∏Ä‰∏™BeanDefiniionÂØπË±°„ÄÇËøô‰∏™ÂØπË±°ÊåÅÊúâ‰∫ÜÊàë‰ª¨ÈÖçÁΩÆÁöÑBeanÁöÑÂÖÉÊï∞ÊçÆ ÈÇ£‰πàÂÖ∂ÂÆû @Bean ÁöÑÊ≥®Ëß£ÁöÑÂéüÁêÜ‰πüÊòØÁ±ª‰ººÔºå‰πüÊòØÈÄöËøáÂ∞ÜÊàë‰ª¨ÈÖçÁΩÆÁöÑBean‰ø°ÊÅØÊäΩË±°Êàê‰∏Ä‰∏™BeanDefiniionÂØπË±° ËøôÈáåÊàë‰ª¨ÂàÜ‰∏§ÁßçÊÉÖÂÜµËÆ®ËÆ∫Ôºå‰∏ÄÁßçÊòØ Spring ÈÄöËøá xmlÊñá‰ª∂ÈÖçÁΩÆÂÆûÁé∞Ê≥®Ëß£ÈÖçÁΩÆÔºå‰∏ÄÁßçÂ∞±ÊòØÊàë‰ª¨Áé∞Âú®ÈùûÂ∏∏ÊµÅË°åÁöÑ SpringBootÂÆûÁé∞ÁöÑÊ≥®Ëß£ÈÖçÁΩÆ„ÄÇÂÖ∂ÂÆû‰∏§ËÄÖÂÆûÁé∞ÂéüÁêÜ‰∏ÄËá¥ÔºåÂè™ÊòØÈÖçÁΩÆÂÖ•Âè£Áï•Êúâ‰∏çÂêå„ÄÇ ÂÖàÁúã ÊôÆÈÄö Spring Â∫îÁî®ÁöÑÈÖçÁΩÆ: Â¶ÇÊûúÊàë‰ª¨Ë¶ÅÂú® ÊôÆÈÄö Spring Â∫îÁî®‰∏≠ÂÆûÁé∞Ê≥®Ëß£ÈÖçÁΩÆ„ÄÇÈÇ£‰πàÊàë‰ª¨ÈúÄË¶ÅÂú®SpringÁöÑÈÖçÁΩÆÊñá‰ª∂‰∏≠ÈÖçÁΩÆ‰ª•‰∏ãÂá†‰∏™ÈÖçÁΩÆ 1234&lt;context:annotation-config&gt;&lt;context:component-scan&gt; Ëøô‰∏§‰∏™ÈÖçÁΩÆÁöÑÊÑèÊÄùÊòØ‰ªÄ‰πàÂë¢Ôºü Êàë‰ª¨Áõ¥Êé•ÁúãSpringÊòØÂ¶Ç‰ΩïËß£ÊûêËøô‰∏§‰∏™Ê†áÁ≠æÁöÑÂêßÔºåÈÄöËøáÂú®META-INF/spring.handlersÁõÆÂΩï‰∏ãÊ†πÊçÆspring.handlersÊñá‰ª∂ÂèØ‰ª•ÊâæÂà∞ Context Ê†áÁ≠æ Ëß£ÊûêÂÖ•Âè£Á±ª ContextNamespaceHandler 1234567891011121314151617181920212223242526public class ContextNamespaceHandler extends NamespaceHandlerSupport &#123;@Overridepublic void init() &#123;registerBeanDefinitionParser("property-placeholder", new PropertyPlaceholderBeanDefinitionParser());registerBeanDefinitionParser("property-override", new PropertyOverrideBeanDefinitionParser());registerBeanDefinitionParser("annotation-config", new AnnotationConfigBeanDefinitionParser());registerBeanDefinitionParser("component-scan", new ComponentScanBeanDefinitionParser());registerBeanDefinitionParser("load-time-weaver", new LoadTimeWeaverBeanDefinitionParser());registerBeanDefinitionParser("spring-configured", new SpringConfiguredBeanDefinitionParser());registerBeanDefinitionParser("mbean-export", new MBeanExportBeanDefinitionParser());registerBeanDefinitionParser("mbean-server", new MBeanServerBeanDefinitionParser());&#125;&#125; Áúã‰∫Ü‰∏äÈù¢ÁöÑËß£ÊûêÊ∫êÁ†ÅÔºåÂèØ‰ª•Áü•ÈÅìannotation-configÁî±AnnotationConfigBeanDefinitionParserËß£Êûê„ÄÇcomponent-scanÁî±ComponentScanBeanDefinitionParserËß£Êûê„ÄÇËøôÈáåÂ∞±ÊòØSpring XML Ê≥®Ëß£ÈÖçÁΩÆÁöÑÂÖ•Âè£Ôºå‰∏ãÈù¢Êàë‰ª¨Êù•‰æùÊ¨°ÂàÜÊûêËøô‰∏§‰∏™Ëß£ÊûêÁ±ªÂπ≤‰∫Ü‰ªÄ‰πà‰∫ãÊÉÖÔºü ComponentScanBeanDefinitionParser 1234567891011121314151617181920212223242526public BeanDefinition parse(Element element, ParserContext parserContext) &#123;String basePackage = element.getAttribute(BASE_PACKAGE_ATTRIBUTE);basePackage = parserContext.getReaderContext().getEnvironment().resolvePlaceholders(basePackage);String[] basePackages = StringUtils.tokenizeToStringArray(basePackage,ConfigurableApplicationContext.CONFIG_LOCATION_DELIMITERS);// Actually scan for bean definitions and register them.ClassPathBeanDefinitionScanner scanner = configureScanner(parserContext, element); // ËøôÈáåÊâ´Êèè‰∫ÜÊàë‰ª¨ÈÖçÁΩÆÁöÑ base-package ÂåÖ‰∏ãÂÖ®ÈÉ® beanDefinitionsÔºåÂπ∂ÊäΩË±°Êàê‰∫Ü BeanDefinitionHolderÁ±ªSet&lt;BeanDefinitionHolder&gt; beanDefinitions = scanner.doScan(basePackages); // Â∞ÜÊäΩË±°ÁöÑ beanDefinitions ÂÖ®ÈÉ®Ê≥®ÂÜåËøõ SpringÂÆπÂô®‰∏≠ÔºåÊ≥® ËøôÈáåÂåÖÂê´‰∫ÜË¢´@ConfigurationÊ≥®Ëß£ÁöÑÁ±ªregisterComponents(parserContext.getReaderContext(), beanDefinitions, element);return null;&#125; AnnotationConfigBeanDefinitionParser ‰∏ªË¶ÅÈÄªËæëÂú® AnnotationConfigUtils Â∑•ÂÖ∑Á±ªÁöÑ registerAnnotationConfigProcessorsÊñπÊ≥ï‰∏≠ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166public BeanDefinition parse(Element element, ParserContext parserContext) &#123;Object source = parserContext.extractSource(element);// ÂàùÂßãÂåñ‰∏Ä‰∫õ BeanFactoryPostProcessor ËøõSpringÂÆπÂô®Ôºå‰ºöÂú®getBean‰πãÂâçÂÖ®ÈÉ®ÊâßË°å„ÄÇ // ‰∏ÄËà¨Áî®Êù•Âú®ÂÆπÂô®ÂÆû‰æãÂåñBeanÂâçÔºåÂØπBeanDefinitionÂÅö‰øÆÊîπÔºåÊàñÊ∑ªÂä†Êñ∞ÁöÑBeanDefinitionÁ≠âÂâçÁΩÆ‰øÆÊîπ // ‰∏ªË¶ÅÈÄªËæëÂ∞±Âú®ËøôÈáåSet&lt;BeanDefinitionHolder&gt; processorDefinitions =AnnotationConfigUtils.registerAnnotationConfigProcessors(parserContext.getRegistry(), source);// Register component for the surrounding &lt;context:annotation-config&gt; element.CompositeComponentDefinition compDefinition = new CompositeComponentDefinition(element.getTagName(), source);parserContext.pushContainingComponent(compDefinition);// Nest the concrete beans in the surrounding component.for (BeanDefinitionHolder processorDefinition : processorDefinitions) &#123;parserContext.registerComponent(new BeanComponentDefinition(processorDefinition));&#125;// Finally register the composite component.parserContext.popAndRegisterContainingComponent();return null;&#125;// AnnotationConfigUtils.class// Ê∑ªÂä†ÊîØÊåÅ annotation-config ÈÖçÁΩÆÁöÑ‰∏Ä‰∫õBeanFactoryPostProcessor ÂÆûÁé∞Á±ªpublic static Set&lt;BeanDefinitionHolder&gt; registerAnnotationConfigProcessors(BeanDefinitionRegistry registry, @Nullable Object source) &#123;DefaultListableBeanFactory beanFactory = unwrapDefaultListableBeanFactory(registry);if (beanFactory != null) &#123;if (!(beanFactory.getDependencyComparator() instanceof AnnotationAwareOrderComparator)) &#123;beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);&#125;if (!(beanFactory.getAutowireCandidateResolver() instanceof ContextAnnotationAutowireCandidateResolver)) &#123;beanFactory.setAutowireCandidateResolver(new ContextAnnotationAutowireCandidateResolver());&#125;&#125;Set&lt;BeanDefinitionHolder&gt; beanDefs = new LinkedHashSet&lt;&gt;(8);// @Configuration Ê≥®Ëß£Ëß£Êûêif (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;RootBeanDefinition def = new RootBeanDefinition(ConfigurationClassPostProcessor.class);def.setSource(source);beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME));&#125; // @Autowired Ê≥®Ëß£Ëß£Êûêif (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;RootBeanDefinition def = new RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class);def.setSource(source);beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));&#125;// @Required Ê≥®Ëß£Ëß£Êûêif (!registry.containsBeanDefinition(REQUIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;RootBeanDefinition def = new RootBeanDefinition(RequiredAnnotationBeanPostProcessor.class);def.setSource(source);beanDefs.add(registerPostProcessor(registry, def, REQUIRED_ANNOTATION_PROCESSOR_BEAN_NAME));&#125;// Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor. // ÂØπ JSR-250ÂÅöÊîØÊåÅ Ëß£ÊûêÊ≥®Ëß£ @Resource @PostConstruct @PreDestroy if (jsr250Present &amp;&amp; !registry.containsBeanDefinition(COMMON_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;RootBeanDefinition def = new RootBeanDefinition(CommonAnnotationBeanPostProcessor.class);def.setSource(source);beanDefs.add(registerPostProcessor(registry, def, COMMON_ANNOTATION_PROCESSOR_BEAN_NAME));&#125;// Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.if (jpaPresent &amp;&amp; !registry.containsBeanDefinition(PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME)) &#123;RootBeanDefinition def = new RootBeanDefinition();try &#123;def.setBeanClass(ClassUtils.forName(PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME,AnnotationConfigUtils.class.getClassLoader()));&#125;catch (ClassNotFoundException ex) &#123;throw new IllegalStateException("Cannot load optional framework class: " + PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME, ex);&#125;def.setSource(source);beanDefs.add(registerPostProcessor(registry, def, PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME));&#125;if (!registry.containsBeanDefinition(EVENT_LISTENER_PROCESSOR_BEAN_NAME)) &#123;RootBeanDefinition def = new RootBeanDefinition(EventListenerMethodProcessor.class);def.setSource(source);beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_PROCESSOR_BEAN_NAME));&#125;if (!registry.containsBeanDefinition(EVENT_LISTENER_FACTORY_BEAN_NAME)) &#123;RootBeanDefinition def = new RootBeanDefinition(DefaultEventListenerFactory.class);def.setSource(source);beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_FACTORY_BEAN_NAME));&#125;return beanDefs;&#125; ÂèØ‰ª•ÁúãÂà∞ annotation-config ÈÖçÁΩÆÂÖ∂ÂÆûÂ∞±ÊòØÊ∑ªÂä†‰∫ÜÂá†‰∏™ BeanFactoryPostProcessor ÂÆûÁé∞Á±ªÔºå‰ª•Ê≠§Êù•ÂÆûÁé∞ Autowired Configuration @Resource @PostConstruct @PreDestroy Á≠âÊ≥®Ëß£ÁöÑÂÆûÁé∞„ÄÇÂÖ∂‰ªñÁöÑÊ≥®Ëß£ÊöÇ‰∏î‰∏çÁúãÔºåÊàë‰ª¨Áõ¥Êé•Áúã‰ªäÂ§©ÁöÑÈáçÁÇπ Configuration Ê≥®Ëß£ÊòØÂ¶Ç‰ΩïËß£ÊûêÔºå@ConfigurationÊòØÈÄöËøá BeanFactoryPostProcessor ÁöÑÂÆûÁé∞Á±ª ConfigurationClassPostProcessor Á±ªÂú®SpringÂêØÂä®ÁöÑÊó∂ÂÄôÊâßË°åÁöÑÔºàÂÖ∑‰ΩìBeanFactoryPostProcessorÁöÑÊâßË°åÊó∂Êú∫ÂèØ‰ª•ÁúãÊàëÂè¶‰∏ÄÁØáÂçöÊñá[ ÈìæÊé•](https://www.yuque.com/wangjunnan/pnhnfo/bx15ai)Ôºâ ConfigurationClassPostProcessor 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) &#123;int registryId = System.identityHashCode(registry); // Âà§Êñ≠ÊòØÂê¶Â∑≤ÁªèÊâßË°åËøáif (this.registriesPostProcessed.contains(registryId)) &#123;throw new IllegalStateException("postProcessBeanDefinitionRegistry already called on this post-processor against " + registry);&#125;if (this.factoriesPostProcessed.contains(registryId)) &#123;throw new IllegalStateException("postProcessBeanFactory already called on this post-processor against " + registry);&#125;this.registriesPostProcessed.add(registryId); // Ê≠£ÂºèÊâßË°åÈÄªËæëprocessConfigBeanDefinitions(registry);&#125;public void processConfigBeanDefinitions(BeanDefinitionRegistry registry) &#123;List&lt;BeanDefinitionHolder&gt; configCandidates = new ArrayList&lt;&gt;();String[] candidateNames = registry.getBeanDefinitionNames();// ÈÅçÂéÜÊâÄÊúâ BeanDefinition namefor (String beanName : candidateNames) &#123;BeanDefinition beanDef = registry.getBeanDefinition(beanName); // Âà§Êñ≠ÊòØÂê¶Â∑≤ÁªèÂ§ÑÁêÜËøáif (ConfigurationClassUtils.isFullConfigurationClass(beanDef) ||ConfigurationClassUtils.isLiteConfigurationClass(beanDef)) &#123;if (logger.isDebugEnabled()) &#123;logger.debug("Bean definition has already been processed as a configuration class: " + beanDef);&#125;&#125; // Êù°‰ª∂Á≠õÈÄâelse if (ConfigurationClassUtils.checkConfigurationClassCandidate(beanDef, this.metadataReaderFactory)) &#123;configCandidates.add(new BeanDefinitionHolder(beanDef, beanName));&#125;&#125;// Ê†ìÈÄâÂÆå‰∏∫Á©∫ Áõ¥Êé•ËøîÂõûif (configCandidates.isEmpty()) &#123;return;&#125;// Ê†πÊçÆ @Order Ê≥®Ëß£ÊéíÂ∫èconfigCandidates.sort((bd1, bd2) -&gt; &#123;int i1 = ConfigurationClassUtils.getOrder(bd1.getBeanDefinition());int i2 = ConfigurationClassUtils.getOrder(bd2.getBeanDefinition());return Integer.compare(i1, i2);&#125;);// Detect any custom bean name generation strategy supplied through the enclosing application context // Ëé∑Âèñ BeanName ÁîüÊàêÁ≠ñÁï•SingletonBeanRegistry sbr = null;if (registry instanceof SingletonBeanRegistry) &#123;sbr = (SingletonBeanRegistry) registry;if (!this.localBeanNameGeneratorSet) &#123;BeanNameGenerator generator = (BeanNameGenerator) sbr.getSingleton(CONFIGURATION_BEAN_NAME_GENERATOR);if (generator != null) &#123;this.componentScanBeanNameGenerator = generator;this.importBeanNameGenerator = generator;&#125;&#125;&#125;if (this.environment == null) &#123;this.environment = new StandardEnvironment();&#125;// Parse each @Configuration class // Ëß£Êûê @Configuration Ê≥®Ëß£ConfigurationClassParser parser = new ConfigurationClassParser(this.metadataReaderFactory, this.problemReporter, this.environment,this.resourceLoader, this.componentScanBeanNameGenerator, registry);Set&lt;BeanDefinitionHolder&gt; candidates = new LinkedHashSet&lt;&gt;(configCandidates);Set&lt;ConfigurationClass&gt; alreadyParsed = new HashSet&lt;&gt;(configCandidates.size());do &#123;parser.parse(candidates);parser.validate();Set&lt;ConfigurationClass&gt; configClasses = new LinkedHashSet&lt;&gt;(parser.getConfigurationClasses());configClasses.removeAll(alreadyParsed);// Read the model and create bean definitions based on its content // ËØªÂèñÂπ∂Ëß£ÊûêÊ≥®ÂÜå BeanDefinitionif (this.reader == null) &#123;this.reader = new ConfigurationClassBeanDefinitionReader(registry, this.sourceExtractor, this.resourceLoader, this.environment,this.importBeanNameGenerator, parser.getImportRegistry());&#125;this.reader.loadBeanDefinitions(configClasses);alreadyParsed.addAll(configClasses);candidates.clear(); // Â§ÑÁêÜÊñ∞Âä†ÂÖ•ÁöÑif (registry.getBeanDefinitionCount() &gt; candidateNames.length) &#123;String[] newCandidateNames = registry.getBeanDefinitionNames();Set&lt;String&gt; oldCandidateNames = new HashSet&lt;&gt;(Arrays.asList(candidateNames));Set&lt;String&gt; alreadyParsedClasses = new HashSet&lt;&gt;();for (ConfigurationClass configurationClass : alreadyParsed) &#123;alreadyParsedClasses.add(configurationClass.getMetadata().getClassName());&#125;for (String candidateName : newCandidateNames) &#123;if (!oldCandidateNames.contains(candidateName)) &#123;BeanDefinition bd = registry.getBeanDefinition(candidateName);if (ConfigurationClassUtils.checkConfigurationClassCandidate(bd, this.metadataReaderFactory) &amp;&amp;!alreadyParsedClasses.contains(bd.getBeanClassName())) &#123;candidates.add(new BeanDefinitionHolder(bd, candidateName));&#125;&#125;&#125;candidateNames = newCandidateNames;&#125;&#125;while (!candidates.isEmpty());// Register the ImportRegistry as a bean in order to support ImportAware @Configuration classesif (sbr != null &amp;&amp; !sbr.containsSingleton(IMPORT_REGISTRY_BEAN_NAME)) &#123;sbr.registerSingleton(IMPORT_REGISTRY_BEAN_NAME, parser.getImportRegistry());&#125;if (this.metadataReaderFactory instanceof CachingMetadataReaderFactory) &#123;// Clear cache in externally provided MetadataReaderFactory; this is a no-op// for a shared cache since it'll be cleared by the ApplicationContext.((CachingMetadataReaderFactory) this.metadataReaderFactory).clearCache();&#125;&#125; ÂÖ∑‰ΩìÁöÑÊâßË°åÈÄªËæëÂú®ConfigurationClassParser Á±ªÁöÑ parse ÊñπÊ≥ï‰∏≠ ConfigurationClassParser Ê†∏ÂøÉËß£ÊûêÊñπÊ≥ïÊòØ doProcessConfigurationClassÊñπÊ≥ïÔºå‰∏ãÈù¢Áõ¥Êé•ÁúãËøô‰∏™ÊñπÊ≥ïÁöÑÂÆûÁé∞ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150protected final SourceClass doProcessConfigurationClass(ConfigurationClass configClass, SourceClass sourceClass)throws IOException &#123;// Recursively process any member (nested) classes firstprocessMemberClasses(configClass, sourceClass);// Process any @PropertySource annotations // Ëß£Êûê @PropertySource for (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(sourceClass.getMetadata(), PropertySources.class,org.springframework.context.annotation.PropertySource.class)) &#123;if (this.environment instanceof ConfigurableEnvironment) &#123;processPropertySource(propertySource);&#125;else &#123;logger.warn("Ignoring @PropertySource annotation on [" + sourceClass.getMetadata().getClassName() +"]. Reason: Environment must implement ConfigurableEnvironment");&#125;&#125;// Process any @ComponentScan annotations // Ëß£Êûê @ComponentScan Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(sourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);if (!componentScans.isEmpty() &amp;&amp;!this.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) &#123;for (AnnotationAttributes componentScan : componentScans) &#123;// The config class is annotated with @ComponentScan -&gt; perform the scan immediatelySet&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =this.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());// Check the set of scanned definitions for any further config classes and parse recursively if neededfor (BeanDefinitionHolder holder : scannedBeanDefinitions) &#123;BeanDefinition bdCand = holder.getBeanDefinition().getOriginatingBeanDefinition();if (bdCand == null) &#123;bdCand = holder.getBeanDefinition();&#125;if (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, this.metadataReaderFactory)) &#123;parse(bdCand.getBeanClassName(), holder.getBeanName());&#125;&#125;&#125;&#125;// Process any @Import annotations // Ëß£Êûê @ImportprocessImports(configClass, sourceClass, getImports(sourceClass), true);// Process any @ImportResource annotations // Ëß£Êûê @ImportResourceAnnotationAttributes importResource =AnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);if (importResource != null) &#123;String[] resources = importResource.getStringArray("locations");Class&lt;? extends BeanDefinitionReader&gt; readerClass = importResource.getClass("reader");for (String resource : resources) &#123;String resolvedResource = this.environment.resolveRequiredPlaceholders(resource);configClass.addImportedResource(resolvedResource, readerClass);&#125;&#125;// Process individual @Bean methods // Ëß£Êûê @BeanSet&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);for (MethodMetadata methodMetadata : beanMethods) &#123;configClass.addBeanMethod(new BeanMethod(methodMetadata, configClass));&#125;// Process default methods on interfacesprocessInterfaces(configClass, sourceClass);// Process superclass, if anyif (sourceClass.getMetadata().hasSuperClass()) &#123;String superclass = sourceClass.getMetadata().getSuperClassName();if (superclass != null &amp;&amp; !superclass.startsWith("java") &amp;&amp;!this.knownSuperclasses.containsKey(superclass)) &#123;this.knownSuperclasses.put(superclass, configClass);// Superclass found, return its annotation metadata and recursereturn sourceClass.getSuperClass();&#125;&#125;// No superclass -&gt; processing is completereturn null;&#125; ÂèØ‰ª•ÁúãÂà∞‰∏äÈù¢ÁöÑ‰ª£Á†Å‰æùÊ¨°Ëß£Êûê‰∫Ü @PropertySourceÔºå@ComponentScan @Bean @Import Á≠âÊ≥®Ëß£„ÄÇËøôÈáåÊàë‰ª¨ÈáçÁÇπÂÖ≥Ê≥® @Bean ÁöÑÂÆûÁé∞ 123456789101112// Ëé∑Âèñ @bean Ê≥®Ëß£‰øÆÈ•∞ÁöÑ ÊñπÊ≥ïÂÖÉÊï∞ÊçÆ‰ø°ÊÅØSet&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);for (MethodMetadata methodMetadata : beanMethods) &#123; // Â∞ÅË£ÖÊàê BeanMethod configClass.addBeanMethod(new BeanMethod(methodMetadata, configClass));&#125; ‰∏ãÈù¢Êàë‰ª¨ÂõûÂà∞ ConfigurationClassPostProcessor ÔºåËß£ÊûêÂÆå ÂÖÉÊï∞ÊçÆ‰πãÂêéÔºåÂ∞±ÊòØÂä†ËΩΩÊ≥®ÂÜå BeanDefinition‰∫Ü 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354this.reader.loadBeanDefinitions(configClasses);public void loadBeanDefinitions(Set&lt;ConfigurationClass&gt; configurationModel) &#123;TrackedConditionEvaluator trackedConditionEvaluator = new TrackedConditionEvaluator();for (ConfigurationClass configClass : configurationModel) &#123;loadBeanDefinitionsForConfigurationClass(configClass, trackedConditionEvaluator);&#125;&#125;private void loadBeanDefinitionsForConfigurationClass(ConfigurationClass configClass, TrackedConditionEvaluator trackedConditionEvaluator) &#123;if (trackedConditionEvaluator.shouldSkip(configClass)) &#123;String beanName = configClass.getBeanName();if (StringUtils.hasLength(beanName) &amp;&amp; this.registry.containsBeanDefinition(beanName)) &#123;this.registry.removeBeanDefinition(beanName);&#125;this.importRegistry.removeImportingClass(configClass.getMetadata().getClassName());return;&#125;if (configClass.isImported()) &#123;registerBeanDefinitionForImportedConfigurationClass(configClass);&#125;for (BeanMethod beanMethod : configClass.getBeanMethods()) &#123; // Ëß£Êûê‰πãÂâç Ëß£Êûê @bean Âä†ÂÖ•ÁöÑ beanMethod‰ø°ÊÅØloadBeanDefinitionsForBeanMethod(beanMethod);&#125;loadBeanDefinitionsFromImportedResources(configClass.getImportedResources());loadBeanDefinitionsFromRegistrars(configClass.getImportBeanDefinitionRegistrars());&#125; ÁúãÁúã loadBeanDefinitionsForBeanMethod ÊñπÊ≥ïÁöÑÂÆûÁé∞ÔºåÂÖ∂ÂÆûÂ∞±ÊòØ‰ªéBeanMethod‰∏≠ÊèêÂèñ‰ø°ÊÅØÁªÑË£ÖÊàê BeanDefinition 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174private void loadBeanDefinitionsForBeanMethod(BeanMethod beanMethod) &#123;ConfigurationClass configClass = beanMethod.getConfigurationClass();MethodMetadata metadata = beanMethod.getMetadata();String methodName = metadata.getMethodName();// Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅË∑≥Ëøáif (this.conditionEvaluator.shouldSkip(metadata, ConfigurationPhase.REGISTER_BEAN)) &#123;configClass.skippedBeanMethods.add(methodName);return;&#125;if (configClass.skippedBeanMethods.contains(methodName)) &#123;return;&#125;AnnotationAttributes bean = AnnotationConfigUtils.attributesFor(metadata, Bean.class);Assert.state(bean != null, "No @Bean annotation attributes");// ËÄÉËôëÂà´Âêç ÂêçÁß∞List&lt;String&gt; names = new ArrayList&lt;&gt;(Arrays.asList(bean.getStringArray("name")));String beanName = (!names.isEmpty() ? names.remove(0) : methodName);// Ê≥®ÂÜåÂà´Âêç for (String alias : names) &#123;this.registry.registerAlias(beanName, alias);&#125;// Has this effectively been overridden before (e.g. via XML)? // Âà§Êñ≠ÊòØÂê¶Âú® xmlÈÖçÁΩÆÊñá‰ª∂‰∏≠ Â∑≤ÁªèÈÖçÁΩÆËøáif (isOverriddenByExistingDefinition(beanMethod, beanName)) &#123;if (beanName.equals(beanMethod.getConfigurationClass().getBeanName())) &#123;throw new BeanDefinitionStoreException(beanMethod.getConfigurationClass().getResource().getDescription(),beanName, "Bean name derived from @Bean method '" + beanMethod.getMetadata().getMethodName() +"' clashes with bean name for containing configuration class; please make those names unique!");&#125;return;&#125;ConfigurationClassBeanDefinition beanDef = new ConfigurationClassBeanDefinition(configClass, metadata);beanDef.setResource(configClass.getResource());beanDef.setSource(this.sourceExtractor.extractSource(metadata, configClass.getResource())); // ËøôÈáåÂèØ‰ª•Áü•ÈÅì @bean ÈÖçÁΩÆÊòØ ÈÄöËøá FactoryMethod Êù•ÂàùÂßãÂåñÁöÑif (metadata.isStatic()) &#123;// static @Bean methodbeanDef.setBeanClassName(configClass.getMetadata().getClassName());beanDef.setFactoryMethodName(methodName);&#125;else &#123;// instance @Bean methodbeanDef.setFactoryBeanName(configClass.getBeanName());beanDef.setUniqueFactoryMethodName(methodName);&#125;beanDef.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_CONSTRUCTOR);beanDef.setAttribute(RequiredAnnotationBeanPostProcessor.SKIP_REQUIRED_CHECK_ATTRIBUTE, Boolean.TRUE);AnnotationConfigUtils.processCommonDefinitionAnnotations(beanDef, metadata); // ËÆæÁΩÆautowireÂ±ûÊÄßAutowire autowire = bean.getEnum("autowire");if (autowire.isAutowire()) &#123;beanDef.setAutowireMode(autowire.value());&#125;// ËÆæÁΩÆinitMethod ÂàùÂßãÂåñÊñπÊ≥ïString initMethodName = bean.getString("initMethod");if (StringUtils.hasText(initMethodName)) &#123;beanDef.setInitMethodName(initMethodName);&#125;// ËÆæÁΩÆdestroyMethod ÈîÄÊØÅÊñπÊ≥ïString destroyMethodName = bean.getString("destroyMethod");beanDef.setDestroyMethodName(destroyMethodName);// Ëé∑Âèñ scopeScopedProxyMode proxyMode = ScopedProxyMode.NO;AnnotationAttributes attributes = AnnotationConfigUtils.attributesFor(metadata, Scope.class);if (attributes != null) &#123;beanDef.setScope(attributes.getString("value"));proxyMode = attributes.getEnum("proxyMode");if (proxyMode == ScopedProxyMode.DEFAULT) &#123;proxyMode = ScopedProxyMode.NO;&#125;&#125;// Replace the original bean definition with the target one, if necessary // Â¶ÇÊúâÂøÖË¶ÅÔºåÂ∞ÜÂéüÂßãBeanÂÆö‰πâÊõøÊç¢‰∏∫ÁõÆÊ†áBeanÂÆö‰πâBeanDefinition beanDefToRegister = beanDef;if (proxyMode != ScopedProxyMode.NO) &#123;BeanDefinitionHolder proxyDef = ScopedProxyCreator.createScopedProxy(new BeanDefinitionHolder(beanDef, beanName), this.registry,proxyMode == ScopedProxyMode.TARGET_CLASS);beanDefToRegister = new ConfigurationClassBeanDefinition((RootBeanDefinition) proxyDef.getBeanDefinition(), configClass, metadata);&#125;if (logger.isDebugEnabled()) &#123;logger.debug(String.format("Registering bean definition for @Bean method %s.%s()",configClass.getMetadata().getClassName(), beanName));&#125;this.registry.registerBeanDefinition(beanName, beanDefToRegister);&#125; ‰ª£Á†ÅËß£ÊûêÂà∞ËøôÈáå‰∏∫Ê≠¢Ôºå@BeanÈÖçÁΩÆÁöÑBean‰ø°ÊÅØÂ∞±Ë¢´ÂÖ®ÈÉ®ÊäΩË±°Êàê‰∫Ü‰∏Ä‰∏™ BeanDefinitionÂØπË±°ÔºåÊé•‰∏ãÊù•ÁöÑBeanÂä†ËΩΩÁ≠âÁ≠â‰∏ÄÂ§ßÂ†ÜÈÄªËæëËµ∞ÁöÑÂ∞±ÊòØSpringÁöÑÂêå‰∏ÄÂ•óÈÄªËæë‰∫Ü„ÄÇ ‰ª•‰∏äÊòØÈÄöËøáÂú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÈÖçÁΩÆ &lt;context:annotation-config&gt; &lt;context:component-scan&gt;„ÄÇ SpringbootÊÄé‰πàÂÅöÁöÑÈÇ£‰πàSpring BootÂπ∂‰∏çÈúÄË¶ÅÈÖçÁΩÆÊñá‰ª∂ÔºåÂÆÉÂèàÊòØÂú®Âì™ÈáåÈÖçÁΩÆ‰∫ÜÂÖ•Âè£Âë¢Ôºü ÂÖ∂ÂÆûÂú®‰πãÂâçÁöÑÂàÜÊûêSpring bootÁöÑÂêØÂä®ËøáÁ®ãÊó∂ Â∑≤ÁªèÊúâÊèêÂà∞‰∫Ü ÈìæÊé• ÔºåÂÖ∂ÂÆûÊòØÂú®ÂàùÂßãÂåñ SpringÂÆπÂô®ÁöÑÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ËøõË°å‰∫ÜÈÖçÁΩÆÁöÑÂä†ËΩΩÔºåÂπ∂‰∏îÊúÄÁªà‰πüÊòØË∞ÉÁî®‰∫Ü AnnotationConfigUtils Â∑•ÂÖ∑Á±ªÁöÑ registerAnnotationConfigProcessorsÊñπÊ≥ï ÊÄªÁªìÁªà‰∫éÂÜôÂÆå‰∫ÜÔºåÂÖ∂ÂÆûÂàÜÊûêÊù•ÂàÜÊûêÂéªÔºå‰∏çËÆ∫ÊòØSpring Boot Spring mvc ÂÖ∂ÂÆûÊúÄÊ†∏ÂøÉ‰∏çÂèòÁöÑËøòÊòØ Spring FrameworkÔºåÂè™Ë¶ÅÊääÊ†∏ÂøÉÊêûÊ∏ÖÊ•ö‰∫ÜÔºå‰∏ãÊ¨°Spring ÂèàÊé®Âá∫‰ªÄ‰πà Spring xxx ‰πüËÉΩÂ∫î‰ªòËá™Â¶Ç]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MVC-HttpRequestHandlerÊé•Âè£ÈùôÊÄÅËµÑÊ∫êÁöÑÂÖ≥Á≥ª]]></title>
    <url>%2F2019%2F08%2F30%2FMVC-HttpRequestHandler%E6%8E%A5%E5%8F%A3%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E5%85%B3%E7%B3%BB%2F</url>
    <content type="text"><![CDATA[Âú®Spring MvcÔºå‰∏ÄËà¨Êàë‰ª¨ÈÉΩ‰ºöÈÖçÁΩÆÂØπÈùôÊÄÅËµÑÊ∫êÁöÑÊã¶Êà™ÔºåÂõ†‰∏∫ÈùôÊÄÅËµÑÊ∫êÂ§ÑÁêÜÊúâÂà´‰∏éÊôÆÈÄöËØ∑Ê±ÇÔºåÈúÄË¶ÅËøõË°åÁâπÊÆäÈÖçÁΩÆ„ÄÇ ÊØîËæÉÂ∏∏Áî®ÁöÑÈÖçÁΩÆÊúâËøôÂá†Áßç Tomcat defaultServelt ÊøÄÊ¥ªtomcatËá™Â∏¶ÁöÑdefaultServelt Áî®Êù•Â§ÑÁêÜÈùôÊÄÅËµÑÊ∫ê 123456789101112&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jpg&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;*.js&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;*.css&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; ‰ΩøÁî® &lt;mvc:resources/&gt; Spring mvcËá™Â∑±Êèê‰æõÁöÑÈùôÊÄÅËµÑÊ∫êÂ§ÑÁêÜÂô® ‰æãÂ¶ÇÂÅöÂ¶Ç‰∏ãÈÖçÁΩÆÔºåÂ∞±ÂèØ‰ª•Â∞ÜstaticÂºÄÂ§¥ÁöÑË∑ØÂæÑÂÖ®ÈÉ®ËÆøÈóÆËá≥staticÁõÆÂΩï 1&lt;mvc:resources mapping="/static/**" location="/static/" /&gt; ÈÇ£‰πàËøô‰∏™ÈÖçÁΩÆÁöÑÂÆûÁé∞ÂéüÁêÜÊòØ‰ªÄ‰πàÔºü ÈÄöËøáÈòÖËØªÊ∫êÁ†ÅÂÖ∂ÂÆûÂèØ‰ª•Áü•ÈÅìÂÆûÈôÖ‰∏äÊòØ Spring mvc Ëá™Âä®Â∏ÆÊàë‰ª¨Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™SimpleUrlHandlerMappingÔºåÂú®‰πãÂâçÂàÜÊûêSimpleUrlHandlerMappingÊó∂‰πüÊúâÊèêÂà∞ÂÆÉÂÖ∂ÂÆûÂèØ‰ª•ÂΩìÊàêÊã¶Êà™Âô®Áî®ÔºåËøôÈáåÂÖ∂ÂÆûÂ∞±ÊòØ‰∏Ä‰∏™ÂÆû‰æã„ÄÇÊ≥®ÂÜå‰∫ÜHandlerMappingÂøÖÁÑ∂Ë¶ÅÁ°ÆÂÆöhandlerÂ§ÑÁêÜÂô®ÔºåËøôÈáåÁöÑhandlerÂ§ÑÁêÜÂô®ÂÖ∂ÂÆûÂ∞±ÊòØHttpRequestHandlerÊé•Âè£ÁöÑÂÆûÁé∞Á±ªÔºàResourceHttpRequestHandlerÔºâ ‰ΩøÁî® &lt;mvc:default-servlet-handler/&gt; ÊøÄÊ¥ªSpring mvcÊèê‰æõÁöÑÈªòËÆ§ÈùôÊÄÅËµÑÊ∫êÂ§ÑÁêÜÂô® ‰ΩøÁî®Ëøô‰∏™ÈÖçÁΩÆÂÖ∂ÂÆûÂéüÁêÜ‰∏éÁ¨¨‰∫å‰∏™ÈÖçÁΩÆÈùûÂ∏∏Áõ∏‰ººÔºå‰πüÊòØÂà©Áî®‰∫ÜSimpleUrlHandlerMappingÔºåÂπ∂‰∏îhandlerÂ§ÑÁêÜÂô®‰πüÊòØHttpRequestHandlerÊé•Âè£ÁöÑÂÆûÁé∞Á±ªÔºåÂè™ÊòØÊääÂÖ∑‰ΩìÁöÑÂÆûÁé∞Á±ªÊç¢Êàê‰∫ÜDefaultServletHttpRequestHandlerÔºåÁõ∏ÊØîÁ¨¨‰∫åÁßçÈÖçÁΩÆÔºåÊ≠§ÁßçÈÖçÁΩÆÊó†Ê≥ïËá™ÂÆö‰πâ„ÄÇ ÂÜôÂú®ÂêéÈù¢ ‰∏çËøáÊàë‰ª¨Ë¶ÅÊòØ‰ΩøÁî®Spring bootÂºÄÂèëÔºå‰πüÂ∞±ÁúÅÂéª‰∫ÜËøô‰∏ÄÂ†ÜÁπÅÁêêÁöÑÈÖçÁΩÆÔºåÂåÖÊã¨ÈùôÊÄÅËµÑÊ∫êÁöÑÈÖçÁΩÆ‰πüÈÉΩÊòØËá™Âä®ÂÆåÊàêÈÖçÁΩÆ„ÄÇÂè™Ë¶ÅÊåâÁÖßÁ∫¶ÂÆöÂ∞ÜÈùôÊÄÅËµÑÊ∫êÊîæÁΩÆÂú®classpath‰∏ãÁöÑËøôÂá†‰∏™ÁõÆÂΩï‰∏ãÔºàpublic,resource,staticÔºâÔºåÂ∞±‰∏çÈúÄË¶Å‰ªª‰ΩïÈÖçÁΩÆÔºå‰∏çÂæó‰∏çËØ¥ÔºåÁ∫¶ÂÆö‰ºò‰∫éÈÖçÁΩÆËøòÊòØÂèØ‰ª•ÊûÅÂ§ßÁöÑÊèêÂçáÂºÄÂèëÊïàÁéáÁöÑ„ÄÇ]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊâãÂÜô‰∏Ä‰∏™starter]]></title>
    <url>%2F2019%2F08%2F28%2F%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AAstarter%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂâçÊñáËØ¥ËøáÔºåSpring BootÊúÄÂ§ßÁöÑ‰ºòÂäøÂú®‰∫éËá™Âä®ÈÖçÁΩÆÔºåÊàë‰πàÂè™ÈúÄË¶ÅÂºïÂÖ•‰∏Ä‰∏™‰∏™Á¨¨‰∏âÊñπÊèê‰æõÁöÑstarterÂ∞±ÂèØ‰ª•Âø´ÈÄüÈõÜÊàêÁ¨¨‰∏âÊñπÂäüËÉΩÔºåÊó¢ÁÑ∂starterËøô‰πàÊñπ‰æøÔºåÊàë‰ª¨Ëá™Â∑±Â∫îËØ•‰πüÂèØ‰ª•ÂÜô‰∏Ä‰∏™„ÄÇ Âø´ÈÄüÂÜô‰∏Ä‰∏™starter Êñ∞Âª∫‰∏Ä‰∏™mavenÈ°πÁõÆ 123456789101112&lt;groupId&gt;com.walm&lt;/groupId&gt; &lt;artifactId&gt;boot-test-starter&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; Êñ∞Âª∫‰∏Ä‰∏™configÁ±ª 12345678@Configurationpublic class HelloWorldConfig &#123; @Bean public HelloWorld HelloWord() &#123; return new HelloWorld(); &#125;&#125; Êñ∞Âª∫‰∏Ä‰∏™Êèê‰æõÊúçÂä°ÁöÑserviceÁ±ª 123456public class HelloWorld &#123; public void sayHello() &#123; System.out.println("hello world !!!!"); &#125;&#125; ÊúÄÈáçË¶ÅÁöÑÊòØ‰∏ÄÊ≠•ÔºåÈúÄË¶ÅËÆ©springËÉΩÂ§üÊâ´ÊèèÂà∞Êàë‰ª¨ÁöÑ config HelloWorldConfig Á±ª Âú®resource Êñá‰ª∂Â§π‰∏ãÊñ∞Âª∫‰∏Ä‰∏™ META-INF Êñá‰ª∂Â§π Êñ∞Âª∫‰∏Ä‰∏™ spring.factories Êñá‰ª∂ Âú®spring.factoriesÊñá‰ª∂‰∏≠ÈÖçÁΩÆÊàë‰ª¨ÁöÑÂÜôÁöÑHelloWorldConfigÁ±ª 1org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.walm.boottest.HelloWorldConfig ËøôÊ†∑‰∏Ä‰∏™ÁÆÄÂçïÁöÑ springboot starter Â∞±ÂÆåÊàê‰∫ÜÔºåÊúÄÂêéÊú¨Âú∞ÂÆâË£Ö installÊàë‰ª¨ÁöÑstarter jarÂåÖÂ∞±ÂèØ‰ª•Âú®ÂÖ∂‰ªñÈ°πÁõÆ‰∏≠ÂºïÁî®‰∫Ü ÂºïÁî®starterÔºåÂè™ÈúÄË¶ÅÂú®È°πÁõÆÂºïÁî® ËØ•jarÂåÖÂç≥ÂèØ 12345&lt;dependency&gt; &lt;groupId&gt;com.walm&lt;/groupId&gt; &lt;artifactId&gt;boot-test-starter&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; ‰∏ãÈù¢Êàë‰ª¨ÁÆÄÂçïÂàÜÊûê‰∏Ä‰∏ã staterÁöÑÂéüÁêÜ starter Ëá™Âä®ÈÖçÁΩÆÂéüÁêÜÈ¶ñÂÖàËá™Âä®ÈÖçÁΩÆÁöÑÂéüÁêÜÂÖ≥ÈîÆ‰∏ÄÂÆöÊòØÂú® spring.factories Êñá‰ª∂ÊòØÂ¶Ç‰ΩïË¢´Âä†ËΩΩÂà∞ÁöÑËøô‰∏™ÁÇπ‰∏äÂéªÊé¢Á©∂ ÈúÄË¶Å‰ªéspring bootÁöÑÂêØÂä®ËøáÁ®ã‰∏ÄÊ≠•‰∏ÄÊ≠•ÁöÑÂéªÁúã‰∫Ü È¶ñÂÖàÔºåÊàë‰ª¨ÂêØÂä®‰∏Ä‰∏™spring-bootÈ°πÁõÆÔºåËÇØÂÆö‰ºöÊúâ‰∏Ä‰∏™ÈÖçÁΩÆÊ≥®Ëß£ SpringBootApplication ÈÇ£‰πàËøô‰∏™Ê≥®Ëß£Âà∞Â∫ïËµ∑‰ªÄ‰πà‰ΩúÁî®Âë¢Ôºü SpringBootApplication.class 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@SpringBootConfiguration@EnableAutoConfiguration@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)public @interface SpringBootApplication &#123; /** * Exclude specific auto-configuration classes such that they will never be applied. * @return the classes to exclude */ @AliasFor(annotation = EnableAutoConfiguration.class) Class&lt;?&gt;[] exclude() default &#123;&#125;; /** * Exclude specific auto-configuration class names such that they will never be * applied. * @return the class names to exclude * @since 1.3.0 */ @AliasFor(annotation = EnableAutoConfiguration.class) String[] excludeName() default &#123;&#125;; /** * Base packages to scan for annotated components. Use &#123;@link #scanBasePackageClasses&#125; * for a type-safe alternative to String-based package names. * @return base packages to scan * @since 1.3.0 */ @AliasFor(annotation = ComponentScan.class, attribute = "basePackages") String[] scanBasePackages() default &#123;&#125;; /** * Type-safe alternative to &#123;@link #scanBasePackages&#125; for specifying the packages to * scan for annotated components. The package of each class specified will be scanned. * &lt;p&gt; * Consider creating a special no-op marker class or interface in each package that * serves no purpose other than being referenced by this attribute. * @return base packages to scan * @since 1.3.0 */ @AliasFor(annotation = ComponentScan.class, attribute = "basePackageClasses") Class&lt;?&gt;[] scanBasePackageClasses() default &#123;&#125;;&#125; ËøôÈáåÁùÄÈáçÁúã EnableAutoConfiguration Ëøô‰∏™Ê≥®Ëß£ 12345678910111213141516171819202122232425@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@AutoConfigurationPackage@Import(AutoConfigurationImportSelector.class)public @interface EnableAutoConfiguration &#123; String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration"; /** * Exclude specific auto-configuration classes such that they will never be applied. * @return the classes to exclude */ Class&lt;?&gt;[] exclude() default &#123;&#125;; /** * Exclude specific auto-configuration class names such that they will never be * applied. * @return the class names to exclude * @since 1.3.0 */ String[] excludeName() default &#123;&#125;;&#125; ÂèØ‰ª•ÁúãÂà∞ @Import(AutoConfigurationImportSelector.class)Ëøô‰∏™Ê≥®Ëß£ÔºåËøôÈáåÂ∞±ÊòØÊàë‰ª¨Ëá™Âä®ÈÖçÁΩÆÁöÑÂÖ•Âè£Ê≥®ÊÑèÔºåËß£ÊûêImportÊ≥®Ëß£ÂÖ∂ÂÆûÊòØÈÄöËøá BeanFactoryPostProcessor Êé•Âè£Êù•Êâ©Â±ïÁöÑ ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãAutoConfigurationImportSelector.class Á±ªÁöÑÂÆûÁé∞ÔºåAutoConfigurationImportSelector ÂÆûÁé∞‰∫ÜImportSelectorÊé•Âè£ ImportSelector 123456789public interface ImportSelector &#123; /** * Select and return the names of which class(es) should be imported based on * the &#123;@link AnnotationMetadata&#125; of the importing @&#123;@link Configuration&#125; class. */ String[] selectImports(AnnotationMetadata importingClassMetadata);&#125; Âú®Ëß£ÊûêimportÊ≥®Ëß£ÁöÑÊó∂ÂÄô‰ºöË∞ÉÁî®ÊåáÂÆöImportSelector Êé•Âè£ÂÆûÁé∞ ÁöÑ selectImportsÊñπÊ≥ï„ÄÇ‰∏ãÈù¢Êàë‰ª¨Áúã‰∏ãAutoConfigurationImportSelectorÁöÑ selectImportsÊñπÊ≥ïÂÆûÁé∞ selectImports 12345678910111213141516171819public String[] selectImports(AnnotationMetadata annotationMetadata) &#123; if (!isEnabled(annotationMetadata)) &#123; return NO_IMPORTS; &#125; AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader .loadMetadata(this.beanClassLoader); AnnotationAttributes attributes = getAttributes(annotationMetadata); // Ëé∑Âèñ META-INF/spring.factories Êñá‰ª∂‰∏≠ÁöÑÈÖçÁΩÆ‰ø°ÊÅØ List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes); configurations = removeDuplicates(configurations); Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes); checkExcludedClasses(configurations, exclusions); configurations.removeAll(exclusions); configurations = filter(configurations, autoConfigurationMetadata); // Ëß¶Âèë‰∫ã‰ª∂ fireAutoConfigurationImportEvents(configurations, exclusions); return StringUtils.toStringArray(configurations); &#125; ÊÄªÁªìÂÜô‰∏Ä‰∏™starterËøòÊòØÈùûÂ∏∏ÁÆÄÂçïÁöÑÔºåÊ†∏ÂøÉÂ∞±ÊòØË¶ÅËÆ©springbootËá™Âä®Êâ´ÊèèÂà∞Êàë‰ª¨ÁöÑ ÈÖçÁΩÆÁ±ªÔºåÊ†∏ÂøÉÈÄªËæëÂÖ∂ÂÆûÂ∞±ÊòØÈÄöËøáÊâ´ÊèèÊàë‰ª¨ÁöÑËá™ÂÆö‰πâÁöÑMETA-INF/spring.factoriesÊñá‰ª∂Êù•ËøõË°åËá™Âä®ÈÖçÁΩÆ]]></content>
      <categories>
        <category>Spring</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootÁöÑÂêØÂä®ËøáÁ®ã]]></title>
    <url>%2F2019%2F08%2F27%2FSpringBoot%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®Êàë‰πãÂâçÂÜôÁöÑÊñáÁ´†‰∏≠ÊúâËØ¶ÁªÜÂàÜÊûêËøáSpringÁöÑÂêØÂä®ËøáÁ®ãÔºåÂ¶Ç‰ΩïÂ§ßÂÆ∂ÊúâÊ∑±ÂÖ•ÈòÖËØªËøáSpring FrameworkÁöÑÊ†∏ÂøÉÊ∫êÁ†ÅÔºåÈÇ£‰πàÈòÖËØªSpring BootÁöÑÊ∫êÁ†Å‰ºöÊØîËæÉËΩªÊùæ„ÄÇ‰∏™‰∫∫ËßâÂæóSpring BootÊ†∏ÂøÉÁöÑ‰∏úË•øÊØîËæÉÂ∞ëÔºåÂÖ∂Ê†∏ÂøÉËøòÊòØSpring Framework„ÄÇ ÂêØÂä®ÂÖ•Âè£ËøòÊòØ‰∏ÄÊ≠•Âà∞‰ΩçÔºåÁõ¥Êé•ÁúãÊ∫êÁ†Å 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public ConfigurableApplicationContext run(String... args) &#123; // ÁªüËÆ°ÂêØÂä®Êó∂Èó¥ StopWatch stopWatch = new StopWatch(); stopWatch.start(); ConfigurableApplicationContext context = null; Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;(); // ËÆæÁΩÆ java.awt.headless ÂèÇÊï∞ configureHeadlessProperty(); // Ëé∑ÂèñÁõëÂê¨Âô® SpringApplicationRunListeners listeners = getRunListeners(args); listeners.starting(); try &#123; ApplicationArguments applicationArguments = new DefaultApplicationArguments( args); ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments); configureIgnoreBeanInfo(environment); Banner printedBanner = printBanner(environment); // ÂàõÂª∫ contextÂÆπÂô® context = createApplicationContext(); exceptionReporters = getSpringFactoriesInstances( SpringBootExceptionReporter.class, new Class[] &#123; ConfigurableApplicationContext.class &#125;, context); // ÂáÜÂ§áÂÆπÂô® prepareContext(context, environment, listeners, applicationArguments, printedBanner); // Âà∑Êñ∞ÂÆπÂô® refreshContext(context); afterRefresh(context, applicationArguments); stopWatch.stop(); if (this.logStartupInfo) &#123; new StartupInfoLogger(this.mainApplicationClass) .logStarted(getApplicationLog(), stopWatch); &#125; listeners.started(context); callRunners(context, applicationArguments); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, listeners); throw new IllegalStateException(ex); &#125; try &#123; listeners.running(context); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, null); throw new IllegalStateException(ex); &#125; return context; &#125; createApplicationContext12345678910111213141516171819202122232425protected ConfigurableApplicationContext createApplicationContext() &#123; Class&lt;?&gt; contextClass = this.applicationContextClass; if (contextClass == null) &#123; try &#123; switch (this.webApplicationType) &#123; case SERVLET: contextClass = Class.forName(DEFAULT_SERVLET_WEB_CONTEXT_CLASS); break; case REACTIVE: contextClass = Class.forName(DEFAULT_REACTIVE_WEB_CONTEXT_CLASS); break; default: contextClass = Class.forName(DEFAULT_CONTEXT_CLASS); &#125; &#125; catch (ClassNotFoundException ex) &#123; throw new IllegalStateException( "Unable create a default ApplicationContext, " + "please specify an ApplicationContextClass", ex); &#125; &#125; // ËøôÈáå‰ºöÂºïÂÖ•‰∏Ä‰∫õBeanFactoryProcessÔºåÊØîÂ¶Ç ConfigurationClassPostProcessor Ëß£ÊûêConfigurationÊ≥®Ëß£ÁöÑ return (ConfigurableApplicationContext) BeanUtils.instantiateClass(contextClass); &#125; Ê≥®: ÂºïÂÖ•ÁöÑBeanFactoryProcess ÁöÑÈÄªËæëÂú®DEFAULT_SERVLET_WEB_CONTEXT_CLASSÁöÑÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ 1234567// Áúã‰∏ã AnnotationConfigServletWebServerApplicationContext ÁöÑÊûÑÈÄ†ÊñπÊ≥ïpublic AnnotationConfigServletWebServerApplicationContext() &#123; // Áõ∏ÂΩì‰∫éxml‰∏≠ÈÖçÁΩÆ‰∫Ü &lt;context:annotation-config&gt; this.reader = new AnnotatedBeanDefinitionReader(this); // Áõ∏ÂΩì‰∫éxml‰∏≠ÈÖçÁΩÆ‰∫Ü &lt;context:component-scan&gt; this.scanner = new ClassPathBeanDefinitionScanner(this); &#125; Êàë‰ª¨Âú®Áúã‰∏ã AnnotatedBeanDefinitionReader ÁöÑÊûÑÈÄ†ÊñπÊ≥ï 123456789101112131415161718192021public AnnotatedBeanDefinitionReader(BeanDefinitionRegistry registry) &#123; this(registry, getOrCreateEnvironment(registry)); &#125; /** * Create a new &#123;@code AnnotatedBeanDefinitionReader&#125; for the given registry and using * the given &#123;@link Environment&#125;. * @param registry the &#123;@code BeanFactory&#125; to load bean definitions into, * in the form of a &#123;@code BeanDefinitionRegistry&#125; * @param environment the &#123;@code Environment&#125; to use when evaluating bean definition * profiles. * @since 3.1 */ public AnnotatedBeanDefinitionReader(BeanDefinitionRegistry registry, Environment environment) &#123; Assert.notNull(registry, "BeanDefinitionRegistry must not be null"); Assert.notNull(environment, "Environment must not be null"); this.registry = registry; this.conditionEvaluator = new ConditionEvaluator(registry, environment, null); // Âú®ËøôÈáå Ê≥®ÂÜå‰∫Ü‰∏ÄÂ†ÜÁöÑ BeanFactoryProcess AnnotationConfigUtils.registerAnnotationConfigProcessors(this.registry); &#125; ‰∏ãÈù¢‰∏ªË¶ÅprepareContextÂíårefreshContextÊñπÊ≥ï prepareContext 1234567891011121314151617181920212223242526private void prepareContext(ConfigurableApplicationContext context, ConfigurableEnvironment environment, SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner) &#123; context.setEnvironment(environment); postProcessApplicationContext(context); applyInitializers(context); listeners.contextPrepared(context); if (this.logStartupInfo) &#123; logStartupInfo(context.getParent() == null); logStartupProfileInfo(context); &#125; // Add boot specific singleton beans context.getBeanFactory().registerSingleton("springApplicationArguments", applicationArguments); if (printedBanner != null) &#123; context.getBeanFactory().registerSingleton("springBootBanner", printedBanner); &#125; // Load the sources Set&lt;Object&gt; sources = getAllSources(); Assert.notEmpty(sources, "Sources must not be empty"); // ËøôÈáåÂºïÂÖ•‰∫Ü ÂêØÂä®Á±ª load(context, sources.toArray(new Object[0])); listeners.contextLoaded(context); &#125; Ê≥®Ôºö ËøôÈáåÁöÑ‰∏ªË¶Å‰ΩúÁî®Â∞±ÊòØÂºïÂÖ•‰∫ÜÂêØÂä®Á±ªÔºåÂä†ÂÖ•Âà∞ BeanFactory‰∏≠ refreshContext ÂêéÈù¢ÂÖ∂ÂÆû Â∞±ÊòØ Spring Áªü‰∏ÄÁöÑ‰∏ÄÂ•ó‰∫Ü ÂèØ‰ª•ÁúãÊàëÁöÑ‰πãÂâçÂÜôÁöÑ Spring Ê∫êÁ†ÅËß£ÊûêÁ≥ªÂàó ÊÄªÁªìSpringbootÁöÑÊ†∏ÂøÉÂú®‰∫éËá™Âä®ÈÖçÁΩÆ Âø´ÈÄüÈõÜÊàê „ÄÇ‰∏Ä‰∫õÂéüÊú¨ÈúÄË¶ÅÂú®Spring xmlÊñá‰ª∂ÈÖçÁΩÆÁöÑ‰∏úË•øÔºåSpring Âè™ÈúÄË¶Å‰∏Ä‰∏™Ê≥®Ëß£Â∞±Â∏ÆÊàë‰ª¨ÈÉΩÂÅö‰∫Ü„ÄÇ‰∏çËøáÂâçÊñá‰πüÈÉΩËØ¥‰∫ÜÔºåÊ†∏ÂøÉËøòÊòØ Spring Framework„ÄÇ]]></content>
      <categories>
        <category>Spring</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MVCÊ∫êÁ†ÅËß£Êûê-HandlerAdapter]]></title>
    <url>%2F2019%2F08%2F25%2FMVC%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-HandlerAdapter%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏äÁØáÊñáÁ´†ÂàÜÊûê‰∫ÜhanderMappingÁöÑÂÆûÁé∞„ÄÇÊú¨ÁØáÊñáÁ´†‰ºöÁªßÁª≠ÂàÜÊûêÂíåhanderMappingÁõ∏ËæÖÁõ∏ÊàêÁöÑhanderAdapter„ÄÇ ‰ªÄ‰πàÊòØhanderAdapterÔºüÂú®ÁêÜËß£‰∫ÜhanderMappingÁöÑÂü∫Á°Ä‰∏äÔºåÊàë‰ª¨Â∫îËØ•ÂèëÁé∞‰∫Ü‰∏Ä‰∏™ÈóÆÈ¢ò„ÄÇÂ∞±ÊòØÊØè‰∏™handerMappingÊâÄÂåπÈÖçÁöÑÂà∞ÁöÑhanderÂÆûÁé∞ÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑ„ÄÇÊØîÂ¶ÇRequestMappingHandlerMappingÁöÑhanderÁöÑÂÆûÁé∞ÊòØ‰∏Ä‰∏™HandlerMethodÂÆûÁé∞ÔºåËÄåBeanNameUrlHandlerMappingÁöÑhanderÂàôÊòØ‰∏Ä‰∏™ControllerÊé•Âè£ÂÆûÁé∞Á±ª„ÄÇÊâÄ‰ª•Â¶ÇÊûúÊàë‰ª¨Ë¶ÅÊòØ‰∏çÂºïÂÖ•handerAdapterÁöÑËØùÔºåÂ∞±Êó†Ê≥ïÁªü‰∏ÄÁöÑÂéªÊâßË°åÂêÑËá™ÁöÑhander ‰∏äÊñáÊâÄËØ¥handerAdapterÂíåhanderMappingÊòØÁõ∏ËæÖÁõ∏ÊàêÁöÑ„ÄÇ‰ª•‰∏ãÂàóÂá∫‰∫ÜÂá†‰∏™ÁöÑÂØπÂ∫îÂÖ≥Á≥ª RequestMappingHandlerMapping -&gt; RequestMappingHandlerAdapter BeanNameUrlHandlerMapping -&gt; SimpleControllerHandlerAdapter SimpleUrlHandlerMapping -&gt; SimpleControllerHandlerAdapter SimpleUrlHandlerMapping -&gt; HttpRequestHandlerAdapter ÂÖ∂‰∏≠SimpleUrlHandlerMappingÊØîËæÉÁâπÊÆäÔºåÂèØ‰ª•ÂØπÂ∫îÂ§ö‰∏™AdapterÔºå‰∏ªË¶ÅÂéüÂõ†ÊòØSimpleUrlHandlerMapping‰∏≠ÁöÑhandlerÁ±ªÂûã‰πüÂèØ‰ª•ÊúâÂ§öÁßçÔºåÊØîËæÉÂ∏∏ËßÅÁöÑÊúâControllerÊé•Âè£ÂÆûÁé∞Á±ªÔºåHttpRequestHandlerÊé•Âè£ÂÆûÁé∞Á±ª„ÄÇ HandlerAdapterÊé•Âè£ÂÖàÁúã‰∏ãHandlerAdapterÊé•Âè£ÁöÑÂá†‰∏™ÊñπÊ≥ï 123456789101112131415161718192021222324252627282930public interface HandlerAdapter &#123; /*** * Âà§Êñ≠ÊåáÂÆöhanderÊòØÂê¶ÂèØ‰ª•Ë¢´ÂΩìÂâçAdapterÊîØÊåÅ * * @param handler handler object to check * @return whether or not this object can use the given handler */ boolean supports(Object handler); /** * ÊâßË°åhanderÊñπÊ≥ï * returned &#123;@code true&#125;. * @throws Exception in case of errors * @return ModelAndView object with the name of the view and the required * model data, or &#123;@code null&#125; if the request has been handled directly */ @Nullable ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception; /** * ‰∏éHttpServletÁöÑ&#123;@code getLastModified&#125;ÊñπÊ≥ïÁöÑÁ∫¶ÂÆöÁõ∏Âêå * @param request current HTTP request * @param handler handler to use * @return the lastModified value for the given handler * @see javax.servlet.http.HttpServlet#getLastModified * @see org.springframework.web.servlet.mvc.LastModified#getLastModified */ long getLastModified(HttpServletRequest request, Object handler);&#125; Ê†∏ÂøÉÊòØsupportsÂíåhanderÊñπÊ≥ï supportsÁî®‰∫éÂà§Êñ≠ÊåáÂÆöhanderÊòØÂê¶ÂèØ‰ª•Ë¢´ÂΩìÂâçAdapterÊîØÊåÅ handerÊñπÊ≥ïÁî®‰∫éÊâßË°åÊåáÂÆöÁöÑhanderÁöÑÊ†∏ÂøÉÈÄªËæë ‰∏ãÈù¢ÁÆÄÂçïÊù•Áúã‰∏ãÂêÑ‰∏™HandlerAdapterÊé•Âè£ÁöÑÂÆûÁé∞Á±ªÔºåÁúã‰∏Ä‰∏ãÂØπËøô‰∏§‰∏™Ê†∏ÂøÉÊñπÊ≥ïÁöÑÂÆûÁé∞ RequestMappingHandlerAdapter supports 123public final boolean supports(Object handler) &#123; return (handler instanceof HandlerMethod &amp;&amp; supportsInternal((HandlerMethod) handler));&#125; ÊñπÊ≥ïÊØîËæÉÁÆÄÂçïÔºåÂà§Êñ≠handlerÁöÑÁ±ªÂûãÊòØ‰∏çÊòØHandlerMethodÔºåÂ¶ÇÊûúÊòØÁöÑËØùÔºåÂàôËØ¥ÊòéËØ•handlerÂèØ‰ª•Ë¢´ËØ•adapterÊâÄÈÄÇÈÖçÔºåÈÇ£‰πàÂ∞±‰ºöÁõ¥Êé•ËøîÂõûËØ•Adapter„ÄÇ hander 123456789101112131415161718192021222324252627282930313233343536373839protected ModelAndView handleInternal(HttpServletRequest request, HttpServletResponse response, HandlerMethod handlerMethod) throws Exception &#123; // ÂÆö‰πâ ModelAndView ModelAndView mav; checkRequest(request); // Â§Ñ‰∫é‰∏Ä‰∏™sessionÊó∂Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÂêåÊ≠• if (this.synchronizeOnSession) &#123; // Ëé∑ÂèñÂΩìÂâçsession HttpSession session = request.getSession(false); if (session != null) &#123; Object mutex = WebUtils.getSessionMutex(session); synchronized (mutex) &#123; // ÊâßË°å handerMethod ÂÆûÈôÖÈÄªËæë mav = invokeHandlerMethod(request, response, handlerMethod); &#125; &#125; else &#123; // No HttpSession available -&gt; no mutex necessary mav = invokeHandlerMethod(request, response, handlerMethod); &#125; &#125; else &#123; // mav = invokeHandlerMethod(request, response, handlerMethod); &#125; if (!response.containsHeader(HEADER_CACHE_CONTROL)) &#123; if (getSessionAttributesHandler(handlerMethod).hasSessionAttributes()) &#123; applyCacheSeconds(response, this.cacheSecondsForSessionAttributeHandlers); &#125; else &#123; prepareResponse(response); &#125; &#125; return mav;&#125; SimpleControllerHandlerAdapter supports 123public boolean supports(Object handler) &#123; return (handler instanceof Controller);&#125; Âà§Êñ≠ÊòØÂê¶ÊòØhandlerÁöÑÁ±ªÂûãÊòØÂê¶ÊòØController handler 12345public ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; return ((Controller) handler).handleRequest(request, response);&#125; ÊòØÁöÑËØùÔºåÂàôÁõ¥Êé•ÊâßË°åControllerÁöÑhandleRequestÊñπÊ≥ï HttpRequestHandlerAdapter supports 123public boolean supports(Object handler) &#123; return (handler instanceof HttpRequestHandler);&#125; handler 123456public ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; ((HttpRequestHandler) handler).handleRequest(request, response); return null;&#125; ÂÆûÁé∞ÈÄªËæë‰∏éSimpleControllerHandlerAdapterÁ±ª‰ºº ÂØπ‰∫é‰ª•‰∏äÂá†‰∏™AdapterÁöÑÂåπÈÖçÈ°∫Â∫èÔºåSpring‰ºöÊ†πÊçÆÂêÑ‰∏™AdapterÁöÑOrderÂÄºÊù•ËøõË°åÊéíÂ∫èÔºå‰æùÊ¨°ÂåπÈÖçÁõ¥Âà∞ÊâæÂà∞ÂêàÈÄÇÁöÑ‰∏∫Ê≠¢„ÄÇ ÊÄªÁªìHandlerAdapterÁöÑÊ†∏ÂøÉÈÄªËæëÂ∞±ÊòØÊâøÊé•‰∏çÂêåÁöÑHandlerMappingÂÅöÈÄÇÈÖç„ÄÇÊú¨Ë∫´ÁöÑÈÄªËæëÂπ∂‰∏çÂ§çÊùÇÔºåÂÖ∂ÂºïÂÖ•ÁöÑÈÄÇÈÖç‰∏≠Èó¥Â±ÇËÆæËÆ°Ê®°ÂºèÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â•ΩÁöÑÊ°à‰æã„ÄÇ]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MVCÊ∫êÁ†ÅËß£Êûê-HandlerMapping]]></title>
    <url>%2F2019%2F08%2F20%2FMVC%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-HandlerMapping%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰ªÄ‰πàÊòØSpring mvc ÁöÑ HanderMapping? **Êàë‰ª¨Áü•ÈÅìÂΩì‰∏Ä‰∏™httpËØ∑Ê±ÇÂà∞ÊúçÂä°Âô®Êó∂ÔºåÊàë‰ª¨ÈúÄË¶ÅÊ†πÊçÆËØ∑Ê±ÇÁöÑ‰∏ä‰∏ãÊñáurlÊù•ÂåπÈÖçÂà∞ÂØπÂ∫îÁöÑÂ§ÑÁêÜÁ±ªÔºåËÄåHanderMappingÂÅöÁöÑÂ∞±ÊòØËøô‰∏™‰∫ãÊÉÖÔºåÂÆÉÂÆö‰πâ‰∫ÜÊàë‰ª¨ÁöÑËØ∑Ê±ÇÂíåÂØπÂ∫îÁöÑÂ§ÑÁêÜÁ±ªÁöÑÊò†Â∞ÑÂÖ≥Á≥ª„ÄÇ Spring mvcÊèê‰æõ‰∫ÜÂ§öÁßçHanderMappingÁ±ªÂûãÔºåÊØîËæÉÂ∏∏Áî®ÁöÑÊúâ RequestMappingHandlerMapping,BeanNameUrlHandlerMapping,SimpleUrlHandlerMapping ‰ª•‰∏ãÊòØËøô‰∏â‰∏™HanderMappingÁöÑÁªßÊâøÁªìÊûÑÔºö ÂÖàÊù•Áúã‰∏Ä‰∏ãËøôÂá†‰∏™HandlerMappingÁöÑÈÖçÁΩÆÂÖ•Âè£ÔºåÂ¶ÇÊûúÊòØÊôÆÈÄöSpring MvcÂ∫îÁî®ÁöÑËØùÔºåÂΩìÊàë‰ª¨Âú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÈÖçÁΩÆ‰∫Üannotation-drivenÂêéÔºå‰æø‰ºöËá™Âä®Â∏ÆÊàë‰ª¨Ê≥®ÂÖ•ËøôÂá†‰∏™Á±ª„ÄÇÂÖ∑‰ΩìÁöÑÊ∫êÁ†ÅÂÖ•Âè£Âú®AnnotationDrivenBeanDefinitionParser‰∏≠ÔºåËøôÈáåÁöÑÈÄªËæëÈùûÂ∏∏ÁÆÄÂçïÔºåÂ∞±ÊòØÂ∏ÆÊàë‰ª¨Ëá™Âä®Ê≥®ÂÖ•ËøôÂá†‰∏™Â∏∏Áî®Á±ªÁöÑBeanDefinitionÂÖÉÊï∞ÊçÆÔºàÂåÖÊã¨HandlerMappingÔºåhandlerAdapterÔºåExceptionResolverÁ≠âÁ≠âÔºâ ‰∏ãÈù¢ÈÄöËøáÈòÖËØªÊ∫êÁ†Å‰æùÊ¨°ÂàÜÂà´Áúã‰∏Ä‰∏ãËøôÂá†‰∏™HanderMappingÁöÑ‰ΩúÁî®ÂèäÂÆûÁé∞ÂéüÁêÜ RequestMappingHandlerMappingÊàë‰ª¨ÂÖàÊù•Áúã‰∏ã RequestMappingHandlerMapping ÁöÑÁî®Ê≥ï 123456789101112@Controllerpublic class TestAPI &#123; @RequestMapping(value = &quot;/api/sayHello&quot;) public String hello() &#123; return &quot;OK&quot;; &#125; @RequestMapping(value = &quot;/api/sayHello2&quot;) public String hello2() &#123; return &quot;OK&quot;; &#125;&#125; Â¶Ç‰∏äÈù¢ÁöÑ‰ª£Á†ÅÔºåËøôÊòØ‰∏Ä‰∏™Êàë‰ª¨ÈùûÂ∏∏Â∏∏Áî®ÁöÑÁî®Ê≥ïÔºå‰∏Ä‰∏™ControllerÂÆö‰πâÂ§ö‰∏™Â§ÑÁêÜÊñπÊ≥ïÔºåÂπ∂‰∏îÂú®ÊñπÊ≥ï‰∏äÊ≥®Ëß£RequestMappingÔºåÂ¶ÇÊ≠§ÂÅö‰πãÂêéÂ∞±ÂèØ‰ª•ÂÆûÁé∞‰∏Ä‰∏™ControllerÊ†πÊçÆ‰∏çÂêåÁöÑË∑ØÂæÑÂàÜÂà´ÂèØ‰ª•Â§ÑÁêÜÂ§ö‰∏™ËØ∑Ê±Ç„ÄÇ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãÂÖ∂ÂÆûÁé∞ÂéüÁêÜ„ÄÇÊàëÊØîËæÉÂ•ΩÂ•áÁöÑÊòØÔºåRequestMappingHandlerMappingÊòØÂ¶Ç‰ΩïÂ∞ÜËØ∑Ê±ÇË∑ØÂæÑ‰∏éÂ§ÑÁêÜÊñπÊ≥ïËøõË°åÂàùÂßãÂåñÊò†Â∞ÑÁöÑÔºü ÈÄöËøáËßÇÂØüRequestMappingHandlerMappingÁöÑÁªßÊâø‰ΩìÁ≥ªÔºåÂèØ‰ª•Áü•ÈÅìÂÖ∂ÂÆûÁé∞‰∫ÜInitializingBeanÊé•Âè£ 1234567891011121314151617181920212223242526272829303132333435363738@Overridepublic void afterPropertiesSet() &#123; initHandlerMethods();&#125;/** * ÂàùÂßãÂåñ HandlerMethods */protected void initHandlerMethods() &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Looking for request mappings in application context: " + getApplicationContext()); &#125; // Ëé∑ÂèñÂÆπÂô®‰∏≠ÊâÄÊúâÁöÑBean String[] beanNames = (this.detectHandlerMethodsInAncestorContexts ? BeanFactoryUtils.beanNamesForTypeIncludingAncestors(obtainApplicationContext(), Object.class) : obtainApplicationContext().getBeanNamesForType(Object.class)); for (String beanName : beanNames) &#123; if (!beanName.startsWith(SCOPED_TARGET_NAME_PREFIX)) &#123; Class&lt;?&gt; beanType = null; try &#123; beanType = obtainApplicationContext().getType(beanName); &#125; catch (Throwable ex) &#123; // An unresolvable bean type, probably from a lazy bean - let's ignore it. if (logger.isDebugEnabled()) &#123; logger.debug("Could not resolve target class for bean with name '" + beanName + "'", ex); &#125; &#125; // Âà§Êñ≠ËØ•BeanÊòØÂê¶Ë¢´ @Controller ÊàñÂàô @RequestMapping ÊâÄÊ≥®Ëß£ if (beanType != null &amp;&amp; isHandler(beanType)) &#123; // ÂàùÂßãÂåñ HandlerMethods detectHandlerMethods(beanName); &#125; &#125; &#125; handlerMethodsInitialized(getHandlerMethods());&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏ªË¶ÅÂÅö‰∫Ü3‰ª∂‰∫ãÊÉÖ Ëé∑ÂèñÂÆπÂô®‰∏≠ÊâÄÊúâÁöÑBean Á≠õÈÄâÂá∫Ë¢´@Controller ÊàñÂàô @RequestMapping ÊâÄÊ≥®Ëß£ÁöÑBean Ê†πÊçÆÁ≠õÈÄâÂá∫ÁöÑBeanÂàùÂßãÂåñHandlerMethod ÂèØ‰ª•ÁúãÂà∞ËøôÈáåÊúâ‰∏Ä‰∏™ÂæàÈáçË¶ÅÁöÑÁ±ªÂè´ÂÅöHandlerMethodÔºåÊàë‰ª¨Êù•ÁúãÁúãËøô‰∏™Á±ªÁöÑÁªìÊûÑ 12345678910111213141516171819202122232425/** ÁõÆÊ†áBean **/private final Object bean;@Nullableprivate final BeanFactory beanFactory;private final Class&lt;?&gt; beanType; /** ÂØπÂ∫îÁöÑÁõÆÊ†áÊñπÊ≥ï **/private final Method method;private final Method bridgedMethod;/** ÊñπÊ≥ïÂèÇÊï∞Á±ªÂûã **/private final MethodParameter[] parameters;@Nullableprivate HttpStatus responseStatus;@Nullableprivate String responseStatusReason;@Nullableprivate HandlerMethod resolvedFromHandlerMethod;... ËøòÊèê‰æõ‰∫ÜÂæàÂ§öÊñπÊ≥ïÔºåÂÉèËé∑ÂèñÊñπÊ≥ïËøîÂõûÂÄºÁ≠âÁ≠â ÂØπ‰∫éËøô‰∏™Á±ªÊàë‰ª¨Áé∞Âú®ÂèØ‰ª•‰∏çÁî®Ê∑±ÂÖ•ÂéªÁêÜËß£ÔºåÂè™ÈúÄÁü•ÈÅìÂÆÉÂ∞ÅË£Ö‰∫ÜÂ§ÑÁêÜÁ±ªÁöÑÁõÆÊ†áÊñπÊ≥ï 123456789101112131415161718192021222324252627protected void detectHandlerMethods(Object handler) &#123; Class&lt;?&gt; handlerType = (handler instanceof String ? obtainApplicationContext().getType((String) handler) : handler.getClass()); if (handlerType != null) &#123; Class&lt;?&gt; userType = ClassUtils.getUserClass(handlerType); // Ëé∑ÂèñÁõÆÊ†áBean‰∏≠Ë¢´RequestMappingÊ≥®Ëß£ÁöÑÊñπÊ≥ï Map&lt;Method, T&gt; methods = MethodIntrospector.selectMethods(userType, (MethodIntrospector.MetadataLookup&lt;T&gt;) method -&gt; &#123; try &#123; return getMappingForMethod(method, userType); &#125; catch (Throwable ex) &#123; throw new IllegalStateException("Invalid mapping on handler class [" + userType.getName() + "]: " + method, ex); &#125; &#125;); if (logger.isDebugEnabled()) &#123; logger.debug(methods.size() + " request handler methods found on " + userType + ": " + methods); &#125; // Ê≥®ÂÜå HandlerMethod methods.forEach((method, mapping) -&gt; &#123; Method invocableMethod = AopUtils.selectInvocableMethod(method, userType); registerHandlerMethod(handler, invocableMethod, mapping); &#125;); &#125;&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏ªË¶ÅÂÅö‰∫Ü‰∏§‰ª∂‰∫ãÊÉÖ Ëé∑ÂèñÁõÆÂâçBean‰∏≠Ë¢´RequestMappingÊ≥®Ëß£ÁöÑÊñπÊ≥ï ÊääËé∑ÂèñÂà∞ÁöÑMethod Â∞ÅË£ÖÊàêHandlerMethodÂπ∂ÂÆåÊàêÊ≥®ÂÜå Âà∞ËøôÈáå‰∏∫Ê≠¢RequestMappingHandlerMappingÂ∞±ÂÆåÊàêÂàùÂßãÂåñ‰∫ÜÔºå‰∏ãÈù¢ÂÜçÊù•Áúã‰∏ãÂΩì‰∏Ä‰∏™ËØ∑Ê±ÇÊù•Êó∂ÂÖ∂ÂÆûÂ¶Ç‰ΩïÂ§ÑÁêÜÁöÑÔºåÂπ∂ÈÄâÊã©Ê≠£Á°ÆÁöÑ HandlerMethod Â§ÑÁêÜÁöÑ. ÂΩì‰∏Ä‰∏™ËØ∑Ê±ÇËøõÊù•Êó∂ÔºåDispatcherServlet‰ºöÂàÜÂà´Ë∞ÉÁî®ÊØè‰∏™HandlerMappingÁöÑgetHandlerÁöÑÊñπÊ≥ïÔºåÁõ¥Âà∞Êúâ‰∏™HandlerMappingËøîÂõû‰∫Ü‰∏Ä‰∏™hander getHandlerÊñπÊ≥ïÂú®ÊäΩË±°Áà∂Á±ªAbstractHandlerMapping.class‰∏≠ 1234567891011121314151617181920212223public final HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception &#123; // ÂÖ∑‰ΩìË∞ÉÁî®ÈÄªËæëÔºåÁî±Â≠êÁ±ªÂÆûÁé∞ Object handler = getHandlerInternal(request); if (handler == null) &#123; handler = getDefaultHandler(); &#125; if (handler == null) &#123; return null; &#125; if (handler instanceof String) &#123; String handlerName = (String) handler; handler = obtainApplicationContext().getBean(handlerName); &#125; HandlerExecutionChain executionChain = getHandlerExecutionChain(handler, request); if (CorsUtils.isCorsRequest(request)) &#123; CorsConfiguration globalConfig = this.globalCorsConfigSource.getCorsConfiguration(request); CorsConfiguration handlerConfig = getCorsConfiguration(handler, request); CorsConfiguration config = (globalConfig != null ? globalConfig.combine(handlerConfig) : handlerConfig); executionChain = getCorsHandlerExecutionChain(request, executionChain, config); &#125; return executionChain;&#125; ÁúãRequestMappingHandlerMappingÁöÑgetHandlerInternalÊñπÊ≥ï 1234567891011121314151617181920212223242526protected HandlerMethod getHandlerInternal(HttpServletRequest request) throws Exception &#123; // Ê†πÊçÆ requestËé∑ÂèñÂà∞ path // Â¶ÇËØ∑Ê±ÇÊòØ localhost:8080/api/sayHello // ÂàôËøôÈáåËøîÂõû /api/sayHello String lookupPath = getUrlPathHelper().getLookupPathForRequest(request); if (logger.isDebugEnabled()) &#123; logger.debug("Looking up handler method for path " + lookupPath); &#125; this.mappingRegistry.acquireReadLock(); try &#123; // Ëé∑ÂèñÂà∞ËØ∑Ê±ÇÂØπÂ∫îÁöÑ handlerMethod HandlerMethod handlerMethod = lookupHandlerMethod(lookupPath, request); if (logger.isDebugEnabled()) &#123; if (handlerMethod != null) &#123; logger.debug("Returning handler method [" + handlerMethod + "]"); &#125; else &#123; logger.debug("Did not find handler method for [" + lookupPath + "]"); &#125; &#125; return (handlerMethod != null ? handlerMethod.createWithResolvedBean() : null); &#125; finally &#123; this.mappingRegistry.releaseReadLock(); &#125;&#125; ‰ª•‰∏äÂ∞±ÊòØRequestMappingHandlerMappingÂú®Êï¥‰∏™MVCÊµÅÁ®ã‰∏≠ÊâÄËµ∑ÁöÑ‰ΩúÁî® BeanNameUrlHandlerMapping‰∏ãÈù¢Êàë‰ª¨ÂÜçÁÆÄÂçïÁúã‰∏ãBeanNameUrlHandlerMappingÁöÑ‰ΩøÁî®ÂíåÂéüÁêÜÈ°æÂêçÊÄù‰πâÔºåBeanNameUrlHandlerMappingÂ∞±ÊòØÊåáÈÄöËøáBeanNameÂíåUrlËøõË°åÂÖ≥ËÅîÂåπÈÖçÔºåË∑üRequestMappingHandlerMapping‰∏ç‰∏ÄÊ†∑ÔºåBeanNameUrlHandlerMapping‰∏Ä‰∏™BeanÂ∞±ÂØπÂ∫îÂ§ÑÁêÜ‰∏Ä‰∏™ËØ∑Ê±Ç.ÂÖàÊù•Áúã‰∏™‰ΩøÁî®ÁöÑ‰æãÂ≠ê 123456789@Component(&quot;/test2API&quot;)public class Test2API implements Controller &#123; @Override public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; System.out.println(&quot;test2API&quot;); return null; &#125;&#125; Â¶ÇÊ≠§ÂÆö‰πâ‰∏Ä‰∏™Á±ªÔºåÊàë‰ª¨‰æøËÉΩÈÄöËøá/test2APIËøô‰∏™Ë∑ØÂæÑÊù•ËÆøÈóÆËøô‰∏™Á±ª„ÄÇÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑÔºüÊàë‰ª¨ËøòÊòØÊâìÂºÄBeanNameUrlHandlerMappingÁúãÁúãÂÖ∂ÂÆûÁé∞Ôºå‰∏éRequestMappingHandlerMapping‰∏çÂêåÁöÑÊòØÔºåÂÆÉÊ≤°ÊúâÂÆûÁé∞InitializingBeanÊé•Âè£Ôºå‰∏çËøáÂÆÉÂÆûÁé∞‰∫ÜApplicationContextAwareÊé•Âè£ÔºåÂú®SpringÂÆπÂô®ÂÆåÊàêÂàùÂßãÂåñÁöÑÊó∂ÂÄôÂõûË∞ÉÁî®Ëøô‰∏™Âî§ÈÜíÊé•Âè£Ôºå‰πüÂ∞±ÊòØÂú®ËøôÈáåËøõË°å‰∫ÜBeanNameUrlHandlerMappingÁöÑÂàùÂßãÂåñ„ÄÇ ÂàùÂßãÂåñÈÄªËæëÂú® AbstractDetectingUrlHandlerMapping.detectHandlers() ÊñπÊ≥ï‰∏≠ 12345678910111213141516171819202122232425protected void detectHandlers() throws BeansException &#123; ApplicationContext applicationContext = obtainApplicationContext(); if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Looking for URL mappings in application context: &quot; + applicationContext); &#125; String[] beanNames = (this.detectHandlersInAncestorContexts ? BeanFactoryUtils.beanNamesForTypeIncludingAncestors(applicationContext, Object.class) : applicationContext.getBeanNamesForType(Object.class)); // Take any bean name that we can determine URLs for. for (String beanName : beanNames) &#123; // Ëé∑ÂèñBeanNameÊàñÂà´ÂêçÊòØ &quot;/&quot; ÂºÄÂ§¥ÁöÑ BeanÂêçÁß∞ String[] urls = determineUrlsForHandler(beanName); if (!ObjectUtils.isEmpty(urls)) &#123; // URL paths found: Let&apos;s consider it a handler. // ÊääËé∑ÂèñÂà∞ÁöÑ urls Ê≥®ÂÜåÂà∞ handler registerHandler(urls, beanName); &#125; else &#123; if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Rejected bean name &apos;&quot; + beanName + &quot;&apos;: no URL paths identified&quot;); &#125; &#125; &#125;&#125; determineUrlsForHandlerÊòØBeanNameUrlHandlerMappingÁ±ª‰ªÖÊúâÂÆûÁé∞ÁöÑ‰∏Ä‰∏™ÊñπÊ≥ïÔºå‰∏ªË¶ÅÈÄªËæëÂ∞±ÊòØËé∑ÂèñBeanNameÊàñÂà´ÂêçÊòØ ‚Äú/‚Äú ÂºÄÂ§¥ÁöÑ BeanÂêçÁß∞„ÄÇÊâÄ‰ª•ËøôÈáå‰πüÂèØ‰ª•Áü•ÈÅìÂú®‰∏äÊñáÁöÑ‰ΩøÁî®‰æãÂ≠ê‰∏≠ÔºåBeanNameÊàë‰∏∫‰ΩïË¶Å‰ª•ÊñúÊù†ÂºÄÂ§¥„ÄÇ ÂΩì‰∏Ä‰∏™ËØ∑Ê±ÇÊù•Êó∂BeanNameUrlHandlerMappingÁöÑÂ§ÑÁêÜÈÄªËæëÁ±ª‰ººÔºåÂè™‰∏çËøáÂåπÈÖçÁöÑÂÆπÂô®Êç¢Êàê‰∫ÜhandlerMap = new LinkedHashMap&lt;&gt;();ÔºåÂåπÈÖçÈÄªËæëÊõ¥Âä†ÁöÑÁÆÄÂçïÁõ¥Êé•„ÄÇ SimpleUrlHandlerMappingÊúÄÂêéÂÜçÁúã‰∏ã SimpleUrlHandlerMappingÁöÑÁî®Ê≥ïÂèäÂÆûÁé∞ ÂÆö‰πâ‰∏Ä‰∏™SimpleUrlHandlerMapping 1234567891011121314@Configurationpublic class SampleConfig &#123; @Bean public SimpleUrlHandlerMapping simpleUrlHandlerMapping() &#123; SimpleUrlHandlerMapping simpleUrlHandlerMapping = new SimpleUrlHandlerMapping(); Map&lt;String, Object&gt; urlMap = new HashMap&lt;&gt;(); urlMap.put("/**", new Test2API()); // ... ÂèØÈÖçÁΩÆÂ§ö‰∏™Êò†Â∞ÑÂÖ≥Á≥ª simpleUrlHandlerMapping.setUrlMap(urlMap); simpleUrlHandlerMapping.setOrder(1); return simpleUrlHandlerMapping; &#125;&#125; ‰ª•‰∏äÈÖçÁΩÆ‰ºöÊã¶Êà™ÊâÄÊúâÁöÑËØ∑Ê±ÇÔºåÁÑ∂ÂêéËΩ¨‰∫§Áªô Test2APIÂ§ÑÁêÜÔºàTest2APIÂèØ‰ª•ÊòØControllerÊé•Âè£ÂÆûÁé∞Á±ªÔºå‰πüÂèØ‰ª•ÊòØ‰∏Ä‰∏™ HttpRequestHandlerÊé•Âè£ÂÆûÁé∞Á±ªÔºâÔºåÂèØ‰ª•ÁúãÂà∞ËøôÈáåSimpleUrlHandlerMappingËµ∑ÁöÑ‰ΩúÁî®ÈùûÂ∏∏ÂÉè‰∏Ä‰∏™Êã¶Êà™Âô®Ëµ∑ÁöÑ‰ΩúÁî®ÔºåÂÖ∂ÂÆû‰πüÁ°ÆÂÆûÊòØËøôÊ†∑ÔºåÂÉèÂØπÈùôÊÄÅËµÑÊ∫êÁöÑÊã¶Êà™Â∞±ÂèØ‰ª•ÈááÁî®SimpleUrlHandlerMappingÊù•ÂÆûÁé∞„ÄÇ ÂÖ∑‰ΩìÂÆûÁé∞ÂÖ∂ÂÆûË∑ü‰∏äÊñáÁöÑ‰∏§ÁßçmappingÂÆûÁé∞Á±ª‰ººÔºåÁÆÄÂçïÁúã‰∏ãÊ∫êÁ†Å ÂàùÂßãÊ≥®ÂÜåÈÄªËæë 123456789101112131415161718192021222324@Overridepublic void initApplicationContext() throws BeansException &#123; super.initApplicationContext(); registerHandlers(this.urlMap);&#125;protected void registerHandlers(Map&lt;String, Object&gt; urlMap) throws BeansException &#123; if (urlMap.isEmpty()) &#123; logger.warn("Neither 'urlMap' nor 'mappings' set on SimpleUrlHandlerMapping"); &#125; else &#123; urlMap.forEach((url, handler) -&gt; &#123; // Á°Æ‰øùË∑ØÂæÑÊòØ‰ª•ÊñúÊù†ÂºÄÂ§¥ÁöÑ if (!url.startsWith("/")) &#123; url = "/" + url; &#125; // ÂéªÈô§Á©∫Ê†º if (handler instanceof String) &#123; handler = ((String) handler).trim(); &#125; // Ê≥®ÂÜå registerHandler(url, handler); &#125;); &#125;&#125; ÈÄªËæëËøòÊòØÊØîËæÉÁÆÄÂçïÁöÑÔºåÂ∞±ÊòØÂ∞ÜÊàë‰ª¨ÊâãÂä®ÈÖçÁΩÆÁöÑÂ§ö‰∏™Êò†Â∞ÑÂÖ≥Á≥ªËøõË°åÂàùÂßãÊ≥®ÂÜåÔºå‰ª•Â§áÂêéÈù¢ÈÄªËæë‰ΩøÁî®„ÄÇ ÊÄªÁªìÊÄªÁöÑÊù•ËØ¥HanderMappingÁöÑËÅåË¥£ÊòØÈùûÂ∏∏Ê∏ÖÊô∞ÁöÑÔºåÂ∞±ÊòØÂ≠òÂÇ®Âπ∂ÂåπÈÖçËØ∑Ê±ÇurlÂíåÂ§ÑÁêÜÁ±ªÁöÑÊò†Â∞ÑÂÖ≥Á≥ª„ÄÇÊï¥‰∏™Â§ÑÁêÜÊµÅÁ®ãÁöÑÊ∫êÁ†ÅÁõ∏ÂØπÊù•ËØ¥‰πüÊØîËæÉÁõ¥ËßÇÔºåÊòìÈòÖËØª„ÄÇËØªÂÆåÂÖ∂Ê∫êÁ†ÅÂØπMVCÁöÑurlÂåπÈÖçÊµÅÁ®ã‰ºöÊúâÊõ¥Âä†Ê∑±ÂàªÁöÑËÆ§ËØÜ]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂàÜÂ∏ÉÂºè‰∫ãÂä°Âú®ÁßØÂàÜÂïÜÂüéÈáåÁöÑÂ∫îÁî®]]></title>
    <url>%2F2019%2F07%2F10%2F%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E5%9C%A8%E7%A7%AF%E5%88%86%E5%95%86%E5%9F%8E%E9%87%8C%E7%9A%84%E5%BA%94%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÊúÄËøëÂú®ÂÅö‰ºöÂëò‰ΩìÁ≥ªÁöÑÊó∂ÂÄôÔºåÊ∂âÂèäÂà∞‰∫ÜÁßØÂàÜÂïÜÂüéËÆ¢Âçï‰ΩìÁ≥ªÔºåÊó¢ÁÑ∂ËÆæËÆ°Âà∞ËÆ¢Âçï‰ΩìÁ≥ªÔºåÂõ†‰∏∫Áé∞Âú®ÁöÑÈ°πÁõÆÊû∂ÊûÑ‰ΩìÁ≥ªÂü∫Êú¨ÈÉΩÊòØÂæÆÊúçÂä°ÂàÜÂ∏ÉÂºèÁöÑÔºåÊâÄ‰ª•ÂøÖÁÑ∂‰ºöÊ∂âÂèäÂà∞ÂàÜÂ∏ÉÂºè‰∫ãÂä°„ÄÇ‰∫ãÂä°ÈóÆÈ¢òÂú®Êó©‰∫õÊó∂ÂÄôÈÉΩÊòØÂçïÊú∫ÈÉ®ÁΩ≤ÁöÑÊó∂‰ª£‰æùÈù†Êï∞ÊçÆÂ∫ìÊú¨Ë∫´Êèê‰æõÁöÑ‰∫ãÂä°Êú∫Âà∂ÈùûÂ∏∏ÂÆπÊòìËß£ÂÜ≥Ôºå‰ΩÜÊòØ‰∏ÄÊó¶ËÆæËÆ°Âà∞ÂàÜÂ∏ÉÂºèÔºåÂêÑ‰∏™Áã¨Á´ãÁöÑÊúçÂä°ÊòØÊó†Ê≥ïÊÑüÁü•ÂÖ∂‰ªñ‰∫ãÂä°ÊâßË°åÁä∂ÊÄÅÁöÑÔºåÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅÂÄüÂä©‰∏Ä‰∫õÂÖ∂‰ªñÊâãÊÆµÊù•‰øùËØÅÂàÜÂ∏ÉÂºè‰∫ãÂä° ÂàÜÂ∏ÉÂºèÁêÜËÆ∫ CAP CÔºà‰∏ÄËá¥ÊÄßÔºâ‰∏ÄËá¥ÊÄßÊòØÊåáÊï∞ÊçÆÁöÑÂéüÂ≠êÊÄßÔºåÂú®ÁªèÂÖ∏ÁöÑÊï∞ÊçÆÂ∫ì‰∏≠ÈÄöËøá‰∫ãÂä°Êù•‰øùÈöúÔºå‰∫ãÂä°ÂÆåÊàêÊó∂ÔºåÊó†ËÆ∫ÊàêÂäüÊàñÂõûÊªöÔºåÊï∞ÊçÆÈÉΩ‰ºöÂ§Ñ‰∫é‰∏ÄËá¥ÁöÑÁä∂ÊÄÅÔºåÂú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏ãÔºå‰∏ÄËá¥ÊÄßÊòØÊåáÂ§ö‰∏™ËäÇÁÇπÊï∞ÊçÆÊòØÂê¶‰∏ÄËá¥Ôºõ AÔºàÂèØÁî®ÊÄßÔºâÊúçÂä°‰∏ÄÁõ¥‰øùÊåÅÂèØÁî®ÁöÑÁä∂ÊÄÅÔºåÂΩìÁî®Êà∑ÂèëÂá∫‰∏Ä‰∏™ËØ∑Ê±ÇÔºåÊúçÂä°ËÉΩÂú®‰∏ÄÂÆöÁöÑÊó∂Èó¥ÂÜÖËøîÂõûÁªìÊûúÔºõ PÔºàÂàÜÂå∫ÂÆπÈîôÊÄßÔºâÊú∫Âô®ÊïÖÈöú„ÄÅÁΩëÁªúÊïÖÈöú„ÄÅÊú∫ÊàøÂÅúÁîµÁ≠âÂºÇÂ∏∏ÊÉÖÂÜµ‰∏ã‰ªçÁÑ∂ËÉΩÂ§üÊª°Ë∂≥‰∏ÄËá¥ÊÄßÂíåÂèØÁî®ÊÄßÔºåÂàÜÂ∏ÉÂºèÂ∫îÁî®‰∏ÄËà¨ÈÉΩÊª°Ë∂≥ÂàÜÂå∫ÂÆπÈîôÊÄßÂàÜÂ∏ÉÂºè‰∫ãÂä°Êàë‰ª¨Ë¶ÅËß£ÂÜ≥ÁöÑÂ∞±ÊòØÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄßÈóÆÈ¢ò ‰∏ÄËá¥ÊÄßÊ®°Âûã Âü∫Êú¨ÂèØÁî®ÔºàBasically AvailableÔºâ ËΩØÁä∂ÊÄÅÔºàSoft StateÔºâ ÊúÄÁªà‰∏ÄËá¥ÊÄßÔºàEventually ConsistentÔºâ ÂÖ∂‰∏≠ÊúÄÁªà‰∏ÄËá¥ÊÄßÂèàÂèØÂàÜ‰∏∫Ôºö‰ºöËØù‰∏ÄËá¥ÊÄß ÂçïË∞É‰∏ÄËá¥ÊÄßÁ≠âÁ≠â 2PC (Two/Three Phase Commit)2PC Êàë‰ª¨ÂèàÊääÂÆÉÂè´ÂÅö‰∏§Èò∂ÊÆµÊèê‰∫§ÔºåÂú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÊØè‰∏™ËäÇÁÇπËôΩÁÑ∂ÂèØ‰ª•Áü•ÊôìËá™Â∑±ÁöÑÊìç‰ΩúÊó∂ÊàêÂäüÊàñËÄÖÂ§±Ë¥•ÔºåÂç¥Êó†Ê≥ïÁü•ÈÅìÂÖ∂‰ªñËäÇÁÇπÁöÑÊìç‰ΩúÁöÑÊàêÂäüÊàñÂ§±Ë¥•„ÄÇÂΩì‰∏Ä‰∏™‰∫ãÂä°Ë∑®Ë∂äÂ§ö‰∏™ËäÇÁÇπÊó∂Ôºå‰∏∫‰∫Ü‰øùÊåÅ‰∫ãÂä°ÁöÑACIDÁâπÊÄßÔºåÈúÄË¶ÅÂºïÂÖ•‰∏Ä‰∏™‰Ωú‰∏∫ÂçèË∞ÉËÄÖÁöÑÁªÑ‰ª∂Êù•Áªü‰∏ÄÊéåÊéßÊâÄÊúâËäÇÁÇπÔºàÁß∞‰ΩúÂèÇ‰∏éËÄÖÔºâÁöÑÊìç‰ΩúÁªìÊûúÂπ∂ÊúÄÁªàÊåáÁ§∫Ëøô‰∫õËäÇÁÇπÊòØÂê¶Ë¶ÅÊääÊìç‰ΩúÁªìÊûúËøõË°åÁúüÊ≠£ÁöÑÊèê‰∫§ÔºàÊØîÂ¶ÇÂ∞ÜÊõ¥Êñ∞ÂêéÁöÑÊï∞ÊçÆÂÜôÂÖ•Á£ÅÁõòÁ≠âÁ≠âÔºâ„ÄÇÂõ†Ê≠§Ôºå‰∫åÈò∂ÊÆµÊèê‰∫§ÁöÑÁÆóÊ≥ïÊÄùË∑ØÂèØ‰ª•Ê¶ÇÊã¨‰∏∫Ôºö ÂèÇ‰∏éËÄÖÂ∞ÜÊìç‰ΩúÊàêË¥•ÈÄöÁü•ÂçèË∞ÉËÄÖÔºåÂÜçÁî±ÂçèË∞ÉËÄÖÊ†πÊçÆÊâÄÊúâÂèÇ‰∏éËÄÖÁöÑÂèçÈ¶àÊÉÖÊä•ÂÜ≥ÂÆöÂêÑÂèÇ‰∏éËÄÖÊòØÂê¶Ë¶ÅÊèê‰∫§Êìç‰ΩúËøòÊòØ‰∏≠Ê≠¢Êìç‰Ωú„ÄÇ ÂâçÊèê‰∫åÈò∂ÊÆµÊèê‰∫§ÁÆóÊ≥ïÁöÑÊàêÁ´ãÂü∫‰∫é‰ª•‰∏ãÂÅáËÆæÔºö ËØ•ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÂ≠òÂú®‰∏Ä‰∏™ËäÇÁÇπ‰Ωú‰∏∫ÂçèË∞ÉËÄÖ(Coordinator)ÔºåÂÖ∂‰ªñËäÇÁÇπ‰Ωú‰∏∫ÂèÇ‰∏éËÄÖ(Participants)„ÄÇ‰∏îËäÇÁÇπ‰πãÈó¥ÂèØ‰ª•ËøõË°åÁΩëÁªúÈÄö‰ø°„ÄÇ ÊâÄÊúâËäÇÁÇπÈÉΩÈááÁî®È¢ÑÂÜôÂºèÊó•ÂøóÔºå‰∏îÊó•ÂøóË¢´ÂÜôÂÖ•ÂêéÂç≥Ë¢´‰øùÊåÅÂú®ÂèØÈù†ÁöÑÂ≠òÂÇ®ËÆæÂ§á‰∏äÔºåÂç≥‰ΩøËäÇÁÇπÊçüÂùè‰∏ç‰ºöÂØºËá¥Êó•ÂøóÊï∞ÊçÆÁöÑÊ∂àÂ§±„ÄÇ ÊâÄÊúâËäÇÁÇπ‰∏ç‰ºöÊ∞∏‰πÖÊÄßÊçüÂùèÔºåÂç≥‰ΩøÊçüÂùèÂêé‰ªçÁÑ∂ÂèØ‰ª•ÊÅ¢Â§ç„ÄÇ Á¨¨‰∏ÄÈò∂ÊÆµ(Êèê‰∫§ËØ∑Ê±ÇÈò∂ÊÆµ) ÂçèË∞ÉËÄÖËäÇÁÇπÂêëÊâÄÊúâÂèÇ‰∏éËÄÖËäÇÁÇπËØ¢ÈóÆÊòØÂê¶ÂèØ‰ª•ÊâßË°åÊèê‰∫§Êìç‰ΩúÔºåÂπ∂ÂºÄÂßãÁ≠âÂæÖÂêÑÂèÇ‰∏éËÄÖËäÇÁÇπÁöÑÂìçÂ∫î„ÄÇ ÂèÇ‰∏éËÄÖËäÇÁÇπÊâßË°åËØ¢ÈóÆÂèëËµ∑‰∏∫Ê≠¢ÁöÑÊâÄÊúâ‰∫ãÂä°Êìç‰ΩúÔºåÂπ∂Â∞ÜUndo‰ø°ÊÅØÂíåRedo‰ø°ÊÅØÂÜôÂÖ•Êó•Âøó„ÄÇ ÂêÑÂèÇ‰∏éËÄÖËäÇÁÇπÂìçÂ∫îÂçèË∞ÉËÄÖËäÇÁÇπÂèëËµ∑ÁöÑËØ¢ÈóÆ„ÄÇÂ¶ÇÊûúÂèÇ‰∏éËÄÖËäÇÁÇπÁöÑ‰∫ãÂä°Êìç‰ΩúÂÆûÈôÖÊâßË°åÊàêÂäüÔºåÂàôÂÆÉËøîÂõû‰∏Ä‰∏™‚ÄùÂêåÊÑè‚ÄùÊ∂àÊÅØÔºõÂ¶ÇÊûúÂèÇ‰∏éËÄÖËäÇÁÇπÁöÑ‰∫ãÂä°Êìç‰ΩúÂÆûÈôÖÊâßË°åÂ§±Ë¥•ÔºåÂàôÂÆÉËøîÂõû‰∏Ä‰∏™‚Äù‰∏≠Ê≠¢‚ÄùÊ∂àÊÅØ„ÄÇ ÊúâÊó∂ÂÄôÔºåÁ¨¨‰∏ÄÈò∂ÊÆµ‰πüË¢´Áß∞‰ΩúÊäïÁ•®Èò∂ÊÆµÔºåÂç≥ÂêÑÂèÇ‰∏éËÄÖÊäïÁ•®ÊòØÂê¶Ë¶ÅÁªßÁª≠Êé•‰∏ãÊù•ÁöÑÊèê‰∫§Êìç‰Ωú„ÄÇ Á¨¨‰∫åÈò∂ÊÆµ(Êèê‰∫§ÊâßË°åÈò∂ÊÆµ) ÊàêÂäü ÂΩìÂçèË∞ÉËÄÖËäÇÁÇπ‰ªéÊâÄÊúâÂèÇ‰∏éËÄÖËäÇÁÇπËé∑ÂæóÁöÑÁõ∏Â∫îÊ∂àÊÅØÈÉΩ‰∏∫‚ÄùÂêåÊÑè‚ÄùÊó∂Ôºö ÂçèË∞ÉËÄÖËäÇÁÇπÂêëÊâÄÊúâÂèÇ‰∏éËÄÖËäÇÁÇπÂèëÂá∫‚ÄùÊ≠£ÂºèÊèê‰∫§‚ÄùÁöÑËØ∑Ê±Ç„ÄÇ ÂèÇ‰∏éËÄÖËäÇÁÇπÊ≠£ÂºèÂÆåÊàêÊìç‰ΩúÔºåÂπ∂ÈáäÊîæÂú®Êï¥‰∏™‰∫ãÂä°ÊúüÈó¥ÂÜÖÂç†Áî®ÁöÑËµÑÊ∫ê„ÄÇ ÂèÇ‰∏éËÄÖËäÇÁÇπÂêëÂçèË∞ÉËÄÖËäÇÁÇπÂèëÈÄÅ‚ÄùÂÆåÊàê‚ÄùÊ∂àÊÅØ„ÄÇ ÂçèË∞ÉËÄÖËäÇÁÇπÊî∂Âà∞ÊâÄÊúâÂèÇ‰∏éËÄÖËäÇÁÇπÂèçÈ¶àÁöÑ‚ÄùÂÆåÊàê‚ÄùÊ∂àÊÅØÂêéÔºåÂÆåÊàê‰∫ãÂä°„ÄÇ Â§±Ë¥• Â¶ÇÊûú‰ªª‰∏ÄÂèÇ‰∏éËÄÖËäÇÁÇπÂú®Á¨¨‰∏ÄÈò∂ÊÆµËøîÂõûÁöÑÂìçÂ∫îÊ∂àÊÅØ‰∏∫‚ÄùÁªàÊ≠¢‚ÄùÔºåÊàñËÄÖ ÂçèË∞ÉËÄÖËäÇÁÇπÂú®Á¨¨‰∏ÄÈò∂ÊÆµÁöÑËØ¢ÈóÆË∂Ö Êó∂‰πãÂâçÊó†Ê≥ïËé∑ÂèñÊâÄÊúâÂèÇ‰∏éËÄÖËäÇÁÇπÁöÑÂìçÂ∫îÊ∂àÊÅØÊó∂Ôºö ÂçèË∞ÉËÄÖËäÇÁÇπÂêëÊâÄÊúâÂèÇ‰∏éËÄÖËäÇÁÇπÂèëÂá∫‚ÄùÂõûÊªöÊìç‰Ωú‚ÄùÁöÑËØ∑Ê±Ç„ÄÇ ÂèÇ‰∏éËÄÖËäÇÁÇπÂà©Áî®‰πãÂâçÂÜôÂÖ•ÁöÑUndo‰ø°ÊÅØÊâßË°åÂõûÊªöÔºåÂπ∂ÈáäÊîæÂú®Êï¥‰∏™‰∫ãÂä°ÊúüÈó¥ÂÜÖÂç†Áî®ÁöÑËµÑÊ∫ê„ÄÇ ÂèÇ‰∏éËÄÖËäÇÁÇπÂêëÂçèË∞ÉËÄÖËäÇÁÇπÂèëÈÄÅ‚ÄùÂõûÊªöÂÆåÊàê‚ÄùÊ∂àÊÅØ„ÄÇ ÂçèË∞ÉËÄÖËäÇÁÇπÊî∂Âà∞ÊâÄÊúâÂèÇ‰∏éËÄÖËäÇÁÇπÂèçÈ¶àÁöÑ‚ÄùÂõûÊªöÂÆåÊàê‚ÄùÊ∂àÊÅØÂêéÔºåÂèñÊ∂à‰∫ãÂä°„ÄÇ ÊúâÊó∂ÂÄôÔºåÁ¨¨‰∫åÈò∂ÊÆµ‰πüË¢´Áß∞‰ΩúÂÆåÊàêÈò∂ÊÆµÔºåÂõ†‰∏∫Êó†ËÆ∫ÁªìÊûúÊÄéÊ†∑ÔºåÂçèË∞ÉËÄÖÈÉΩÂøÖÈ°ªÂú®Ê≠§Èò∂ÊÆµÁªìÊùüÂΩìÂâç‰∫ãÂä° Áº∫ÁÇπ‰∫åÈò∂ÊÆµÊèê‰∫§ÁÆóÊ≥ïÁöÑÊúÄÂ§ßÁº∫ÁÇπÂ∞±Âú®‰∫é: ÂÆÉÁöÑÊâßË°åËøáÁ®ã‰∏≠Èó¥ÔºåËäÇÁÇπÈÉΩÂ§Ñ‰∫éÈòªÂ°ûÁä∂ÊÄÅ„ÄÇÂç≥ËäÇÁÇπ‰πãÈó¥Âú®Á≠âÂæÖÂØπÊñπÁöÑÂìçÂ∫îÊ∂àÊÅØÊó∂ÔºåÂÆÉÂ∞Ü‰ªÄ‰πà‰πüÂÅö‰∏ç‰∫Ü„ÄÇÁâπÂà´ÊòØÔºåÂΩì‰∏Ä‰∏™ËäÇÁÇπÂú®Â∑≤ÁªèÂç†Êúâ‰∫ÜÊüêÈ°πËµÑÊ∫êÁöÑÊÉÖÂÜµ‰∏ãÔºå‰∏∫‰∫ÜÁ≠âÂæÖÂÖ∂‰ªñËäÇÁÇπÁöÑÂìçÂ∫îÊ∂àÊÅØËÄåÈô∑ÂÖ•ÈòªÂ°ûÁä∂ÊÄÅÊó∂ÔºåÂΩìÁ¨¨‰∏â‰∏™ËäÇÁÇπÂ∞ùËØïËÆøÈóÆËØ•ËäÇÁÇπÂç†ÊúâÁöÑËµÑÊ∫êÊó∂ÔºåËøô‰∏™ËäÇÁÇπ‰πüÂ∞ÜËøûÂ∏¶Èô∑ÂÖ•ÈòªÂ°ûÁä∂ÊÄÅ„ÄÇ TCC Ë°•ÂÅøÂûã‰∏äÈù¢Â§ßÁØáÂπÖÁöÑ‰ªãÁªç‰∫Ü2PCÊèê‰∫§Ôºå‰ΩÜÂÆûÈôÖÁöÑÂ∫îÁî®‰∏≠Êàë‰ª¨Âü∫Êú¨ÈÉΩ‰∏ç‰ºö‰ΩøÁî®ËøôÁßçÊñπÊ°àÔºåÂéüÂõ†Âú®‰∏äÈù¢ÁöÑÁº∫ÁÇπ‰∏≠Â∑≤ÁªèËØ¥Êòé‰∫ÜÔºå2PCËøôÁßç‰º†ÁªüÁöÑÂàÜÂ∏ÉÂºè‰∫ãÂä°Ëß£ÂÜ≥ÊñπÊ°àÊÄßËÉΩÂÆûÂú®ÊòØÂ§™Â∑Æ‰∫ÜÔºåÂú®‰∫íËÅîÁΩëÂ§ßÂπ∂ÂèëÁöÑËÉåÊôØ‰∏ãÊòæÁÑ∂ÊòØ‰∏çË°åÁöÑÔºåËøôÂ∞±ÂºïÁî≥Âá∫‰∫ÜTCCË°•ÂÅøÊÄßÂàÜÂ∏ÉÂºè‰∫ãÂä°Ëß£ÂÜ≥ÊñπÊ°à TCCÊòØ(Try-Confirm-Cancel)ÁöÑÁÆÄÁß∞Ôºå‰ªéÂêçÂ≠óÊàë‰ª¨Áü•ÈÅìTCCÊúâ‰∏â‰∏™Èò∂ÊÆµ TryTryÈò∂ÊÆµ‰∏ªË¶ÅÂÅöËµÑÊ∫êÁöÑÈ¢ÑÁïôÔºåÈîÅÂÆöÊìç‰Ωú ConfirmÂ¶ÇÊûúTryÈ¢ÑÁïôËµÑÊ∫êÊàêÂäüÔºåÂàôÊâßË°åConfirmÊìç‰ΩúÔºåÂØπËµÑÊ∫êÂÅöÊúÄÁªàÁöÑÊèê‰∫§ CancelÂ¶ÇÊûúTryÈ¢ÑÁïôËµÑÊ∫êÂ§±Ë¥•ÔºåÂàôÊâßË°åCancelÂèñÊ∂àÂØπËµÑÊ∫êÁöÑÈîÅÂÆö ÈÄöËøá‰∏äÊñáÁöÑÊèèËø∞ÔºåÂèØ‰ª•ÂèëÁé∞TCC‰∏é2PCÈùûÂ∏∏Áõ∏‰ººÔºå‰ΩÜÂÆûÈôÖ‰∏ä‰∏§ËÄÖÂú®Ëß£ÂÜ≥ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÁöÑÂ±ÇÈù¢‰∏ä‰∏ç‰∏ÄÊ†∑ÁöÑÔºå2PC‰∏ªË¶ÅËøòÊòØÂÄüÂä©Êï∞ÊçÆÂ∫ìÂ±ÇÈù¢ÁöÑ‰∫ãÂä°Êù•ÂçèË∞ÉËß£ÂÜ≥ÔºåÁõ∏ÂØπ‰∫éÊï∞ÊçÆÂ∫ì‰∫ãÂä°ÁöÑrollbackÔºåTCCÂú®ÈÄªËæëÂ±ÇÈù¢ÁöÑCancelÊìç‰ΩúÔºå‰ª£‰ª∑Ë¶ÅÂ∞èÁöÑÂ§ö„ÄÇÂπ∂‰∏îTCC‰∫ãÂä°ÂºïÂÖ•‰∫Ü‰∏≠Èó¥Áä∂ÊÄÅÔºà‰πüÂ∞±ÊòØËµÑÊ∫êÁöÑÈîÅÂÆöÔºâÔºåÂè™Ë¶ÅÂÖ®ÈÉ®ËµÑÊ∫êÈÉΩÈîÅÂÆöÊàêÂäüÔºåÊàë‰ª¨Â∞±ËÆ§‰∏∫ÊúÄÁªàÊòØÊâßË°åÊàêÂäüÁöÑÔºàÊúÄÁªà‰∏ÄËá¥ÊÄßÔºâ ‰∏ãÂõæÊòØÁßØÂàÜ‰∏ãÂçïÁî®TCC‰∫ãÂä°Ëß£ÂÜ≥ÁöÑÂÖ∏ÂûãÂú∫ÊôØ TCCÊòØÂ¶Ç‰ΩïËß£ÂÜ≥ÊúÄÁªà‰∏ÄËá¥ÊÄßÁöÑÔºüÂΩìÊàë‰ª¨Âú®TryÈò∂ÊÆµÈ¢ÑÁïôËµÑÊ∫êÊàêÂäüÁöÑËØùÔºåÈÇ£‰πàÊàë‰ª¨Â∞±ËÆ§‰∏∫ÊúÄÁªàËøô‰∏™‰∫ãÂä°ÊòØËÇØÂÆöÂèØ‰ª•ÂÆåÊàêÁöÑÔºåÂç≥‰ΩøÂõ†‰∏∫Êüê‰∫õÂéüÂõ†(Êï∞ÊçÆÂ∫ìdown‰∫ÜÁ≠âÁöÑ)ConfirmÊâßË°åÂ§±Ë¥•ÔºåTCC‰∫ãÂä°Ê°ÜÊû∂‰ºö‰∏çÂÅúÁöÑÈáçËØïË∞ÉÁî®ÂÆÉÁöÑConfirmÈÄªËæëÔºåÂä°ÂøÖ‰ºö‰øùËØÅÂÖ∂ÊúÄÁªà‰∏ÄËá¥ÊÄß ÂÖ∏ÂûãÂ∫îÁî®Âú∫ÊôØËÆ¢ÂçïÁ≥ªÁªü ‰∫ãÂä°Ê∂àÊÅØ‰∫ãÂä°Ê∂àÊÅØÁöÑÂ∫îÁî®Âú∫ÊôØÊòØÔºå‰∫ãÂä°ÂèÇ‰∏éÊñπÁöÑËµÑÊ∫êÂ∑≤ÁªèÈîÅÂÆöÔºåÂè™ÈúÄË¶Å‰øùÊåÅÊúÄÁªà‰∏ÄËá¥ÊÄßÁöÑÂú∫ÊôØ„ÄÇÊØîËæÉÂÖ∏ÂûãÁöÑÂÆû‰æãÊòØÈì∂Ë°åËΩ¨Ë¥¶ÔºåÂΩìAË¥¶Êà∑ÂÆåÊàêË¥¶Êà∑Êâ£ÂáèÂêéÔºåBË¥¶Êà∑‰∏çÈúÄË¶ÅÈîÅÂÆöË¥¶Êà∑ÔºåÂè™ÈúÄË¶Å‰øùËØÅÊúÄÁªàBË¥¶Êà∑ÂèØ‰ª•Â¢ûÂä†ÊåáÂÆöÈáëÈ¢ù ‰∏∫‰ΩïÈúÄË¶ÅÂÖàÂèëÈÄÅ PrepareÊ∂àÊÅØÔºüËØïÊÉ≥‰∏ÄÁßçÂú∫ÊôØÔºåÊú¨Âú∞‰∫ãÂä°ÊâßË°åÊàêÂäüÔºåÂáÜÂ§áÂèëÈÄÅÊ∂àÊÅØÁöÑÊó∂ÂÄôÊñ≠ÁΩë‰∫ÜÔºåËøôÊó∂ÂÄôÂ∞±‰ºöÈÄ†ÊàêÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµ commit or rollback Ê∂àÊÅØÂèëÈÄÅÂ§±Ë¥•ÔºüËøôÊó∂ÂÄôÈúÄË¶ÅÊ∂àÊÅØ‰∏≠Èó¥‰ª∂Êèê‰æõÊ∂àÊÅØÂõûÊü•ÂäüËÉΩÔºå‰πüÂ∞±ÊòØÂΩìÈó¥Èöî‰∏ÄÊÆµÊó∂Èó¥‰πãÂêéÔºåPrepareÊ∂àÊÅØÊ≤°ÊúâÊî∂Âà∞ commit or rollbackÊ∂àÊÅØÔºåÈúÄË¶ÅÂèëËµ∑Ê∂àÊÅØÂõûÊü•ÔºåÂπ∂‰∏îÁî±‰∏öÂä°ÊñπÂà§Êñ≠ÊúÄÁªàÊ∂àÊÅØÊòØÂê¶ÈúÄË¶ÅÊäïÈÄí ÂØπ‰∫é‰∫ãÂä°Ê∂àÊÅØÁöÑËß£ÂÜ≥ÊñπÊ°àÔºåÈòøÈáåÁöÑRocketMq‰πüÊèê‰æõ‰∫ÜËß£ÂÜ≥ÊñπÊ°à ÊÄªÁªìÊÄª‰ΩìÊù•ËØ¥ÔºåÊØèÁßçÂàÜÂ∏ÉÂºè‰∫ãÂä°Ëß£ÂÜ≥ÊñπÊ°àÈÉΩÊúâÂÖ∂Â∫îÁî®Âú∫ÊôØÔºå‰ΩÜÁõÆÂâç‰∏öÁïåÊØîËæÉ‰∏ªÊµÅÁöÑËøòÊòØTCCÂíå‰∫ãÂä°Ê∂àÊÅØÔºåTCC‰∫ãÂä°ÈúÄË¶Å‰∏öÂä°ÂÆûÁé∞Try-Confirm-CancelÈÄªËæëÔºåÈúÄË¶ÅÂú®TryÈò∂ÊÆµÊèêÂâçÈîÅÂÆöËµÑÊ∫êÔºåÁõ∏ÂØπ‰∫é‰∫ãÂä°Ê∂àÊÅØÊù•ËØ¥ÊàêÊú¨ËæÉÈ´òÔºå‰ΩÜÊòØ‰∫ãÂä°Ê∂àÊÅØÁöÑÈÄÇÁî®Âú∫ÊôØ‰πüÊòØÊúâÈôêÁöÑÔºåÂ¶Ç‰∏ãÂçïÊâ£ÂáèÂ∫ìÂ≠òËøô‰∏™Âú∫ÊôØÂõ†‰∏∫ÈúÄË¶ÅÊèêÂâçÈîÅÂÆöÂ∫ìÂ≠òÔºå‰∫ãÂä°Ê∂àÊÅØÂ∞±‰∏çÈÄÇÁî®‰∫Ü„ÄÇ]]></content>
      <categories>
        <category>ÂàÜÂ∏ÉÂºè</category>
      </categories>
      <tags>
        <tag>ÂàÜÂ∏ÉÂºè</tag>
        <tag>‰∫ãÂä°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[git ‰Ω†ÁúüÁöÑ‰ºöÁî®Âêó]]></title>
    <url>%2F2019%2F06%2F21%2Fgit-%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BC%9A%E7%94%A8%E5%90%97%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩïÂéüÁî±ÊúÄËøëÂõ†‰∏∫ÂÖ¨Âè∏Êñ∞Êù•ÁöÑÂêå‰∫ãÔºåÂú®‰ΩøÁî®GitÊó∂ÁäØ‰∫Ü‰∏Ä‰∫õÈùûÂ∏∏‰ΩéÁ∫ßÁöÑÈîôËØØÔºåÂØºËá¥Âõ¢Èòü‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∫õÈóÆÈ¢òÊµ™Ë¥π‰∫ÜÂæàÂ§öÊó∂Èó¥„ÄÇÁ©∂ÂÖ∂ÂéüÂõ†ÂÖ∂ÂÆûËøòÊòØÂØπ‰∫éGitÂÜÖÈÉ®ÂÆûÁé∞‰∏çÊ∏ÖÊô∞Ôºå‰ªÖ‰ªÖÁü•ÈÅìÊï≤Âá†‰∏™gitÂëΩ‰ª§Ôºå‰ΩÜÊòØÂç¥‰∏çÁü•ÈÅìÊï≤‰∫ÜËøô‰∏™ÂëΩ‰ª§Git‰ºöÂèëÁîü‰ªÄ‰πàÔºÅËøôÈáåÊ†πÊçÆgitÂÆòÊñπÊñáÊ°£ËäÇÈÄâ‰∫Ü‰∏Ä‰∫õÈáçË¶ÅÊ¶ÇÂøµÂàÜ‰∫´Âá∫Êù•„ÄÇ Âá†‰∏™ÈáçË¶ÅÊ¶ÇÂøµ‰∏âÁßçÁä∂ÊÄÅ Â∑•‰ΩúÂå∫Áä∂ÊÄÅ Â∞±ÊòØ‰øÆÊîπ‰∫ÜÊñá‰ª∂ËøòÊ≤°ÊúâÂÅö git addÁöÑÊñá‰ª∂Áä∂ÊÄÅ ÊöÇÂ≠òÂå∫Áä∂ÊÄÅ Â∑≤Áªègit add‰ΩÜËøòÊú™git commitÁöÑÊñá‰ª∂Áä∂ÊÄÅ Â∑≤Êèê‰∫§Áä∂ÊÄÅ Â∑≤Áªègit commitÁöÑÊñá‰ª∂Áä∂ÊÄÅÔºå‰πüÂ∞±ÊòØÁúüÊ≠£Â≠òÂÇ®Âà∞git‰ªìÂ∫ì BranchÊåáÈíàÂíåHEADÊåáÈíàGitÁöÑÂàÜÊîØÁâπÊÄßÊòØÂÖ∂ÊúÄÂº∫Â§ßÊúÄÁã¨ÁâπÁöÑÂäüËÉΩÔºå‰πüÊ≠£ÊòØÂõ†‰∏∫Ëøô‰∏™ÁâπÊÄßËÆ©gitÂæó‰ª•Âú®‰ºóÂ§öÁöÑÁâàÊú¨ÊéßÂà∂Á≥ªÁªü‰∏≠ËÑ±È¢ñËÄåÂá∫ÔºåÂú®ÁêÜËß£branch‰πãÂâçÔºåÊúâÂøÖË¶ÅÂÖàÂØπgit commitÂëΩ‰ª§ÂÅö‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰ªãÁªç ÂΩì‰ΩøÁî®git commitËøõË°åÊèê‰∫§Êìç‰ΩúÊó∂ÔºåGit‰æø‰ºöÂàõÂª∫‰∏Ä‰∏™Êèê‰∫§ÂØπË±°ÔºåËøô‰∏™ÂØπË±°‰ºöÂåÖÂê´‰∏Ä‰∏™ÊåáÂêëÊú¨Ê¨°Êèê‰∫§ÁöÑÊåáÈíàÔºåÊåáÈíàÊåáÂêëÊú¨Ê¨°commitÁöÑÂø´ÁÖß„ÄÇÊåáÈíà‰πüÂ∞±ÊòØÊàë‰ª¨ÈÄöÂ∏∏ÊâÄËØ¥ÁöÑcommit id(ÈïøÂ∫¶‰∏∫ 40 ÁöÑ SHA-1 ÂÄºÂ≠óÁ¨¶‰∏≤)„ÄÇÂ¶ÇÊ≠§‰∏ÄÊù•ÔºåGitÂ∞±ÂèØ‰ª•Âú®ÈúÄË¶ÅÁöÑÊó∂ÂÄôÊ†πÊçÆcommit idÊù•ÂõûÈÄÄÁâàÊú¨ BranchÁöÑÊú¨Ë¥®ÂÖ∂ÂÆû‰ªÖ‰ªÖÊòØÊåáÂêëÊèê‰∫§ÂØπË±°ÁöÑÊüê‰∏Ä‰∏™ÂèØÂèòÊåáÈíà„ÄÇÊâÄ‰ª•Ê†πÊçÆËøô‰∏™Ê¶ÇÂøµÔºåÊàë‰ª¨ÂèØ‰ª•Áü•ÈÅìmasterÂπ∂‰∏çÊòØ‰∏Ä‰∏™ÁâπÊÆäÁöÑÂàÜÊîØÔºå‰ªñË∑üÊàë‰ª¨‰ºóÂ§öËá™ÂÆö‰πâÁöÑÂàÜÊîØÊ≤°Êúâ‰ªª‰Ωï‰∏çÂêåÔºåÂîØ‰∏ÄÂå∫Âà´ÊòØÂÆÉÊòØGitÁöÑÈªòËÆ§ÂàÜÊîØ(ÂàùÂßãÂåñÁöÑÊó∂ÂÄôÊÄªÂæóÊúâ‰∏Ä‰∏™ÈªòËÆ§ÂàÜÊîØ) ‰∏ãÈù¢ÁöÑÂõæÊòØÂçï‰∏™masterÂàÜÊîØÊó∂ÁöÑÁªìÊûÑÔºåËøôÈáåmaster‰ªÖ‰ªÖÊòØ‰∏Ä‰∏™ÊåáÂêëf30abÊèê‰∫§ÂØπË±°ÁöÑÊåáÈíà ÊâßË°å $ git branch testingÂàõÂª∫‰∏Ä‰∏™ testingÂàÜÊîØÔºå‰ºöÂú®ÂΩìÂâçÊâÄÂú®ÁöÑÊèê‰∫§ÂØπË±°‰∏äÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫testingÁöÑÊåáÈíàÔºå‰πüÂ∞±ÊòØtestingÂàÜÊîØ Ê≥®ÊÑèÔºöÊ≠§Êó∂‰∏§‰∏™ÊåáÈíàÊåáÂêë‰∫ÜÁõ∏ÂêåÁöÑÊèê‰∫§ÈÇ£‰πàGitÊòØÂ¶Ç‰ΩïÊù•Áü•ÈÅìÂΩìÂâçÂ§Ñ‰∫éÂì™‰∏™ÂàÜÊîØÁöÑÂë¢ÔºüËøôÂ∞±ÂºïÂá∫‰∫ÜGit‰∏≠ÁöÑÂè¶‰∏Ä‰∏™ÁâπÊÆäÁöÑÊåáÈíàHEADÔºåHEADÁî®Êù•ÊåáÂêëÂΩìÂâçÊâÄÂú®ÁöÑÂàÜÊîØÔºå‰πüÂ∞±ÊòØ‰∏Ä‰∏™Áî®Êù•ÊåáÂêëÂàÜÊîØÊåáÈíàÁöÑÊåáÈíàÔºàÊúâÁÇπÊãóÂè£ÔºâÔºåÂ∞±ÂÉè‰∏ãÂõæËøôÊ†∑ÔºåÂΩìÂâçÊòØÂú®masterÂàÜÊîØÔºåÂõ†‰∏∫git branchÂπ∂‰∏ç‰ºöÁßªÂä®HEADÊåáÈíàÂàáÊç¢ÂàÜÊîØ ÊâßË°å $ git checkout testingÂëΩ‰ª§Êâç‰ºöÂ∞ÜHEADÊåáÈíàÊåáÂêëtestingÂàÜÊîØ ÂΩìÊàë‰ª¨Âú®testingÂàÜÊîØ‰∏äÁªßÁª≠Êèê‰∫§Âá†‰∏™commit‰πãÂêéÔºåtestingÊåáÈíàÂíåHEADÊåáÈíàÈÉΩ‰ºöË∑üÁùÄÂêëÂâçÁßªÂä®Ôºå‰ΩÜÊòØmasterÊåáÈíàÂπ∂‰∏ç‰ºöÁßªÂä®Ôºå‰æùÊóßÊåáÂêëf30abËøô‰∏™Êèê‰∫§ Áé∞Âú®ÊâßË°ågit checkout masterÂàáÂõûmasterÂàÜÊîØÔºåHEADÊåáÈíà‰ºöÈáçÊñ∞ÊåáÂêëmasterÔºå‰πüÂ∞±ÊòØËØ¥Áé∞Âú®ÂèàÂõûÂà∞‰∫Ü‰∏Ä‰∏™ÊóßÁöÑÁâàÊú¨ÔºåËøô‰πüÊòØGitÁöÑÁ•ûÂ•á‰πãÂ§Ñ Êé•‰∏ãÊù•Êàë‰ª¨Âú®masterÂàÜÊîØ‰∏äÂÅö‰∏Ä‰∫õ‰øÆÊîπÔºåÊèê‰∫§‰∏Ä‰∏™commitÔºåHEADÂíåmasterÊåáÈíà‰ºöÁªßÁª≠ÂêëÂâçÁßªÂä®ÔºåÂπ∂‰∏îËøô‰∏™È°πÁõÆÁöÑÊèê‰∫§ÔºàÂø´ÁÖßÁâàÊú¨ÔºâÂ∑≤Áªè‰∫ßÁîü‰∫ÜÂàÜÂèâ ‰øùÂ≠òÂàÜÊîØ‰ø°ÊÅØÁöÑÁõÆÂΩïÂú®.git/refs/heads‰∏ãÔºå‰πüÂèØ‰ª•Âú®Ëøô‰∏™ÁõÆÂΩï‰∏ãÊü•ÁúãÊàñ‰øÆÊîπÂàÜÊîØÊåáÈíà merge ÂëΩ‰ª§Âú®‰∏äÊñáÁöÑ‰æãÂ≠ê‰∏≠ÔºåÈ°πÁõÆÊúâ‰∏§‰∏™ÂàÜÊîØÔºå‰∏îÂ∑≤Áªè‰∫ßÁîü‰∫ÜÂàÜÂèâÔºåËøôÊó∂ÂÄôÈúÄË¶ÅÊäätestingÂàÜÊîØ‰∏äÁöÑÂÜÖÂÆπÂêàÂπ∂Ëá≥masterÊó∂ÈúÄË¶ÅÁî®Âà∞mergeÂëΩ‰ª§Âú®masterÊâßË°ågit merge testingÔºå‰ºöÁîüÊàê‰∏Ä‰∏™Êñ∞ÁöÑÊèê‰∫§9c67aÔºåÂπ∂‰∏îHEADÂíåmasterÊåáÈíàÁªßÁª≠ÂêëÂâçÁßªÂä® reset ÂëΩ‰ª§ÂÅáÂ¶Ç‰∏äÈù¢ÁöÑmergeÊìç‰ΩúÊúâÈóÆÈ¢òÔºåÈúÄË¶ÅÊí§ÈîÄÔºåÂèØ‰ª•‰ΩøÁî®resetÂëΩ‰ª§Ôºå‰ΩÜÈ¶ñÂÖàÈúÄË¶ÅÊòéÁ°ÆÂõûÈÄÄÁöÑÁâàÊú¨ÊòØÂì™‰∏Ä‰∏™Ôºå‰æãÂ¶ÇË¶ÅÂõûÈÄÄÁöÑÁâàÊú¨ÊòØc2b9eÔºåÊâßË°ågit reset --hard c2b9eÂêéÔºåHEADÂíåmasterÊåáÈíà‰ºöÂõûÈÄÄÂà∞ÁâàÊú¨c2b9e ‚Ä¶]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVA Ê≥õÂûã ‰Ω†ÁúüÁöÑÁêÜËß£‰∫ÜÂêóÔºü]]></title>
    <url>%2F2019%2F06%2F19%2FJAVA-%E6%B3%9B%E5%9E%8B-%E4%BD%A0%E7%9C%9F%E7%9A%84%E7%90%86%E8%A7%A3%E4%BA%86%E5%90%97%EF%BC%9F%2F</url>
    <content type="text"><![CDATA[ËÆ∞ÂΩïÂéüÁî±‰πãÂâçËôΩÁÑ∂Ê≥õÂûã‰∏ÄÁõ¥Âú®‰ΩøÁî®Ôºå‰ΩÜ‰ΩøÁî®ÁöÑËøáÁ®ã‰∏≠ÊÄªÊòØÊ≤°ÊúâÈÇ£‰πàÂæóÂøÉÂ∫îÊâãÔºåÊúâ‰∫õÁªÜËäÇËøòÊòØËøá‰∫éÊ®°Á≥ä„ÄÇÁ©∂ÂÖ∂ÂéüÂõ†ÂÖ∂ÂÆûÊòØ‰∏ÄÁõ¥ÈÉΩÊ≤°ÊúâÁ≥ªÁªüÊ∑±ÂÖ•ÁöÑÂéªÁêÜËß£ËøáÔºåÊúÄËøëËä±‰∫Ü‰∏ÄÁÇπÊó∂Èó¥ÂéªÊ∑±ÂÖ•ÁöÑÁêÜËß£‰∫Ü‰∏Ä‰∏ãjavaÁöÑÊ≥õÂûãÊú∫Âà∂Ôºå‰πüÂ∏åÊúõÂÄüËøôÊ¨°ËÆ∞ÂΩïËÉΩÂ§üÂΩªÂ∫ïÁöÑÁêÜËß£javaÁöÑÊ≥õÂûã ‰∏∫‰ªÄ‰πàË¶ÅÊúâÊ≥õÂûãÊ≥õÂûãÁöÑÊú¨Ë¥®ÊòØÊää Á±ªÂûãÂèÇÊï∞ÂåñÔºå‰ªÄ‰πàÊòØÁ±ªÂûãÂèÇÊï∞ÂåñÔºü‰∏æ‰∏™‰æãÂ≠êÔºåÊàë‰ª¨Â∏∏Áî®ÁöÑÈõÜÂêàÁ±ªÔºåË¶ÅÊòØÊ≤°ÊúâÁ±ªÂûãÂèÇÊï∞ÂåñÁöÑËØùÔºåÊàë‰ª¨Â∞±ÂæóÂÆûÁé∞Ë£Ö‰∏çÂêåÁ±ªÂûãÁöÑÈõÜÂêàÁ±ªÔºå‰ºöÂ§ßÂ§ßÈôç‰Ωé‰ª£Á†ÅÁöÑÂèØÈáçÁî®ÊÄßÔºÅ ‰æãÂ¶ÇÊàë‰ª¨Ë¶ÅËÆæËÆ°‰∏Ä‰∏™Ë£ÖËãπÊûúÁöÑÁõòÂ≠êÂíå‰∏Ä‰∏™Ë£ÖÈ¶ôËïâÁöÑÁõòÂ≠êÔºåË¶ÅÊÄé‰πàËÆæËÆ°Âë¢ÔºüÈùûÂ∏∏ÁÆÄÂçïÔºåÊúÄÁÆÄÂçïÁöÑÊñπÂºèÂ∞±ÊòØËÆæËÆ°‰∏§‰∏™ÁõòÂ≠êÁ±ªÔºå‰∏Ä‰∏™ÊòØËãπÊûúÁõòÂ≠êÔºå‰∏Ä‰∏™È¶ôËïâÁõòÂ≠êÔºåÂ∞±ÂÉè‰∏ãÈù¢ÁöÑ‰ª£Á†Å‰∏ÄÊ†∑ 12345678910111213141516171819202122232425public class ApplePlant &#123; private Apple apple; public Apple getApple() &#123; return apple; &#125; public void setApple(Apple apple) &#123; this.apple = apple; &#125;&#125;public class BananaPlant &#123; private Banana banana; public Banana getBanana() &#123; return banana; &#125; public void setBanana(Banana banana) &#123; this.banana = banana; &#125;&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÁöÑÁ°ÆËÉΩÂ§üÊª°Ë∂≥Êàë‰ª¨ÁöÑÈúÄÊ±ÇÔºå‰ΩÜÂ∞±ÂÉè‰∏äÊñáÊâÄËØ¥ÁöÑÔºåËøôÊ†∑ÁöÑ‰ª£Á†ÅÈôç‰Ωé‰∫Ü‰ª£Á†ÅÁöÑÂèØÈáçÁî®ÊÄßÔºåÈÇ£‰πàÊàë‰ª¨Ë¶ÅÊÄé‰πà‰ºòÂåñÂë¢ÔºåËÅ™ÊòéÁöÑÁ®ãÂ∫èÂëò‰ª¨È©¨‰∏äÊÉ≥Âà∞‰∫ÜÔºåÂèØ‰ª•Áî®ObjectÊù•‰ª£ÊõøÁõòÂ≠êÈáåÊâÄÊåá‰ª£ÁöÑÂÖ∑‰ΩìÁ±ªÂûãÔºåÂ∞±ÂÉè‰∏ãÈù¢ËøôÊ†∑ 123456789101112public class ObjectPlant &#123; private Object object; public Object getObject() &#123; return object; &#125; public void setObject(Object object) &#123; this.object = object; &#125;&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÁúã‰ººÂÆåÁæéËß£ÂÜ≥‰∫Ü‰ª£Á†Å‰∏çÂèØÈáçÁî®ÁöÑÈóÆÈ¢òÔºå‰ΩÜÂêåÊó∂‰πüÈöêÂê´‰∫ÜÂæàÂ§öÂÖ∂‰ªñÈóÆÈ¢òÔºå‰æãÂ¶ÇÂú®Êàë‰ª¨ÂèñÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÂèñÂá∫Êù•ÁöÑÂè™ËÉΩÊòØObjectÁ±ªÂûãÔºåÈúÄË¶ÅÊàë‰ª¨Âº∫ËΩ¨Á±ªÂûãÔºåËÄåÂæÄÁõòÂ≠ê‰∏≠Âä†ÂÖ•Êï∞ÊçÆÁöÑÊó∂ÂÄôÔºå‰πüÊ≤°Êúâ‰ªª‰ΩïÈ™åËØÅÔºåÊúâÂèØËÉΩÂæÄÊîæËãπÊûúÁöÑÁõòÂ≠ê‰∏≠Âä†ÂÖ•‰∫ÜÈ¶ôËïâ‰πüËØ¥‰∏çÂÆöÔºåÂõ†‰∏∫ÁºñËØëÂô®Âπ∂Ê≤°ÊúâÂÅö‰ªª‰ΩïÈôêÂà∂ÔºåÂè™Ë¶ÅÊòØObjectÁ±ªÂûãÔºåÈÉΩÂèØ‰ª•È™åËØÅÈÄöËøá„ÄÇ ‰∏äÈù¢ÁöÑÈóÆÈ¢òÂú®Java 1.5ÂºïÂÖ•‰∫ÜÊ≥õÂûã‰πãÂêéÂæóÂà∞‰∫ÜÂÆåÁæéÁöÑËß£ÂÜ≥Ôºå‰∏ãÈù¢ËÆ©Êàë‰ª¨Êù•ÁúãÁúãÁî®Ê≥õÂûãÂ¶Ç‰Ωï‰ºòÈõÖÁöÑËß£ÂÜ≥‰∏äËø∞ÈóÆÈ¢ò 123456789101112public class Plant &lt;T&gt;&#123; private T t; public T getT() &#123; return t; &#125; public void setT(T t) &#123; this.t = t; &#125;&#125; Âú®‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏≠ÔºåÊàë‰ª¨ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™Ê≥õÂûãÁ±ªÔºåÂÆÉË°®Á§∫‰∫Ü‰∏Ä‰∏™ÂèØ‰ª•TÁ±ªÂûãÁöÑÁØÆÂ≠êÔºåËÄåËøô‰∏™TÁ±ªÂûãÈúÄË¶ÅÂà∞Êàë‰ª¨ÁúüÊ≠£‰ΩøÁî®ÁöÑÊó∂ÂÄôÊâç‰ºöÂéªÊåáÂÆö ‰æãÂ¶ÇÁé∞Âú®Êàë‰ª¨Ë¶ÅÂÆö‰πâ‰∏§ÁßçÁõòÂ≠êÔºåÂèØ‰ª•ËøôÊ†∑Â£∞Êòé 123456Plant&lt;Apple&gt; applePlant = new Plant&lt;&gt;();Plant&lt;Banana&gt; bananaPlant = new Plant&lt;&gt;();Apple apple = new Apple();Banana banana = new Banana();applePlant.set(banana); // ÁºñËØëÊä•ÈîôbananaPlant.set(apple); // ÁºñËØëÊä•Èîô ‰∏äÈù¢ÁöÑ‰ª£Á†Å‰πãÊâÄ‰ª•ÂÆûÈôÖÁ±ªÂûãnew Plant&lt;&gt;()ÁöÑ&lt;&gt;‰∏≠Ê≤°ÊúâÊåáÊòéÂÖ∑‰ΩìÁ±ªÂûãÔºåÊòØÂõ†‰∏∫Java7‰πãÂêéÂä†‰∫ÜÁ±ªÂûãËá™Âä®Êé®Êñ≠Ôºå‰πüÂ∞±‰∏çÈúÄË¶Å‰∏§‰æßÈÉΩÂä†‰∏äÊ≥õÂûãÁ±ªÂûã ÂèØ‰ª•ÁúãÂà∞‰ΩøÁî®‰∫ÜÊ≥õÂûã‰πãÂêéÔºåÊó¢ÊèêÈ´ò‰∫Ü‰ª£Á†ÅÁöÑÂèØÈáçÁî®ÊÄßÔºåÂú®ÂÆûÈôÖ‰ΩøÁî®Êó∂‰πüÂØπÁ±ªÂûãËøõË°å‰∫ÜÁ∫¶ÊùüÔºåË£ÖËãπÊûúÁöÑÁõòÂ≠êÊòØË£Ö‰∏ç‰∫ÜÈ¶ôËïâÁöÑÔºÅ ‰∏çËøáË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåjavaÁöÑÊ≥õÂûãÁ∫¶ÊùüÊòØÂú®ÁºñËØëÊó∂ÁîüÊïàÁöÑÔºå‰∏ÄÊó¶ÁºñËØëÊàê‰∫ÜclassÂ≠óËäÇÁ†ÅÊñá‰ª∂ÂêéÔºå‰∏ÄÂàáÈÉΩÊâìÂõûÂéüÂΩ¢‰∫ÜÔºåÊ≥õÂûã‰ø°ÊÅØ‰ºöË¢´Êì¶Èô§ÔºåÊâÄ‰ª•Êàë‰ª¨ÊääJAVAÁöÑÊ≥õÂûãÁß∞‰∏∫‰º™Ê≥õÂûãÔºåË∑üC#Á≠âËØ≠Ë®ÄÁöÑÁúüÊ≥õÂûãÊúâÁùÄÊú¨Ë¥®Âå∫Âà´ÔºåÂú®C#‰∏≠ÔºåList&lt;Integer&gt;ÂíåList&lt;String&gt; Â∞±ÊòØ‰∏§Áßç‰∏çÂêåÁöÑÁ±ªÂûã Â¶Ç‰∏ãÈù¢Â≠óËäÇÁ†ÅÊñá‰ª∂ÁöÑÊúÄÂêé‰∏ÄË°åinvokevirtualÂëΩ‰ª§ÁöÑÊñπÊ≥ïÊèèËø∞Á¨¶Method setT:(Ljava/lang/Object;)VÔºåÂèØÁü•Ê≥õÂûãÁ±ªÂûãÂ∑≤ÁªèË¢´Êì¶Èô§Êàê‰∫ÜObjectÁ±ªÂûãÔºå‰πüÂ∞±ÊòØÂú®Â≠óËäÇÁ†ÅÂ±ÇÈù¢ÂÆûÈôÖ‰∏ä‰∏éÊàë‰ª¨Áõ¥Êé•Áî®ObjectÊù•ÂÆûÁé∞ÊòØ‰∏ÄÊ†∑ÁöÑ 1234567890: new #3 // class com/sunshine/common/test/Plant 3: dup 4: invokespecial #4 // Method &quot;&lt;init&gt;&quot;:()V 7: astore_1 8: aload_1 9: new #5 // class com/sunshine/common/test/Apple 12: dup 13: invokespecial #6 // Method com/sunshine/common/test/Apple.&quot;&lt;init&gt;&quot;:()V 16: invokevirtual #7 // Method setT:(Ljava/lang/Object;)V Ê≥õÂûãËøõÈò∂‰ΩøÁî® &lt;T extends ?&gt; ÂÆö‰πâÊ≥õÂûãÁ±ªÂ§¥‰∏ÄÊ¨°ÁúãÂà∞‰∏äÈù¢‰∏§‰∏™Á¨¶Âè∑ÔºåÊòØ‰∏çÊòØÊúâÁÇπÊáµÈÄºÔºüÂÆÉ‰ª¨Âú®‰ª£Á†ÅÈáå‰πüÈùûÂ∏∏Â∏∏ËßÅÔºåÈÇ£‰πàÂÆÉ‰ª¨Á©∂Á´üÊòØË°®Á§∫‰ªÄ‰πàÊÑèÊÄùÂë¢ÔºüËøòÊòØÈÄöËøá‰∏äÊñáÁöÑplantÁõòÂ≠êÊù•‰∏æ‰æãÂêßÔºå‰∏æ‰∏ÄÁßçÊÉÖÂÜµÔºåÊàë‰ª¨Âè™Â∏åÊúõËøô‰∏™ÁõòÂ≠êÁî®Êù•Ë£Ö‰∏Ä‰∫õÊ∞¥ÊûúÔºåËÄå‰∏çÂ∏åÊúõÂÆÉË¢´Áî®Êù•Ë£ÖËÇâÔºåÈÇ£‰πàÊàë‰ª¨ËØ•ÊÄé‰πàÂÅöÂë¢ÔºüÁé∞Âú®ÁöÑÊÉÖÂÜµÊòØÔºåÂÆÉÊó¢ÂèØ‰ª•ÂÆû‰æãÂåñÊàê‰∏Ä‰∏™Ë£ÖÈ¶ôËïâÁöÑÁõòÂ≠êÔºå‰πüÂèØ‰ª•Ë¢´ÂÆû‰æãÂåñÊàê‰∏Ä‰∏™Ë£ÖËÇâÁöÑÁõòÂ≠ê 12Plant&lt;Apple&gt; applePlant = new Plant&lt;&gt;(); // Plant&lt;Meat&gt; meatPlant = new Plant&lt;&gt;(); // ÈÉΩÊòØOkÁöÑ Áé∞Âú®ËÆ©Êàë‰ª¨Êù•ÈáçÊñ∞ËÆæËÆ°‰∏Ä‰∏™ÁõòÂ≠êÁ±ªÔºåÈÄöËøá&lt;T extends Firut&gt;Êù•ÈôêÂà∂Ê≥õÂûãÔºåÂÖ∂ÂÆûÂ¶ÇÊûúÊàë‰ª¨Áõ¥Êé•Áî®&lt;T&gt;ÁöÑÁºñËØëÊàêÂ≠óËäÇÁ†ÅÂêé‰πü‰ºöËá™Âä®ÁºñËØëÊàê&lt;T extends Object&gt; 123456789101112public class FirutPlant &lt;T extends Firut&gt;&#123; private T t; public T getT() &#123; return t; &#125; public void setT(T t) &#123; this.t = t; &#125;&#125; ‰ΩøÁî® 123FirutPlant&lt;Apple&gt; appleFirutPlant = new FirutPlant&lt;&gt;(); // OKFirutPlant&lt;Firut&gt; firutPlant = new FirutPlant&lt;&gt;(); // OKFirutPlant&lt;Meat&gt; meatFirutPlant = new FirutPlant&lt;&gt;(); // ÁºñËØëÊó†Ê≥ïÈÄöËøá ÈÄöËøá‰∏äÈù¢ÁöÑ‰ª£Á†ÅÂèØÁü•Êàë‰ª¨ÊàêÂäüÁöÑÈôêÂà∂‰∫ÜÊ≥õÂûãÔºåÊ∞¥ÊûúÁõòÂ≠êÂ∞±Âè™ËÉΩË£ÖÊ∞¥ÊûúÔºåÁõòÂ≠ê‰∏≠ÁöÑÁ±ªÂûãÂè™ËÉΩÊòØÊ∞¥ÊûúÊàñÂàôÂÆÉÁöÑÂ≠êÁ±ªÂûã„ÄÇ &lt;? extends T&gt; &lt;? super T&gt;Ê≥®ÊÑèËøôÈáåÁöÑTÊòØÊ≥õÂûãÂèÇÊï∞ÔºåË∑ü‰∏äÈù¢ÁöÑ T‰∏ç‰∏ÄÊ†∑ ÁúãÂÆå‰∏äÈù¢ÁöÑ &lt;T extends ?&gt;ÔºåÊé•‰∏ãÊù•Êàë‰ª¨ÂÜçÊù•Áúã&lt;? extends T&gt; &lt;? super T&gt;ÔºåÂèØËÉΩËøôÈáå‰Ω†‰ºöÈùûÂ∏∏ÁñëÊÉëÔºåÂìá Ëøô‰∏§‰∏™Êúâ‰ªÄ‰πàÂå∫Âà´ÔºüÂÖ∂ÂÆûÁÆÄÂçïÁêÜËß£ÁöÑËØùÔºå&lt;T extends ?&gt;ÊòØÂú®Á±ªÊñá‰ª∂Â±ÇÈù¢Â∞±ÈôêÂà∂‰∫ÜÊ≥õÂûãÁöÑËåÉÂõ¥ÔºåËÄå&lt;? extends T&gt; &lt;? super T&gt;ÊòØÂú®‰ΩøÁî®Ê≥õÂûãÁöÑÊó∂ÂÄôÂÜçÂéªÂÅöÈôêÂà∂„ÄÇÊòéÁôΩ‰∫ÜËøô‰∏™‰πãÂêéÊé•‰∏ãÊù•Êàë‰ª¨Â∞±Êù•Áúã‰∏ã&lt;? extends T&gt; &lt;? super T&gt;ÁöÑ‰ΩøÁî®„ÄÇ ËÆ©Êàë‰ª¨ÂõûÂà∞Firut.class 123456789101112public class Plant &lt;T&gt;&#123; private T t; public T getT() &#123; return t; &#125; public void setT(T t) &#123; this.t = t; &#125;&#125; Êàë‰ª¨Áé∞Âú®‰∏çÂú®ÂÆö‰πâÊ≥õÂûãÁ±ªÁöÑÊó∂ÂÄôÂÅöÈôêÂà∂Ôºå(‰ΩøÁî®&lt;T&gt;ÔºåÂÖ∂ÂÆûËøôÈáåËøòÊòØÁõ∏ÂΩì‰∫é&lt;T extends Object&gt;)ÔºåËÄåÊòØÂú®‰ΩøÁî®ÁöÑÊòØÂéªÂÅöÈôêÂà∂ ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ã&lt;? extends T&gt;ÁöÑ‰ΩøÁî® 12345678Plant&lt;Apple&gt; applePlant = new Plant&lt;Apple&gt;();applePlant.setT(new Apple());// ‰ΩøÁî® &lt;? extends T&gt;Plant&lt;? extends Firut&gt; plant = applePlant;plant.setT(new Apple()); // Êó†Ê≥ïÂ≠ò ÁºñËØëÊä•Èîôplant.setT(new Firut()); // Êó†Ê≥ïÂ≠ò ÁºñËØëÊä•ÈîôFirut apple = plant.getT(); // ÂèØ‰ª•Ëé∑Âèñ ÂèØ‰ª•ÁúãÂà∞ÂΩì&lt;? extends T&gt;ÂÅö‰∏∫Êé•Êî∂ÂèÇÊï∞Êó∂ÔºåÂõ†‰∏∫ÂÖ∂ÂøÖÁÑ∂ÊòØFirutÁöÑÂ≠êÁ±ªÔºåËøôÈáåÂÆû‰æãÁ±ªÂûãÊòØAppleÔºåÊâÄ‰ª•getT()ÊñπÊ≥ï‰ªçÁÑ∂ÂèØ‰ª•‰ΩøÁî®ÔºåÂõ†‰∏∫‰ºöËøõË°å‰∏ÄÊ¨°ÈöêÂºèÁöÑÁ±ªÂûãËΩ¨Êç¢ÔºàÂêë‰∏äËΩ¨ÂûãÊòØÂÆâÂÖ®ÁöÑÔºâÔºå‰ΩÜÊòØsetT()ÊñπÊ≥ïÊòØÂ§±ÊïàÁöÑÔºåËøôÊòØÂõ†‰∏∫ÁºñËØëÂô®‰∏çËÉΩÁ°ÆÂÆö‰Ω†‰∏ÄÂÆö‰ºöÂæÄÈáåÈù¢Ê∑ªÂä†AppleÁ±ªÂûãÔºåÂõ†‰∏∫‰Ω†ËøòÂèØ‰ª•ÂæÄÈáåÈù¢Ê∑ªÂä†BananaÁ±ªÂûãÔºåÊòæÁÑ∂BananaÁ±ªÂûãÊó†Ê≥ïÂº∫ËΩ¨AppleÁ±ªÂûãÔºåÊâÄ‰ª•ËøôÈáåÁöÑsetT()ÊñπÊ≥ïÊòØÂ§±ÊïàÁöÑ ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ã&lt;? super T&gt;ÁöÑ‰ΩøÁî®Êúâ‰∫Ü‰∏äÈù¢&lt;? extends T&gt;ÁöÑ‰ΩøÁî®ÁªèÈ™åÔºåÈ°æÊòéÊÄùËÆÆÔºå&lt;? super T&gt;ÂøÖÁÑ∂Ë°®Á§∫TÁöÑÂÖ®ÈÉ®Áà∂Á±ªÂûãÔºåËøòÊòØÂÜçÊù•Áúã‰∏ã&lt;? super T&gt;ÁöÑ‰ΩøÁî®Âêß 12345678Plant&lt;Firut&gt; firutPlant = new Plant&lt;&gt;();Plant&lt;? super Apple&gt; plant = firutPlant;plant.setT(new Apple()); // ÂèØ‰ª•Â≠òÊàêÂäüÔºå‰∏çËøáËøôÈáåÂè™ËÉΩÂ≠ò AppleÁ±ªÂûãApple apple = plant.getT(); // ÁºñËØëÊä•ÈîôFirut firut = firutPlant.getT(); ‰∏äÈù¢ÂèØ‰ª•Â≠òÊàêÂäüÁöÑÂéüÂõ†Âíå‰∏äÈù¢&lt;? extends T&gt;ÂèØ‰ª•ÂèñÊàêÂäüÁöÑÂéüÂõ†‰∏ÄÊ†∑Ôºå‰πüÊòØÂõ†‰∏∫Â≠òÂú®‰∏Ä‰∏™ÈöêÂºèÁöÑÂêë‰∏äËΩ¨ÂûãÔºåËÄåËé∑ÂèñÂ§±Ë¥•ÁöÑÂéüÂõ† ‰πüÂæàÂÆπÊòìÁêÜËß£ÔºåÂõ†‰∏∫ÂÆûÈôÖÁ±ªÂûãËÇØÂÆöÊòØAppleÁöÑÁà∂Á±ªÔºàËøôÈáåÊòØFirutÔºâÔºåÊâÄ‰ª•Ë¶ÅÂ∞ÜFirutËΩ¨ÊàêAppleÊòæÁÑ∂ÊòØ‰∏çÂèØË°åÁöÑÔºÅ &lt;?&gt;&lt;?&gt;ÂÖ∂ÂÆûÁ≠â‰ª∑‰∏é&lt;? extends Object&gt;ÔºåËøôÊ†∑Â≠êÊàëÁõ∏‰ø°Â∞±ÊØîËæÉÂ•ΩÁêÜËß£‰∫ÜÔºåË∑ü&lt;? extends T&gt;Á±ª‰ººÔºå‰πüÊòØÂèñÂèØ‰ª•ÔºåÂ≠òË¢´ÈôêÂà∂ &lt;T&gt;‰∏ÄËà¨ÈÉΩÊòØÂú®ÂÆö‰πâÊ≥õÂûãÁ±ªÊàñÂàôÊ≥õÂûãÊñπÊ≥ïÊó∂Âá∫Áé∞ÔºåÂÆûÈôÖ‰ΩøÁî®Êó∂ÈÉΩ‰ª•?ÊàñÂÖ∑‰ΩìÁ±ªÂûãÊõø‰ª£T Type ‰∏é Class ÁöÑÂå∫Âà´ÂíåËÅîÁ≥ªËØ¥Ëµ∑Ê≥õÂûãÔºå‰∏çÂæó‰∏çÊèêJDKÂú®1.5‰πãÂêéÂºïÂÖ•ÁöÑTypeÁ±ªÂûãÔºåÊòæÁÑ∂TypeÊòØJava‰∏∫‰∫ÜÂÆûÁé∞Ê≥õÂûãËÄåÂºïÂÖ•ÁöÑ„ÄÇÈÇ£‰πàTypeÂà∞Â∫ïÊòØ‰ªÄ‰πàÂë¢ÔºåÂÆÉË°®Á§∫ÁöÑËåÉÂõ¥ÊúâÂ§öÂ§ßÔºüÂÖ∂ÂÆûÊàë‰ª¨ÂèØ‰ª•Áõ¥Êé•ÁêÜËß£ÊääClassÂΩìÊàêÊòØTypeÁöÑÂ≠êÈõÜÔºåClassÂØπÂ∫îÁùÄjdk1.5‰πãÂâç‰∏çÊòØÊ≥õÂûãÁöÑÂéüÂßãÁ±ªÂûã Type‰∏ãÂåÖÂê´‰∫ÜÂá†Áßç‰∏çÂêåÁöÑÁ±ªÂûã Class ÂéüÂßãÁ±ªÂûãÔºåÊàëËøôÈáåÁõ¥Êé•ÁêÜËß£ÊàêÊàë‰ª¨Â∏∏Áî®ÁöÑClassÁ±ªÂûãÔºåClassÊòØTypeÁöÑÁõ¥Êé•Â≠êÁ±ª ParameterizedType ÂèÇÊï∞ÂåñÁ±ªÂûãÁ±ª‰ºº List&lt;String&gt; list Ëé∑ÂèñlistÁöÑÁ±ªÂûã TypeVariable Á±ª‰ºº T t GenericArrayType Á±ª‰ºº List&lt;String&gt;[] ÊàñÂàô List&lt;T&gt; [] GenericArrayType Êé•Âè£Âè™Êúâ‰∏Ä‰∏™ÊñπÊ≥ïgetGenericComponentTypeÔºåÁî®Êà∑ËøîÂõûParameterizedTypeÊàñÂàôTypeVariableÁ±ªÂûã WildcardType Á±ª‰ºº &lt;? super T&gt; Ë¶ÅÂæóÂà∞Ëøô‰∏™Á±ªÂûãÔºåÈ¶ñÂÖàÈúÄË¶ÅÂæóÂà∞ParameterizedTypeÁ±ªÂûãÔºåÁÑ∂ÂêéÈÄöËøágetActualTypeArgumentsÊñπÊ≥ïËé∑ÂèñWildcardTypeÁ±ªÂûã ËØ¥‰∫ÜËøô‰πàÂ§öÔºåËøòÊòØÈÄöËøáÂÆûÈôÖÁöÑ‰ª£Á†ÅÊù•ËØ¶ÁªÜËß£ÈáäÂêß 123456789public class TypeTest &#123; public void testOne(Plant&lt;Apple&gt; plant, Plant&lt;Apple&gt; [] plants, Plant&lt;? extends Apple&gt; applePlant) &#123; &#125; public &lt;T&gt; void testOne(T t) &#123; &#125;&#125; ÂÜôÊÆµÊµãËØï‰ª£Á†Å 12345678910111213141516171819202122232425262728293031323334353637Method [] methods = TypeTest.class.getMethods();for (Method method : methods) &#123; if (method.getName().equals("testOne")) &#123; Type [] parameterTypes = method.getGenericParameterTypes(); System.out.println("methodOne start --------&gt; "); for (Type type : parameterTypes) &#123; if (type instanceof Class) &#123; System.out.println("Class ---- " + type.getTypeName()); &#125; if (type instanceof ParameterizedType) &#123; System.out.println("ParameterizedType ---- " + type.getTypeName()); Type ytpe3[] = ((ParameterizedType) type).getActualTypeArguments(); for (Type type2 : ytpe3) &#123; if (type2 instanceof WildcardType) &#123; System.out.println("ParameterizedType-WildcardType ---- " + type2.getTypeName()); &#125; &#125; &#125; if (type instanceof GenericArrayType) &#123; System.out.println("GenericArrayType ---- " + type.getTypeName()); Type type2 = ((GenericArrayType) type).getGenericComponentType(); &#125; if (type instanceof TypeVariable) &#123; System.out.println("TypeVariable ---- " + type.getTypeName()); &#125; &#125; &#125; else if (method.getName().equals("testTwo")) &#123; Type [] parameterTypes = method.getGenericParameterTypes(); System.out.println("methodTwo start --------&gt; "); for (Type type : parameterTypes) &#123; if (type instanceof TypeVariable) &#123; System.out.println("TypeVariable ---- " + type.getTypeName()); &#125; &#125; &#125;&#125; ËæìÂá∫ 1234567methodTwo start --------&gt; TypeVariable ---- TmethodOne start --------&gt; ParameterizedType ---- com.sunshine.common.test.Plant&lt;com.sunshine.common.test.Apple&gt;GenericArrayType ---- com.sunshine.common.test.Plant&lt;com.sunshine.common.test.Apple&gt;[]ParameterizedType ---- com.sunshine.common.test.Plant&lt;? extends com.sunshine.common.test.Apple&gt;ParameterizedType-WildcardType ---- ? extends com.sunshine.common.test.Apple ‰ªÄ‰πàÊÉÖÂÜµÂèØ‰ª•ÊãøÂà∞Ê≥õÂûãÁ±ªÂûãÂÖàÁúãÂèØ‰ª•ÊãøÂà∞Ê≥õÂûãÁöÑÊÉÖÂΩ¢Ôºå‰∏é‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰∏ÄÊ†∑ÔºåÊàë‰ª¨ÂèØ‰ª•Ëé∑ÂèñÊñπÊ≥ïÂÖ•ÂèÇÔºåË∂ÖÁ±ªÁöÑÂèÇÊï∞ÂåñÁ±ªÂûãÔºå‰∏æ‰∏™‰æãÂ≠ê 123456789101112131415class SuperPlant extend Plant&lt;Apple&gt; &#123; public void addAll(List&lt;Apple&gt; apples) &#123; // do something &#125; public static void main(String[] args) &#123; // Ëé∑ÂèñÁà∂Á±ªÂèÇÊï∞ÂåñÁ±ªÂûã Type type = SuperPlant.class.getGenericSuperclass(); Method[] methods = SuperPlant.class.getMethods(); for (Method method : methods) &#123; // Ëé∑ÂèñÊñπÊ≥ïÂèÇÊï∞ÂåñÁ±ªÂûã Type[] types = method.getGenericParameterTypes(); &#125; &#125;&#125; ÂèØ‰ª•ÂèëÁé∞‰ª•‰∏ä‰ª£Á†ÅÊòØÂèØ‰ª•Ëé∑ÂèñÂà∞Ê≥õÂûãÁ±ªÂûã„ÄÇÈÄöËøágetGenericSuperclassËé∑ÂèñÂà∞Áà∂Á±ªÁöÑÂèÇÊï∞ÂåñÁ±ªÂûãÔºåmethodÁöÑgetGenericParameterTypesËé∑ÂèñÂà∞ÂÖ•ÂèÇÁöÑÂèÇÊï∞ÂåñÁ±ªÂûãÊï∞ÁªÑ„ÄÇ ÂÜçÁúã‰∏ÄÁßçÊÉÖÂÜµ1234public void testMethod() &#123; Plant&lt;Firut&gt; firutPlant = new Plant&lt;&gt;(); // ËøôÈáåÂèØ‰ª•ÊãøÂà∞ firutPlant ÂØπË±°ÁöÑÊ≥õÂûãÂêó?&#125; ‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰∏≠ÔºåÊàë‰ª¨ÊòØÊãø‰∏çÂà∞ firutPlant ÁöÑÊ≥õÂûãÁöÑÔºåÂõ†‰∏∫JAVA Âú®Â∞ÜÂÖ∂ÁºñËØëÊàêÂ≠óËäÇÁ†ÅÁöÑÊó∂ÂÄôÔºåÂÆûÈôÖ‰∏ä‰ºöÂèòÊàê Plant&lt;Object&gt;Á±ªÂûãÔºåÊ≥õÂûã‰ºöË¢´Êì¶Èô§„ÄÇ ÊâÄ‰ª•Êàë‰ª¨ÂÖ∂ÂÆûÊòØÊó†Ê≥ïÂú®ËøêË°åÊó∂ÈÄöËøáÊ≥õÂûãÂØπË±°Êú¨Ë∫´ÊãøÂà∞Ê≥õÂûãÁ±ªÂûãÁöÑÔºåÈÇ£‰πàÊúâÊ≤°ÊúâÈªëÁßëÊäÄÂèØ‰ª•ÊãøÂà∞ËøêË°åÊó∂Ê≥õÂûãÊú¨Ë∫´ÁöÑÊ≥õÂûã‰ø°ÊÅØÔºü‰∏äÈù¢ÊúâÊèêÂà∞ÔºåÊàë‰ª¨ÊãøÊ≥õÂûãÂèØ‰ª•ÈÄöËøáÂ≠êÁ±ªÊù•Ëé∑ÂèñÁà∂Á±ªÁöÑÊ≥õÂûãÊàë‰ª¨‰æùÊçÆËøô‰∏™ÊÄùË∑ØÂ∞Ü‰∏äÈù¢‰æãÂ≠ê‰øÆÊîπ‰∏Ä‰∏ã 123public void testMethod() &#123; Type type = new Plant&lt;Firut&gt;() &#123;&#125;.getClass().getGenericSuperclass();&#125; ÂÖ∂ÂÆûÂ∞±ÊòØÂ∞ÜPlantÊîπÊàê‰∫ÜÂåøÂêçÁ±ªÊñπÂºèÂÆûÁé∞ÔºåËøôÁßçÊñπÂºèÂèØ‰ª•ÊãøÂà∞PlantÁöÑÊ≥õÂûã‰ø°ÊÅØÂêóÔºüÁ≠îÊ°àÊòØÂèØ‰ª•ÁöÑËøôÈáåÈÄöËøágetGenericSuperclassÊãøÂà∞ÁöÑÂ∞±ÊòØPlant ÁöÑÊ≥õÂûãÁ±ªÂûã‰ø°ÊÅØ„ÄÇÂÖ∂ÂÆûËøôÁßçÊñπÂºèÂú®ÂæàÂ§öÊ°ÜÊû∂Ê∫êÁ†ÅÈáåÂæàÂ∏∏ËßÅÔºåÈÄöËøáÂåøÂêçÁ±ªÊñπÂºèËé∑ÂèñÂèÇÊï∞Á±ªÂûãÔºåÊÑüÂÖ¥Ë∂£ÁöÑÂèØ‰ª•Áúã‰∏ãGsonÁöÑTypeTokenÁöÑÂÆûÁé∞Ôºå‰πüÊòØ‰∏ÄÊ†∑ÁöÑÂéüÁêÜ„ÄÇ]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
      </categories>
      <tags>
        <tag>javaÂü∫Á°Ä</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaÂ≠óËäÇÁ†ÅÊñπÊ≥ïË°®]]></title>
    <url>%2F2019%2F04%2F25%2FJava%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%B9%E6%B3%95%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂõ†‰∏∫Â≠óÊÆµË°®ÂíåÊñπÊ≥ïË°®ÁöÑÁªìÊûÑÁ±ª‰ººÔºåÊâÄ‰ª•Êàë‰ª¨Áõ¥Êé•ÂàÜÊûêJavaÂ≠óËäÇÁ†ÅÁöÑÊñπÊ≥ïË°®ÂÜÖÂÆπÔºåÁêÜËß£‰∫ÜÊñπÊ≥ïË°®ÔºåËá™ÁÑ∂Â∞±ÁêÜËß£‰∫ÜÂ≠óÊÆµË°® ÊñπÊ≥ïË°®ÊñπÊ≥ïË°®Âú®ClassÊñá‰ª∂‰∏≠ÁöÑ‰ΩçÁΩÆÊòØÂú®Â≠óÊÆµË°®‰πãÂêéÁöÑÔºåÂÖ∑‰ΩìÁöÑÁªìÊûÑÊàë‰ª¨Ê†πÊçÆ‰∏ãË°®ÂÜçÊù•ÂõûÈ°æ‰∏Ä‰∏ã Á±ªÂûã ÂêçÁß∞ Êï∞Èáè u2 access_flas 1 u2 name_index 1 u2 descriptor_index 1 u2 attributes_count 1 attribute_info Â±ûÊÄßË°® attributes_count ËøòÊòØË∑ü‰∏äÁØáÊñáÁ´†‰∏ÄÊ†∑ÔºåÊàë‰ª¨ÂÜô‰∏Ä‰∏™ÁÆÄÂçïÁöÑJavaÁ±ª 1234567891011121314151617181920public class Test &#123; public String sayHello() &#123; String sayStr = "hello world"; return sayStr; &#125; public static void main(String[] args) &#123; Test test = new Test(); System.out.println(test.sayHello()); &#125;&#125; ‰ΩøÁî®javapÁøªËØëÂ≠óËäÇÁ†ÅÊñá‰ª∂ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206public class com.ymm.agent.Test minor version: 0 major version: 52 flags: (0x0021) ACC_PUBLIC, ACC_SUPER this_class: #3 // com/ymm/agent/Test super_class: #8 // java/lang/Object interfaces: 0, fields: 0, methods: 3, attributes: 1Constant pool: #1 = Methodref #8.#27 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = String #28 // hello world #3 = Class #29 // com/ymm/agent/Test #4 = Methodref #3.#27 // com/ymm/agent/Test.&quot;&lt;init&gt;&quot;:()V #5 = Fieldref #30.#31 // java/lang/System.out:Ljava/io/PrintStream; #6 = Methodref #3.#32 // com/ymm/agent/Test.sayHello:()Ljava/lang/String; #7 = Methodref #33.#34 // java/io/PrintStream.println:(Ljava/lang/String;)V #8 = Class #35 // java/lang/Object #9 = Utf8 &lt;init&gt; #10 = Utf8 ()V #11 = Utf8 Code #12 = Utf8 LineNumberTable #13 = Utf8 LocalVariableTable #14 = Utf8 this #15 = Utf8 Lcom/ymm/agent/Test; #16 = Utf8 sayHello #17 = Utf8 ()Ljava/lang/String; #18 = Utf8 sayStr #19 = Utf8 Ljava/lang/String; #20 = Utf8 main #21 = Utf8 ([Ljava/lang/String;)V #22 = Utf8 args #23 = Utf8 [Ljava/lang/String; #24 = Utf8 test #25 = Utf8 SourceFile #26 = Utf8 Test.java #27 = NameAndType #9:#10 // &quot;&lt;init&gt;&quot;:()V #28 = Utf8 hello world #29 = Utf8 com/ymm/agent/Test #30 = Class #36 // java/lang/System #31 = NameAndType #37:#38 // out:Ljava/io/PrintStream; #32 = NameAndType #16:#17 // sayHello:()Ljava/lang/String; #33 = Class #39 // java/io/PrintStream #34 = NameAndType #40:#41 // println:(Ljava/lang/String;)V #35 = Utf8 java/lang/Object #36 = Utf8 java/lang/System #37 = Utf8 out #38 = Utf8 Ljava/io/PrintStream; #39 = Utf8 java/io/PrintStream #40 = Utf8 println #41 = Utf8 (Ljava/lang/String;)V&#123; public com.ymm.agent.Test(); descriptor: ()V flags: (0x0001) ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return LineNumberTable: line 9: 0 LocalVariableTable: Start Length Slot Name Signature 0 5 0 this Lcom/ymm/agent/Test; public java.lang.String sayHello(); descriptor: ()Ljava/lang/String; flags: (0x0001) ACC_PUBLIC Code: stack=1, locals=2, args_size=1 0: ldc #2 // String hello world 2: astore_1 3: aload_1 4: areturn LineNumberTable: line 12: 0 line 13: 3 LocalVariableTable: Start Length Slot Name Signature 0 5 0 this Lcom/ymm/agent/Test; 3 2 1 sayStr Ljava/lang/String; public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: (0x0009) ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=2, args_size=1 0: new #3 // class com/ymm/agent/Test 3: dup 4: invokespecial #4 // Method &quot;&lt;init&gt;&quot;:()V 7: astore_1 8: getstatic #5 // Field java/lang/System.out:Ljava/io/PrintStream; 11: aload_1 12: invokevirtual #6 // Method sayHello:()Ljava/lang/String; 15: invokevirtual #7 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 18: return LineNumberTable: line 17: 0 line 18: 8 line 19: 18 LocalVariableTable: Start Length Slot Name Signature 0 19 0 args [Ljava/lang/String; 8 11 1 test Lcom/ymm/agent/Test;&#125;SourceFile: &quot;Test.java&quot; ÈÄöËøá‰∏äÊñáÁöÑinterfaces: 0, fields: 0, methods: 3, attributes: 1ÔºåÊàë‰ª¨ÂèØ‰ª•Áü•ÈÅìËØ•Êñá‰ª∂‰∏ÄÂÖ±ÂåÖÂê´3‰∏™ÊñπÊ≥ïÔºåÂàÜÂà´ÂØπÂ∫îÁùÄÊó†ÂèÇÊûÑÈÄ†,sayHello,main‰∏â‰∏™ÊñπÊ≥ï Â•Ω‰∫ÜÔºåÁé∞Âú®ËÆ©Êàë‰ª¨Áõ¥Êé•Áï•ËøáÂâçÈù¢ÁöÑ‰∏ÄÂ§ßÊé®Â∏∏ÈáèÊ±†È°πÔºå Áõ¥Êé•ÈòÖËØªÊàë‰ª¨Ëá™Â∑±ÂÜôÁöÑsayHelloÊñπÊ≥ïÁöÑÂ≠óËäÇÁ†ÅÂÜÖÂÆπ 1234567891011121314151617181920212223242526272829303132public java.lang.String sayHello(); descriptor: ()Ljava/lang/String; /* ÊñπÊ≥ïÊèèËø∞Á¨¶ */ flags: (0x0001) ACC_PUBLIC /* ËÆøÈóÆÊ†áËØÜ */ Code: /* codeÂ±ûÊÄß ‰πüÂ∞±ÊòØÊàë‰ª¨ÂÜôÁöÑÂÖ∑‰Ωì‰ª£Á†ÅÁøªËØëÊàêÁöÑÂ≠óËäÇÁ†ÅÊåá‰ª§ÂÜÖÂÆπ */ stack=1, locals=2, args_size=1 /* ÂàÜÂà´ÊåáÊìç‰ΩúÊï∞Ê†àÊ∑±Â∫¶ÔºõÊú¨Âú∞ÂèòÈáèÊâÄÈúÄÁöÑÂ≠òÂÇ®Á©∫Èó¥Ôºàslot‰∏∫Âçï‰ΩçÔºâÔºõÂèÇÊï∞‰∏™Êï∞ */ 0: ldc #2 // String hello world /*Â∞Ü‰∏Ä‰∏™Â∏∏ÈáèÂä†ËΩΩÂà∞Êìç‰ΩúÊï∞Ê†à*/ 2: astore_1 /* Â∞Ü‰∏Ä‰∏™Êï∞ÂÄº‰ªéÊìç‰ΩúÊï∞Ê†àÂ≠òÂÇ®Âà∞Â±ÄÈÉ®ÂèòÈáèË°® */ 3: aload_1 /* Â∞Ü‰∏Ä‰∏™Êï∞ÂÄº‰ªéÂ±ÄÈÉ®ÂèòÈáèË°®Âä†ËΩΩÂà∞Êìç‰ΩúÊï∞Ê†à */ 4: areturn /* Â∞ÜÊ†àÈ°∂Á¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ËøîÂõû */ LineNumberTable: /* Â≠óËäÇÁ†Å‰∏éjava‰ª£Á†ÅË°åÊï∞ÂØπÂ∫îÂÖ≥Á≥ª ‰∏ÄËà¨Áî®‰∫éË∞ÉËØï */ line 12: 0 line 13: 3 LocalVariableTable: /* Â±ÄÈÉ®ÂèòÈáèË°® */ Start Length Slot Name Signature 0 5 0 this Lcom/ymm/agent/Test; 3 2 1 sayStr Ljava/lang/String; Ê†πÊçÆ‰∏äË°®Êàë‰ª¨Áü•ÈÅìÊñπÊ≥ïË°®ÁöÑÁ¨¨‰∏Ä‰∏™ÂÜÖÂÆπÁöÑÊòØaccess_flasÔºåÂç†‰∏Ä‰∏™Â≠óËäÇ„ÄÇË°®‰∏≠ÁöÑaccess_flasÂÖ∂ÂÆûÂ∞±ÂØπÂ∫îÁùÄ‰∏äÊñá‰∏≠ÁöÑ flags: (0x0001) ACC_PUBLICÔºåÊ†áËØÜËøô‰∏™ÊñπÊ≥ïÊòØpublicÁöÑÔºåÊé•‰∏ãÂú®ÁöÑname_indexÂíådescriptor_indexÔºåÂú®‰∏äÊñá‰∏≠ÁöÑ‰ΩìÁé∞ÂàÜÂà´ÂØπÂ∫îÁùÄsayHelloÂíå()Ljava/lang/String;„ÄÇ ËøôÈáåËß£Èáä‰∏Ä‰∏ãÊèèËø∞Á¨¶ÁöÑÊ¶ÇÂøµÔºåÂú®‰ªãÁªçClassÊñá‰ª∂ÁªìÊûÑÁöÑÊñáÁ´†‰∏≠ÊúâÊèêÂà∞ÔºåËøôÈáåÂÜçÊèê‰∏ÄÈÅç: ÊèèËø∞Á¨¶ÁöÑ‰ΩúÁî®ÊòØÁî®Êù•ÊèèËø∞Â≠óÊÆµÁöÑÊï∞ÊçÆÁ±ªÂûãÔºåÊñπÊ≥ïÁöÑÂèÇÊï∞ÂàóË°®ÂíåËøîÂõûÂÄºÔºåÊ†πÊçÆÊèèËø∞Á¨¶ËßÑÂàôÔºåÂü∫Êú¨Êï∞ÊçÆÁ±ªÂûãÔºàbyte,char,int,long,float,double,short,booleanÔºâ‰ª•Âèä‰ª£Ë°®Êó†ËøîÂõûÂÄºÁöÑvoidÁ±ªÂûãÈÉΩÁî®‰∏Ä‰∏™Â§ßÂÜôÂ≠óÁ¨¶Êù•Ë°®Á§∫ÔºåËÄåÂØπË±°Á±ªÂûãÂàôÁî®LÂä†ÂØπË±°ÁöÑÂÖ®ÈôêÂÆöÂêçÊù•Ë°®Á§∫ ÊúÄÈáçË¶ÅÁöÑÂÜÖÂÆπÂÖ∂ÂÆûËøòÊòØÂú®attribute_infoÂ±ûÊÄßË°®‰∏≠ÁöÑcodeÂÜÖÂÆπÔºå‰πüÂ∞±ÊòØÊàë‰ª¨ÂÜôÁöÑÂÖ∑‰Ωì‰ª£Á†ÅÁøªËØëÊàêÁöÑÂ≠óËäÇÁ†ÅÊåá‰ª§ÂÜÖÂÆπÔºåËøôÂùóÂÜÖÂÆπÊòØÊàë‰ª¨ÈòÖËØªÂ≠óËäÇÁ†ÅÊñá‰ª∂ÁöÑÈáç‰∏≠‰πãÈáç„ÄÇ‰∏ãÈù¢Êàë‰ª¨Â∞±Êù•ÈòÖËØª‰∏Ä‰∏ã‰∏äÊñáÁöÑÂ≠óËäÇÁ†ÅÂÜÖÂÆπ ldc #2 Â∞ÜÂ∏∏ÈáèÊ±†‰∏≠Á¥¢Âºï‰∏∫2ÁöÑÂ≠óÁ¨¶‰∏≤Âä†ËΩΩÂà∞Êìç‰ΩúÊï∞Ê†àÈ°∂ astore_1 Â∞Ü‰∏Ä‰∏™Êï∞ÂÄº‰ªéÊìç‰ΩúÊï∞Ê†àÂ≠òÂÇ®Âà∞Â±ÄÈÉ®ÂèòÈáèË°® aload_1 Â∞Ü‰∏Ä‰∏™Êï∞ÂÄº‰ªéÂ±ÄÈÉ®ÂèòÈáèË°®Âä†ËΩΩÂà∞Êìç‰ΩúÊï∞Ê†à areturn Â∞ÜÊ†àÈ°∂Á¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ËøîÂõû ÂèØ‰ª•ÁúãÂà∞‰∏äÈù¢ÁöÑÂõõ‰∏™Ê≠•È™§ÁöÑÊìç‰ΩúÂÖ∂ÂÆûÈÉΩÊòØÂü∫‰∫éÊ†àÁöÑÊìç‰ΩúÔºåËøôÈáåÊèê‰∏Ä‰∏ãjavaËôöÊãüÊú∫Ê†àÁöÑÊ†àÂ∏ßÁªìÊûÑ ÂÖ≥‰∫éÂ≠óËäÇÁ†ÅÂ≠ê‰ª§ÈõÜÂèØ‰ª•ÂèÇËÄÉjavaÂ≠óËäÇÁ†ÅÂ≠ê‰ª§ÈõÜ ÊúâË∂£ÁöÑ‰æãÂ≠ê ‚Äî‰∏ãÈù¢Êàë‰ª¨ÂÜçÊù•Áúã‰∏Ä‰∏™ÊúâË∂£ÁöÑ‰æãÂ≠êÔºåÂ§ßÂÆ∂ÊÄùËÄÉ‰∏Ä‰∏ãËøô‰∏™ÊâßË°åËøô‰∏™ÊñπÊ≥ïÁöÑËøîÂõûÂÄº‰ºöÊòØÂ§öÂ∞ëÔºü 12345678910111213141516171819202122232425262728public class Test &#123; public int inc() &#123; int x; try &#123; x = 1; return x; &#125; catch (Exception e) &#123; x = 2; return x; &#125; finally &#123; x = 3; &#125; &#125;&#125; ‰ª£Á†ÅÈùûÂ∏∏ÁÆÄÂçïÔºåÊàëÊÉ≥Â§ßÂÆ∂Â∫îËØ•‰πüÈÉΩÁü•ÈÅìÊ≠£Á°ÆÁ≠îÊ°àÔºåÂΩìÊ≤°ÊúâÂá∫Áé∞ÂºÇÂ∏∏ÁöÑÊó∂ÂÄôÔºåËøîÂõûÂÄº‰∏∫1ÔºåÂá∫Áé∞ÂºÇÂ∏∏ÁöÑËØùÂàô‰∏∫2ÔºàÂΩìÁÑ∂ËøôÈáå‰∏ç‰ºöÊäõÂºÇÂ∏∏Ôºâ„ÄÇÂèØÊòØÂ¶ÇÊûúÊàë‰ª¨Âú®finallyÂø´ÈáåÂä†Âè•‰ª£Á†ÅSystem.out.prinln(&quot;do it&quot;)ÔºåÁÑ∂ÂêéÂÜçÊâßË°åËøô‰∏™ÊñπÊ≥ïÔºåÂÖ∂ÂÆûÊòØÂèØ‰ª•ÁúãÂà∞do itË¢´ÊâìÂç∞‰∫ÜÔºå‰πüÂ∞±ÊòØËØ¥Âú®ÊâßË°åreturn‰πãÂâçÔºåfinallyÂø´‰∏≠ÁöÑ‰ª£Á†ÅÊòØË¢´ÊâßË°å‰∫ÜÁöÑÔºåÈÇ£‰πàËøôÈáåÂ∞±Êúâ‰∏Ä‰∏™ÊúâË∂£ÁöÑÈóÆÈ¢ò‰∫ÜÔºå‰∏∫‰ΩïËøîÂõû‰ªçÁÑ∂ÊòØ2ËÄå‰∏çÊòØ3Âë¢Ôºü ‰∏ãÈù¢Êàë‰ª¨Â∞±‰ªéÂ≠óËäÇÁ†ÅÊñá‰ª∂‰∏≠Êù•ÊâæÂá∫Á≠îÊ°à 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566public int inc(); descriptor: ()I flags: (0x0001) ACC_PUBLIC Code: stack=1, locals=5, args_size=1 0: iconst_1 // Â∞Üint = 1ÁöÑÂÄºÂéãÂÖ•Ê†àÈ°∂ 1: istore_1 // ÂºπÂá∫Ê†àÈ°∂ÂÖÉÁ¥†ÔºåÂ≠òÂÖ•‰ΩçÁΩÆ‰∏∫1ÁöÑÂ±ÄÈÉ®ÂèòÈáèË°® 2: iload_1 // ‰ªé‰ΩçÁΩÆ‰∏∫1ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ÂèñÂá∫ÂÖÉÁ¥†ÂéãÂÖ•Ê†àÈ°∂ 3: istore_2 // ÂºπÂá∫Ê†àÈ°∂ÂÖÉÁ¥†ÔºåÂ≠òÂÖ•‰ΩçÁΩÆ2ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ 4: iconst_3 // Â∞Üint = 3ÁöÑÂÄºÂéãÂÖ•Ê†àÈ°∂ ÔºàËøôÈáåÊâßË°åfinallyÂùó‰∏≠ÁöÑ‰ª£Á†Å‰∫ÜÔºâ 5: istore_1 // ÂºπÂá∫Ê†àÈ°∂ÂÖÉÁ¥†ÔºåÂ≠òÂÖ•‰ΩçÁΩÆ1ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ 6: iload_2 // ‰ªé‰ΩçÁΩÆ‰∏∫2ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ÂèñÂá∫ÂÖÉÁ¥†ÂéãÂÖ•Ê†àÈ°∂ 7: ireturn // ËøîÂõûÊ†àÈ°∂ÂÖÉÁ¥†2 (ÂìàÂìàÂìà ÁúãÂà∞Ê≤°ÊúâÔºåËøôÈáåËøîÂõûÁöÑÊòØ2ÔºåÊ≤°ÊúâÂºÇÂ∏∏ÁöÑËØùÔºåËøôÈáåÊñπÊ≥ïÂ∞±ËøîÂõû‰∫Ü) 8: astore_2 // Â∞ÜÊ†àÈ°∂ÁöÑÂºÇÂ∏∏ÂºïÁî®ÔºåÂ≠òÂÖ•‰ΩçÁΩÆ2ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ ÔºàËøôÈáåÂ∞±ÊòØÂºÇÂ∏∏ÊçïËé∑ÁöÑ‰ª£Á†Å‰∫ÜÔºâ 9: iconst_2 // Â∞Üint = 2ÁöÑÂÄºÂéãÂÖ•Ê†àÈ°∂ 10: istore_1 // ÂºπÂá∫Ê†àÈ°∂ÂÖÉÁ¥†ÔºåÂ≠òÂÖ•‰ΩçÁΩÆ1ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ 11: iload_1 // ‰ªé‰ΩçÁΩÆ‰∏∫1ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ÂèñÂá∫ÂÖÉÁ¥†ÂéãÂÖ•Ê†àÈ°∂ 12: istore_3 // ÂºπÂá∫Ê†àÈ°∂ÂÖÉÁ¥†ÔºåÂ≠òÂÖ•‰ΩçÁΩÆ3ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ 13: iconst_3 // Â∞Üint = 3ÁöÑÂÄºÂéãÂÖ•Ê†àÈ°∂ 14: istore_1 // ÂºπÂá∫Ê†àÈ°∂ÂÖÉÁ¥†ÔºåÂ≠òÂÖ•‰ΩçÁΩÆ1ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ 15: iload_3 // ‰ªé‰ΩçÁΩÆ‰∏∫3ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ÂèñÂá∫ÂÖÉÁ¥†ÂéãÂÖ•Ê†àÈ°∂ 16: ireturn // ËøîÂõûÊ†àÈ°∂ÂÖÉÁ¥† 2 17: astore 4 // Â∞ÜÊ†àÈ°∂ÂºÇÂ∏∏ÂºïÁî®Â≠òÂÖ•‰ΩçÁΩÆ‰∏∫4ÁöÑÂ±ÄÈÉ®ÂèòÈáèË°®‰∏≠ 19: iconst_3 // Â∞Üint = 3ÁöÑÂÄºÂéãÂÖ•Ê†àÈ°∂ 20: istore_1 // ÂºπÂá∫Ê†àÈ°∂ÂÖÉÁ¥†ÔºåÂ≠òÂÖ•‰ΩçÁΩÆ1ÁöÑÂ±ÄÈÉ®ÂèòÈáè‰∏≠ 21: aload 4 Â∞Ü‰ΩçÁΩÆ‰∏∫4ÁöÑÂ±ÄÈÉ®ÂèòÈáèÂºïÁî®ÂéãÂÖ•Ê†àÈ°∂ 23: athrow // Â∞ÜÊ†àÈ°∂ÁöÑÂºÇÂ∏∏ÊäõÂá∫ Exception table: // ÂºÇÂ∏∏Ë°® from to target type 0 4 8 Class java/lang/Exception 0 4 17 any 8 13 17 any 17 19 17 any Â¶ÇÊûú‰Ω†Â∑≤ÁªèÁúãÊáÇ‰∫Ü‰∏äÈù¢ÁöÑÂ≠óËäÇÁ†ÅÔºå‰Ω†Â∫îËØ•‰ºöË±ÅÊúóÂºÄÊúó„ÄÇÂéüÂõ†ÂÖ∂ÂÆûÂ∞±ÊòØÂú®‰∫éËøôÈáåÂºÄËæü‰∫Ü‰∏§‰∏™Â±ÄÈÉ®ÂèòÈáèÔºåfinallyÂùó‰∏≠ÁöÑ‰ª£Á†Å‰πüÁ°ÆÂÆûÊâßË°å‰∫ÜÔºåÂè™ÊòØÂ∞ÜÂèòÈáèÂ≠òÂÖ•‰∫ÜÂ±ÄÈÉ®ÂèòÈáèË°®‰∏≠ÁöÑÂè¶‰∏Ä‰∏™‰ΩçÁΩÆÔºåÂπ∂‰∏îÈÄöËøáËøô‰∏™‰æãÂ≠êÔºå‰πüÂèØ‰ª•ÂèëÁé∞ÔºåÊó†ËÆ∫‰ªÄ‰πàÊÉÖÂÜµfinallyÂùó‰∏≠ÁöÑ‰ª£Á†ÅÈÉΩ‰ºöÊâßË°å„ÄÇ Â∞æË®ÄÂ•Ω‰∫ÜÔºåÊú¨ÊñáÂà∞ËøôÈáåÂ∞±Â∑Æ‰∏çÂ§öÁªìÊùü‰∫Ü„ÄÇÂØπ‰∫éÂ≠óËäÇÁ†ÅÁöÑÊé¢Á¥¢‰∏™‰∫∫ËßâÁöÑËøòÊòØÈùûÂ∏∏ÊúâÊÑèÊÄùÁöÑÔºå‰πãÂêéÂ∫îËØ•‰πü‰ºöÊé¢Á¥¢Êõ¥Â§öÊúâÊÑèÊÄùÁöÑ‰∏úË•ø]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>JVM</category>
        <category>javaÂ≠óËäÇÁ†Å</category>
      </categories>
      <tags>
        <tag>JVM</tag>
        <tag>javaÂ≠óËäÇÁ†Å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[‰ΩøÁî®Java NIOÂÆûÁé∞‰∏Ä‰∏™HTTPÊúçÂä°Âô®]]></title>
    <url>%2F2019%2F04%2F19%2F%E4%BD%BF%E7%94%A8Java-NIO%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAHTTP%E6%9C%8D%E5%8A%A1%E5%99%A8%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏ÄÁõ¥‰ª•Êù•ÈÉΩÊÉ≥ÂÜô‰∏Ä‰∏™Ëá™Â∑±ÁöÑhttpÊúçÂä°Âô®ÔºåËøôÊ¨°Ë∂ÅÁùÄÁ®çÂæÆÁ©∫Èó≤‰∫Ü‰∏Ä‰∫õÔºåËµ∂Á¥ßÁ†Å‰∫Ü‰∏Ä‰∏™miniÁâàÁöÑ„ÄÇÂú®ËøôÈáåË∑üÂ§ßÂÆ∂ÂàÜ‰∫´‰∏Ä‰∏ãÁºñÂÜôÁöÑÊï¥‰∏™ÊÄùË∑ØÔºåÊÄª‰ΩìÊù•ËØ¥ÔºåÊï¥‰∏™Â∫îÁî®ÈùûÂ∏∏ÁÆÄÂçïÔºåÁõÆÂâç‰πüÂè™ÊòØÂÆûÁé∞‰∫ÜÊúÄÂü∫Êú¨ÁöÑÈùôÊÄÅËµÑÊ∫êËÆøÈóÆÔºå‰ΩÜÂØπ‰∫éÊÉ≥Â≠¶‰π†HttpÂçèËÆÆÁöÑÂêåÂ≠¶Êù•ËØ¥ÔºåÂ∫îËØ•ËøòÊòØÊúâÊâÄÂ∏ÆÂä© HTTPÂçèËÆÆÂÖàÁÆÄÂçï‰ªãÁªç‰∏Ä‰∏ãHTTPÂçèËÆÆÔºåHTTPÂçèËÆÆÊòØÊûÑÂª∫‰∫éTCP/IPÂçèËÆÆ‰πã‰∏äÁöÑ‰∏Ä‰∏™Â∫îÁî®Â±ÇÂçèËÆÆÔºåÂπ∂‰∏îÊòØÊó†ËøûÊé•Êó†Áä∂ÊÄÅÁöÑ„ÄÇ httpËØ∑Ê±ÇÊä•ÊñáhttpÁöÑËØ∑Ê±ÇÊä•ÊñáÁî±‰∏âÈÉ®ÂàÜÁªÑÊàê Áä∂ÊÄÅË°å &lt;method&gt; &lt;request-URL&gt; &lt;version&gt; methodÂåÖÂê´GETÔºåPOSTÔºåPUTÔºåDELETEÁ≠â ËØ∑Ê±ÇÂ§¥ Ê∂àÊÅØ‰∏ª‰Ωì ‰∏ãÈù¢ÊòØÂÖ∏ÂûãÁöÑhttpËØ∑Ê±ÇÊä•ÊñáÁ§∫‰æã 123456789101112131415161718GET /static/home.html HTTP/1.1Host: localhost:8080Connection: keep-aliveCache-Control: max-age=0Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3Accept-Encoding: gzip, deflate, brAccept-Language: zh-CN,zh;q=0.9 httpÂìçÂ∫îÊä•ÊñáÂìçÂ∫îÊä•ÊñáË∑üËØ∑Ê±ÇÊä•ÊñáÁ±ª‰ººÔºå‰πüÁî±‰∏âÈÉ®ÂàÜÁªÑÊàê Áä∂ÊÄÅË°å ËøôÈáåÈúÄË¶ÅÂÖ≥Ê≥®‰∏ãÂìçÂ∫îÁöÑÂêÑ‰∏™Áä∂ÊÄÅÊâÄ‰ª£Ë°®ÁöÑÂê´‰πâÔºå‰ª•ÂèäÊµèËßàÂô®ËØÜÂà´Ëøô‰∫õÁä∂ÊÄÅÁ†Å‰ºöÁõ∏Â∫îÁöÑÂÅöÂì™‰∫õ‰∫ãÊÉÖ ÂìçÂ∫îÂ§¥ ÂìçÂ∫îÊ≠£Êñá 12345678HTTP/1.1 200 OKServer: cloud http v1.0Content-Type: text/html;charset=UTF-8&lt;html&gt;... ## Âä®Êâã ÂâçÈù¢ÁÆÄÂçï‰ªãÁªç‰∫Ü‰∏Ä‰∏ãhttpÂçèËÆÆÁöÑÂü∫Êú¨‰ø°ÊÅØÔºå‰∏ãÈù¢Â∞±ÊòØÊ∫êÁ†ÅÂÆûÁé∞‰∫ÜÔºåÊàëËøôÈáåÁõ¥Êé•‰ΩøÁî®‰∫ÜJava NIO‰Ωú‰∏∫Â∫ïÂ±ÇÈÄö‰ø°ÊîØÊíëÔºåÂú®ÂÆûÈôÖÁöÑÁîü‰∫ß‰ª£Á†Å‰∏≠ÔºåÂ§ßÂ§ö‰ºöÈÄâÊã©Â∞ÅË£ÖËâØÂ•ΩÁöÑnettyÊù•‰Ωú‰∏∫Á®≥ÂÆöÁöÑÂ∫ïÂ±ÇÈÄö‰ø° ËøôÈáåÂÖàÊîæ‰∏äÈ°πÁõÆÊ∫êÁ†Å CloudHttp ÂÆö‰πâRequestÂíåResponse Request 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class Request &#123; /** * method */ private String method; /** * httpÂçèËÆÆÁâàÊú¨ */ private String httpVersion; /** * ËØ∑Ê±Çuri */ private String uri; /** * ËØ∑Ê±ÇÁõ∏ÂØπË∑ØÂæÑ */ private String path; /** * ËØ∑Ê±ÇÂ§¥‰ø°ÊÅØ */ private Map&lt;String, String&gt; headers; /** * ËØ∑Ê±ÇÂèÇÊï∞ */ private Map&lt;String, String&gt; attribute;&#125; Response 12345678910111213141516171819202122232425262728public class Response &#123; private Integer code; private String protocol = "HTTP/1.1"; private String msg; private Map&lt;String, String&gt; headers; private ByteArrayOutputStream outPutStream = new ByteArrayOutputStream(); public Response() &#123; this.code = HttpCode.STATUS_200.getCode(); this.msg = HttpCode.STATUS_200.getMsg(); headers = new HashMap&lt;&gt;(); headers.put("Content-Type", "text/html;charset=UTF-8"); headers.put("Server", "cloud http v1.0"); &#125;&#125; ÂÆö‰πâËØ∑Ê±ÇÂìçÂ∫îËß£ÊûêÁ±ª HttpParser 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176public class HttpParser &#123; private final static Logger logger = LoggerFactory.getLogger(HttpParser.class); /** * &lt;p&gt;Ëß£ÊûêhttpËØ∑Ê±Ç‰Ωì&lt;/p&gt; * * @param buffers * @return */ public static Request decodeReq(byte [] buffers) &#123; Request request = new Request(); if (buffers != null) &#123; String resString = new String(buffers); logger.info(resString); String[] headers = resString.trim().split("\r\n"); if (headers.length &gt; 0) &#123; String firstline = headers[0]; // ÊåâÁ©∫Ê†ºÂàÜÂâ≤Â≠óÁ¨¶‰∏≤ // Ëß£Êûê method uri ÂçèËÆÆÁâàÊú¨ String mainInfo [] = firstline.split("\\s+"); request.setMethod(mainInfo[0]); try &#123; request.setUri(URLDecoder.decode(mainInfo[1], "UTF-8")); &#125; catch (UnsupportedEncodingException e) &#123; logger.error("error_HttpParser_URLDecode, uri = &#123;&#125;", mainInfo[1], e); &#125; request.setHttpVersion(mainInfo[2]); // Ëß£Êûêheader Map&lt;String, String&gt; headersMap = new HashMap&lt;&gt;(); for (int i = 1; i &lt; headers.length; i++) &#123; String entryStr = headers[i]; String entry [] = entryStr.trim().split(":"); headersMap.put(entry[0].trim(), entry[1].trim()); &#125; request.setHeaders(headersMap); // Ëß£ÊûêÂèÇÊï∞ String uri = request.getUri(); Map&lt;String, String&gt; attribute = new HashMap&lt;&gt;(); request.setPath(uri); if (StringUtils.isNotEmpty(uri)) &#123; int indexOfParam = uri.indexOf("?"); if (indexOfParam &gt; 0) &#123; // ËÆæÁΩÆpath request.setPath(uri.substring(0, indexOfParam)); String queryString = uri.substring(indexOfParam + 1, uri.length()); String paramEntrys [] = queryString.split("&amp;"); for (String paramEntry : paramEntrys) &#123; String [] entry = paramEntry.split("="); if (entry.length &gt; 0) &#123; String key = entry[0]; String value = entry.length &gt; 1 ? entry[1] : ""; attribute.put(key, value); &#125; &#125; &#125; &#125; request.setAttribute(attribute); &#125; &#125; return request; &#125; /** * &lt;p&gt;ËøîÂõûhttpÂìçÂ∫îÂ≠óËäÇÊµÅ&lt;/p&gt; * * @param response * @return */ public static byte[] encodeResHeader(Response response) &#123; StringBuilder resBuild = new StringBuilder(); resBuild.append(response.getProtocol() + " " + response.getCode() + " " + response.getMsg()); resBuild.append("\r\n"); Map&lt;String, String&gt; headers = response.getHeaders(); headers.entrySet().forEach(entry -&gt; &#123; resBuild.append(entry.getKey()); resBuild.append(": "); resBuild.append(entry.getValue()); resBuild.append("\r\n"); &#125;); resBuild.append("\r\n"); String resString = resBuild.toString(); byte [] bytes = null; try &#123; bytes = resString.getBytes("UTF-8"); &#125; catch (UnsupportedEncodingException e) &#123; logger.error("error_encodeResHeader", e); &#125; return bytes; &#125;&#125; ‰ΩøÁî®Java nio ÂêØÂä®ÊúçÂä°Âô® NioServer 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246public class NioServer implements Server, Runnable &#123; private final static Logger logger = LoggerFactory.getLogger(NioServer.class); private Thread serverThread; private Integer port; private boolean running = false; private static volatile NioServer server; private CloudService cloudService; private ServerSocketChannel serverSocketChannel; private ByteBuffer readBuffer = ByteBuffer.allocate(8192); public static final ExecutorService requestWork = Executors.newCachedThreadPool(); public static NioServer getServerInstance () &#123; if (server == null) &#123; synchronized (NioServer.class) &#123; if (server == null) &#123; server = new NioServer(); &#125; &#125; &#125; return server; &#125; public NioServer() &#123; this.cloudService = new CloudService(); port = Integer.valueOf(CloudHttpConfig.getValue("port", "8080")); &#125; @Override public synchronized void start() &#123; if (running) &#123; logger.info("ÊúçÂä°Âô®Â∑≤ÁªèÂêØÂä®"); return; &#125; serverThread = new Thread(this); serverThread.start(); this.running = true; &#125; @Override public void stop() &#123; try &#123; serverSocketChannel.close(); serverThread.stop(); &#125; catch (IOException e) &#123; logger.error("error_NioServer_stop", e); &#125; &#125; @Override public void run() &#123; try &#123; //ÊâìÂºÄServerSocketChannelÈÄöÈÅì serverSocketChannel = ServerSocketChannel.open(); //ÂæóÂà∞ServerSocketÂØπË±° serverSocketChannel.socket().bind(new InetSocketAddress(port)); Selector selector = Selector.open(); serverSocketChannel.configureBlocking(false); serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); while (true) &#123; selector.select(); Iterator&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys().iterator(); SelectionKey key = null; while (selectedKeys.hasNext()) &#123; key = selectedKeys.next(); selectedKeys.remove(); if (!key.isValid()) &#123; continue; &#125; if (key.isAcceptable()) &#123; accept(key); &#125; if (key.isReadable()) &#123; read(key); &#125; if (key.isWritable()) &#123; write(key); &#125; &#125; &#125; &#125; catch (IOException e) &#123; logger.error("error_NioServer_run", e); &#125; &#125; private void accept(SelectionKey key) &#123; try &#123; ServerSocketChannel serverSocketChannel = (ServerSocketChannel)key.channel(); SocketChannel socketChannel = serverSocketChannel.accept(); socketChannel.configureBlocking(false); socketChannel.register(key.selector(), SelectionKey.OP_READ); &#125; catch (IOException e) &#123; logger.error("error_NioServer_accept", e); &#125; &#125; private Request read(SelectionKey key) &#123; Request request = null; SocketChannel socketChannel = (SocketChannel) key.channel(); try &#123; int readNum = socketChannel.read(readBuffer); if (readNum == -1) &#123; socketChannel.close(); key.cancel(); return null; &#125; readBuffer.flip(); byte [] buffers = new byte[readBuffer.limit()]; readBuffer.get(buffers); readBuffer.clear(); request = HttpParser.decodeReq(buffers); requestWork.execute(new RequestWorker(request, key, cloudService)); &#125; catch (IOException e) &#123; logger.error("error_NioServer_read", e); &#125; return request; &#125; private void write(SelectionKey key) throws IOException &#123; ByteBuffer buffer = (ByteBuffer) key.attachment(); if(buffer == null || !buffer.hasRemaining()) &#123; return; &#125; SocketChannel socketChannel = (SocketChannel) key.channel(); socketChannel.write(buffer); if(!buffer.hasRemaining())&#123; key.interestOps(SelectionKey.OP_READ); buffer.clear(); &#125; socketChannel.close(); &#125;&#125; Â§ÑÁêÜËØ∑Ê±ÇÁöÑ RequestWorkÁ±ªÂØπ‰∫éÊØè‰∏Ä‰∏™ËøõÂÖ•ÁöÑËØ∑Ê±Ç„ÄÇÈÉΩ‰ºöÂçïÁã¨ÂêØÂä®‰∏Ä‰∏™Á∫øÁ®ãÊù•ËøõË°åÂ§ÑÁêÜ RequestWorker 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990public class RequestWorker implements Runnable &#123; private final static Logger logger = LoggerFactory.getLogger(RequestWorker.class); private Request request; private SelectionKey key; private SocketChannel channel; private CloudService cloudService; public RequestWorker(Request request, SelectionKey key, CloudService cloudService) &#123; this.request = request; this.key = key; this.channel = (SocketChannel) key.channel(); this.cloudService = cloudService; &#125; @Override public void run() &#123; Response response = new Response(); try &#123; cloudService.doService(request, response); &#125; catch (ViewNotFoundException e) &#123; response.setCode(HttpCode.STATUS_404.getCode()); response.setMsg(HttpCode.STATUS_404.getMsg()); ByteArrayOutputStream outputStream = response.getOutPutStream(); InputStream inputStream = this.getClass().getClassLoader().getResourceAsStream("404.html"); byte bytes [] = new byte [1024]; int len; try &#123; while ((len = inputStream.read(bytes)) &gt; -1) &#123; outputStream.write(bytes, 0, len); &#125; &#125; catch (IOException e1) &#123; logger.error("error_requestWork_write404", e); &#125; &#125; byte [] resHeader = HttpParser.encodeResHeader(response); byte [] body = response.getOutPutStream().toByteArray(); ByteBuffer byteBuffer = ByteBuffer.allocate(resHeader.length + body.length); byteBuffer.put(resHeader); byteBuffer.put(body); byteBuffer.flip(); // Â∞ÜËæìÂá∫ÊµÅÁªëÂÆöËá≥ÈôÑ‰ª∂ key.attach(byteBuffer); // Ê≥®ÂÜåÂÜô‰∫ã‰ª∂ key.interestOps(SelectionKey.OP_WRITE); key.selector().wakeup(); &#125;&#125; ÂÆö‰πâServletÊé•Âè£ CloudServlet 12345678910111213141516171819202122232425262728293031323334353637383940public interface CloudServlet &#123; /** * Âà§Êñ≠ÂΩìÂâçËØ∑Ê±ÇÊòØÂê¶ÂåπÈÖç handler * * @param request * @return */ boolean match(Request request); /** * ÊâßË°åÂàùÂßãÂåñ */ void init(Request request, Response response); /** * ÊâßË°åËØ∑Ê±Ç * * @param request * @param response */ void doService(Request request, Response response);&#125; StaticViewServlet ÂÆö‰πâ‰∏Ä‰∏™Â§ÑÁêÜÈùôÊÄÅËµÑÊ∫êÁöÑStaticViewServletÂÆûÁé∞CloudServletÊé•Âè£ ËØ•ÈùôÊÄÅËµÑÊ∫êÂ§ÑÁêÜÂô®‰ºöËá™Âä®Êã¶Êà™staticË∑ØÂæÑ‰∏ãÁöÑËØ∑Ê±Ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172public class StaticViewServlet implements CloudServlet &#123; private final static Logger logger = LoggerFactory.getLogger(StaticViewServlet.class); private String staticRootPath; public static Pattern p = Pattern.compile("^/static/\\S+"); @Override public boolean match(Request request) &#123; String path = request.getPath(); Matcher matcher = p.matcher(path); return matcher.matches(); &#125; @Override public void init(Request request, Response response) &#123; staticRootPath = CloudHttpConfig.getValue("static.resource.path"); &#125; @Override public void doService(Request request, Response response) &#123; String path = request.getPath(); String fileRelativePath = path.substring(8); String absolutePath = staticRootPath + "/" + fileRelativePath; RandomAccessFile randomAccessFile = null; try &#123; randomAccessFile = new RandomAccessFile(absolutePath, "r"); FileChannel fileChannel = randomAccessFile.getChannel(); ByteBuffer htmBuffer = ByteBuffer.allocate((int)fileChannel.size()); fileChannel.read(htmBuffer); htmBuffer.flip(); byte [] htmByte = new byte[htmBuffer.limit()]; htmBuffer.get(htmByte); response.getOutPutStream().write(htmByte); &#125; catch (FileNotFoundException e) &#123; throw new ViewNotFoundException(); &#125; catch (IOException e) &#123; logger.error("error_StaticViewServlet_doService ÂºÇÂ∏∏", e); &#125; &#125;&#125; ÂÆö‰πâ CloudServiceCloudServiceÊòØÁî®‰∫éÁõõÊîæServletÁöÑÂÆπÂô® 12345678910111213141516171819202122232425262728293031323334353637383940public class CloudService &#123; private List&lt;CloudServlet&gt; cloudServlets = new ArrayList&lt;&gt;(); public CloudService() &#123; cloudServlets.add(new StaticViewServlet()); cloudServlets.add(new MappingUrlServlet()); &#125; public void doService(Request request, Response response) &#123; CloudServlet servlet = doSelect(request); servlet.init(request, response); servlet.doService(request, response); &#125; private CloudServlet doSelect(Request request) &#123; for (CloudServlet cloudServlet : cloudServlets) &#123; if (cloudServlet.match(request)) &#123; return cloudServlet; &#125; &#125; return new MappingUrlServlet(); &#125;&#125; ÊúÄÂêé ÁºñÂÜôÂêØÂä®Á±ª12345678910111213141516171819202122public class CloudHttpServer &#123; /** * ÂêØÂä®ÊúçÂä°Âô® */ public static void startServer() &#123; NioServer.getServerInstance().start(); &#125; public static void main(String[] args) &#123; startServer(); &#125;&#125; ÊµãËØï ÂêØÂä®ÊúçÂä°Âô® ÊµèËßàÂô®ËÆøÈóÆ http://localhost:8080/static/home.html ÂìçÂ∫îÈ°µÈù¢ Â∞æË®ÄÊú¨ÊñáÂè™ÊòØ‰∏Ä‰∏™Á§∫‰æãÔºå‰ªÖ‰ªÖÂÆûÁé∞‰∫ÜÈùôÊÄÅËµÑÊ∫êËÆøÈóÆ„ÄÇÂÅö‰∏∫Ëá™Â®±Ëá™‰πêÁöÑÈ°πÁõÆ +‚Äî‚Äî=]]></content>
      <categories>
        <category>NIO</category>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>NIO</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaÂ≠óËäÇÁ†ÅÂ∏∏ÈáèÊ±†]]></title>
    <url>%2F2019%2F04%2F17%2FJava%E5%AD%97%E8%8A%82%E7%A0%81%E5%B8%B8%E9%87%8F%E6%B1%A0%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏äÁØáÊñáÁ´†ÁÆÄÂçï‰ªãÁªç‰∫Üjava Class Â≠óËäÇÁ†ÅÊñá‰ª∂ÁöÑÂü∫Êú¨Ê†ºÂºè„ÄÇÊú¨ÊñáÊàë‰ª¨Áõ¥Êé•ÈÄöËøáÈòÖËØªÂ≠óËäÇÁ†ÅÊñá‰ª∂Êù•Ëøõ‰∏ÄÊ≠•ÁêÜËß£Â≠óËäÇÁ†Å‰∏≠ÁöÑÂ∏∏ÈáèÊ±†ÁªìÊûÑ È¶ñÂÖàÊàë‰ª¨Êñ∞Âª∫‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑJavaÊñá‰ª∂ 12345public class Test &#123; public static void main(String[] args) &#123; System.out.println("hello world"); &#125;&#125; ÁºñËØë‰πãÂêé‰ΩøÁî®ÊñáÊú¨ÁºñËæëÂô®ÊâìÂºÄÔºåÂèØ‰ª•ÁúãÂà∞ClassÊñá‰ª∂ÊúÄÂéüÂßãÁöÑ16ËøõÂà∂Ê†ºÂºè„ÄÇÊúÄÊòéÊòæÁöÑClassÊñá‰ª∂ÁöÑÈ≠îÊï∞cafe babe‰∏ÄÁúºÂ∞±ËÉΩÁúãÂà∞ 12345678910111213141516171819202122232425262728293031323334cafe babe 0000 0034 0022 0a00 0600 14090015 0016 0800 170a 0018 0019 0700 1a07001b 0100 063c 696e 6974 3e01 0003 28295601 0004 436f 6465 0100 0f4c 696e 654e756d 6265 7254 6162 6c65 0100 124c 6f63616c 5661 7269 6162 6c65 5461 626c 65010004 7468 6973 0100 144c 636f 6d2f 796d6d2f 6167 656e 742f 5465 7374 3b01 00046d61 696e 0100 1628 5b4c 6a61 7661 2f6c616e 672f 5374 7269 6e67 3b29 5601 00046172 6773 0100 135b 4c6a 6176 612f 6c616e67 2f53 7472 696e 673b 0100 0a53 6f757263 6546 696c 6501 0009 5465 7374 2e6a6176 610c 0007 0008 0700 1c0c 001d 001e0100 0b68 656c 6c6f 2077 6f72 6c64 07001f0c 0020 0021 0100 1263 6f6d 2f79 6d6d2f61 6765 6e74 2f54 6573 7401 0010 6a617661 2f6c 616e 672f 4f62 6a65 6374 0100106a 6176 612f 6c61 6e67 2f53 7973 74656d01 0003 6f75 7401 0015 4c6a 6176 612f696f 2f50 7269 6e74 5374 7265 616d 3b010013 6a61 7661 2f69 6f2f 5072 696e 74537472 6561 6d01 0007 7072 696e 746c 6e010015 284c 6a61 7661 2f6c 616e 672f 53747269 6e67 3b29 5600 2100 0500 0600 00000000 0200 0100 0700 0800 0100 0900 00002f00 0100 0100 0000 052a b700 01b1 00000002 000a 0000 0006 0001 0000 0009 000b0000 000c 0001 0000 0005 000c 000d 00000009 000e 000f 0001 0009 0000 0037 00020001 0000 0009 b200 0212 03b6 0004 b1000000 0200 0a00 0000 0a00 0200 0000 0b000800 0c00 0b00 0000 0c00 0100 0000 09001000 1100 0000 0100 1200 0000 0200 13 Â¶Ç‰Ωï‰ªé‰∏äÈù¢ÁöÑÊñá‰ª∂‰∏≠ÊâæÂà∞Â∏∏ÈáèÊ±†ÊâÄÂú®ÁöÑ‰ΩçÁΩÆÂë¢Âú®‰∏äÁØáÊñáÁ´†‰∏≠Êàë‰ª¨Â∑≤ÁªèÂàÜÊûêËøáClassÊñá‰ª∂Êñá‰ª∂Ê†ºÂºè‰∫ÜÔºåÂ∏∏ÈáèÊ±†ÁöÑ‰ΩçÁΩÆÁ¥ßÈöèÂú®ÁâàÊú¨Âè∑‰πãÂêéÔºå‰πüÂ∞±ÊòØ‰ªéÁ¨¨9‰∏™Â≠óËäÇÂºÄÂßãÂ∞±ÊòØÂ∏∏ÈáèÊ±†ÁöÑÂÜÖÂÆπ‰∫ÜÔºå‰∏ãÈù¢Â∞±ËÆ©Êàë‰ª¨‰∏ÄËµ∑Êù•Áúã‰∏ãÂ∏∏ÈáèÊ±†ÁöÑÂÖ∑‰ΩìÂÜÖÂÆπ constant_pool_count u2‰ªéÁ¨¨9‰∏™Â≠óËäÇÂºÄÂßãÂæÄÂêéÁöÑ‰∏§‰∏™Â≠óËäÇÔºåÊòØconstant_pool_countÔºåÊàë‰ª¨ÊääÂÆÉÂè´ÂÅöÂ∏∏ÈáèËÆ°Êï∞Âô®ÔºåÊØîËæÉÁâπÊÆäÁöÑÊòØÂÆÉÁöÑ‰∏ãÊ†áÊòØ‰ªé1ÂºÄÂßãÁöÑÔºå‰πüÂ∞±ÊòØËØ¥ÁúüÊ≠£ÁöÑÂ∏∏ÈáèÊ±†Êï∞ÈáèÊòØconstant_pool_count - 1‰∏™ÔºåÈÇ£Â•ΩÁé∞Âú®ËÆ©Êàë‰ª¨Êù•ÁúãÁúã‰∏äÈù¢ÁöÑÈÇ£‰∏™ÊôÆÈÄöClassÊñá‰ª∂ÂåÖÂê´‰∫ÜÂ§öÂ∞ë‰∏™Â∏∏ÈáèË°®Ôºàcp_infoÔºâ ÂèØ‰ª•ÁúãÂà∞constant_pool_countÊ†áËØÜ‰ΩçÊòØ0022ÔºåËΩ¨‰∏∫10ËøõÂà∂Â∞±ÊòØ34„ÄÇ‰πüÂ∞±ÊòØËØ¥ÂåÖÂê´34 - 1 = 33‰∏™Â∏∏ÈáèË°®ÂÜÖÂÆπ cp_info‰∏äÊñáÁªèËøáÂàÜÊûêÊàë‰ª¨Â∑≤ÁªèÁ°ÆÂÆö‰∫ÜÂ≠óËäÇÁ†ÅÊñá‰ª∂ÂåÖÂê´ÁöÑÂ∏∏ÈáèË°®‰∏™Êï∞ÔºåÈÇ£‰πàÊé•‰∏ãÊù•Êàë‰ª¨Ë¶ÅÂÖ∑‰ΩìÊÄé‰πàÁúãÂë¢Ôºü ‰∏ãÈù¢ËÆ©Êàë‰ª¨Êù•ÂÖ∑‰ΩìÂàÜÊûê‰∏ãcp_infoÁöÑÁªìÊûÑ ÂèØ‰ª•ÁúãÂà∞ÊØè‰∏™cp_infoÁöÑÁ¨¨‰∏Ä‰∏™Â≠óËäÇ‰ΩçÈÉΩÊòØtagÔºåÁî®‰∫éÊ†áËØÜÂ∏∏ÈáèË°®ÊâÄÂ±ûÁöÑÂÖ∑‰ΩìÁ±ªÂûãÔºå‰∏äÁØáÊñáÁ´†Êàë‰ª¨ËØ¥ËøáÔºåÂ∏∏ÈáèË°®‰πãÊâÄ‰ª•ÈùûÂ∏∏Â§çÊùÇÔºåÂ∞±ÊòØÂõ†‰∏∫ÂÆÉÁöÑÁ±ªÂûã‰ºóÂ§öÔºåÊúâÂ§öÂ§ß14ÁßçÁ±ªÂûã„ÄÇÈÇ£‰πàËøô‰∫õÁ±ªÂûãÁöÑÂå∫ÂàÜÂ∞±ÊòØÈÄöËøátagÊù•Âå∫ÂàÜ„ÄÇÊàë‰ª¨‰ºöÈÄê‰∏™ÂàÜÊûêËøô14ÁßçÁ±ªÂûã ÂÖàÊù•Áúã‰∏ãËøô14Â∏∏ÈáèÊ±†Á±ªÂûã ËøòÊòØÂõûÂà∞‰∏äËø∞Â≠óËäÇÁ†ÅÁöÑ16ËøõÂà∂Êñá‰ª∂ÔºåÊàë‰ª¨Êé•ÁùÄÂæÄ‰∏ãÁúã ÂèØ‰ª•ÁúãÂà∞tag = 10ÔºåÊ†πÊçÆ‰∏äÊñáÊàë‰ª¨ÂàóÂá∫ÁöÑÁªÜÂàÜÁ±ªÂûãÂèØ‰ª•Á°ÆÂÆöËøôÁ¨¨‰∏Ä‰∏™Âá∫Áé∞ÁöÑÂ∏∏ÈáèË°®Á±ªÂûãÊòØconstant_Methodref_info„ÄÇÈÇ£Â•ΩÁé∞Âú®Êàë‰ª¨ÂÜçÂéªÂÖ∑‰ΩìÁöÑÁúã‰∏ãconstant_Methodref_infoË°®ÁöÑÂÖ∑‰ΩìÂÜÖÂÆπ ÂèØ‰ª•ÁúãÂà∞Á¥ßË∑üÂú®tag‰πãÂêéÂÖ∂ÂÆûÊòØ‰∏§È°πindexÁ¥¢ÂºïÂÄºÔºåÂàÜÂà´ÊåáÂêëconstant_Class_infoÂíåconstant_NameAndType_info„ÄÇ ÁªßÁª≠ÂæÄ‰∏ãÈòÖËØªÔºåÂèØ‰ª•Áü•ÈÅìÂÖ∑‰ΩìÁöÑÁ¥¢ÂºïÂÄºÂàÜÂà´‰∏∫0006Ôºå0014„ÄÇ‰πüÂ∞±ÊòØÊåáÂêëÂ∏∏ÈáèÊ±†ÁöÑÁ¨¨6È°πÂíåÁ¨¨20È°π ‰∏ãÈù¢‰∏∫‰∫ÜÊñπ‰æøÈòÖËØªÔºåÊàë‰ª¨Áõ¥Êé•‰ΩøÁî®javap -v TestÂëΩ‰ª§ÁîüÊàêÊñπ‰æøÊàë‰ª¨ÈòÖËØªÁöÑÂ≠óËäÇÁ†ÅÊñá‰ª∂ÔºåÂΩìÁÑ∂Â¶ÇÊûúÊúâÂÖ¥Ë∂£ÁöÑËØùÔºåÁõ¥Êé•ÈòÖËØªÊ∫êÊñá‰ª∂‰πüÊòØoKÁöÑ 123456789101112131415161718192021222324252627282930313233343536373839404142434445public class com.ymm.agent.Test minor version: 0 major version: 52 flags: (0x0021) ACC_PUBLIC, ACC_SUPER this_class: #5 // com/ymm/agent/Test super_class: #6 // java/lang/Object interfaces: 0, fields: 0, methods: 2, attributes: 1Constant pool: #1 = Methodref #6.#20 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = Fieldref #21.#22 // java/lang/System.out:Ljava/io/PrintStream; #3 = String #23 // hello world #4 = Methodref #24.#25 // java/io/PrintStream.println:(Ljava/lang/String;)V #5 = Class #26 // com/ymm/agent/Test #6 = Class #27 // java/lang/Object #7 = Utf8 &lt;init&gt; #8 = Utf8 ()V #9 = Utf8 Code #10 = Utf8 LineNumberTable #11 = Utf8 LocalVariableTable #12 = Utf8 this #13 = Utf8 Lcom/ymm/agent/Test; #14 = Utf8 main #15 = Utf8 ([Ljava/lang/String;)V #16 = Utf8 args #17 = Utf8 [Ljava/lang/String; #18 = Utf8 SourceFile #19 = Utf8 Test.java #20 = NameAndType #7:#8 // &quot;&lt;init&gt;&quot;:()V #21 = Class #28 // java/lang/System #22 = NameAndType #29:#30 // out:Ljava/io/PrintStream; #23 = Utf8 hello world #24 = Class #31 // java/io/PrintStream #25 = NameAndType #32:#33 // println:(Ljava/lang/String;)V #26 = Utf8 com/ymm/agent/Test #27 = Utf8 java/lang/Object #28 = Utf8 java/lang/System #29 = Utf8 out #30 = Utf8 Ljava/io/PrintStream; #31 = Utf8 java/io/PrintStream #32 = Utf8 println #33 = Utf8 (Ljava/lang/String;)V&#123; public com.ymm.agent.Test(); descriptor: ()V.... ÁúÅÁï•ÂÖ∂‰ªñÂ≠óËäÇÁ†Å ÈÄöËøájavap ÁîüÊàêÁöÑÂ≠óËäÇÁ†ÅÊñá‰ª∂ÔºåÁúãËµ∑Êù•Â∞±ËàíÊúçÂ§ö‰∫Ü„ÄÇÁé∞Âú®ÁªßÁª≠ÂõûÂà∞Á¨¨‰∏Ä‰∏™Â∏∏ÈáèÊ±†È°πconstant_Methodref_infoÔºåÂèØ‰ª•Áü•ÈÅìÂÆÉÊòØÁî±constant_Class_infoÔºåconstant_NameAndType_info‰∏§È°πÁöÑÁ¥¢ÂºïÂÄºÁªÑÊàêÔºåÊ†πÊçÆÁ¥¢ÂºïÂÄº6,20Êàë‰ª¨ÂèØ‰ª•ÊâæÂà∞ÂÖ∑‰ΩìÂ∏∏ÈáèÊ±†È°πÂÜÖÂÆπ„ÄÇ ÂÖàÊâæÂà∞Á¥¢ÂºïÂÄº‰∏∫6ÁöÑconstant_Class_infoÁöÑÂÜÖÂÆπÔºåÂèØ‰ª•ÂèëÁé∞ÂÖ∂ÂÖ∑‰ΩìÂÜÖÂÆπ‰πüÊòØÊåáÂêë‰∫Ü‰∏Ä‰∏™Á¥¢ÂºïÂÄº27ÔºåÁªßÁª≠ÊâæÁ¥¢ÂºïÂÄº‰∏∫27Â∏∏ÈáèÈ°π ÊâæÂà∞Á¥¢ÂºïÂÄº‰∏∫27ÁöÑÂ∏∏ÈáèÈ°πÔºåÂèØ‰ª•ÂèëÁé∞ÊòØ‰∏Ä‰∏™constant_utf8_infoÁ±ªÂûãÁöÑÂ≠óÁ¨¶‰∏≤(java/lang/Object)ÔºåËøô‰πüÂ∞±ÊòØÊàë‰ª¨‰πãÂâçÊèêÂà∞ÁöÑÁ±ªÁöÑÂÖ®ÈôêÂÆöÂêçÁß∞ Âà∞ÁõÆÂâç‰∏∫Ê≠¢Â§ßÂÆ∂Â∫îËØ•Â∑≤ÁªèÊâæÂà∞‰∫ÜÈòÖËØªÂ∏∏ÈáèÊ±†ÁöÑÊÑüËßâ‰∫ÜÔºåÈÇ£‰πàÊàë‰ª¨ÂéªÊü•ÁúãÁ¥¢ÂºïÈ°π‰∏∫20ÁöÑconstant_NameAndType_infoÁöÑÊñπÊ≥ï‰πüÊòØ‰∏ÄÊ†∑ÁöÑ constant_NameAndType_infoÊåáÂêëÁ¥¢ÂºïÂÄº‰∏∫7Âíå8ÁöÑÂÜÖÂÆπ ÂèØ‰ª•Áü•ÈÅìÊñπÊ≥ïÂêçÁß∞‰∏∫initÔºåÁ±ªÂûã‰∏∫voidÊñπÊ≥ï Âà∞ÁõÆÂâç‰∏∫Ê≠¢Êàë‰ª¨Â§ßÊ¶ÇÂèØ‰ª•Áü•ÈÅìÊ≠§Â∏∏ÈáèÊ±†ÁöÑÁ¨¨‰∏ÄÈ°πË°®Á§∫ÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™Êó†ÂèÇÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºåÂπ∂‰∏îÊòØÁºñËØëÂô®‰∏∫Êàë‰ª¨Ëá™Âä®ÁîüÊàêÁöÑ ÂÖ∂ÂÆûÂ§ßÂ§öÊï∞Â§çÊùÇÁöÑÂ∏∏ÈáèÊ±†ÂÜÖÂÆπÊúÄÁªàÈÉΩ‰ºöÁ¥¢ÂºïÂà∞‰∏Ä‰∏™constant_utf8_infoÂ≠óÁ¨¶‰∏≤Á±ªÂûãÔºåÁî®‰∫éÊèèËø∞Á±ªÂÖ®ÈôêÂÆöÂêçÔºåÊñπÊ≥ïÊàñÂ≠óÊÆµÂêçÁß∞ÂèäÊèèËø∞Á¨¶Á≠âÁ≠â .. Â∞æË®ÄÊú¨ÁØáÊñáÁ´†Êàë‰ª¨Âè™ÊòØÈÄöËøá‰∏Ä‰∏™Á§∫‰æãÊù•ÈòÖËØªClassÊñá‰ª∂ÁöÑÂ∏∏ÈáèÊ±†ÂÜÖÂÆπÔºåÂÖ∑‰ΩìÁöÑÂ∏∏ÈáèÊ±†ÁªìÊûÑÂú®‰∏äÁØáÊñáÁ´†‰∏≠Êàë‰ª¨ÈÉΩÊúâÂàóÂá∫ÔºåÂπ∂‰∏îÈòÖËØªÁöÑÊñπÊ≥ï‰πüÊòØ‰∏éÊú¨ÊñáÁ±ª‰ºº„ÄÇ]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>JVM</category>
        <category>javaÂ≠óËäÇÁ†Å</category>
      </categories>
      <tags>
        <tag>JVM</tag>
        <tag>javaÂ≠óËäÇÁ†Å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java ClassÊñá‰ª∂ÁªìÊûÑ]]></title>
    <url>%2F2019%2F04%2F04%2FJava-Class%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÊàë‰ª¨ÈÉΩÁü•ÈÅìjavaÊòØË∑®Âπ≥Âè∞ÁöÑÔºåÂéüÂõ†Â∞±Âú®‰∫éÂêÑ‰∏™Âπ≥Âè∞ÁöÑjavaËôöÊãüÊú∫ÂèØ‰ª•ËΩΩÂÖ•ÂíåÊâßË°åÂêå‰∏ÄÁßçÂπ≥Âè∞Êó†ÂÖ≥ÁöÑÂ≠óËäÇÁ†ÅÊñá‰ª∂Ôºå‰πüÂ∞±ÊòØËØ¥javaËôöÊãüÊú∫‰∏ç‰∏éÂåÖÊã¨JavaÂú®ÂÜÖÁöÑ‰ªª‰ΩïËØ≠Ë®ÄÁªëÂÆöÔºåÂè™‰∫éClassÊñá‰ª∂ËøôÁßç‰∫åËøõÂà∂Ê†ºÂºèÊñá‰ª∂ÊâÄÂÖ≥ËÅî„ÄÇ Âü∫‰∫éËøôÊ†∑ÁöÑËÆæËÆ°ÔºåÂà∞ÁõÆÂâç‰∏∫Ê≠¢Â∑≤ÁªèÂá∫Áé∞‰∫ÜÂæàÂ§öÂü∫‰∫éJavaËôöÊãüÊú∫ÁöÑËØ≠Ë®Ä Â¶ÇgroovyÊúÄÁªàÈÉΩ‰ºöÁºñËØëÊàêclassÊñá‰ª∂ ClassÊñá‰ª∂ÁªìÊûÑ‰∏Ä‰∏™ClassÊñá‰ª∂ÂîØ‰∏ÄÂØπÂ∫î‰∏Ä‰∏™Á±ªÊàñÊé•Âè£ Áé∞Âú®ËÆ©Êàë‰ª¨Êù•Áúã‰∏ãClassÊñá‰ª∂ÁöÑÂü∫Êú¨ÁªìÊûÑ ClassÊñá‰ª∂‰ª•8‰ΩçÂ≠óËäÇ‰∏∫Âü∫Êú¨Âçï‰ΩçÁöÑ‰∫åËøõÂà∂Êñá‰ª∂ÔºåÂêÑ‰∏™Êï∞ÊçÆÈ°πÁõÆ‰∏•Ê†ºÁöÑÊåâÁÖßÈ°∫Â∫èÁ¥ßÂáëÁöÑÊéíÂàóÂú®ClassÊñá‰ª∂‰πã‰∏≠Ôºå‰∏≠Èó¥Ê≤°Êúâ‰ªª‰ΩïÂàÜÈöîÁ¨¶ÔºåËøô‰ΩøÂæóÊï¥‰∏™ClassÊñá‰ª∂‰∏≠Â≠òÂÇ®ÁöÑÂÜÖÂÆπÂá†‰πéÂÖ®ÈÉ®ÊòØËøêË°åÊó∂ÁöÑÂøÖË¶ÅÊï∞ÊçÆ ClassÊñá‰ª∂ÁöÑ‰∫åËøõÂà∂Êñá‰ª∂Âè™Êúâ‰∏§ÁßçÊï∞ÊçÆÁ±ªÂûãÔºöÊó†Á¨¶Âè∑Êï∞ÂíåË°®ÔºåÂêéÈù¢ÁöÑËß£ÊûêÈÉΩ‰ºö‰ª•Ëøô‰∏§ÁßçÊï∞ÊçÆÁ±ªÂûã‰∏∫Âü∫Á°Ä Êó†Á¨¶Âè∑Êï∞ Êó†Á¨¶Âè∑Êï∞ÊòØÊúÄÂü∫Êú¨ÁöÑÊï∞ÊçÆÁ±ªÂûãÔºå‰ª•u1,u2,u4,u8Êù•ÂàÜÂà´‰ª£Ë°®1‰∏™Â≠óËäÇÔºå2‰∏™Â≠óËäÇÔºå4‰∏™Â≠óËäÇÔºå8‰∏™Â≠óËäÇÁöÑÊó†Á¨¶Âè∑Êï∞ÔºåÊó†Á¨¶Âè∑Êï∞Áî®Êù•ÊèèËø∞Êï∞Â≠óÔºåÁ¥¢ÂºïÂºïÁî®ÔºåÊï∞ÈáèÂÄºÔºå‰ª•Âèä‰ª•UTF-8ÁºñÁ†ÅÁöÑÂ≠óÁ¨¶‰∏≤ Ë°® Ë°®ÂàôÊòØÁî±Â§ö‰∏™Êó†Á¨¶Âè∑Êï∞ÊàñÂÖ∂‰ªñË°®ÁªÑÊàêÁöÑÂ§çÂêàÊï∞ÊçÆÁªìÊûÑÔºåË°®ÁöÑÂêçÁß∞‰∏ÄËà¨‰ª•_infoÁªìÂ∞æ„ÄÇÊâÄ‰ª•Êï¥‰∏™ClassÊñá‰ª∂ÂÖ∂ÂÆûÂ∞±ÊòØ‰∏ÄÂº†ÁâπÊÆäÁöÑË°® ‰∏ãÈù¢Ë°®‰∏≠ÊâÄÂàóÁöÑÂ∞±ÊòØ‰∏Ä‰∏™ClassÊåâÈ°∫Â∫èÊéíÂàóÁöÑÊï∞ÊçÆÁªìÊûÑ Á±ªÂûã ÂêçÁß∞ Êï∞Èáè u4 magic È≠îÊï∞ Ê†áËØÜClassÊñá‰ª∂ 1 u2 minor_version Ê¨°ÁâàÊú¨Âè∑ 1 u2 major_version ‰∏ªÁâàÊú¨Âè∑ 1 u2 constant_pool_count Â∏∏ÈáèË°®ÈõÜÂêàÊï∞Èáè 1 cp_info constant_pool Â∏∏ÈáèË°® constant_pool_count - 1 u2 access_flag ËÆøÈóÆÊ†áËØÜ 1 u2 this_class Á±ªÁ¥¢Âºï 1 u2 super_class Áà∂Á±ªÁ¥¢Âºï 1 u2 interfaces_count Êé•Âè£Á¥¢ÂºïÊï∞Èáè 1 u2 interfaces Êé•Âè£Á¥¢Âºï interfaces_count u2 fields_count Â≠óÊÆµË°®ÈõÜÂêàÊï∞Èáè 1 field_info fields Â≠óÊÆµË°® fields_count u2 methods_count ÊñπÊ≥ïË°®ÈõÜÂêàÊï∞Èáè 1 method_info methods ÊñπÊ≥ïË°® methods_count u2 attributes_count Â±ûÊÄßË°®ÈõÜÂêàÊï∞Èáè 1 attribute_info attributes Â±ûÊÄßË°® attributes_count ‰∏ãÈù¢‰æùÊ¨°Êù•Ëß£ËØªË°®‰∏≠ÊØè‰∏™Á±ªÂûã È≠îÊï∞ÂíåÁâàÊú¨Âè∑Â§¥4‰∏™Â≠óËäÇÁß∞‰∏∫ClassÊñá‰ª∂ÁöÑÈ≠îÊï∞ÔºåÈ≠îÊï∞ÁöÑ‰ΩúÁî®ÊòØÊ†áËØÜÊ≠§Êñá‰ª∂ËÉΩË¢´JavaËôöÊãüÊú∫Êé•ÂèóÁöÑClassÊñá‰ª∂ÔºåÂÖ∂ÂÆû‰∏çÊ≠¢ClassÊñá‰ª∂ÊúâÈ≠îÊï∞Ëøô‰∏™Ê¶ÇÂøµÔºåÂåÖÊã¨ÂÖ∂‰ªñÂæàÂ§öÊñá‰ª∂Ê†ºÂºèÂá∫‰∫éÂÆâÂÖ®ÁöÑËÄÉËôë‰πüÈÉΩ‰ºöÊúâÈ≠îÊï∞Ëøô‰∏™Ê¶ÇÂøµÔºåÈ≠îÊï∞ÈÉΩÊòØÂõ∫ÂÆö‰∏çÂèòÁöÑÔºåÂ¶ÇClassÊñá‰ª∂ÁöÑÈ≠îÊï∞Â∞±ÊòØcafebabe Á¥ßÊé•ÁùÄÈ≠îÊï∞‰πãÂêéÁöÑÊòØÁâàÊú¨Âè∑ÔºåÁ¨¨5 6‰∏™Â≠óËäÇË°®Á§∫ÁöÑÊòØÊ¨°ÁâàÊú¨Âè∑ÔºåÁ¨¨7 8‰∏™Â≠óËäÇË°®Á§∫ÁöÑÊòØ‰∏ªÁâàÊú¨Âè∑„ÄÇÁâàÊú¨Âè∑ÈÉΩÊòØÂêë‰∏ãÂÖºÂÆπÁöÑ Â∏∏ÈáèÊ±†Ë°®ËØªÊáÇÂ∏∏ÈáèÊ±†Ë°®ÂØπ‰∫éÈòÖËØªClassÂ≠óËäÇÁ†ÅÈùûÂ∏∏ÈáçË¶ÅÔºå‰∏ãÈù¢Êàë‰ª¨Â∞Ü‰ª•Â§ßÁØáÂπÖÂàÜÊûêÂ∏∏ÈáèÊ±†Ë°® Â∏∏ÈáèÊ±†ÊòØClassÊñá‰ª∂‰∏≠Âá∫Áé∞ÁöÑÁ¨¨‰∏Ä‰∏™Ë°®ÁªìÊûÑÁ±ªÂûãÔºåÂêåÊó∂‰πüÊòØÂç†Áî®ClassÊñá‰ª∂ÊúÄÂ§ßÁ©∫Èó¥ÁöÑÁ±ªÂûã‰πã‰∏Ä„ÄÇÁî±‰∫éÂ∏∏ÈáèÊ±†Ë°®ÁöÑÊï∞Èáè‰∏çÊòØÂõ∫ÂÆöÁöÑÔºåÊâÄ‰ª•Âú®Â∏∏ÈáèÊ±†ÁöÑÂÖ•Âè£Êúâ‰∏ÄÈ°πu2Á±ªÂûãÁöÑÊï∞ÊçÆÔºåÊù•‰ª£Ë°®Â∏∏ÈáèÊ±†ÁöÑÊï∞Èáè„ÄÇÂπ∂‰∏îÂ∏∏ÈáèÊ±†ÊØîËæÉÁâπÊÆäÔºåÂÆπÈáèËÆ°Êï∞ÊòØ‰ªé1ÂºÄÂßãËÄå‰∏çÊòØ‰ªé0ÂºÄÂßãÔºåÊâÄ‰ª•ÂÆûÈôÖÁöÑÂ∏∏ÈáèÊ±†Êï∞ÈáèÊòØconstant_pool_count - 1 Â∏∏ÈáèÊ±†‰∏≠‰∏ªË¶ÅÂ≠òÊîæ‰∏§Â§ßÁ±ªÂèòÈáè: Â≠óÈù¢ÈáèÂíåÁ¨¶Âè∑ÂºïÁî®„ÄÇÂ≠óÈù¢ÈáèÁ±ª‰ººÂ∏∏ÈáèÁöÑÊ¶ÇÂøµÔºåËÄåÁ¨¶Âè∑ÂºïÁî®ÂàôÂºïËá≥ÁºñËØëÂéüÁêÜÁöÑÊ¶ÇÂøµÔºåÂåÖÊã¨‰∏âÁ±ª(Á±ªÂíåÊé•Âè£ÁöÑÂÖ®ÈôêÂÆöÂêçÔºåÂ≠óÊÆµÁöÑÂêçÁß∞ÂíåÊèèËø∞Á¨¶ÔºåÊñπÊ≥ïÁöÑÂêçÁß∞ÂíåÊèèËø∞Á¨¶)ÔºåËøôÈáåË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåJavaÂú®javacÁºñËØëÁöÑÊó∂ÂÄô‰∏ç‰ºöËøõË°åClassÊñá‰ª∂ÁöÑÂä®ÊÄÅËøûÊé•ÔºåÂè™ÊúâÂú®ËøêË°åÊó∂Êâç‰ºöËøõË°åÂÖ∑‰ΩìÁöÑClassÊñá‰ª∂ÁöÑËß£ÊûêÊìç‰Ωú Â∏∏ÈáèÊ±†Ë°®ÁªìÊûÑ‰∏äÊñá‰∏§Â§ßÁ±ªÁöÑÂ∏∏ÈáèÊ±†Á±ªÂûãÁªÜÂàÜ‰πãÂêéÔºåÂà∞JDK1.7‰πãÂêéÂ¢ûÂä†Âà∞‰∫Ü14Áßç„ÄÇ‰πãÊâÄ‰ª•ËØ¥Â∏∏ÈáèÊ±†ÊòØÊúÄÂ§çÊùÇÁöÑÁªìÊûÑÔºåÂ∞±ÊòØÂõ†‰∏∫Ëøô14Áßç‰∏çÂêåÁöÑÁ±ªÂûãÈÉΩÊúâ‰∏çÂêåÁöÑË°®ÁªìÊûÑÔºå‰∏ãÈù¢Êàë‰ª¨Êù•ÁÆÄÂçïÁúã‰∏ãËøô14ÁßçÁªìÊûÑ ÊØèÁßçÂ∏∏ÈáèÁ±ªÂûãÁöÑËµ∑Âßã‰ΩçÈÉΩÊúâ‰∏Ä‰∏™u1Á±ªÂûãÁöÑtagÊ†áËØÜÁ¨¶ÔºåÁî®‰∫éÊ†áËØÜÂΩìÂâçÁöÑÂ∏∏ÈáèÁ±ªÂûã ËÆøÈóÆÊ†áÂøóËÆøÈóÆÊ†áÂøóÁî®‰∫éËØÜÂà´Á±ªÊàñÊé•Âè£Â±ÇÈù¢ÁöÑ‰ø°ÊÅØÔºåÊ†áËØÜÊòØÂê¶‰∏∫publicÔºåabstractÔºåfinalÔºåÊ≥®Ëß£ÔºåÊûö‰∏æÁ≠â Á±ªÁ¥¢Âºï Áà∂Á±ªÁ¥¢Âºï Êé•Âè£Á¥¢ÂºïÁ±ªÁ¥¢ÂºïÂíåÁà∂Á±ªÁ¥¢ÂºïÈÉΩÊòØ‰∏Ä‰∏™u2Á±ªÂûãÁöÑÊï∞ÊçÆÔºåËÄåÊé•Âè£Á¥¢ÂºïÂàôÊòØ‰∏ÄÁªÑu2Á±ªÂûãÁöÑÈõÜÂêàÔºåÊâÄ‰ª•Êé•Âè£Á¥¢ÂºïÂÖ•Âè£ÁöÑÁ¨¨‰∏ÄÈ°π‰∏∫‰∏Ä‰∏™u2Á±ªÂûãÁöÑËÆ°Êï∞ÔºåË°®Á§∫ÊúâÂá†‰∏™Êé•Âè£Á¥¢Âºï Á±ªÁ¥¢ÂºïÂíåÊé•Âè£Á¥¢ÂºïÁöÑÂÖ∑‰ΩìÂÄºÊòØ‰∏Ä‰∏™u2ÁöÑÊï∞ÊçÆÈ°πÔºåÂπ∂‰∏îÊåáÂêë‰∏Ä‰∏™CONSTANT_Class_infoÂ∏∏ÈáèÊ±†Ë°®Á±ªÂûãÂú®Â∏∏ÈáèÊ±†‰∏≠ÁöÑÂÅèÁßªÈáè Â≠óÊÆµË°®ÈõÜÂêàÂ≠óÊÆµË°®Áî®‰∫éÊèèËø∞Êé•Âè£ÊàñÁ±ª‰∏≠Â£∞ÊòéÁöÑÂèòÈáèÔºåÂåÖÊã¨Á±ªÁ∫ßÂèòÈáèÂíåÂÆûÈôÖÁ∫ßÂèòÈáèÔºå‰∏çÂåÖÊã¨Âú®ÊñπÊ≥ïÂÜÖÈÉ®Â£∞ÊòéÁöÑÂ±ÄÈÉ®ÂèòÈáè ÂåÖÂê´ÁöÑ‰ø°ÊÅØ‰∏ªË¶ÅÊúâËøôÂá†Áßç: Â≠óÊÆµ‰ΩúÁî®Âüü(private,protact,public)ÔºåÊòØÂê¶static‰øÆÈ•∞ÔºåÂèØÂèòÊÄßÔºåvolatile ‰øÆÈ•∞ÔºåÂèØÂê¶Ë¢´Â∫èÂàóÂåñÔºåÂ≠óÊÆµÁ±ªÂûã(Âü∫Êú¨Á±ªÂûãÔºåÂºïÁî®ÔºåÊï∞ÁªÑ)ÔºåÂ≠óÊÆµÂêçÁß∞ Â≠óÊÆµË°®ÁªìÊûÑ Á±ªÂûã ÂêçÁß∞ Êï∞Èáè u2 access_flas 1 u2 name_index 1 u2 descriptor_index 1 u2 attributes_count 1 attribute_info Â±ûÊÄßË°® attributes_count access_flasÊàë‰ª¨Êù•Áúã‰∏ãÂ≠óÊÆµaccess_flasËÆøÈóÆÊ†áËØÜÂèØÈÄâÁöÑÁ±ªÂûã Ê†áÂøóÂêçÁß∞ Ê†áÂøóÂÄº Âê´‰πâ ACC_PUBLIC 0x0001 Â≠óÊÆµÊòØÂê¶public ACC_PRIVARE 0x0002 Â≠óÊÆµÊòØÂê¶private ACC_PROTECTED 0x0004 Â≠óÊÆµÊòØÂê¶protected ACC_STATIC 0x0008 Â≠óÊÆµÊòØÂê¶static ACC_FINAL 0x0010 Â≠óÊÆµÊòØÂê¶final ACC_VOLATILE 0x0040 Â≠óÊÆµÊòØÂê¶volatile ACC_TRANSIENT 0x0080 ÊòØÂê¶ transient ACC_SYNTHETIC 0x1000 Â≠óÊÆµÁî±ÁºñËØëÂô®Ëá™Âä®‰∫ßÁîü ACC_ENUM 0x4000 Â≠óÊÆµÊòØÂê¶‰∏∫Êûö‰∏æÁ±ªÂûã Áúã‰∏™‰æãÂ≠êÔºåÂ¶ÇÊûúaccess_flas‰∏∫0x0019ÔºåÂàôÊ†áËØÜ‰∫ÜACC_PUBLICÔºåACC_STATICÔºåACC_FINAL‰∏âÁßçÁ±ªÂûã name_indexÂíådescriptor_indexË∑üÂú®access_flas‰πãÂêéÊòØname_index(ÁÆÄÂçïÂêçÁß∞)Âíådescriptor_index(ÊèèËø∞Á¨¶)„ÄÇÂåÖÊã¨‰πãÂâçÂá∫Áé∞ÁöÑÂÖ®ÈôêÂÆöÂêçÔºåËøôÈáåËß£Èáä‰∏Ä‰∏ãËøôÂá†‰∏™ÂêçÁß∞„ÄÇÂÖ®ÈôêÂÆöÂêçÁß∞‰∏ÄËà¨Êù•ËØ¥ÊòØÊåáorg/xxx/TestClassËøôÁßçÁ±ªÂûãÁöÑÂêçÁß∞ÔºåÂèØ‰ª•ÁêÜËß£‰∏∫Á±ªÁöÑË∑ØÂæÑÔºåÁÆÄÂçïÂêçÁß∞Â∞±Êõ¥Âä†ÂÆπÊòìÁêÜËß£‰∫ÜÔºå‰æãÂ¶ÇÊñπÊ≥ïinc()ÁöÑÁÆÄÂçïÂêçÁß∞ÂÄºÁöÑÂ∞±ÊòØinc ÊèèËø∞Á¨¶Áõ∏ÂØπ‰∫é‰∏äÈù¢ÁöÑ‰∏§ÁßçÁ®çÂ§çÊùÇ‰∏Ä‰∫õÔºåÊèèËø∞Á¨¶ÁöÑ‰ΩúÁî®ÊòØÁî®Êù•ÊèèËø∞Â≠óÊÆµÁöÑÊï∞ÊçÆÁ±ªÂûãÔºåÊñπÊ≥ïÁöÑÂèÇÊï∞ÂàóË°®ÂíåËøîÂõûÂÄºÔºåÊ†πÊçÆÊèèËø∞Á¨¶ËßÑÂàôÔºåÂü∫Êú¨Êï∞ÊçÆÁ±ªÂûãÔºàbyte,char,int,long,float,double,short,booleanÔºâ‰ª•Âèä‰ª£Ë°®Êó†ËøîÂõûÂÄºÁöÑvoidÁ±ªÂûãÈÉΩÁî®‰∏Ä‰∏™Â§ßÂÜôÂ≠óÁ¨¶Êù•Ë°®Á§∫ÔºåËÄåÂØπË±°Á±ªÂûãÂàôÁî®LÂä†ÂØπË±°ÁöÑÂÖ®ÈôêÂÆöÂêçÊù•Ë°®Á§∫ ÂÖ∑‰ΩìÁöÑÂàóÂú®‰∫Ü‰∏ãË°®‰∏≠ Ê†áËØÜÂ≠óÁ¨¶ Âê´‰πâ B byte C char D double F float I int J long S short Z boolean V void L ÂØπË±°Á±ªÂûã Â¶Ç Ljava/lang/Object ÂØπ‰∫éÊï∞ÁªÑÁ±ªÂûãÔºåÊØè‰∏ÄÁ∫¨Â∫¶‰ΩøÁî®‰∏Ä‰∏™ÂâçÁΩÆÁöÑ[Êù•Ë°®Á§∫ÔºåÂ¶ÇÂÆö‰πâ‰∏Ä‰∏™java.lang.String []ÁöÑÊï∞ÁªÑÁ±ªÂûãÔºåÂ∞ÜË¢´ËÆ∞ÂΩï‰∏∫[[Ljava/lang/String; Áî®ÊèèËø∞Á¨¶Êù•ÊèèËø∞ÊñπÊ≥ïÊó∂ÔºåÊåâÁÖßÂÖàÂèÇÊï∞ÂàóË°®ÂêéËøîÂõûÂÄºÁöÑÈ°∫Â∫èÊèèËø∞ÔºåÂèÇÊï∞ÂàóË°®‰∏•Ê†ºÊåâÁÖßÈ°∫Â∫èÊîæÂú®()ÂÜÖÔºåÂ¶ÇÊñπÊ≥ïvoid inc()ÁöÑÊèèËø∞Á¨¶‰∏∫()VÔºåÊñπÊ≥ïint inc(int i, double)ÁöÑÊèèËø∞Á¨¶‰∏∫(ID)I Âú®ÊèèËø∞Á¨¶‰πãÂêéÔºåÁ¥ßË∑üÁùÄÊòØ‰∏Ä‰∏™Â±ûÊÄßË°®ÈõÜÂêàÔºåÂ±ûÊÄßË°®ÈõÜÂêàÂèØ‰ª•‰∏∫Á©∫Ôºå ÊñπÊ≥ïË°®ÊñπÊ≥ïË°®ÁöÑÁªÑÊàê‰∏éÂ±ûÊÄßË°®ÁöÑÁªÑÊàêÊòØÂÆåÂÖ®‰∏ÄËá¥ÁöÑÔºåËÆøÈóÆÊ†áËØÜÁ¨¶ÁöÑÂèñÂÄºÁï•Êúâ‰∏çÂêå Ê†áÂøóÂêçÁß∞ Ê†áÂøóÂÄº Âê´‰πâ ACC_PUBLIC 0x0001 ÊñπÊ≥ïÊòØÂê¶public ACC_PRIVARE 0x0002 ÊñπÊ≥ïÊòØÂê¶private ACC_PROTECTED 0x0004 ÊñπÊ≥ïÊòØÂê¶protected ACC_STATIC 0x0008 ÊñπÊ≥ïÊòØÂê¶static ACC_FINAL 0x0010 ÊñπÊ≥ïÊòØÂê¶final ACC_SYNCHRONIZED 0x0020 ÊñπÊ≥ïÊòØÂê¶ÂêåÊ≠• ACC_BRIDGE 0x0040 ÊñπÊ≥ïÊòØÂê¶Áî±ÁºñËØëÂô®‰∫ßÁîüÁöÑÊ°•Êé•ÊñπÊ≥ï ACC_VARARGS 0x0080 ÊñπÊ≥ïÊòØÂê¶Êé•Âèó‰∏çÂÆöËöïÈ£ü ACC_NATIVE 0x0100 ÊñπÊ≥ïÊòØÂê¶‰∏∫native ACC_ABSTRACT 0x0400 ÊñπÊ≥ïÊòØÂê¶‰∏∫abstract ACC_STRICTFP 0x0800 ÊñπÊ≥ïÊòØÂê¶‰∏∫strictfp SYNTHETIC 0x1000 ÊñπÊ≥ïÁî±ÁºñËØëÂô®Ëá™Âä®‰∫ßÁîü ÈÇ£‰πàËøôÈáåÂ§ßÂÆ∂ÂèØËÉΩ‰ºöÊúâÁñëÈóÆÔºåÊñπÊ≥ïÈáåÁöÑjava‰ª£Á†ÅÂéªÂì™‰∫ÜÂë¢Ôºü Á≠îÊ°àÂ∞±ÊòØÂú®ÊñπÊ≥ïË°®ÁöÑÂ±ûÊÄßË°®ÈõÜÂêà‰∏≠ÔºåÊúâ‰∏Ä‰∏™codeÂ±ûÊÄßÔºåÈÇ£ÈáåÂ≠òÊîæ‰∫ÜÁºñËØëÊàêÂ≠óËäÇÁ†ÅÁöÑJava‰ª£Á†Å„ÄÇÂØπ‰∫éÂ±ûÊÄßË°®ÔºåÂú®‰∏ãÊñá‰ºöÊèêÂà∞ Â±ûÊÄßË°®Â±ûÊÄßË°®ÔºåÂâçÊñáÂ∑≤ÁªèÊèêÂà∞‰∫ÜÂ§öÊ¨°„ÄÇÂåÖÊã¨ClassÊñá‰ª∂Êú¨Ë∫´ÔºåÊñπÊ≥ïË°®ÔºåÂ≠óÊÆµË°®ÈÉΩÊúâÊê∫Â∏¶Ëá™Â∑±ÁöÑÂ±ûÊÄßË°®ÈõÜÂêàÔºåÁî®‰∫éÊèèËø∞‰∏ìÊúâÂú∫ÊôØ‰ø°ÊÅØ Âπ∂‰∏îÂ±ûÊÄßË°®‰∏éClassÊñá‰ª∂ÂÖ∂‰ªñÊï∞ÊçÆÈ°πË¶ÅÊ±Ç‰∏çÂêåÔºåÂêÑ‰∏™Â±ûÊÄß‰∏çË¶ÅÊ±Ç‰∏•Ê†ºÁöÑÈ°∫Â∫èÔºåÂπ∂‰∏îÂè™Ë¶Å‰∏ç‰∏éÂ∑≤ÊúâÂ±ûÊÄßÂêçÈáçÂ§çÔºå‰ªª‰Ωï‰∫∫ÂÆûÁé∞ÁöÑÁºñËØëÂô®ÈÉΩÂèØ‰ª•ÂêëÂ±ûÊÄßË°®‰∏≠ÂÜôÂÖ•Ëá™Â∑±ÂÆö‰πâÁöÑÂ±ûÊÄß‰ø°ÊÅØ ‰∏ãÈù¢Êàë‰ª¨Êù•ÁúãÂá†‰∏™ÂÖ≥ÈîÆÂ±ûÊÄß code Â±ûÊÄßjavaÁ®ãÂ∫èÊñπÊ≥ï‰Ωì‰∏≠ÁöÑ‰ª£Á†ÅjavacÁºñËØëÂô®Â§ÑÁêÜÂêéÔºåÊúÄÁªàÂèò‰∏∫Â≠óËäÇÁ†ÅÂ≠ê‰ª§Â≠òÂÇ®Âú®CodeÂ±ûÊÄßÂÜÖ Exceptions Â±ûÊÄßÂàó‰∏æÊñπÊ≥ïÂèØËÉΩ‰ºöÊäõÂá∫ÁöÑÂºÇÂ∏∏ LineNumberTable Â±ûÊÄßÊèèËø∞javaÊ∫êÁ†ÅË°åÊï∞ÂíåÂ≠óËäÇÁ†ÅË°åÊï∞ÁöÑÂØπÂ∫îÂÖ≥Á≥ªÔºåÂâçËÄÖÊòØÂ≠óËäÇÁ†ÅË°åÔºåÂêéËÄÖÊòØÊ∫êÁ†ÅË°å LocalVariableTable Â±ûÊÄßÊèèËø∞Ê†àÂ±ÄÈÉ®ÂèòÈáèÂíåÊ∫êÁ†Å‰∏≠ÂÆö‰πâÁöÑÂèòÈáèÁöÑÂÖ≥Á≥ª.ËøôÈ°πÊòØÂèØÈÄâÁöÑÔºåÂèØ‰ΩøÁî®javac -g:noneÊàñjavac -g:varsÂëΩ‰ª§ÂÖ≥Èó≠ÁîüÊàêËøôÈ°π‰ø°ÊÅØ SourceFile Â±ûÊÄßÁî®‰∫éËÆ∞ÂΩïClassÊ∫êÁ†ÅÊñá‰ª∂ÁöÑÊñá‰ª∂ÂêçÁß∞ÔºåËøô‰∏™Â±ûÊÄßÊòØÂèØÈÄâÁöÑ„ÄÇÂèØ‰ΩøÁî®javac -g:noneÊàñjavac -g:sourceÂëΩ‰ª§ÂÖ≥Èó≠ÁîüÊàêËøôÈ°π‰ø°ÊÅØ ConstantValue Â±ûÊÄßÈÄöÁü•ËôöÊãüÊú∫‰∏∫ÈùôÊÄÅÂèòÈáèËµãÂÄº InnerClasses Â±ûÊÄßÁî®‰∫éËÆ∞ÂΩïÂÜÖÈÉ®Á±ª‰∏éÂÆø‰∏ªÁ±ª‰πãÈó¥ÁöÑÂÖ≥Á≥ª Deprecated Synthetic Â±ûÊÄßDeprecated Ê†áËØÜÊüê‰∏™Á±ªÔºåÂ≠óÊÆµÊàñÊñπÊ≥ïËøáÊúüSynthetic Ê†áËØÜÊ≠§Â≠óÊÆµ‰∏çÁî±JavaÊ∫êÁ†ÅÁõ¥Êé•‰∫ßÁîüÔºåÁî±ÁºñËØëÂô®Ëá™Âä®Ê∑ªÂä† StackMapTable Â±ûÊÄßËøô‰∏™Â±ûÊÄß‰ºöÂú®ËôöÊãüÊú∫Âä†ËΩΩÂÆåÂ≠óËäÇÁ†ÅÂêéÁöÑÈ™åËØÅÈò∂ÊÆµË¢´‰ΩøÁî® Signature Â±ûÊÄßSignatureÂú®JDK1.5‰πãÂêéË¢´Ê∑ªÂä†ÔºåÁî®‰∫éËÆ∞ÂΩïÊ≥õÂûãÁ≠æÂêç‰ø°ÊÅØ„ÄÇ‰πãÊâÄ‰ª•Ë¶ÅÁî®Ëøô‰πà‰∏Ä‰∏™Â±ûÊÄßÂéªËÆ∞ÂΩïÊ≥õÂûã‰ø°ÊÅØÔºåÊòØÂõ†‰∏∫JavaËØ≠Ë®ÄÁöÑÊ≥õÂûãÈááÁî®ÁöÑÊòØÊì¶Èô§Ê≥ïÂÆûÁé∞ÁöÑ‰º™Ê≥õÂûãÔºåÂú®CodeÂ±ûÊÄß‰∏≠ÔºåÊ≥õÂûã‰ø°ÊÅØÂú®ÁºñËØë‰πãÂêéÁªüÁªüÈÉΩË¢´Êì¶Èô§Êéâ‰∫Ü„ÄÇ‰ΩøÁî®ÁöÑÊì¶Èô§Ê≥ïÁöÑÂéüÂõ†ÊòØËøôÊ†∑Â≠êÂÆûÁé∞ÊØîËæÉÁÆÄÂçïÔºåÂè™ÈúÄË¶Å‰øÆÊîπjavacÁºñËØëÂô®Â∞±ÂèØ‰ª•ÂÆûÁé∞‰∫ÜÔºåËøêË°åÊó∂‰πüÂèØ‰ª•ËäÇÁúÅ‰∏Ä‰∫õÁ©∫Èó¥„ÄÇÂùèÂ§ÑÂ∞±ÊòØËøêË°åÊó∂Êó†Ê≥ïÊãøÂà∞Ê≥õÂûã‰ø°ÊÅØ„ÄÇSignatureÂ∞±ÊòØ‰∏∫‰∫ÜÂº•Ë°•Ëøô‰∏™Áº∫Èô∑ËÄåËÆæÁΩÆÁöÑÔºåÁé∞Âú®ÁöÑJava APIÂèçÂ∞ÑËÉΩÂ§üËé∑ÂèñÂà∞ÁöÑÊ≥õÂûã‰ø°ÊÅØ‰πüÊù•Ëá™Ëøô‰∏™Â±ûÊÄß BootStrapMathods Â±ûÊÄßBootStrapMathodsÊòØJDK 1.7‰πãÂêéÂ¢ûÂä†Âà∞ËßÑËåÉ‰∏≠ÁöÑÔºåËøô‰∏™Â±ûÊÄßÁî®‰∫é‰øùÂ≠òinvokedynamicÊåá‰ª§ÂºïÁî®ÁöÑÂºïÂØºÊñπÊ≥ïÈôêÂÆöÁ¨¶„ÄÇÊú¨ÁØáÊñáÁ´†ÊöÇ‰∏çËµòËø∞Ëøô‰∏™Êåá‰ª§]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>JVM</category>
        <category>javaÂ≠óËäÇÁ†Å</category>
      </categories>
      <tags>
        <tag>JVM</tag>
        <tag>javaÂ≠óËäÇÁ†Å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaÁ±ªÂä†ËΩΩÊú∫Âà∂]]></title>
    <url>%2F2019%2F04%2F02%2FJava%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰ªãÁªç‰∏Ä‰∏ãjavaÁ±ªÂä†ËΩΩÁöÑËøáÁ®ã Á±ªÂä†ËΩΩÁöÑÊó∂Êú∫Á±ª‰ªéË¢´Âä†ËΩΩÂà∞javaËôöÊãüÊú∫ÂÜÖÂ≠ò‰∏≠ÂºÄÂßãÔºåË¢´ÂàÜ‰∏∫7‰∏™Èò∂ÊÆµÔºåÂåÖÊã¨Âä†ËΩΩÔºåÈ™åËØÅÔºåÂáÜÂ§áÔºåËß£ÊûêÔºåÂàùÂßãÂåñÔºå‰ΩøÁî®ÔºåÂç∏ËΩΩ ËøôÈáåÊàë‰ª¨ÊöÇ‰∏î‰∏ªË¶ÅÁúãÂä†ËΩΩÈò∂ÊÆµÂíåÂàùÂßãÂåñÈò∂ÊÆµÔºåjavaËôöÊãüÊú∫‰∏ªË¶ÅÊòØÂÅö‰∫Ü‰∏â‰ª∂‰∫ãÊÉÖ Âä†ËΩΩ ÈÄöËøáÁ±ªÁöÑÂÖ®ÈôêÂÆöÂêçËé∑ÂèñÂÆö‰πâÊ≠§Á±ªÁöÑ‰∫åËøõÂà∂Â≠óËäÇÊµÅ Â∞ÜËøô‰∏™Â≠óËäÇÊµÅÊâÄ‰ª£Ë°®ÁöÑÈùôÊÄÅÂ≠òÂÇ®ÁªìÊûÑËΩ¨Âåñ‰∏∫ÊñπÊ≥ïÂå∫ÁöÑËøêË°åÊó∂Êï∞ÊçÆÁªìÊûÑ Âú®ÂÜÖÂ≠ò‰∏≠ÁîüÊàê‰∏Ä‰∏™‰ª£Ë°®Ëøô‰∏™Á±ªÁöÑClassÂØπË±° Ê≥®ÊÑèËøôÈáåËôöÊãüÊú∫Âπ∂Ê≤°ÊúâËßÑÂÆöÁ±ªÁöÑ‰∫åËøõÂà∂Â≠óËäÇÊµÅÁöÑÊù•Ê∫êÔºåÊâÄ‰ª•Êàë‰ª¨ÂÖ∂ÂÆûÈÄöËøáËá™ÂÆö‰πâÁ±ªÂä†ËΩΩÂô®Êù•ÂÆûÁé∞‰ªéÂÖ∂‰ªñÈÄîÂæÑÔºàÂ¶ÇÁΩëÁªú‰∏≠Ëé∑ÂèñÔºâ‰∏≠Ëé∑ÂèñClassÊñá‰ª∂ÁöÑ‰∫åËøõÂà∂Â≠óËäÇÊµÅ ÂàùÂßãÂåñÂàùÂßãÂåñÈò∂ÊÆµÊòØÁ±ªÂä†ËΩΩÁöÑÊúÄÂêé‰∏Ä‰∏™Èò∂ÊÆµÔºåÂèØ‰ª•ÁêÜËß£ÊàêÂàùÂßãÈùôÊÄÅÂùóÂèäÈùôÊÄÅÂèòÈáèÔºåÂú®ÂáÜÂ§áÈò∂ÊÆµÔºåÈùôÊÄÅÂèòÈáèÂ∑≤ÁªèËµã‰∫ÜÂàùÂßãÂÄºÔºåÂàùÂßãÂåñÈò∂ÊÆµËµãÁöÑÂ∞±ÊòØÂÖ∑‰ΩìÁöÑÂÄº„ÄÇ ÂàùÂßãÂåñÁöÑÂøÖË¶ÅÊù°‰ª∂ÔºåÂπ∂‰∏îÊúâ‰∏îÂè™ÊúâËøô5ÁßçÊÉÖÂÜµÊâç‰ºöËß¶ÂèëÁ±ªÁöÑÂàùÂßãÂåñ ÈÅáÂà∞new,getstatic,putstatic,invokestaticËøôÂõõ‰∏™Â≠óËäÇÁ†ÅÊó∂ÔºåÂ¶ÇÊûúËøòÊú™ÊâßË°åÁ±ªÁöÑÂàùÂßãÂåñÂàô‰ºöÊâßË°åÂàùÂßãÂåñ ‰ΩøÁî®java.lang.reflectÂåÖËøõË°åÂèçÂ∞ÑË∞ÉÁî®Êó∂ÔºåÂ¶ÇÊûúËøòÊ≤°ÊúâËøõË°åÂàùÂßãÂåñÔºåÂàô‰ºöÊâßË°åÂàùÂßãÂåñ ÂΩìÂàùÂßãÂåñ‰∏Ä‰∏™Á±ªÊó∂ÔºåÂèëÁé∞ÂÖ∂Áà∂Á±ªËøòÊ≤°ÊúâÂàùÂßãÂåñÔºåÂàô‰ºöÂàùÂßãÂåñÂÖ∂Áà∂Á±ª ÂΩìËôöÊãüÊú∫ÂêØÂä®Êó∂ÔºåÁî®Êà∑ÈúÄË¶ÅÊåáÂÆö‰∏Ä‰∏™‰∏ªÁ±ªÔºåËøô‰∏™‰∏ªÁ±ª‰ºöË¢´ÂàùÂßãÂåñ ‰ΩøÁî®jdk7Âä®ÊÄÅËØ≠Ë®ÄÊîØÊåÅÊó∂Ôºå‰ºöÊâßË°åÂàùÂßãÂåñ ‰ª•‰∏ä5‰∏≠Âú∫ÊôØÔºåÁß∞‰∏∫ÂØπ‰∏Ä‰∏™Á±ªÁöÑ‰∏ªÂä®ÂºïÁî®„ÄÇÈô§Ëøô5ÁßçÊñπÂºè‰πãÂ§ñÔºå‰ªª‰ΩïÂÖ∂‰ªñÂºïÁî®ÈÉΩË¢´Áß∞‰∏∫Ë¢´Âä®ÂºïÁî®ÔºåÂπ∂‰∏îÈÉΩ‰∏ç‰ºöËß¶ÂèëÁ±ªÁöÑÂàùÂßãÂåñ„ÄÇ ‰∏ãÈù¢‰∏æ‰∏âÁßçÊÉÖÂÜµÊù•ËØ¥ÊòéË¢´Âä®ÂºïÁî® ÈÄöËøáÂ≠êÁ±ªÂºïÁî®Áà∂Á±ªÈùôÊÄÅÂ≠óÊÆµÔºå‰∏ç‰ºöËß¶ÂèëÁà∂Á±ªÁöÑÂàùÂßãÂåñ 1234567891011121314151617181920public class BoshiCat extends Cat &#123; static &#123; System.out.println(&quot;BoshiCat init&quot;); &#125;&#125;public class Cat &#123; static &#123; System.out.println(&quot;Cat init&quot;); &#125; public static int value = 10;&#125;public class Test &#123; public static void main(String[] args) &#123; System.out.println(BoshiCat.value); &#125;&#125;// ËæìÂá∫ 10 ÈÄöËøáÊï∞ÁªÑÊù•ÂºïÁî®Á±ªÔºå‰∏ç‰ºöËß¶ÂèëÂºïÁî®Á±ªÁöÑÂàùÂßãÂåñ 1234567public class Test &#123; public static void main(String[] args) &#123; Cat [] cats = new Cat[10]; &#125;&#125;// ËæìÂá∫ 10 ÂºïÁî®static final‰øÆÈ•∞ÁöÑÂ∏∏ÈáèÔºåÂõ†‰∏∫Â∏∏ÈáèÂú®ÁºñËØëÈò∂ÊÆµÂ∞±Ë¢´ÂÜôËøõ‰∫ÜÂ∏∏ÈáèÊ±† 12345678910111213public class Cat &#123; static &#123; System.out.println(&quot;Cat init&quot;); &#125; public static final int value = 10;&#125;public class Test &#123; public static void main(String[] args) &#123; System.out.println(Cat.value); &#125;&#125;// ËæìÂá∫ 10]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ReentrantLockÂèØÈáçÂÖ•ÈîÅÊ∫êÁ†ÅÂàÜÊûê]]></title>
    <url>%2F2019%2F03%2F25%2FReentrantLock%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄReentrantLockÂèØÈáçÂÖ•ÈîÅÔºå‰πüÊòØÊó•Â∏∏‰ΩøÁî®Èô§‰∫ÜsynchronizedÂÖ≥ÈîÆÂ≠óÊúÄÂ§öÁöÑÈîÅ„ÄÇ‰ªéÂ≠óÈù¢‰∏äÁêÜËß£ÂèØÈáçÂÖ•ÁöÑÊÑèÊÄùÂ∞±ÊòØÂêå‰∏Ä‰∏™Á∫øÁ®ãÂèØ‰ª•ÈáçÂ§çÂä†ÈîÅÔºåÂΩìÁÑ∂synchronizedÂÖ≥ÈîÆÂ≠ó‰πüÊòØÊîØÊåÅÂèØÈáçÂÖ•ÁöÑÔºåÂÖ∂ÂÆûÂÆÉ‰ª¨ÁöÑ‰∏ªË¶ÅÂäüËÉΩ‰πüÊòØÁ±ª‰ººÁöÑÔºå‰ΩÜÊòØÁõ∏ÊØîËæÉÊù•ËØ¥ÔºåReentrantLockÂäüËÉΩÊõ¥ÁÅµÊ¥ª‰∏∞ÂØåÔºå‰æãÂ¶ÇReentrantLockÊîØÊåÅËÆæÁΩÆÂÖ¨Âπ≥ÈîÅÊàñÈùûÂÖ¨Âπ≥ÈîÅÔºåÊîØÊåÅÂàÜÁªÑÂî§ÈÜíÈúÄË¶ÅÂî§ÈÜíÁöÑÁ∫øÁ®ã‰ª¨ÔºåËÄå‰∏çÊòØÂÉèsynchronizedË¶Å‰πàÈöèÊú∫Âî§ÈÜí‰∏Ä‰∏™Á∫øÁ®ãË¶Å‰πàÂî§ÈÜíÂÖ®ÈÉ®Á∫øÁ®ã„ÄÇ Êï¥‰∏™ReentrantLockÁöÑÂÆûÁé∞Âü∫‰∫éAQSÁã¨Âç†ÈîÅÔºåËøô‰∏™Âú®‰∏äÁØáÊñáÁ´†Â∑≤ÁªèËØ¶ÁªÜÂàÜÊûêËøá Á±ªÁªìÊûÑ ReentrantLock.class ReentrantLockÂÆûÁé∞‰∫ÜLockÊé•Âè£Ôºå‰ΩÜÊòØÈÄöËøáÊü•ÁúãÊ∫êÁ†ÅÂèØÁü•ReentrantLockÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÂÖ∂ÂÆûÈÉΩÂßîÊâòÁªô‰∫ÜNonfairSynsÔºàÈùûÂÖ¨Âπ≥ÈîÅÔºâÊàñÂàôFairSyncÔºàÂÖ¨Âπ≥ÈîÅÔºâ‰∏§‰∏™Á±ªÂÆûÁé∞ÔºåNonfairSynsÂíåFairSyncÁªßÊâø‰∫ÜÊäΩË±°ÈùôÊÄÅÁ±ªSyncÔºåSyncÂàôÊòØAQSÁöÑÂ≠êÁ±ª ÂÖ¨Âπ≥ÈîÅ ÈùûÂÖ¨Âπ≥ÈîÅReentrantLockÊîØÊåÅÂÖ¨Âπ≥ÈîÅÔºåÈÇ£‰πà‰ªÄ‰πàÊòØÂÖ¨Âπ≥ÈîÅÂë¢ÔºüÁÆÄÂçïÁöÑÁêÜËß£Â∞±ÊòØÂ§ö‰∏™Á∫øÁ®ãËé∑ÂèñÈîÅÁöÑÈ°∫Â∫èÂ∫îËØ•ÊòØÊåâÁÖßÊó∂Èó¥ÁöÑÂÖàÂêéÔºåÂÖàÊù•ÁöÑÂÖàËé∑Âèñ„ÄÇ‰πüÂ∞±ÊòØËØ¥ÂÖ¨Âπ≥ÈîÅÁªùÂØπÊª°Ë∂≥ÂÖàËøõÂÖàÂá∫ÁöÑÈòüÂàóÂΩ¢Âºè„ÄÇ Êàë‰ª¨‰ªéAQSÂêåÊ≠•ÈòüÂàóÊù•ÁêÜËß£ÁöÑËØùÔºåÂèØ‰ª•ËÆ§‰∏∫ÂÖ¨Âπ≥ÈîÅÊØèÊ¨°ÈÉΩÊòØ‰ªéÂêåÊ≠•ÈòüÂàó‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™ËäÇÁÇπËé∑ÂèñÂà∞ÈîÅÔºåËÄåÈùûÂÖ¨Âπ≥ÈîÅÂàô‰∏ç‰∏ÄÂÆöÔºåÊúâÂèØËÉΩÂç†ÊçÆÈîÅÁöÑÁ∫øÁ®ãÂàöÈáäÊîæÈîÅÔºåÂêåÊ≠•ÈòüÂàó‰∏≠ÁöÑÁ∫øÁ®ãËøòÊú™Êù•ÂæóÂèäËé∑ÂèñÂà∞ÈîÅÔºåÂ∞±Ë¢´Êñ∞ËØ∑Ê±ÇÈîÅÁöÑÁ∫øÁ®ãËé∑Âèñ‰∫Ü„ÄÇÂΩìÁÑ∂ËøôÈáåË¶ÅÊ≥®ÊÑèÔºåÂØπ‰∫éÂ∑≤ÁªèÂä†ÂÖ•AQSÂêåÊ≠•ÈòüÂàóÁöÑÁ∫øÁ®ãÊù•ËØ¥ÔºåÊó†ËÆ∫ÂÖ¨Âπ≥ÈîÅËøòÊòØÈùûÂÖ¨Âπ≥ÈîÅÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑÔºåÊåâÁÖßÈòüÂàóÂÖàÂêéÈ°∫Â∫èËé∑Âèñ„ÄÇ ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãReentrantLockÁöÑÊûÑÈÄ†ÊñπÊ≥ï 1234567public ReentrantLock() &#123; sync = new NonfairSync();&#125;public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; ReentrantLockÊó†ÂèÇÊûÑÈÄ†ÈªòËÆ§ÊòØÈùûÂÖ¨Âπ≥ÈîÅ ÂèØ‰ª•ÈÄöËøáËÆæÁΩÆÂèÇÊï∞Â∞ÜReentrantLockËÆæÁΩÆ‰∏∫ÂÖ¨Âπ≥ÈîÅ ‰ªé‰ª£Á†ÅÂ±ÇÈù¢ÁúãÂÆûÁé∞Âå∫Âà´ 1234567891011121314151617/** * ÈùûÂÖ¨Âπ≥ÈîÅËé∑ÂèñÈîÅ */final void lock() &#123; if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1);&#125;/** * ÂÖ¨Âπ≥ÈîÅËé∑ÂèñÈîÅ */final void lock() &#123; acquire(1);&#125; ÂèØ‰ª•ÁúãÂà∞ÂæàÊòéÊòæÁöÑÂå∫Âà´ÔºåÈùûÂÖ¨Âπ≥ÈîÅËé∑ÂèñÈîÅÔºåÂè™Ë¶ÅÂΩìÂâçÊ≤°ÊúâÊåÅÈîÅÁ∫øÁ®ãÔºåÊñ∞Âä†ÂÖ•ÁöÑÁ∫øÁ®ãÈÉΩÊúâÊú∫‰ºöËé∑ÂèñÂà∞ÈîÅ ÂèØÈáçÂÖ•‰∏äÊñáËØ¥ËøáÔºåÂèØÈáçÂÖ•ÁöÑÊ¶ÇÂøµÂè™ÈíàÂØπÂêå‰∏Ä‰∏™Á∫øÁ®ãÔºåÈÇ£‰πàReentrantLockÊòØÂ¶Ç‰ΩïÂÆûÁé∞Âêå‰∏Ä‰∏™Á∫øÁ®ãÂèØÈáçÂÖ•ÁöÑÂë¢Ôºü ËøôÂ∞±ÂèàË¶ÅÊ∂âÂèäÂà∞AQS stateÁöÑÊ¶ÇÂøµÔºåÂú®AQSÂÜÖÈÉ®Áª¥Êä§‰∫Ü‰∏Ä‰∏™Áä∂ÊÄÅÂÄºstateÔºåÂΩìÊúâ‰∏Ä‰∏™Á∫øÁ®ãËé∑ÂèñÂà∞ÈîÅÔºåstateÂÄºÂ∞±‰ºö+1ÔºåÂØπ‰∫éÁã¨Âç†ÈîÅÊù•ËØ¥Ôºå‰∏çÂêåÁöÑÁ∫øÁ®ãË¶ÅÊÉ≥Ëé∑ÂèñÈîÅÔºåstateÂÄºÂøÖÈ°ª‰∏∫0„ÄÇ‰∏ãÈù¢Êàë‰ª¨Â∞±ÈÄöËøáÊ∫êÁ†ÅÊù•ÁúãÁúãReentrantLockÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÂèØÈáçÂÖ•ÊÄßÁöÑ ‰ª•ÈùûÂÖ¨Âπ≥ÈîÅ‰∏∫‰æã 123456789101112131415161718192021222324252627282930313233343536373839/** * Â∞ùËØïËé∑ÂèñÈîÅ */final void lock() &#123; // Â¶ÇÊûúÂΩìÂâçËé∑ÂèñÈîÅÁöÑÁ∫øÁ®ã‰∏∫0ÔºåÂàôÁõ¥Êé•Ëé∑Âèñ if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else // Ë∞ÉÁî®AQSÊ®°ÊùøÊñπÊ≥ïÔºå‰ºöË∞ÉÁî®Â≠êÁ±ªÁöÑtryAcquire acquire(1);&#125;protected final boolean tryAcquire(int acquires) &#123; return nonfairTryAcquire(acquires);&#125;/** * ÈùûÂÖ¨Âπ≥ÊñπÊ≥ïÂ∞ùËØïËé∑ÂèñÈîÅ */final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; // Â¶ÇÊûúÂΩìÂâçËé∑ÂèñÈîÅÁöÑÁ∫øÁ®ã‰∏∫0ÔºåÂàôÁõ¥Êé•Ëé∑ÂèñÈîÅ if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; // Â¶ÇÊûúÂΩìÂâçËé∑ÂèñÈîÅÁöÑÁ∫øÁ®ã‰∏∫ÂΩìÂâçËØ∑Ê±ÇÁ∫øÁ®ãÔºåÂàôÂ∞Üstate + 1 else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; È¶ñÂÖà‰ºöÂà§Êñ≠stateÁä∂ÊÄÅÊòØÂê¶‰∏∫0(‰πüÂ∞±ÊòØÂΩìÊó∂ËøòÊ≤°ÊúâÊåÅÈîÅÁ∫øÁ®ã)ÔºåÂ¶ÇÊûú‰∏∫0ÁöÑËØùÂàôÁõ¥Êé•Ëé∑ÂèñÈîÅ stateÁä∂ÊÄÅ‰∏ç‰∏∫0.ÂàôÂà§Êñ≠‰∏éÂΩìÂâçÊåÅÈîÅÁ∫øÁ®ãÊòØÂê¶‰∏∫Âêå‰∏Ä‰∏™Á∫øÁ®ãÔºåÊòØÁöÑËØùÔºåÂàôstateËá™Â¢û1.Ëé∑ÂèñÈîÅÊàêÂäü ÊÄªÁªìÊÄªÁöÑÊù•ËØ¥ÔºåReentrantLockÂíåsynchronizedÈùûÂ∏∏Áõ∏‰ººÔºå‰ΩÜÊòØ‰πüËøòÊòØÊØîËæÉÂ§ßÁöÑÂå∫Âà´ÔºåReentrantLockÁöÑÂäüËÉΩÊõ¥‰∏∞ÂØåÁÅµÊ¥ªÔºåsynchronizedÂè™ÊîØÊåÅÈùûÂÖ¨Âπ≥ÈîÅÔºåReentrantLockÂèØ‰ª•ÊîØÊåÅÂÖ¨Âπ≥ÈîÅÔºåÂπ∂‰∏îReentrantLockÊîØÊåÅConditionÁ≠âÔºåÂèØ‰ª•ÊâπÈáèÂàÜÁªÑÂî§ÈÜíÁ≠âÂæÖÁ∫øÁ®ã„ÄÇ `]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>Âπ∂ÂèëÁºñÁ®ã</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java AQS Ê∫êÁ†ÅËß£Êûê]]></title>
    <url>%2F2019%2F03%2F12%2FJava-AQS-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄAQSÂÖ®Áß∞java.util.concurrent.locks.AbstractQueuedSynchronizerÔºåÊòØJava Âπ∂ÂèëÂåÖ‰∏≠ÁöÑ‰∏Ä‰∏™ÊäΩË±°Á±ªÔºåÊàë‰ª¨‰∏ÄËà¨ÊääÂÆÉÂè´ÂÅöÊäΩË±°ÈòüÂàóÂêåÊ≠•Âô®ÔºåÂ¶ÇÊàë‰ª¨Â∏∏Áî®ÁöÑÂèØÈáçÂÖ•ÈîÅReentrantLockÁöÑÂÜÖÈÉ®ÂÆûÁé∞Â∞±ÊòØÂü∫‰∫éAQSÔºåÁêÜËß£AQSÁöÑÂÜÖÈÉ®Ê∫êÁ†ÅÂÆûÁé∞ÂØπ‰∫éÊàë‰ª¨Ê∑±ÂÖ•ÁêÜËß£‰ΩøÁî®javaÂπ∂ÂèëÂåÖ‰∏≠ÁöÑÂêÑ‰∏™ÂäüËÉΩÈùûÂ∏∏ÈáçË¶Å„ÄÇ ÂÆûÁé∞ÂéüÁêÜAQSÂÜÖÈÉ®Áª¥Êä§‰∫Ü‰∏Ä‰∏™ÂèåÂêëÈìæË°®ÈòüÂàóÊù•ÁÆ°ÁêÜÂ§ö‰∏™Á∫øÁ®ã„ÄÇÁÆÄÂçï‰ªãÁªç‰∏Ä‰∏ãÂ∞±ÊòØÔºåÂΩìÊúâ‰∏Ä‰∏™Êñ∞ÁöÑÁ∫øÁ®ãÂéªÂ∞ùËØïËé∑ÂèñÈîÅÔºåËøôÊòØÂ¶ÇÊûúËé∑ÂèñÂ§±Ë¥•ÔºåAQSÂàô‰ºöÂ∞ÜÊ≠§Á∫øÁ®ãÂ∞ÅË£ÖÊàê‰∏Ä‰∏™NodeËäÇÁÇπÔºåÂπ∂Â∞ÜÊ≠§ËäÇÁÇπÂä†ÂÖ•Âà∞ÂÜÖÈÉ®Áª¥Êä§ÁöÑÈòüÂàó‰∏≠„ÄÇ ‰∏äÈù¢ÁÆÄÂçïÁöÑÊèèËø∞‰∫ÜÁ∫øÁ®ãËé∑ÂèñÈîÅÁöÑËøáÁ®ãÔºåÈÇ£‰πàAQSÊòØ‰ΩøÁî®‰ªÄ‰πàÊù•Á°ÆËÆ§ÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶ÂèØ‰ª•Â∞ùËØïËé∑ÂèñÈîÅÂë¢Ôºü ÂÖ∂ÂÆûAQSÂÜÖÈÉ®‰∏∫‰∫Ü‰∏Ä‰∏™volatile int stateÂèòÈáèÊù•Ë°®Á§∫ÂΩìÂâçËµÑÊ∫êÊòØÂê¶Â∑≤ÁªèË¢´ÂÖ∂‰ªñÁ∫øÁ®ãÂç†ÊúâÔºåÂØπ‰∫éÁã¨Âç†ÈîÅÊù•ËØ¥ÔºåÂè™ÊúâÂΩìstate = 0Êó∂ÊâçËØ¥ÊòéËØ•ËµÑÊ∫êÂΩìÂâçÊ≤°ÊúâÁ∫øÁ®ãÂç†ÊúâÔºåÂêéÁª≠Á∫øÁ®ãÂèØ‰ª•ÂºÄÂßã‰∫âÊä¢ÊîπËµÑÊ∫êÔºåÂêéÁª≠Á∫øÁ®ãÈúÄË¶ÅÈÄöËøáCASÊìç‰ΩúÊù•Á°Æ‰øù‰øÆÊîπstateÂèòÈáèÊàêÂäüÊâçËÉΩÊàêÂäüÊä¢Âç†ËØ•ËµÑÊ∫ê„ÄÇ ÈáçË¶ÅÊñπÊ≥ïAQSÂÜÖÈÉ®Êèê‰æõ‰∫Ü‰∏âÁªÑÊ†∏ÂøÉÊñπÊ≥ïÁî®Êù•ÂÆûÁé∞‰∏Ä‰∏™ÂêåÊ≠•ÁªÑ‰ª∂„ÄÇ‰∏âÁªÑÊñπÊ≥ï‰ªéÂ≠óÈù¢ÊÑèÊÄù‰∏äÂå∫ÂàÜÂèØ‰ª•ÂàÜ‰∏∫‰∏§ÁßçÁ±ªÂûãÔºöÁã¨Âç†ÈîÅÁõ∏ÂÖ≥ÔºåÂÖ±‰∫´ÈîÅÁõ∏ÂÖ≥ ËÆøÈóÆstateÊúâ‰∏âÁßçÊñπÊ≥ï getState() Ëé∑ÂèñÂêåÊ≠•Áä∂ÊÄÅ setState() ËÆæÁΩÆÂêåÊ≠•Áä∂ÊÄÅÔºàÈùûCASÊìç‰ΩúÔºâ compareAndSetState() ÈÄöËøáCASÊìç‰Ωú‰øÆÊîπ ‰∏ÄÁªÑÊäΩË±°ÊñπÊ≥ïÔºåÈúÄË¶ÅÂ≠êÁ±ªÂÆûÁé∞Ôºå‰∏ªË¶ÅÊòØËé∑ÂèñÂêåÊ≠•ÈîÅÂπ∂Âà§Êñ≠ÊòØÂê¶ÊàêÂäüÁöÑÊìç‰Ωú ÊñπÊ≥ï ÊèèËø∞ boolean tryAcquire(int arg) Áã¨Âç†ÂºèËé∑ÂèñÂêåÊ≠•Áä∂ÊÄÅ boolean tryRelease(int arg) Áã¨Âç†ÂºèÈáäÊîæÂêåÊ≠•Áä∂ÊÄÅ int tryAcquireShared(int arg) ÂÖ±‰∫´ÂºèËé∑ÂèñÂêåÊ≠•Áä∂ÊÄÅ boolean tryReleaseShared(int arg) ÂÖ±‰∫´ÂºèÈáäÊîæÂêåÊ≠•Áä∂ÊÄÅ boolean isHeldExclusively() Ê£ÄÊµãÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶Ëé∑ÂèñÁã¨Âç†ÈîÅ Ê®°ÊùøÊñπÊ≥ïÔºåÁî®‰∫éÂ≠êÁ±ªÁõ¥Êé•Ë∞ÉÁî® ÊñπÊ≥ï ÊèèËø∞ void acquire(int arg) Ëé∑ÂèñÁã¨Âç†ÈîÅ„ÄÇ‰ºöË∞ÉÁî®tryAcquireÊñπÊ≥ïÔºåÂ¶ÇÊûúÊú™Ëé∑ÂèñÊàêÂäüÔºåÂàô‰ºöËøõÂÖ•ÂêåÊ≠•ÈòüÂàóÁ≠âÂæÖ void acquireInterruptibly(int arg) ÂìçÂ∫î‰∏≠Êñ≠ÁâàÁöÑ acquire boolean tryAcquireNanos(int arg,long nanos) Ë∂ÖÊó∂+ÂìçÂ∫î‰∏≠Êñ≠ÁâàÁöÑ acquire void acquireShared(int arg) Ëé∑ÂèñÂÖ±‰∫´ÈîÅ„ÄÇÂÖ±‰∫´ÂºèËé∑ÂèñÂêåÊ≠•Áä∂ÊÄÅÔºåÂêå‰∏ÄÊó∂ÂàªÂèØËÉΩ‰ºöÊúâÂ§ö‰∏™Á∫øÁ®ãËé∑ÂæóÂêåÊ≠•Áä∂ÊÄÅ„ÄÇÊØîÂ¶ÇËØªÂÜôÈîÅÁöÑËØªÈîÅÂ∞±ÊòØÂ∞±ÊòØË∞ÉÁî®Ëøô‰∏™ÊñπÊ≥ïËé∑ÂèñÂêåÊ≠•Áä∂ÊÄÅÁöÑ void acquireSharedInterruptibly(int arg) ÂìçÂ∫î‰∏≠Êñ≠ÁâàÁöÑacquireShared boolean tryAcquireSharedNanos(int arg,long nanos) Ë∂ÖÊó∂+ÂìçÂ∫î‰∏≠Êñ≠ÁâàÁöÑacquireShared boolean release(int arg) Áã¨Âç†ÂºèÈáäÊîæÂêåÊ≠•Áä∂ÊÄÅ boolean releaseShared(int arg) ÈáäÊîæÂÖ±‰∫´ÈîÅ Collection getQueuedThreads() Ëé∑ÂèñÂêåÊ≠•ÈòüÂàó‰∏äÁöÑÁ∫øÁ®ãÈõÜÂêà Ê∫êÁ†ÅÂàÜÊûê‰∏äÊñáÊúâÊèêÂà∞ÔºåËøõÂÖ•ÂêåÊ≠•ÈòüÂàóÁöÑÁ∫øÁ®ã‰ºöË¢´Â∞ÅË£ÖÊàê‰∏Ä‰∏™NodeËäÇÁÇπÔºå‰∏ãÈù¢Êàë‰ª¨ÂÖàÊù•Áúã‰∏ãNode.class 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158static final class Node &#123; /** * Áî®‰∫éÊ†áËÆ∞‰∏Ä‰∏™ËäÇÁÇπÂú®ÂÖ±‰∫´Ê®°Âºè‰∏ãÁ≠âÂæÖ */ static final Node SHARED = new Node(); /** * Áî®‰∫éÊ†áËÆ∞‰∏Ä‰∏™ËäÇÁÇπÂú®Áã¨Âç†Ê®°Âºè‰∏ãÁ≠âÂæÖ */ static final Node EXCLUSIVE = null; /** * Á≠âÂæÖÁä∂ÊÄÅÔºöÂèñÊ∂àÁä∂ÊÄÅ */ static final int CANCELLED = 1; /** * Á≠âÂæÖÁä∂ÊÄÅÔºöÈÄöÁü•(ÊåáÁ§∫ÂêéÁªßÁ∫øÁ®ãÈúÄË¶ÅÈòªÂ°û) */ static final int SIGNAL = -1; /** * Á≠âÂæÖÁä∂ÊÄÅÔºöÊù°‰ª∂Á≠âÂæÖ */ static final int CONDITION = -2; /** * Á≠âÂæÖÁä∂ÊÄÅÔºö‰º†Êí≠ */ static final int PROPAGATE = -3; /** * Á≠âÂæÖÁä∂ÊÄÅ */ volatile int waitStatus; /** * ÂâçÈ©±ËäÇÁÇπ */ volatile Node prev; /** * ÂêéÁªßËäÇÁÇπ */ volatile Node next; /** * ËäÇÁÇπÂØπÂ∫îÁöÑÁ∫øÁ®ã */ volatile Thread thread; /** * Á≠âÂæÖÈòüÂàó‰∏≠ÁöÑÂêéÁªßËäÇÁÇπ */ Node nextWaiter; /** * ÂΩìÂâçËäÇÁÇπÊòØÂê¶Â§Ñ‰∫éÂÖ±‰∫´Ê®°ÂºèÁ≠âÂæÖ */ final boolean isShared() &#123; return nextWaiter == SHARED; &#125; /** * Ëé∑ÂèñÂâçÈ©±ËäÇÁÇπÔºåÂ¶ÇÊûú‰∏∫Á©∫ÁöÑËØùÊäõÂá∫Á©∫ÊåáÈíàÂºÇÂ∏∏ */ final Node predecessor() throws NullPointerException &#123; Node p = prev; if (p == null) &#123; throw new NullPointerException(); &#125; else &#123; return p; &#125; &#125; Node() &#123; &#125; /** * addWaiter‰ºöË∞ÉÁî®Ê≠§ÊûÑÈÄ†ÂáΩÊï∞ */ Node(Thread thread, Node mode) &#123; this.nextWaiter = mode; this.thread = thread; &#125; /** * Condition‰ºöÁî®Âà∞Ê≠§ÊûÑÈÄ†ÂáΩÊï∞ */ Node(Thread thread, int waitStatus) &#123; this.waitStatus = waitStatus; this.thread = thread; &#125;&#125; ËøôÈáåËß£ÈáäÂá†‰∏™ÈáçË¶ÅÁöÑÂ±ûÊÄß Â±ûÊÄß ÊÑè‰πâ prev ÂâçÁΩÆËäÇÁÇπ next ÂêéÁΩÆËäÇÁÇπ CANCELLED Áä∂ÊÄÅÂÄº Ë°®Á§∫ËäÇÁÇπË¢´ÂèñÊ∂à SIGNAL Áä∂ÊÄÅÂÄº Ë°®Á§∫ÂêéÁΩÆËäÇÁÇπÈúÄË¶ÅË¢´ÈòªÂ°û CONDITION Áä∂ÊÄÅÂÄº Ë°®Á§∫ËäÇÁÇπËøõÂÖ• CONDITION PROPAGATE Áä∂ÊÄÅÂÄº ÂÖ±‰∫´ÈîÅ‰º†Êí≠Áä∂ÊÄÅ Áã¨Âç†ÈîÅÁöÑËé∑ÂèñÂú®AQS‰∏≠ÂåÖÂê´‰∫ÜheadÂíåtail‰∏§‰∏™NodeÂºïÁî®ÔºåÂÖ∂‰∏≠headÂú®ÈÄªËæë‰∏äÁöÑÂê´‰πâÊòØÂΩìÂâçÊåÅÊúâÈîÅÁöÑÁ∫øÁ®ãÔºåtailÊåáÁ§∫ÈòüÂ∞æËäÇÁÇπ„ÄÇheadÂíåtailÂèØ‰ª•Áõ∏Á≠â 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372/*** Ëé∑ÂèñÁã¨Âç†ÈîÅÔºåËØ•ÊñπÊ≥ï‰ºöÈ¶ñÂÖàË∞ÉÁî®tryAcquireÔºàÁî±Â≠êÁ±ªÂÆûÁé∞ÔºâÊù•Ëé∑ÂèñÈîÅÔºå* Â¶ÇÊûúËé∑ÂèñÊàêÂäü‰ºöÁõ¥Êé•ËøîÂõûÔºåÂ§±Ë¥•Âàô‰ºöÂ∞ÜÂΩìÂâçÊä¢ÈîÅÂ§±Ë¥•ÁöÑÁ∫øÁ®ãÂ∞ÅË£Ö‰∏∫NodeËäÇÁÇπÂä†ÂÖ•ÈòüÂ∞æ */public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125;/*** Â¢ûÂä†‰∏Ä‰∏™ * */private Node addWaiter(Node mode) &#123; Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure // Âø´ÈÄüÊâßË°å‰∏ÄÊ¨°Âä†ÂÖ•ÈòüÂàóÂ∞æÈÉ®ÁöÑÊìç‰ΩúÔºåÂ¶ÇÊûúÂ§±Ë¥•ÁöÑËØùÂàôÊâßË°å enq // Ëé∑ÂèñÈòüÂ∞æËäÇÁÇπ Node pred = tail; if (pred != null) &#123; // Ëé∑ÂèñÈòüÂ∞æÁöÑÂâçÈ©±ËäÇÁÇπ node.prev = pred; // CASËÆæÁΩÆÊñ∞ÁöÑÈòüÂ∞æÔºåÊúâÂèØËÉΩÂ§±Ë¥• if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; // Â¶ÇÊûúËøòÊ≤°ÊúâÈòüÂ∞æÔºàÂàùÂßãÁä∂ÊÄÅÔºâÔºåÊàñÂàôÂÖ•ÈòüÂ§±Ë¥•ÔºåÂàôÊâßË°å‰∏ãÈù¢ÁöÑÊñπÊ≥ï enq(node); return node;&#125;private Node enq(final Node node) &#123; // ÈÄöËøáCAS Ëá™ÊóãËÆæÁΩÆÊñ∞ÁöÑÈòüÂ∞æ for (;;) &#123; Node t = tail; // ÈòüÂ∞æËäÇÁÇπ‰∏∫Á©∫ÔºåËØ¥ÊòéÊòØÂàùÂßãÁä∂ÊÄÅÔºåÂøÖÈ°ªÂàùÂßãÂåñÂ§¥Â∞æËäÇÁÇπ if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; // ËøôÈáåÊ≥®ÊÑè‰∏Ä‰∏™ÁªÜËäÇ // node.prev = t Êìç‰ΩúÊòØËÆæÁΩÆÂΩìÂâçËäÇÁÇπÁöÑÂâçÈ©±ËäÇÁÇπ‰∏∫Áé∞Âú®ÁöÑÈòüÂ∞æËäÇÁÇπ // ‰ΩÜÊòØËØ•Êìç‰ΩúÊ≤°ÊúâÊîæÂà∞compareAndSetTailÊìç‰ΩúÊàêÂäü‰ª•ÂêéÔºå‰πüÂ∞±ÊòØËØ¥‰ª£Á†Å‰∏∫‰Ωï‰∏çËøôÊ†∑ÂÜô // if (compareAndSetTail(t, node)) &#123; // node.prev = t; // t.next = node; // return t; // &#125;// Â¶ÇÊûúËøôÊ†∑Â≠êÂÜôÁöÑËØùÔºåÈòüÂ∞æËäÇÁÇπÂú®Êüê‰∏ÄÁû¨Èó¥‰ºöÊòØ‰∏Ä‰∏™Â≠§Á´ãÁöÑËäÇÁÇπÔºå‰ΩÜÊòØÂ¶ÇÊûúÂÖà// ÊâßË°å node.prev = t Â∞±ÊääÂΩìÂâçËäÇÁÇπÁöÑÂâçÈ©±ÊåáÂêë‰∫ÜËøòÊú™ËÆæÁΩÆÂâçÁöÑÈòüÂ∞æÔºåËøôÊ†∑Â≠êÂΩìÊàë‰ª¨‰ªéÂêéÂæÄÂâçÈÅçÂéÜÁöÑÊó∂ÂÄôÔºåÂ∞±‰∏ç‰ºöÂá∫Áé∞ÈòüÂàóÊñ≠Ë£ÇÁöÑÊÉÖÂÜµ node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125;&#125;/*** ËäÇÁÇπÂä†ÂÖ•ÈòüÂàó‰πãÂêéÊìç‰ΩúÔºåËøôÈáåÂàÜ‰∏§ÁßçÊÉÖÂÜµ* 1\. Â¶ÇÊûúÂΩìÂâçËäÇÁÇπÁöÑÂâçÈ©±ËäÇÁÇπ‰∏∫head Â§¥ËäÇÁÇπÔºåÂàôÂ∞ùËØïËé∑ÂèñÈîÅÔºåÂπ∂ËÆæÁΩÆÊñ∞ÁöÑÂ§¥ËäÇÁÇπ * 2\. ÈòªÂ°ûËá™Â∑± */final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; // Âæ™ÁéØÂ∞ùËØïËé∑ÂèñÈîÅ for (;;) &#123; // Ëé∑ÂèñÂâçÈ©±ËäÇÁÇπ final Node p = node.predecessor(); // ÂâçÈ©±ËäÇÁÇπ‰∏∫headËäÇÁÇπ ÂàôÂ∞ùËØïËé∑ÂèñÈîÅ if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÈòªÂ°ûËá™Â∑± if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; // Â¶ÇÊûúÊäõÂºÇÂ∏∏Â§±Ë¥•ÔºåÂàôË∞ÉÁî® cancelAcquire ÂèñÊ∂àËØ•ËäÇÁÇπ if (failed) cancelAcquire(node); &#125;&#125;private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; int ws = pred.waitStatus; // Â¶ÇÊûúÂâçÈ©±ËäÇÁÇπÁöÑ waitStatus ‰∏∫ -1ÔºåÂàôËØ¥ÊòéÂΩìÂâçÁ∫øÁ®ãÈúÄË¶ÅÈòªÂ°û if (ws == Node.SIGNAL) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true; // waitStatusÂ§ß‰∫é0ÔºåËØ¥ÊòéÂâçÈ©±ËäÇÁÇπ‰∏∫ÂèñÊ∂àÁä∂ÊÄÅÔºåÈúÄË¶ÅÈáçÊñ∞ËÆæÁΩÆÂâçÈ©±ËäÇÁÇπ if (ws &gt; 0) &#123; // ÂêëÂâçÂØªÊâæwaitStatus&lt;=0ÁöÑËäÇÁÇπÔºåÂπ∂ËÆæÁΩÆ‰∏∫Êñ∞ÁöÑÂâçÈ©±ËäÇÁÇπ do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; /* * Â¶ÇÊûúÂâçÈ©±ËäÇÁÇπÁä∂ÊÄÅ‰∏∫ 0 -2 -3ÔºåÂàôËÆæÁΩÆÂâçÈ©±ËäÇÁÇπ WaitStatus = -1ÔºåÂπ∂ÈáçÊñ∞Âæ™ÁéØ */ compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false;&#125;/** * Ë∞ÉÁî® LockSupport.park(this) ÈòªÂ°ûÂΩìÂâçÁ∫øÁ®ã */private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125;/*** ÂèñÊ∂àËäÇÁÇπÔºå‰πüÂ∞±ÊòØÂΩìÂâçÁ∫øÁ®ãÊîæÂºÉËé∑ÂèñÈîÅ */private void cancelAcquire(Node node) &#123; if (node == null) return; node.thread = null; // Ëé∑ÂèñÂâçÈ©±ËäÇÁÇπÔºå‰ºöË∑≥ËøáÁä∂ÊÄÅ‰∏∫ÂèñÊ∂àÁä∂ÊÄÅÁöÑËäÇÁÇπ Skip cancelled predecessors Node pred = node.prev; while (pred.waitStatus &gt; 0) node.prev = pred = pred.prev; // Ëé∑ÂèñÂêéÁªßËäÇÁÇπ Node predNext = pred.next; // ËÆæÁΩÆËäÇÁÇπÁä∂ÊÄÅ‰∏∫ÂèñÊ∂à node.waitStatus = Node.CANCELLED; // Â¶ÇÊûúÂΩìÂâçËäÇÁÇπÊòØÈòüÂ∞æËäÇÁÇπÔºåÂàôËÆæÁΩÆÂâçÈ©±ËäÇÁÇπ‰∏∫ÈòüÂ∞æÔºåÂπ∂ËÆæÁΩÆÂâçÈ©±ËäÇÁÇπÁöÑÂêéÁªßËäÇÁÇπ‰∏∫null if (node == tail &amp;&amp; compareAndSetTail(node, pred)) &#123; compareAndSetNext(pred, predNext, null); &#125; else &#123; int ws; // Â¶ÇÊûúÂâçÈ©±ËäÇÁÇπ‰∏çÊòØÂ§¥ÁªìÁÇπÔºå‰∏îÂâçÈ©±ËäÇÁÇπÁöÑ WaitStatus = -1 if (pred != head &amp;&amp; ((ws = pred.waitStatus) == Node.SIGNAL || (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp; pred.thread != null) &#123; Node next = node.next; // Â∞ÜÂâçÁΩÆËäÇÁÇπÂíåÂêéÁªßËäÇÁÇπÁõ∏Ëøû if (next != null &amp;&amp; next.waitStatus &lt;= 0) compareAndSetNext(pred, predNext, next); &#125; else &#123; // Âî§ÈÜíÂêéÁªßËäÇÁÇπ // ËøôÈáå‰∏∫‰ΩïË¶ÅÂî§ÈÜíÂêéÁªßËäÇÁÇπÔºü // Âõ†‰∏∫Â¶ÇÊûúÂΩìÂâçËäÇÁÇπÁöÑÂâçÁΩÆËäÇÁÇπ‰∏∫headËäÇÁÇπÔºå‰ΩÜÊòØÊ≠§Êó∂headËäÇÁÇπÁöÑÁä∂ÊÄÅ‰∏∫0ÔºàÂΩìÂâçËäÇÁÇπËøòÊú™Êù•ÂæóÂèäËÆæÁΩÆÂâçÁΩÆËäÇÁÇπÁä∂ÊÄÅ‰∏∫ -1ÔºâÔºåËøôÊó∂headËäÇÁÇπÈáäÊîæ‰∫ÜÈîÅÂõ†‰∏∫Áä∂ÊÄÅËøò‰∏∫0ÔºåÊâÄ‰ª•‰∏ç‰ºöÂéªÂî§ÈÜíÂêéÁªßÁ∫øÁ®ã„ÄÇËøôÊó∂ÈòüÂàóÂ∞±Â§±ÂéªÊ¥ªÊÄß‰∫ÜÔºÅÊâÄ‰ª•ËøôÈáåÈúÄË¶ÅÂî§ÈÜíÂêéÁªßÁ∫øÁ®ã unparkSuccessor(node); &#125; node.next = node; // help GC &#125;&#125;/*** Âî§ÈÜíÂêéÁªßËäÇÁÇπ */private void unparkSuccessor(Node node) &#123; /* * Â¶ÇÊûúËäÇÁÇπ waitStatus &lt; 0ÔºåÂàôÂ∞ùËØïÂ∞ÜÁä∂ÊÄÅËÆæ‰∏∫0 */ int ws = node.waitStatus; if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); /* * Ëé∑ÂèñÂΩìÂâçËäÇÁÇπÁöÑÂêéÁªßËäÇÁÇπ * Â¶ÇÊûú s!=null ‰∏î sÊú™Ë¢´ÂèñÊ∂à ÂàôÁõ¥Êé•Âî§ÈÜí */ Node s = node.next; if (s == null || s.waitStatus &gt; 0) &#123; s = null; // ‰ªéÂ∞æËäÇÁÇπÂêëÂâçÊü•ÊâæÁ¶ªnodeÊúÄËøëÁöÑÈùûÂèñÊ∂àËäÇÁÇπ // Ê≥®ÊÑèËøôÈáå‰∏∫‰ΩïË¶Å‰ªéÂêéÂêëÂâçÊü•Êâæ // Âú® enqÊñπÊ≥ï‰∏≠ÊúâÊÆµÊ≥®ÈáäÔºåÂ¶ÇÊûú‰ªéÂâçÂæÄÂêéÁöÑËØùÔºåÊúâÂèØËÉΩÂá∫Áé∞ÈòüÂàóÊñ≠Ë£Ç for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) LockSupport.unpark(s.thread);&#125; ‰∏äÊñáÂü∫Êú¨ÂÆåÊàê‰∫ÜÂØπÁã¨Âç†ÈîÅËé∑ÂèñÈîÅÁöÑÊµÅÁ®ãÁöÑÂàÜÊûêÔºåËøôÈáåÁÆÄÂçïÁîª‰∏™ÂõæÊù•Êõ¥Ê∏ÖÊô∞ÁöÑÂ±ïÁ§∫Êï¥‰∏™Ëé∑ÂèñÈîÅÁöÑËøáÁ®ãÔºö Áã¨Âç†ÈîÅÁöÑÈáäÊîæ12345678910111213141516171819202122232425262728293031323334/** * ÈáäÊîæÈîÅ */public final boolean release(int arg) &#123; // Â¶ÇÊûúÈáäÊîæÈîÅÊàêÂäü if (tryRelease(arg)) &#123; Node h = head; // ‰∏îÂΩìÂâçÊåÅÈîÅÁöÑÂ§¥ÁªìÁÇπÁä∂ÊÄÅ‰∏çÁ≠â‰∫é0ÔºåÂ∞±ÂéªÂî§ÈÜíÂêéÁªßÁ∫øÁ®ã // ÊÄùËÄÉËøôÈáåÁ≠â‰∫é0 ‰∏∫‰Ωï‰∏çË°åÔºü // Âõ†‰∏∫ÂΩì waitStatus == 0Êó∂ÔºåËØ¥ÊòéÂêéÁªßÁ∫øÁ®ãËøòÂú®ËøêË°å‰∏≠ÔºåËøòÊú™Êù•ÂæóÂèäÂ∞ÜwaitStatus Áä∂ÊÄÅËÆæ‰∏∫-1 if (h != null &amp;&amp; h.waitStatus != 0) // ‰∏é‰∏äÊñáunparkSuccessorÊñπÊ≥ï‰∏ÄËá¥ unparkSuccessor(h); return true; &#125; return false;&#125; ÂÖ±‰∫´ÈîÅÂÖ±‰∫´ÈîÅ‰∏éÁã¨Âç†ÈîÅÊúÄÂ§ßÁöÑÂå∫Âà´Âú®‰∫éÔºåÂÖ±‰∫´ÈîÅÂÖÅËÆ∏Â§ö‰∏™Á∫øÁ®ãÊåÅÊúâÈîÅÔºåËÄåÁã¨Âç†ÈîÅÂú®Âêå‰∏ÄÊó∂Èó¥Âè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãÂèØ‰ª•Ëé∑ÂèñÂà∞ÈîÅ ÂÖ±‰∫´ÈîÅÁöÑËé∑Âèñ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166/*** Ëé∑ÂèñÂÖ±‰∫´ÈîÅ */public final void acquireShared(int arg) &#123; // Â¶ÇÊûútryAcquireShared(arg) &lt; 0Ë°®Á§∫Ëé∑ÂèñÂÖ±‰∫´ÈîÅÂ§±Ë¥• // Ëé∑ÂèñÂ§±Ë¥•ÁöÑÂéüÂõ†‰∏ÄËà¨ÊòØÁî±‰∫éËØ•ËµÑÊ∫êÊ≠£Áî±Áã¨Âç†ÈîÅÂç†Êúâ if (tryAcquireShared(arg) &lt; 0) doAcquireShared(arg);&#125;private void doAcquireShared(int arg) &#123; // Âä†ÂÖ•Âà∞ÈòüÂàóÂ∞æÈÉ® final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head) &#123; int r = tryAcquireShared(arg); // ‰∏ÄÊó¶ÂÖ±‰∫´Ëé∑ÂèñÊàêÂäüÔºåËÆæÁΩÆÊñ∞ÁöÑÂ§¥ÁªìÁÇπÔºåÂπ∂‰∏îÂî§ÈÜíÂêéÁªßÁ∫øÁ®ã if (r &gt;= 0) &#123; setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; &#125; &#125; // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÈòªÂ°û if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125;/*** Âú®Ëé∑ÂèñÂÖ±‰∫´ÈîÅÊàêÂäüÂêéÔºåËÆæÁΩÆheadËäÇÁÇπ* Ë∑üÊçÆË∞ÉÁî®tryAcquireSharedËøîÂõûÁöÑÁä∂ÊÄÅ‰ª•ÂèäËäÇÁÇπÊú¨Ë∫´ÁöÑÁ≠âÂæÖÁä∂ÊÄÅÊù•Âà§Êñ≠ÊòØÂê¶Ë¶ÅÈúÄË¶ÅÂî§ÈÜíÂêéÁªßÁ∫øÁ®ã„ÄÇ */private void setHeadAndPropagate(Node node, int propagate) &#123; Node h = head; setHead(node); /* * propagateÊòØtryAcquireSharedÁöÑËøîÂõûÂÄºÔºåËøôÊòØÂÜ≥ÂÆöÊòØÂê¶‰º†Êí≠Âî§ÈÜíÁöÑ‰æùÊçÆ‰πã‰∏Ä„ÄÇ * h.waitStatus‰∏∫SIGNALÊàñËÄÖPROPAGATEÊó∂‰πüÊ†πÊçÆnodeÁöÑ‰∏ã‰∏Ä‰∏™ËäÇÁÇπÂÖ±‰∫´Êù•ÂÜ≥ÂÆöÊòØÂê¶‰º†Êí≠Âî§ÈÜíÔºå * ÊÄùËÄÉÔºåËøôÈáå‰∏∫‰ªÄ‰πà‰∏çËÉΩÂè™Áî®propagate &gt; 0Êù•ÂÜ≥ÂÆöÊòØÂê¶ÂèØ‰ª•‰º†Êí≠ * Âõ†‰∏∫Ê≠§Êó∂ÊúâÂèØËÉΩÊúâÂÖ∂‰ªñÁ∫øÁ®ãÈáäÊîæ‰∫ÜÈîÅÔºå‰ΩÜpropagateËøòÊú™Êõ¥Êñ∞ÔºåÊâÄ‰ª•ËøòÈúÄË¶ÅÂà§Êñ≠h.waitStatus &lt; 0 */ if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) &#123; Node s = node.next; // ÂêéÁªßËäÇÁÇπ‰∏∫ÂÖ±‰∫´ÈîÅÁ±ªÂûã if (s == null || s.isShared()) doReleaseShared(); &#125;&#125;/*** ËøôÊòØÂÖ±‰∫´ÈîÅ‰∏≠ÁöÑÊ†∏ÂøÉÂî§ÈÜíÂáΩÊï∞Ôºå‰∏ªË¶ÅÂÅöÁöÑ‰∫ãÊÉÖÂ∞±ÊòØÂî§ÈÜí‰∏ã‰∏Ä‰∏™Á∫øÁ®ãÊàñËÄÖËÆæÁΩÆ‰º†Êí≠Áä∂ÊÄÅ„ÄÇ */private void doReleaseShared() &#123; for (;;) &#123; Node h = head; // Â¶ÇÊûúÈòüÂàó‰∏≠Â≠òÂú®ÂêéÁªßÁ∫øÁ®ã„ÄÇ if (h != null &amp;&amp; h != tail) &#123; int ws = h.waitStatus; if (ws == Node.SIGNAL) &#123; if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; unparkSuccessor(h); &#125; // Â¶ÇÊûúhËäÇÁÇπÁöÑÁä∂ÊÄÅ‰∏∫0ÔºåÈúÄË¶ÅËÆæÁΩÆ‰∏∫PROPAGATEÁî®‰ª•‰øùËØÅÂî§ÈÜíÁöÑ‰º†Êí≠„ÄÇ else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; &#125; if (h == head) break; &#125;&#125; ÂÖ±‰∫´ÈîÅÁöÑÈáäÊîæ12345678910111213141516public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; // ‰∏é‰∏äÊñádoReleaseShared‰∏ÄÊ†∑ doReleaseShared(); return true; &#125; return false;&#125; ÊÄªÁªìAQSÁöÑÊï¥‰ΩìÁêÜÂøµÁõ∏ÂØπÊØîËæÉÂÆπÊòìÁêÜËß£Ôºå‰ΩÜÊòØAQSÁúüÊ≠£ÈöæÊáÇÁöÑÂÖ∂ÂÆûÊòØÂÆÉÁöÑÁªÜËäÇÔºåÂõ†‰∏∫‰∏Ä‰∏™ÂæàÁÆÄÂçïÁöÑÈóÆÈ¢ò‰∏ÄÊó¶Ë¢´ÊîæÂú®Âπ∂ÂèëÁéØÂ¢É‰∏≠Â∞±‰ºöÂèòÁöÑÈùûÂ∏∏ÊäΩË±°ÔºåÈöæ‰ª•ÁêÜËß£„ÄÇË¶ÅÁêÜËß£AQSÁöÑÁªÜËäÇÂÆûÁé∞ÔºåËøòÊòØÈúÄË¶ÅÂ§öÁúãÔºåÊàëÊòØÂâçÂâçÂêéÂêéÁúã‰∫ÜÊúâ‰∏ÄÂë®ÔºåÂØπ‰∫éÊúâ‰∫õÁªÜËäÇËøòÊòØÁï•Ê®°Á≥ä„ÄÇ Êú¨ÁØáÊñáÁ´†ÂèÇËÄÉ‰∫Ü AbstractQueuedSynchronizerÊ∫êÁ†ÅËß£ËØª]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>Âπ∂ÂèëÁºñÁ®ã</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java CAS]]></title>
    <url>%2F2019%2F03%2F02%2FJava-CAS%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®‰ªãÁªçCAS‰πãÂâçÔºåÊàë‰ª¨ÊúâÂøÖË¶ÅÂÖàÁêÜËß£Á∫øÁ®ãÂÆâÂÖ®ÁöÑ‰∏âÂ§ßÁâπÊÄß ÂéüÂ≠êÊÄß: ÂØπ‰∫éÊ∂âÂèäÂÖ±‰∫´ÂèòÈáèËÆøÈóÆÁöÑÊìç‰ΩúÔºåËØ•Êìç‰Ωú‰ªéÂÖ∂ÊâßË°åÁ∫øÁ®ã‰ª•Â§ñÁöÑ‰ªªÊÑèÁ∫øÁ®ãÊù•ÁúãÊòØ‰∏çÂèØÂàÜÂâ≤ÁöÑÔºå‰ªéËÄåÂèØ‰ª•ËÆ©ÂêÑ‰∏™Á∫øÁ®ã‰æùÊ¨°‰∏≤Ë°åËÆøÈóÆÔºå‰ΩÜÊòØÂéüÂ≠êÊÄßÂπ∂‰∏ç‰øùËØÅÂèØËßÅÊÄß ÂèØËßÅÊÄß: ‰øÆÊîπÂÖ±‰∫´ÂèòÈáèÊó∂ÔºåÁ´ãÂç≥Â∞ÜÂ∑•‰ΩúÂÜÖÂ≠ò‰∏≠ÁöÑÂÄºÂêåÊ≠•Âà∞‰∏ªÂ≠ò‰∏≠ÔºåÂπ∂‰ΩøËØ•‰øÆÊîπÂØπÂÖ∂‰ªñÁ∫øÁ®ãÂèØËßÅ ÊúâÂ∫èÊÄß: Á¶ÅÊ≠¢ËØªÂèñÂÖ±‰∫´ÂèòÈáèÂêéÁöÑ‰ª£Á†Å„ÄÅ‰øÆÊîπÂÖ±‰∫´ÂèòÈáèÂâçÁöÑ‰ª£Á†ÅÈáçÊéíÂ∫è CASÂç≥compare and swapÁöÑÁº©ÂÜôÔºå‰∏≠ÊñáÁøªËØëÊàêÊØîËæÉÂπ∂‰∫§Êç¢„ÄÇÊòØ‰∏ÄÁßçÁî®‰∫éÂú®Â§öÁ∫øÁ®ãÁéØÂ¢É‰∏ãÂÆûÁé∞ÂêåÊ≠•ÂäüËÉΩÁöÑÊú∫Âà∂„ÄÇË∞ÉÁî®Java CASÈúÄË¶Å‰∏â‰∏™Êìç‰ΩúÊï∞ ÂÜÖÂ≠ò‰∏≠ÂÄºÁöÑÂÜÖÂ≠ò‰ΩçÁΩÆ È¢ÑÊúüÂÄº Êñ∞ÂÄº ÂÖ∑‰ΩìÂÆûÁé∞ÊòØÈÄöËøáÂÄºÁöÑÂÜÖÂ≠ò‰ΩçÁΩÆÂèñÂà∞ÂÜÖÂ≠ò‰∏≠ÁöÑÂÄºÂπ∂‰∏éÈ¢ÑÊúüÂÄºÊØîËæÉÔºåËã•Áõ∏Á≠âÔºåÂàôÂ∞ÜÂÜÖÂ≠ò‰ΩçÁΩÆÂ§ÑÁöÑÂÄºÊõøÊç¢‰∏∫Êñ∞ÂÄºÔºåËã•‰∏çÁõ∏Á≠âÔºåÂàô‰∏çÂÅö‰ªª‰ΩïÊìç‰ΩúËøîÂõûfalse„ÄÇÂ¶ÇÊûúÂ§ßÂÆ∂Êúâ‰∫ÜËß£ËøáÊÇ≤ËßÇÈîÅÂíå‰πêËßÇÈîÅÔºåÂèØ‰ª•ÂèëÁé∞CASÂÖ∂ÂÆûÊòØ‰∏ÄÁßç‰πêËßÇÈîÅÁöÑÂÆûÁé∞„ÄÇ ‰ΩøÁî®CASÁöÑÁõÆÁöÑÂØπ‰∫éÂÆûÁé∞Á∫øÁ®ãÂÆâÂÖ®ÔºåÊàë‰ª¨Áî®ÁöÑÊØîËæÉÂ§öÁöÑÂ∫îËØ•ÊòØsynchronizedÂÖ≥ÈîÆÂ≠óÔºåsynchronizedÂÖ∂ÂÆûÊòØ‰∏ÄÁßçÊÇ≤ËßÇÈîÅÔºåÈîÅË¢´Âç†Áî®ÁöÑÊÉÖÂÜµ‰ºöÂØºËá¥ÂÖ∂ÂÆÉÊâÄÊúâÈúÄË¶ÅÈîÅÁöÑÁ∫øÁ®ãÊåÇËµ∑ÔºåÁ≠âÂæÖÊåÅÊúâÈîÅÁöÑÁ∫øÁ®ãÈáäÊîæÈîÅ„ÄÇCASÊòØ‰∏ÄÁßç‰πêËßÇÈîÅÔºåÊØèÊ¨°ÂèñÊï∞ÊçÆÈÉΩ‰∏ç‰ºöÂä†ÈîÅÔºåÊõ¥Êñ∞ÁöÑÊó∂ÂÄô‰ºöËøõË°åÊï∞ÊçÆÊØîÂØπÔºåÊúâÂÜ≤Á™ÅÁöÑËØùÂàô‰ºöËá™ÊóãÈáçËØï„ÄÇÂèØ‰ª•ÁúãÂà∞Âú®ËØªÊìç‰ΩúÈ¢ëÁπÅÔºåÊõ¥Êñ∞È¢ëÁéá‰ΩéÔºåÂÜ≤Á™ÅÊ¶ÇÁéá‰ΩéÁöÑÊÉÖÂÜµ‰∏ãÔºåÁî®CASÁöÑËØù‰ºöÊõ¥Âä†ÂêàÁêÜ„ÄÇÂΩìÁÑ∂JDK1.6‰πãÂêéÔºåJavaÂØπsynchronizedÂÖ≥ÈîÆÂ≠óÊù•‰∫Ü‰∏ÄÂ§ßÊ≥¢‰ºòÂåñÔºàËá™ÊóãÈîÅÔºåÈîÅÊ∂àÈô§ÔºåÈîÅÁ≤óÂåñÔºåÂÅèÂêëÈîÅÔºåËΩªÈáèÁ∫ßÈîÅÔºâÔºå‰∏ÄËà¨ÊÉÖÂÜµ‰∏ã‰ΩøÁî®synchronizedÊòØÈùûÂ∏∏Á®≥ÂÆöÁöÑ„ÄÇ CASÁöÑÂ∫ïÂ±ÇÂÆûÁé∞Áé∞Âú®ÁöÑCPUÈÉΩÊòØÂ§öÊ†∏ÂøÉÁöÑÔºåÂ§ö‰∏™Ê†∏ÂøÉÈÄöËøáÊÄªÁ∫øÊù•Êìç‰ΩúÂÜÖÂ≠ò„ÄÇÈÇ£‰πàËøôÈáåÂ∞±Â≠òÂú®‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂ∞±ÊòØÂ¶ÇÊûúÂ§ö‰∏™Ê†∏ÂøÉÂêåÊó∂Êìç‰Ωú‰∏ÄÂùóÂÜÖÂ≠òÂå∫ÂüüÔºå‰ºöÂèëÁîü‰ªÄ‰πàÈóÆÈ¢òÂë¢ÔºüÊòØÁöÑÔºåËøôÈáåÊï∞ÊçÆÂ∞±‰ºöÂá∫Áé∞Ê∑∑‰π±„ÄÇ‰∏çËøáËøôÈáåÊàë‰ª¨ÂèØ‰ª•‰ªéintelÁöÑ‰ΩøÁî®ÊâãÂÜå‰∏≠ÊâæÂà∞Á≠îÊ°àÔºåÂØπÊåá‰ª§Âä†lockÂâçÁºÄÂèØ‰ª•‰øùËØÅÊìç‰ΩúÁöÑÂéüÂ≠êÊÄßÔºåÂèØËßÅÊÄß‰ª•ÂèäÊúâÂ∫èÊÄß„ÄÇÂ•Ω‰∫ÜÔºåÂ∫ïÂ±ÇÁöÑÂ∞±‰∏çÂ§öËØ¥‰∫ÜÔºåÊàë‰ª¨Áõ¥Êé•ÂéªÁúã‰∏Ä‰∏ãjava.util.concurrent.atomicÂåÖ‰∏ãÁöÑÂéüÂ≠êÁ±ª AtomicIntegerÁöÑÊ∫êÁ†ÅÂÆûÁé∞ AtomicIntegerÊ∫êÁ†Å12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class AtomicInteger extends Number implements java.io.Serializable &#123; private static final long serialVersionUID = 6214790243416807050L; // setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); // valueÂÄºÁöÑÂÜÖÂ≠ò‰ΩçÁΩÆ private static final long valueOffset; static &#123; try &#123; // Ëé∑ÂèñvalueÁöÑÂÜÖÂ≠ò‰ΩçÁΩÆ valueOffset = unsafe.objectFieldOffset (AtomicInteger.class.getDeclaredField(&quot;value&quot;)); &#125; catch (Exception ex) &#123; throw new Error(ex); &#125; &#125; // valueÂÄº volatile ‰øÆÈ•∞ ‰øùËØÅÂèØËßÅÊÄß private volatile int value; public AtomicInteger(int initialValue) &#123; value = initialValue; &#125; public AtomicInteger() &#123; &#125; /** * Ëé∑ÂèñvalueÂú®ÂÜÖÂ≠ò‰∏≠ÂΩìÂâçÁöÑÂÄº * * @return the current value */ public final int get() &#123; return value; &#125; /** * ÊØîËæÉÂπ∂ÊõøÊç¢ ÂÆûÁé∞Âú®unsafe.compareAndSwapInt‰∏≠ * @param expect ÊúüÊúõÂÄº * @param update Êñ∞ÂÄº */ public final boolean compareAndSet(int expect, int update) &#123; return unsafe.compareAndSwapInt(this, valueOffset, expect, update); &#125; /** * Ëá™Â¢û ÂÆûÁé∞Âú®unsafe.getAndAddInt‰∏≠ */ public final int incrementAndGet() &#123; return unsafe.getAndAddInt(this, valueOffset, 1) + 1; &#125;&#125; Unsafe.class 12345678910111213public final native boolean compareAndSwapInt(Object o, long valueOffset, int expected, int value);/** * Ëé∑ÂèñÂΩìÂâçÂÄº Âπ∂Âä†1ÔºåËøîÂõûÁöÑÊòØÂä†1ÂâçÁöÑÂÄº */public final int getAndAddInt(Object o, long valueOffset, int addValue) &#123; int currentValue; do &#123; currentValue = this.getIntVolatile(o, valueOffset); // ÊØîËæÉÂΩìÂâçÂÜÖÂ≠òÁöÑÂÄºÂíåÈ¢ÑÊúüÂÄºcurrentValueÊòØÂê¶‰∏ÄËá¥Ôºå‰∏ÄËá¥ÁöÑËØùÂàôËÆæÁΩÆÊñ∞ÂÄº„ÄÇ‰ΩÜÊòØÂõ†‰∏∫ÂΩìÂâçÂÜÖÂ≠ò‰∏≠ÁöÑÂÄºÊúâÂèØËÉΩË¢´ÂÖ∂‰ªñÁ∫øÁ®ã‰øÆÊîπÔºå‰ºöÊúâÂíåÈ¢ÑÊúüÂÄº‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºåÊâÄ‰ª•ËøôÈáå‰ºöÂæ™ÁéØÁõ¥Âà∞ compareAndSwapInt ËøîÂõûÊàêÂäü‰∏∫Ê≠¢ÔºåËøôÈáåÁöÑÊìç‰Ωú‰πüÁß∞‰∏∫CASËá™Êóã &#125; while(!this.compareAndSwapInt(o, valueOffset, currentValue, value + addValue)); return value;&#125; AtomicIntegerÊòØJavaÂØπIntegerÁ±ªÂûãÂéüÂ≠êÊÄßÊìç‰ΩúÁöÑÂÆûÁé∞ÔºåÂèØ‰ª•ÁúãÂà∞Â∫ïÂ±ÇÈÉΩÊòØË∞ÉÁî®‰∫ÜCAS compareAndSwapIntnativeÊñπÊ≥ï„ÄÇËøôÈáå‰∏ªË¶ÅÁúã‰∏Ä‰∏ãcompareAndSwapInt(Object o, long valueOffset, int expect, int update)ÁöÑÂõõ‰∏™ÂèÇÊï∞ o ÂΩìÂâçÊìç‰ΩúÁöÑÂØπË±° valueOffset Êìç‰ΩúÂÄºÊâÄÂú®ÁöÑÂÜÖÂ≠ò‰ΩçÁΩÆ expect ÊúüÊúõÂÄº update Êñ∞ÂÄº ÂÖ∑‰ΩìÂÆûÁé∞ÊòØÂ∞ÜÂÜÖÂ≠ò‰ΩçÁΩÆÂ§ÑÁöÑÊï∞ÂÄº‰∏éÈ¢ÑÊúüÊï∞ÂÄºÁõ∏ÊØîËæÉÔºåËã•Áõ∏Á≠âÔºåÂàôÂ∞ÜÂÜÖÂ≠ò‰ΩçÁΩÆÂ§ÑÁöÑÂÄºÊõøÊç¢‰∏∫Êñ∞ÂÄº„ÄÇËã•‰∏çÁõ∏Á≠âÔºåÂàô‰∏çÂÅö‰ªª‰ΩïÊìç‰Ωú„ÄÇCASËá™ÊóãÊåáÁöÑÊòØÊõøÊç¢Êñ∞ÂÄºÂ§±Ë¥•Êó∂‰ºöËøõÂÖ•Âæ™ÁéØÔºåÈáçÊñ∞Ëé∑ÂèñÊúüÊúõÂÄºÔºåÁõ¥Âà∞ÊúüÊúõÂÄºÂíåÂÜÖÂ≠ò‰ΩçÁΩÆÂ§ÑÁöÑÊï∞ÂÄºÁõ∏Á≠â„ÄÇ CASÁöÑÈóÆÈ¢òABAÈóÆÈ¢òÊèêÂà∞CASÂ≠òÂú®ÁöÑÈóÆÈ¢òÔºåÂ∞±‰∏çÂæó‰∏çÊèêABAÈóÆÈ¢òÔºå‰ªÄ‰πàÊòØABAÈóÆÈ¢òÂë¢Ôºü‰∏æ‰∏™‰æãÂ≠êÔºåAÊòØ‰∏™ÂÖ±‰∫´ÂèòÈáèÔºåÂéüÂÄºÊòØ10ÔºåÁ∫øÁ®ã1‰ªéÂÜÖÂ≠ò‰∏≠ÊãøÂà∞‰∫ÜAÔºåÊ≠§Êó∂ÂÄº‰∏∫10ÔºåÂΩìÁ∫øÁ®ã1Ë¶ÅÂØπÂèòÈáèAËøõË°åCASÊìç‰ΩúÂâçÔºåÂõ†‰∏∫ÂÖ∂‰ªñÁ∫øÁ®ãÁöÑÊìç‰ΩúÔºåA‰ªé10Âèò‰∏∫‰∫Ü11ÔºåÂèà‰ªé11ÂèòÂõû‰∫Ü10„ÄÇÊ≠§Êó∂Á∫øÁ®ã1ÂØπÂèòÈáèAÊâßË°åCASÊìç‰ΩúÁÖßÈÅìÁêÜÂ∫îËØ•ÊòØË¶ÅÂ§±Ë¥•ÁöÑÔºå‰ΩÜÂÆûÈôÖÂç¥ÊòØÊàêÂäüÁöÑ„ÄÇËøôÊòØÂõ†‰∏∫ÁªèËøá‰∫Ü‰∏äÈù¢ÁöÑÊµÅÁ®ãÔºåÂú®Á∫øÁ®ã1ÁúãÊù•ÔºåÂèòÈáèAÊ≤°ÊúâÂèëÁîü‰ªª‰ΩïÂèòÂåñÔºåÊâÄ‰ª•ÂÆÉÊâßË°åCASÊìç‰ΩúÊòØ‰ºöÊàêÂäüÁöÑ„ÄÇ Ë¶ÅËß£ÂÜ≥ABAÈóÆÈ¢òÔºåÈÄöÂ∏∏ÁöÑËß£ÂÜ≥ÊñπÊ°àÁªôÂØπË±°Âä†‰∏äÁâàÊú¨Âè∑ÔºåÊØèÁªèËøá‰∏ÄÊ¨°CASÊìç‰ΩúÂ∞±Êõ¥Êñ∞‰∏ÄÊ¨°ÁâàÊú¨Âè∑ ÊÄªÁªìÊú¨ÊñáÁöÑÁõÆÁöÑ‰∏ªË¶ÅÊòØËÆ©Ëá™Â∑±ÂØπjavaÂπ∂ÂèëÂåÖÁöÑÂü∫Á°ÄCASÊúâ‰∏™ÁÆÄÂçïÁöÑ‰∫ÜËß£Ôºå‰ª•‰æøËøõË°åÂêéÁª≠ÁöÑÊ∫êÁ†ÅÂàÜÊûê]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>Âπ∂ÂèëÁºñÁ®ã</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TomcatÊ∫êÁ†ÅËß£Êûê‰∏â ConnectorËøûÊé•Âô®]]></title>
    <url>%2F2019%2F02%2F13%2FTomcat%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%89-Connector%E8%BF%9E%E6%8E%A5%E5%99%A8%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏äÊñáÂàÜÊûê‰∫ÜTomcatÁöÑÂêØÂä®ÊµÅÁ®ãÔºåÊàë‰ª¨Â∑≤ÁªèÂ§ßËá¥ÁêÜÊ∏Ö‰∫ÜTomcatÂêØÂä®ÁöÑÊï¥‰∏™ÊµÅÁ®ãÔºåÊú¨ÊñáÂ∞Ü‰ºöÂØπConnectorËøûÊé•Âô®ÁöÑÂàõÂª∫ËøõË°åÂàÜÊûê Êï¥‰ΩìÊû∂ÊûÑ ‰∏äÂõæÂÆåÊï¥‰∫ÜÊ¶ÇÊã¨‰∫ÜÊï¥‰∏™ConnectorÁöÑÊû∂ÊûÑ‰ΩìÁ≥ªÔºåÂÖàÁÆÄÂçïÁöÑ‰ªãÁªç‰∏Ä‰∏ãÂêÑ‰∏™ÁªÑ‰ª∂ÁöÑÂäüËÉΩ Endpoint Áî®Êù•Â§ÑÁêÜÂ∫ïÂ±ÇSocketÁöÑÁΩëÁªúËøûÊé• Processor Áî®Êù•ÂÆûÁé∞HTTPÂçèËÆÆÁöÑ Adapter Â∞ÜËØ∑Ê±ÇÈÄÇÈÖçÂà∞ServletÂÆπÂô®ËøõË°åÂÖ∑‰ΩìÁöÑÂ§ÑÁêÜ org.apache.catalina.connector.ConnectorÊàë‰ª¨ÂÖàÊù•Áúã‰∏ãorg.apache.catalina.connector.ConnectorËøô‰∏™‰∏ª‰ΩìÁ±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºåConnectorÁ±ªÂàùÂßãÂåñÊòØÂú®TomcatËØªÂèñÈÖçÁΩÆÊñá‰ª∂Êó∂Â∞±ÂÆåÊàêÁöÑ 1234567891011121314151617181920212223242526272829303132333435public Connector(String protocol) &#123; boolean aprConnector = AprLifecycleListener.isAprAvailable() &amp;&amp; AprLifecycleListener.getUseAprConnector(); // Âà§Êñ≠ÂçèËÆÆÁ±ªÂûã if (&quot;HTTP/1.1&quot;.equals(protocol) || protocol == null) &#123; if (aprConnector) &#123; protocolHandlerClassName = &quot;org.apache.coyote.http11.Http11AprProtocol&quot;; &#125; else &#123; protocolHandlerClassName = &quot;org.apache.coyote.http11.Http11NioProtocol&quot;; &#125; &#125; else if (&quot;AJP/1.3&quot;.equals(protocol)) &#123; if (aprConnector) &#123; protocolHandlerClassName = &quot;org.apache.coyote.ajp.AjpAprProtocol&quot;; &#125; else &#123; protocolHandlerClassName = &quot;org.apache.coyote.ajp.AjpNioProtocol&quot;; &#125; &#125; else &#123; protocolHandlerClassName = protocol; &#125; // Instantiate protocol handler ProtocolHandler p = null; try &#123; Class&lt;?&gt; clazz = Class.forName(protocolHandlerClassName); p = (ProtocolHandler) clazz.getConstructor().newInstance(); &#125; catch (Exception e) &#123; log.error(‰ªÄ‰πà.getString( &quot;coyoteConnector.protocolHandlerInstantiationFailed&quot;), e); &#125; finally &#123; this.protocolHandler = p; &#125; // Default for Connector depends on this system property setThrowOnFailure(Boolean.getBoolean(&quot;org.apache.catalina.startup.EXIT_ON_INIT_FAILURE&quot;));&#125; ËøôÈáåÂÖ∂ÂÆûÊòØÊãøÂà∞server.xml‰∏≠ConnectorÁöÑÂçèËÆÆÈÖçÁΩÆÔºåÂà©Áî®ÂèçÂ∞ÑÂàõÂª∫ProtocolHandleÔºåConnectorÂ∞±ÊòØ‰ΩøÁî®ProtocolHandlerÊù•Â§ÑÁêÜËØ∑Ê±ÇÁöÑÔºå‰∏çÂêåÁöÑProtocolHandler‰ª£Ë°®‰∏çÂêåÁöÑËøûÊé•Á±ªÂûã„ÄÇ Âõ†‰∏∫ÊàëËøôÈáå‰ΩøÁî®ÁöÑÊòØtomcat9ÁöÑÊ∫êÁ†ÅÁâàÊú¨ÔºåÂèØ‰ª•ÁúãÂà∞ÂÖ∂Â∑≤ÁªèÊ∑òÊ±∞‰∫ÜBIO„ÄÇÈªòËÆ§ÁöÑhttp1.1ÂçèËÆÆÂ§ÑÁêÜÁ±ªÂ∑≤ÁªèÊòØorg.apache.coyote.http11NioProtocol‰∫ÜÔºå‰∏ãÈù¢Êàë‰ª¨Â∞±‰ª•http11NioProtocolÁªßÁª≠ÂæÄ‰∏ãÂàÜÊûê org.apache.coyote.http11NioProtocolÈÄöËøáÊü•ÁúãHttp11NioProtocolÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºåÂèØÁü•EndpointÁöÑÂÆûÁé∞Á±ªÊòØNioEndpoint123public Http11NioProtocol() &#123; super(new NioEndpoint());&#125; Endpoint‰∏äÊñáÊúâËØ¥ËøáÊòØÁî®Êù•Â§ÑÁêÜÂ∫ïÂ±ÇSocketÁΩëÁªúËøûÊé•ÁöÑÔºå‰∏ãÈù¢Â∞±ËÆ©Êàë‰ª¨Êù•Áúã‰∏ãNioEndpointÁöÑÂÆûÁé∞ NioEndpointËøòÊòØÂÖàÁúã‰∏ãÂêØÂä®ÊñπÊ≥ï startInternal‰∏≠ÁöÑÂÆûÁé∞123456789101112131415public void startInternal() throws Exception &#123; ..... // ÂàùÂßãÂåñPollerÊï∞ÁªÑÔºåÂêØÂä®PollerÁ∫øÁ®ã pollers = new Poller[getPollerThreadCount()]; for (int i=0; i&lt;pollers.length; i++) &#123; pollers[i] = new Poller(); Thread pollerThread = new Thread(pollers[i], getName() + &quot;-ClientPoller-&quot;+i); pollerThread.setPriority(threadPriority); pollerThread.setDaemon(true); pollerThread.start(); &#125; // ÂêØÂä® Acceptor Á∫øÁ®ã startAcceptorThreads(); &#125;&#125; ËøôÈáåÊàëÁúÅÁï•‰∫ÜÂÖ∂‰ªñ‰ª£Á†ÅÔºåÂèØ‰ª•ÁúãÂà∞Âú®ËøôÈáåÂàùÂßãÂåñ‰∫ÜÂ§ö‰∏™PollerÁ±ªÔºåÂπ∂ÂçïÁã¨ÂêØÂä®‰∫ÜÁ∫øÁ®ãÔºåËøôÈáåÁöÑÊØè‰∏™PollerÂÖ∂ÂÆûÈÉΩÁªëÂÆö‰∫Ü‰∏Ä‰∏™SelectorÈÄâÊã©Âô®ÔºàÔºâ„ÄÇÂπ∂‰∏îË∞ÉÁî®startAcceptorThreadsÊñπÊ≥ïÂêØÂä®‰∫ÜAcceptorÁ∫øÁ®ãÔºåÁî®Êù•Êé•Êî∂Êñ∞ÁöÑËØ∑Ê±Ç„ÄÇ‰∏ãÈù¢Êàë‰ª¨ÁªßÁª≠ÁúãstartAcceptorThreadsÊñπÊ≥ï 12345678910111213141516protected void startAcceptorThreads() &#123; // Ëé∑ÂèñAcceptorÁ∫øÁ®ãÊï∞ ÈªòËÆ§ÊòØ1 int count = getAcceptorThreadCount(); acceptors = new ArrayList&lt;&gt;(count); for (int i = 0; i &lt; count; i++) &#123; Acceptor&lt;U&gt; acceptor = new Acceptor&lt;&gt;(this); String threadName = getName() + &quot;-Acceptor-&quot; + i; acceptor.setThreadName(threadName); acceptors.add(acceptor); Thread t = new Thread(acceptor, threadName); t.setPriority(getAcceptorThreadPriority()); t.setDaemon(getDaemon()); t.start(); &#125;&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÊ†πÊçÆÈÖçÁΩÆÂêØÂä®‰∫ÜÂ§ö‰∏™AcceptorÁ∫øÁ®ãÔºå‰∏ãÈù¢Â∞±ÂéªÁúã‰∏ãAcceptorÁ±ªÁöÑrunÊñπÊ≥ï Acceptor1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980public void run() &#123; int errorDelay = 0; // Loop until we receive a shutdown command while (endpoint.isRunning()) &#123; .... try &#123; // Êé•Êî∂Êñ∞ÁöÑËØ∑Ê±Ç socket = endpoint.serverSocketAccept(); &#125; catch (Exception ioe) &#123; // We didn&apos;t get a socket endpoint.countDownConnection(); if (endpoint.isRunning()) &#123; // Introduce delay if necessary errorDelay = handleExceptionWithDelay(errorDelay); // re-throw throw ioe; &#125; else &#123; break; &#125; &#125; // Successful accept, reset the error delay errorDelay = 0; // Configure the socket if (endpoint.isRunning() &amp;&amp; !endpoint.isPaused()) &#123; // ËÆæÁΩÆÊñ∞ÁöÑSocketËøûÊé•‰∏éPollerÁªëÂÆöÔºåÂπ∂ËÆæÁΩÆÁõ∏ÂÖ≥ÂèÇÊï∞ if (!endpoint.setSocketOptions(socket)) &#123; endpoint.closeSocket(socket); &#125; &#125; else &#123; endpoint.destroySocket(socket); &#125; &#125; catch (Throwable t) &#123; &#125; state = AcceptorState.ENDED;&#125;// NioEndpoint.class ‰∏≠protected boolean setSocketOptions(SocketChannel socket) &#123; // Process the connection try &#123; // ËÆæÁΩÆÊ≠§SocketËøûÊé•Êú™ÈùûÈòªÂ°û socket.configureBlocking(false); Socket sock = socket.socket(); // ËÆæÁΩÆÊ≠§SocketÁöÑÁõ∏ÂÖ≥ÂèÇÊï∞ÂÄº socketProperties.setProperties(sock); NioChannel channel = nioChannels.pop(); if (channel == null) &#123; SocketBufferHandler bufhandler = new SocketBufferHandler( socketProperties.getAppReadBufSize(), socketProperties.getAppWriteBufSize(), socketProperties.getDirectBuffer()); // Âà§Êñ≠ÊòØÂê¶ÂºÄÂêØssl if (isSSLEnabled()) &#123; channel = new SecureNioChannel(socket, bufhandler, selectorPool, this); &#125; else &#123; channel = new NioChannel(socket, bufhandler); &#125; &#125; else &#123; channel.setIOChannel(socket); channel.reset(); &#125; // ÁªëÂÆö Poller ÂÖ∂ÂÆûÂ∞±ÊòØÁªëÂÆöÈÄâÊã©Âô® Selector getPoller0().register(channel); &#125; catch (Throwable t) &#123; ExceptionUtils.handleThrowable(t); try &#123; log.error(sm.getString(&quot;endpoint.socketOptionsError&quot;), t); &#125; catch (Throwable e) &#123; ExceptionUtils.handleThrowable(e); &#125; // Tell to close the socket return false; &#125; return true;&#125; ‰∏äÈù¢‰ª£Á†ÅÈÄªËæë‰∏ªË¶ÅÂÅö‰∫Ü‰∏§‰ª∂‰∫ãÊÉÖ Ë∞ÉÁî®NioEndpointÁöÑserverSocketAcceptÊñπÊ≥ïÊù•Êé•Êî∂Êñ∞ÁöÑËØ∑Ê±ÇÔºåÊ≥®ÊÑèËøôÈáåÊòØÈòªÂ°ûÁöÑ Ë∞ÉÁî®NioEndpointÁöÑsetSocketOptionsÊñπÊ≥ïÂØπÊñ∞Êé•Êî∂ÁöÑSocketËØ∑Ê±ÇÔºåÈÖçÁΩÆÁõ∏ÂÖ≥‰ø°ÊÅØÔºåÂπ∂ÁªëÂÆöPoller(ÁªëÂÆöÈÄâÊã©Âô® Selector) PollerÊé•‰∏ãÊù•Êàë‰ª¨Â∞Ü‰ºöÂàÜÊûêPollerÁ±ªÔºåÊòØNioEndpointÁöÑÂÜÖÈÉ®Á±ª 123456789101112131415public void register(final NioChannel socket) &#123; socket.setPoller(this); NioSocketWrapper ka = new NioSocketWrapper(socket, NioEndpoint.this); socket.setSocketWrapper(ka); ka.setPoller(this); ka.setReadTimeout(getConnectionTimeout()); ka.setWriteTimeout(getConnectionTimeout()); ka.setKeepAliveLeft(NioEndpoint.this.getMaxKeepAliveRequests()); ka.setSecure(isSSLEnabled()); PollerEvent r = eventCache.pop(); ka.interestOps(SelectionKey.OP_READ);//this is what OP_REGISTER turns into. if ( r==null) r = new PollerEvent(socket,ka,OP_REGISTER); else r.reset(socket,ka,OP_REGISTER); addEvent(r);&#125; registerÊñπÊ≥ïÂ∞±ÊòØÂ∞ÜÊñ∞ÁöÑSocketËøûÊé•‰∏éSelectorËøõË°åÁªëÂÆöÔºåÂπ∂Ê≥®ÂÜåÁõëÂê¨ËØª‰∫ã‰ª∂ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public void run() &#123; // Loop until destroy() is called while (true) &#123; boolean hasEvents = false; try &#123; if (!close) &#123; hasEvents = events(); if (wakeupCounter.getAndSet(-1) &gt; 0) &#123; //if we are here, means we have other stuff to do //do a non blocking select keyCount = selector.selectNow(); &#125; else &#123; keyCount = selector.select(selectorTimeout); &#125; wakeupCounter.set(0); &#125; if (close) &#123; events(); timeout(0, false); try &#123; selector.close(); &#125; catch (IOException ioe) &#123; log.error(‰ªÄ‰πà.getString(&quot;endpoint.nio.selectorCloseFail&quot;), ioe); &#125; break; &#125; &#125; catch (Throwable x) &#123; ExceptionUtils.handleThrowable(x); log.error(‰ªÄ‰πà.getString(&quot;endpoint.nio.selectorLoopError&quot;), x); continue; &#125; //either we timed out or we woke up, process events first if ( keyCount == 0 ) hasEvents = (hasEvents | events()); Iterator&lt;SelectionKey&gt; iterator = keyCount &gt; 0 ? selector.selectedKeys().iterator() : null; // Walk through the collection of ready keys and dispatch // any active event. while (iterator != null &amp;&amp; iterator.hasNext()) &#123; SelectionKey sk = iterator.next(); NioSocketWrapper attachment = (NioSocketWrapper)sk.attachment(); // Attachment may be null if another thread has called // cancelledKey() if (attachment == null) &#123; iterator.remove(); &#125; else &#123; iterator.remove(); processKey(sk, attachment); &#125; &#125;//while //process timeouts timeout(keyCount,hasEvents); &#125;//while getStopLatch().countDown();&#125; runÊñπÊ≥ï‰∏≠ÁöÑ‰∏ÄÂ§ßÂ†Ü‰ª£Á†ÅÔºåÂ§öÊòØ‰∏éNIOÁõ∏ÂÖ≥Ôºå‰∏ªË¶ÅÈÄªËæëÂ∞±ÊòØË∞ÉÁî®selectorÁöÑselect()ÂáΩÊï∞ÔºåÁõëÂê¨Â∞±Áª™‰∫ã‰ª∂„ÄÇËøôÈáåÊàë‰ª¨ÂèØ‰ª•Áõ¥Êé•ÁúãprocessKeyÊñπÊ≥ïÔºåËøôÈáåÊòØÊ†πÊçÆSelectionKeyÊù•ÂàÜÂà´ÊâßË°åÂÖ∑‰ΩìÈÄªËæë 12345678910111213141516171819202122232425262728293031323334353637383940protected void processKey(SelectionKey sk, NioSocketWrapper attachment) &#123; try &#123; if ( close ) &#123; cancelledKey(sk); &#125; else if ( sk.isValid() &amp;&amp; attachment != null ) &#123; if (sk.isReadable() || sk.isWritable() ) &#123; if ( attachment.getSendfileData() != null ) &#123; processSendfile(sk,attachment, false); &#125; else &#123; unreg(sk, attachment, sk.readyOps()); boolean closeSocket = false; // Â¶ÇÊûúÊòØÂèØËØª‰∫ã‰ª∂Â∞±Áª™ if (sk.isReadable()) &#123; // ÊâßË°åÂÖ∑‰ΩìÈÄªËæëÁöÑÂú∞Êñπ if (!processSocket(attachment, SocketEvent.OPEN_READ, true)) &#123; closeSocket = true; &#125; &#125; // Â¶ÇÊûúÊòØÂèØÂÜô‰∫ã‰ª∂Â∞±Áª™ if (!closeSocket &amp;&amp; sk.isWritable()) &#123; if (!processSocket(attachment, SocketEvent.OPEN_WRITE, true)) &#123; closeSocket = true; &#125; &#125; if (closeSocket) &#123; cancelledKey(sk); &#125; &#125; &#125; &#125; else &#123; //invalid key cancelledKey(sk); &#125; &#125; catch ( CancelledKeyException ckx ) &#123; cancelledKey(sk); &#125; catch (Throwable t) &#123; ExceptionUtils.handleThrowable(t); log.error(sm.getString(&quot;endpoint.nio.keyProcessingError&quot;), t); &#125;&#125; processKeyÊñπÊ≥ï‰πüÊòØÁõ¥Êé•Ë∞ÉÁî®‰∫ÜAbstractEndpointÁöÑprocessSocketÊñπÊ≥ï 1234567891011121314151617181920212223242526272829303132public boolean processSocket(SocketWrapperBase&lt;S&gt; socketWrapper, SocketEvent event, boolean dispatch) &#123; try &#123; if (socketWrapper == null) &#123; return false; &#125; SocketProcessorBase&lt;S&gt; sc = processorCache.pop(); if (sc == null) &#123; // ÂàõÂª∫‰∏Ä‰∏™ SocketProcessor ÂÆû‰æã sc = createSocketProcessor(socketWrapper, event); &#125; else &#123; sc.reset(socketWrapper, event); &#125; Executor executor = getExecutor(); if (dispatch &amp;&amp; executor != null) &#123; executor.execute(sc); &#125; else &#123; // ÊâßË°å sc.run(); &#125; &#125; catch (RejectedExecutionException ree) &#123; getLog().warn(‰ªÄ‰πà.getString(&quot;endpoint.executor.fail&quot;, socketWrapper) , ree); return false; &#125; catch (Throwable t) &#123; ExceptionUtils.handleThrowable(t); // This means we got an OOM or similar creating a thread, or that // the pool and its queue are full getLog().error(‰ªÄ‰πà.getString(&quot;endpoint.process.fail&quot;), t); return false; &#125; return true;&#125; SocketProcessor123456789101112131415161718192021222324252627protected void doRun() &#123; NioChannel socket = socketWrapper.getSocket(); SelectionKey key = socket.getIOChannel().keyFor(socket.getPoller().getSelector()); .... ÁúÅÁï• if (handshake == 0) &#123; SocketState state = SocketState.OPEN; // Process the request from this socket if (event == null) &#123; // Ëé∑Âèñ ConnectionHandlerÂπ∂Ë∞ÉÁî®processÊâßË°åÂÖ∑‰ΩìÈÄªËæë state = getHandler().process(socketWrapper, SocketEvent.OPEN_READ); &#125; else &#123; state = getHandler().process(socketWrapper, event); &#125; if (state == SocketState.CLOSED) &#123; close(socket, key); &#125; &#125; else if (handshake == -1 ) &#123; close(socket, key); &#125; else if (handshake == SelectionKey.OP_READ)&#123; socketWrapper.registerReadInterest(); &#125; else if (handshake == SelectionKey.OP_WRITE)&#123; socketWrapper.registerWriteInterest(); &#125; &#125; &#125;&#125; SocketProcessorÈÄªËæëÊØîËæÉÁÆÄÂçïÔºådoRunÊñπÊ≥ïÁªßÁª≠‰ºöÂæÄ‰∏ãË∞ÉÁî®ÔºåÊúÄÁªàhttpÂçèËÆÆÁöÑËß£ÊûêÊòØÂú®Http11ProcessorÁöÑservice‰∏≠ËøõË°åÔºåHttp11ProcessorÂ∞±ÂØπÂ∫î‰∏äÊñáÊû∂ÊûÑÂõæÁöÑProcessÊ®°ÂùóÔºåÂú®ProcessÂÆåÊàêHttpÂçèËÆÆËß£Êûê‰πãÂêéÔºå‰ºöÁî±ÈÄÇÈÖçÂô®ËøõË°åÈÄÇÈÖçÂêéÂÜç‰∫§ÁªôServletÂÆπÂô®ËøõË°åÂÖ∑‰ΩìÂ§ÑÁêÜ ÊÄªÁªìÊú¨ÊñáÂàÜÊûêTomcatÁöÑConnectorËøûÊé•Âô®ÁöÑÈÉ®ÂàÜÊ∫êÁ†ÅÔºåConnectorÊòØTomcatÁöÑÊ†∏ÂøÉÁªÑ‰ª∂ÔºåConnectorÁªÑ‰ª∂Áî®‰∫éÁ≠âÂæÖÁî®Êà∑ÁöÑËØ∑Ê±ÇÔºåÂåÖÊã¨ÊîØÊåÅhttp1.1Ôºåhttp2Á≠âÂçèËÆÆÔºåËß£ÊûêÁî®Êà∑ËØ∑Ê±ÇÔºåÂ∞ÅË£ÖËØ∑Ê±Ç‰ø°ÊÅØÔºåÊúÄÂêéÊâç‰∫§ÁªôÊàë‰ª¨ÁÜüÊÇâÁöÑ ServletÂ§ÑÁêÜ„ÄÇÈòÖËØªÊ≠§Ê∫êÁ†ÅÂØπ‰∫éÁêÜËß£httpÂçèËÆÆ‰πüÊúâÂæàÂ§ßÁöÑÂ∏ÆÂä©„ÄÇ]]></content>
      <categories>
        <category>webÂÆπÂô®</category>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TomcatÊ∫êÁ†ÅËß£Êûê‰∫å ÂêØÂä®ËøáÁ®ã]]></title>
    <url>%2F2019%2F02%2F12%2FTomcat%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%BA%8C-%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏äÊñá‰ªãÁªç‰∫ÜTomcatËÆæËÆ°ÁöÑÊï¥‰ΩìÊû∂ÊûÑÔºåÂØπ‰∫éÊé•‰∏ãÊù•ÁöÑÊ∫êÁ†ÅÂàÜÊûêÈùûÂ∏∏ÈáçË¶Å„ÄÇÊé•‰∏ãÊù•Êàë‰ª¨Â∞Ü‰ªéTomcatÁöÑÂÖ•Âè£ÂêØÂä®ÂºÄÂßãÂàÜÊûêTomcatÁöÑÊ∫êÁ†Å TomcatÁöÑÂêØÂä®ÂÖ•Âè£Êàë‰ª¨ÂèØ‰ª•‰ªéÂÖ∂ÂêØÂä®ËÑöÊú¨catalina.sh‰∏≠ÂèëÁé∞ÔºåÊòØÁî±org.apache.catalina.startup.Bootstrap.javaÁöÑmainÊñπÊ≥ïÂêØÂä®ÁöÑ„ÄÇÁé∞Âú®Êàë‰ª¨Â∞±‰ªéBootstrap.javaÂºÄÂßãÂàÜÊûêtomcatÁöÑÊ∫êÁ†Å BootstrapÂú®ÁúãMainÂáΩÊï∞‰πãÂâçÔºåÊàë‰ª¨ÂÖàÁúã‰∏ãÈùôÊÄÅÂùó‰∏≠ÁöÑ‰ª£Á†Å 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061static &#123; String userDir = System.getProperty(&quot;user.dir&quot;); // Ëé∑Âèñ catalina.home ÁöÑÈÖçÁΩÆÁõÆÂΩï String home = System.getProperty(Globals.CATALINA_HOME_PROP); File homeFile = null; if (home != null) &#123; File f = new File(home); try &#123; homeFile = f.getCanonicalFile(); &#125; catch (IOException ioe) &#123; homeFile = f.getAbsoluteFile(); &#125; &#125; // Â¶ÇÊûúÊú™ÈÖçÁΩÆ ÂàôÂèñbootstrap.jarÊâÄÂú®ÁõÆÂΩïÁöÑ‰∏ä‰∏ÄÁ∫ß if (homeFile == null) &#123; // First fall-back. See if current directory is a bin directory // in a normal Tomcat install File bootstrapJar = new File(userDir, &quot;bootstrap.jar&quot;); if (bootstrapJar.exists()) &#123; File f = new File(userDir, &quot;..&quot;); try &#123; homeFile = f.getCanonicalFile(); &#125; catch (IOException ioe) &#123; homeFile = f.getAbsoluteFile(); &#125; &#125; &#125; if (homeFile == null) &#123; // Second fall-back. Use current directory File f = new File(userDir); try &#123; homeFile = f.getCanonicalFile(); &#125; catch (IOException ioe) &#123; homeFile = f.getAbsoluteFile(); &#125; &#125; catalinaHomeFile = homeFile; System.setProperty( Globals.CATALINA_HOME_PROP, catalinaHomeFile.getPath()); // Êú™ÈÖçÁΩÆcatalina.baseÁöÑÊÉÖÂÜµ‰∏ãÔºåcatalina.baseÁöÑÁõÆÂΩïÂíåcatalina.home‰∏ÄËá¥ String base = System.getProperty(Globals.CATALINA_BASE_PROP); if (base == null) &#123; catalinaBaseFile = catalinaHomeFile; &#125; else &#123; File baseFile = new File(base); try &#123; baseFile = baseFile.getCanonicalFile(); &#125; catch (IOException ioe) &#123; baseFile = baseFile.getAbsoluteFile(); &#125; catalinaBaseFile = baseFile; &#125; System.setProperty( Globals.CATALINA_BASE_PROP, catalinaBaseFile.getPath());&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅËÆæÁΩÆ‰∫ÜTomcatÁöÑÂÆâË£ÖÁõÆÂΩïÂíåÂÆûÈôÖÂ∑•‰ΩúÁõÆÂΩï catalina.base tomcatÂ∑•‰ΩúÁõÆÂΩï Êåáconf„ÄÅlogs„ÄÅtemp„ÄÅwebappsÂíåworkÊñá‰ª∂Â§πÁöÑÁà∂ÁõÆÂΩï catalina.home ÂÆâË£ÖÁõÆÂΩï ÂÖ∂ÂÆûÊòØÊåábinÂíålibÊñá‰ª∂Â§πÁöÑÁà∂ÁõÆÂΩï Âà©Áî®Ëøô‰∏™ÁâπÊÄßÔºåÊàë‰ª¨ÂèØ‰ª•‰∏çÂøÖÂ§çÂà∂Â§ö‰∏™tomcatÊù•ÂêØÂä®Â§ö‰∏™ÂÆû‰æã Main ÂáΩÊï∞ÂÖ•Âè£ÁªßÁª≠ÂæÄ‰∏ãÁúãÔºåÂ∞±ÊòØTomcatÂêØÂä®ÁöÑÊúÄÁªàÂÖ•Âè£‰∫Ü 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public static void main(String args[]) &#123; // ‰∏∫‰ΩïËøôÈáåË¶ÅÂä†ÈîÅÔºüÔºü synchronized (daemonLock) &#123; if (daemon == null) &#123; // Don&apos;t set daemon until init() has completed Bootstrap bootstrap = new Bootstrap(); try &#123; // ÊâßË°åÂàùÂßãÂåñÊñπÊ≥ï bootstrap.init(); &#125; catch (Throwable t) &#123; handleThrowable(t); t.printStackTrace(); return; &#125; daemon = bootstrap; &#125; else &#123; // When running as a service the call to stop will be on a new // thread so make sure the correct class loader is used to // prevent a range of class not found exceptions. Thread.currentThread().setContextClassLoader(daemon.catalinaLoader); &#125; &#125; try &#123; String command = &quot;start&quot;; if (args.length &gt; 0) &#123; // Ëé∑ÂèñÂëΩ‰ª§ÂèÇÊï∞ command = args[args.length - 1]; &#125; if (command.equals(&quot;startd&quot;)) &#123; args[args.length - 1] = &quot;start&quot;; daemon.load(args); daemon.start(); &#125; else if (command.equals(&quot;stopd&quot;)) &#123; args[args.length - 1] = &quot;stop&quot;; daemon.stop(); &#125; else if (command.equals(&quot;start&quot;)) &#123; // ÂêØÂä® daemon.setAwait(true); daemon.load(args); daemon.start(); if (null == daemon.getServer()) &#123; System.exit(1); &#125; &#125; else if (command.equals(&quot;stop&quot;)) &#123; daemon.stopServer(args); &#125; else if (command.equals(&quot;configtest&quot;)) &#123; daemon.load(args); if (null == daemon.getServer()) &#123; System.exit(1); &#125; System.exit(0); &#125; else &#123; log.warn(&quot;Bootstrap: command \&quot;&quot; + command + &quot;\&quot; does not exist.&quot;); &#125; &#125; catch (Throwable t) &#123; .... &#125;&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÊòØÊï¥‰∏™tomcatÁöÑÁªü‰∏ÄÂÖ•Âè£„ÄÇÂèØ‰ª•ÁúãÂà∞ÔºåÂú®MainÊñπÊ≥ï‰∏≠ÔºåÊâßË°å‰∫ÜinitÊñπÊ≥ïÔºåÈÇ£‰πàÂú®initÊñπÊ≥ï‰∏≠ËÇØÂÆöÂÅö‰∫ÜÂæàÂ§ö‰∫ãÊÉÖ 1234567891011121314151617181920212223242526272829public void init() throws Exception &#123; // ÂàùÂßãÂåñÁ±ªÂä†ËΩΩÂô® initClassLoaders(); Thread.currentThread().setContextClassLoader(catalinaLoader); SecurityClassLoad.securityClassLoad(catalinaLoader); // Load our startup class and call its process() method if (log.isDebugEnabled()) log.debug(&quot;Loading startup class&quot;); // Ëé∑ÂèñÂÆπÂô®Á±ª org.apache.catalina.startup.Catalina Class&lt;?&gt; startupClass = catalinaLoader.loadClass(&quot;org.apache.catalina.startup.Catalina&quot;); // ÂÆû‰æãÂåñ‰∏Ä‰∏™ServletÂÆπÂô® Object startupInstance = startupClass.getConstructor().newInstance(); if (log.isDebugEnabled()) log.debug(&quot;Setting startup class properties&quot;); String methodName = &quot;setParentClassLoader&quot;; Class&lt;?&gt; paramTypes[] = new Class[1]; paramTypes[0] = Class.forName(&quot;java.lang.ClassLoader&quot;); Object paramValues[] = new Object[1]; paramValues[0] = sharedLoader; Method method = startupInstance.getClass().getMethod(methodName, paramTypes); method.invoke(startupInstance, paramValues); catalinaDaemon = startupInstance;&#125; Âú®initÊñπÊ≥ï‰∏≠ÂàùÂßãÂåñ‰∫ÜÁ±ªÂä†ËΩΩÂô®ÔºåÂπ∂‰∏îÂàùÂßãÂåñ‰∫Ü‰∏Ä‰∏™org.apache.catalina.startup.CatalinaÂÆû‰æãÔºåmainÊñπÊ≥ï‰∏≠Ë∞ÉÁî®CatalinaÁöÑstartÊñπÊ≥ïÊù•ÂêØÂä®ÂÆπÂô®„ÄÇ start12345678910111213141516171819202122232425262728293031323334public void start() &#123; // Â¶ÇÊûú Server‰∏∫Á©∫ÔºåÂàôÂàùÂßãÂåñ‰∏Ä‰∏™ if (getServer() == null) &#123; load(); &#125; if (getServer() == null) &#123; log.fatal(‰ªÄ‰πà.getString(&quot;catalina.noServer&quot;)); return; &#125; long t1 = System.nanoTime(); // Start the new server try &#123; // ÂêØÂä®Server getServer().start(); &#125; catch (LifecycleException e) &#123; try &#123; getServer().destroy(); &#125; catch (LifecycleException e1) &#123; log.debug(&quot;destroy() failed for failed Server &quot;, e1); &#125; return; &#125; long t2 = System.nanoTime(); if(log.isInfoEnabled()) &#123; &#125; if (await) &#123; await(); stop(); &#125;&#125; ÂèØ‰ª•ÁúãÂà∞StartÊñπÊ≥ï‰∏≠‰æùËµñË∞ÉÁî®‰∫ÜServerÁöÑstartÊñπÊ≥ïÔºåÁúãÂà∞ËøôÈáåÊàë‰ª¨ÂèØ‰ª•Áü•ÈÅì‰∏∫‰ΩïTomcatÂÆπÂô®Ëøô‰πàÂ§öÁöÑÁªÑ‰ª∂‰∏∫‰ΩïÂèØ‰ª•Áªü‰∏ÄÂêØÂä®ÔºåÁªü‰∏ÄÈîÄÊØÅÔºåÂÖ∂ÂÆûËøô‰∫õÁªÑ‰ª∂ÈÉΩÊòØorg.apache.catalina .LifecycleÁöÑÂÆûÁé∞Á±ªÔºåLifecycleÊé•Âè£ÂåÖÂê´‰∫ÜstartÂêØÂä®ÔºåinitÂàùÂßãÂåñÔºådestoryÈîÄÊØÅÔºåstopÂÅúÊ≠¢Á≠âÊñπÊ≥ïÔºåÂπ∂‰∏îÈÉΩÁªßÊâø‰∫ÜÊäΩË±°Á±ªLifecycleBaseÔºåÂÖ∂‰∏≠ÂÖ∑‰ΩìÁöÑinitInternal()„ÄÅstartInternal() ÂíåstopInternal() ÊñπÊ≥ïÔºå‰∫§Áî±Â≠êÁ±ªËá™Â∑±ÂÆûÁé∞ÈÄöËøáÂÆûÁé∞ËØ•Êé•Âè£ÔºåËææÂà∞Áªü‰∏ÄÂêØÂä®ÂÖ≥Èó≠ÁöÑÊïàÊûúÔºåËøôÈáåÂÖ∂ÂÆû‰ΩìÁé∞‰∫ÜÊ®°ÊùøÊñπÊ≥ïÁöÑËÆæËÆ°Ê®°Âºè„ÄÇ ÂÜçÂõûÂà∞‰∏äÈù¢ÁöÑÊñπÊ≥ïÔºåÊàë‰ª¨ÁùÄÈáçÁúã‰∏Ä‰∏ãloadÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂàùÂßãÂåñ‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑServer 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public void load() &#123; if (loaded) &#123; return; &#125; loaded = true; long t1 = System.nanoTime(); initDirs(); // Before digester - it may be needed initNaming(); // Set configuration source ConfigFileLoader.setSource(new CatalinaBaseConfigurationSource(Bootstrap.getCatalinaBaseFile(), getConfigFile())); File file = configFile(); // Ëß£ÊûêÈÖçÁΩÆÊñá‰ª∂ server.xml ÔºåÂàõÂª∫‰∏Ä‰∏™Ëß£ÊûêÂô® Digester digester = createStartDigester(); try (ConfigurationSource.Resource resource = ConfigFileLoader.getSource().getServerXml()) &#123; InputStream inputStream = resource.getInputStream(); InputSource inputSource = new InputSource(resource.getURI().toURL().toString()); inputSource.setByteStream(inputStream); digester.push(this); digester.parse(inputSource); &#125; catch (Exception e) &#123; if (file == null) &#123; log.warn(‰ªÄ‰πà.getString(&quot;catalina.configFail&quot;, getConfigFile() + &quot;] or [server-embed.xml&quot;), e); &#125; else &#123; log.warn(‰ªÄ‰πà.getString(&quot;catalina.configFail&quot;, file.getAbsolutePath()), e); if (file.exists() &amp;&amp; !file.canRead()) &#123; log.warn(‰ªÄ‰πà.getString(&quot;catalina.incorrectPermissions&quot;)); &#125; &#125; return; &#125; getServer().setCatalina(this); getServer().setCatalinaHome(Bootstrap.getCatalinaHomeFile()); getServer().setCatalinaBase(Bootstrap.getCatalinaBaseFile()); // Stream redirection initStreams(); // Start the new server try &#123; getServer().init(); &#125; catch (LifecycleException e) &#123; if (Boolean.getBoolean(&quot;org.apache.catalina.startup.EXIT_ON_INIT_FAILURE&quot;)) &#123; throw new java.lang.Error(e); &#125; else &#123; log.error(‰ªÄ‰πà.getString(&quot;catalina.initError&quot;), e); &#125; &#125; long t2 = System.nanoTime(); if(log.isInfoEnabled()) &#123; log.info(‰ªÄ‰πà.getString(&quot;catalina.init&quot;, Long.valueOf((t2 - t1) / 1000000))); &#125;&#125; loadÊñπÊ≥ïÂÖ∂ÂÆûÂÅöÁöÑ‰∏ªË¶Å‰∫ãÊÉÖÂ∞±ÊòØËß£Êûêserver.xmlÊñá‰ª∂Ôºåserver.xmlÊòØtomcatÂÖ≥ÈîÆÈÖçÁΩÆÊñá‰ª∂Ôºå‰∏äÁØáÊñáÁ´†Êàë‰ª¨ËÅäËøáTomcatÁöÑÊï¥‰ΩìÊû∂ÊûÑÔºåÊï¥‰∏™Êû∂ÊûÑ‰ΩìÁ≥ªÂÖ∂ÂÆûÈùûÂ∏∏ÂÆåÊï¥ÁöÑ‰ΩìÁé∞Âú®‰∫Üserver.xmlÊñá‰ª∂‰∏ä„ÄÇËøôÈáåËß£Êûêserver.xmlÊñá‰ª∂Áî®ÁöÑxmlËß£ÊûêÂ∑•ÂÖ∑ÊòØSAXÔºåÊòØ‰∏ÄÁßç‰ª•‰∫ã‰ª∂È©±Âä®ÁöÑXMl APIÔºåÂÖ∑‰ΩìËß£ÊûêÁöÑÊú∫Âà∂ËøôÈáåÂ∞±‰∏çËØ¥‰∫ÜËøôÈáåÂÖ∂ÂÆû‰æùÊ¨°ÈÄöËøáËß£ÊûêÈÖçÁΩÆÊñá‰ª∂ÂàõÂª∫‰∫Ü StandardServer„ÄÅStandardService„ÄÅStandardEngine„ÄÅStandardHost„ÄÇÁÑ∂ÂêéË∞ÉÁî®StandardServerÁöÑinit()ÊñπÊ≥ïÂàùÂßãÂåñTomcatÂÆπÂô®ÁöÑ‰∏ÄÁ≥ªÂàóÁªÑ‰ª∂ÔºåÂÆπÂô®ÂàùÂßãÂåñÁöÑÁöÑÊó∂ÂÄôÔºåÈÉΩ‰ºöË∞ÉÁî®ÂÖ∂Â≠êÂÆπÂô®ÁöÑinit()ÊñπÊ≥ïÔºåÂàùÂßãÂåñÂÆÉÁöÑÂ≠êÂÆπÂô®„ÄÇ‰∏äÈù¢ÊèêÂà∞ÁöÑÊòØinitÁöÑË∞ÉÁî®ËøáÁ®ãÔºåstartÊñπÊ≥ïÁöÑÂêØÂä®ËøáÁ®ãÂÖ∂ÂÆû‰πüÊòØÁ±ª‰ººÔºåÁî±Áà∂ÂÆπÂô®ÂêØÂä®Â≠êÂÆπÂô®Â±ÇÂ±ÇË∞ÉÁî®„ÄÇ ÊÄªÁªìÊú¨ÊñáÂàÜÊûê‰∫ÜTomcatÂêØÂä®ÈÉ®ÂàÜÁöÑÊ∫êÁ†ÅÔºåËøôÊòØÈòÖËØªÂÖ∂Ê∫êÁ†ÅÁöÑÂÖ•Âè£]]></content>
      <categories>
        <category>webÂÆπÂô®</category>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TomcatÊ∫êÁ†ÅËß£Êûê‰∏Ä Êû∂ÊûÑÂàùÁ™•]]></title>
    <url>%2F2019%2F01%2F20%2FTomcat%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%80-%E6%9E%B6%E6%9E%84%E5%88%9D%E7%AA%A5%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄTomcatÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â§çÊùÇÁöÑServletÂÆπÂô®Ôºå‰πüÊòØÂú®Êó•Â∏∏Â∑•‰Ωú‰∏≠‰∏éÊàë‰ª¨Êé•Ëß¶ÈùûÂ∏∏Â§öÁöÑHttpÊúçÂä°Âô®Ôºå‰Ωú‰∏∫‰∏Ä‰∏™ÊàêÁÜüÁöÑËΩØ‰ª∂ÔºåÂÆÉÁöÑÊï¥‰ΩìËÆæËÆ°Ôºå‰ª£Á†ÅÁªìÊûÑÈÉΩÂçÅÂàÜÁöÑ‰ºòÁßÄÔºå‰Ωú‰∏∫ÂºÄÂèëËÄÖÔºåÈùûÂ∏∏ÊúâÂøÖË¶ÅÁ†îËØªTomcatÊ∫êÁ†Å„ÄÇÈòÖËØªÊ∫êÁ†ÅÊÄªÊòØÂºÄÂ§¥ÈöæÔºå‰ΩÜÊòØ‰∏ÄÊó¶ÂØπÊï¥‰ΩìËÆæËÆ°ÁêÜÂøµÊúâ‰∏ÄÂÆö‰∫ÜËß£ÂêéÔºåÂÜçËøõË°åÊ∑±ÂÖ•ÂàÜÊûêÔºåÂ∞±‰ºöÊúâ‰∏ç‰∏ÄÊ†∑ÁöÑÊî∂Ëé∑„ÄÇ Êï¥‰ΩìÊû∂ÊûÑÂÖà‰∏ä‰∏ÄÂº†ÊÄª‰ΩìÊû∂ÊûÑÂõæ ËøôÂº†ÂõæÂèØ‰ª•ËØ¥ÊØèÁØá‰ªãÁªçTomcatÁöÑÂçöÂÆ¢ÈÉΩÊòØÂøÖÊîæÔºåÊó¢ÁÑ∂ÊØè‰∏™‰∫∫ÈÉΩËÆ§ÂèØËøôÂº†ÂõæÔºåËØ¥ÊòéÊ≠§ÂõæÈùûÂ∏∏ÈáçË¶Å„ÄÇÊé•‰∏ãÊù•Êàë‰ª¨Â∞±Âõ¥ÁªïËøôÂº†ÂõæÂØπTomcatÁöÑÊï¥‰ΩìÊû∂ÊûÑËøõË°åÂàÜÊûê„ÄÇ ServerÊúçÂä°Âô®ÔºöÂèØ‰ª•ÁúãÊàê‰ª£Ë°®TomcatÊúçÂä°Âô®Êú¨Ë∫´Ôºå‰∏Ä‰∏™TomcatÂÆû‰æãÂè™‰ºöÊúâ‰∏Ä‰∏™Server ServiceÊü•Áúã‰∏äÂõæÔºåÂèØÁü•‰∏Ä‰∏™ServerÂèØ‰ª•ÂåÖÂê´Â§ö‰∏™ServiceÔºåÂú®ËøôÈáåÂèØ‰ª•ÊääServiceÁúãÊàêÊòØConnectorÂíåContainerÁªÑÂêàÂ±ÇÔºåConnectorÂíåContainerÊòØTomcat‰∏§‰∏™‰∏ªË¶ÅÁöÑÊ®°Âùó Connector ËøûÊé•Âô®Ôºå‰∏Ä‰∏™ServiceÂèØ‰ª•ÊúâÂ§ö‰∏™ConnectorÔºàhttp AJP Á≠âÔºâÔºåÁõëÂê¨Áî®Êà∑ËØ∑Ê±ÇÁ´ØÂè£ Container ÊåâÁÖßÂ±ÇÁ∫ßÊúâEngineÔºåHostÔºåContextÔºåWrapperÂõõÁßçÔºå‰∏Ä‰∏™ServiceÂè™Êúâ‰∏Ä‰∏™EngineÔºåÂÖ∂‰∏ªË¶Å‰ΩúÁî®ÊòØÊâßË°å‰∏öÂä°ÈÄªËæë ËøôÈáåÊàëÂÜçË¥¥‰∏Ä‰∏™TomcatÁöÑÈÖçÁΩÆÊñá‰ª∂ÔºåÂèØ‰ª•Ê†πÊçÆÊ≠§ÈÖçÁΩÆÊñá‰ª∂ÂÜçÂõûËøáÂ§¥ÂéªÁúã‰∏äÂõæ 12345678910111213141516171819202122232425&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt; &lt;Service name=&quot;Catalina&quot;&gt; &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt; &lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt; &lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt; &lt;Realm className=&quot;org.apache.catalina.realm.LockOutRealm&quot;&gt; &lt;Realm className=&quot;org.apache.catalina.realm.UserDatabaseRealm&quot; resourceName=&quot;UserDatabase&quot;/&gt; &lt;/Realm&gt; &lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt; &lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot; prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot; pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt; &lt;/Host&gt; &lt;/Engine&gt; &lt;/Service&gt; ÈÖçÁΩÆÊñá‰ª∂ÁöÑÁ¨¨‰∏Ä‰∏™ËäÇÁÇπÂ∞±ÊòØServerÔºåÂπ∂‰∏îÈÖçÁΩÆ‰∫ÜshutdownÁ´ØÂè£‰∏∫8005ÔºåÁÑ∂ÂêéÂ∞±ÈÖçÁΩÆ‰∫Ü‰∏Ä‰∏™Âêç‰∏∫CatalinaÁöÑServiceÔºåËøôÈáåÂÖ∂ÂÆûÂèØ‰ª•ÈÖçÁΩÆÂ§ö‰∏™Service„ÄÇÂÜçÁúãServiceËäÇÁÇπ‰∏≠ÔºåÈÖçÁΩÆ‰∫ÜÂ§ö‰∏™ConnectorËøûÊé•Âô®ÔºåÂπ∂‰∏îÈÖçÁΩÆ‰∫Ü‰∏Ä‰∏™EngineÔºåEngineÂØπÂ∫îContainerÁöÑÊúÄÈ°∂Â±ÇÔºå‰∏Ä‰∏™ServiceÂè™Êúâ‰∏Ä‰∏™Engine„ÄÇ ‰∏ãÈù¢Êàë‰ª¨ÂÜçËøõË°åÈÄê‰∏™ÂàÜÊûê ServerServerÊòØTomcatÊúÄÈ°∂Â±ÇÁöÑÂÆπÂô®Ôºå‰∏Ä‰∏™TomcatÂÆû‰æãÂè™‰ºöÊúâ‰∏Ä‰∏™Server„ÄÇ‰∏Ä‰∏™ServerËá≥Â∞ëÈúÄË¶ÅÂåÖÂê´‰∏Ä‰∏™ServiceÔºåÂú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑ‰ΩìÁé∞Â∞±ÊòØËá≥Â∞ëÈúÄË¶ÅÂåÖÂê´‰∏Ä‰∏™ServiceËäÇÁÇπ„ÄÇËøôÈáåÊàë‰ª¨ÂèØ‰ª•Áúã‰∏ãTomcatÂØπ‰∫éServerÁöÑÊ†áÂáÜÂÆûÁé∞Á±ªorg.apache.catalina.core.StandardServerÔºåÂÖ∂‰∏≠LifecycleËøô‰∏™Êé•Âè£ÊòØTomcatÂØπ‰∫éÁîüÂëΩÂë®ÊúüÁª¥Êä§ÁöÑÈáçË¶ÅÊé•Âè£ÔºåÊØè‰∏™ÁªÑ‰ª∂ÈÉΩÂøÖÈ°ªÂÆûÁé∞Ôºå‰ªéËÄå‰øùËØÅ‰∫ÜÁªü‰∏ÄÂêØÂä®/Áªü‰∏ÄÂÖ≥Èó≠ÁöÑÊïàÊûú ServiceÂâçÊñáËØ¥ËøáÔºåServiceÂ∞±ÊòØÁî®‰∫éÁªÑË£ÖConnectorÂíåContainerÁöÑÂØπÂ∫îÂÖ≥Á≥ªÁöÑ„ÄÇÈÄöËøáÊü•ÁúãÈÖçÁΩÆÊñá‰ª∂ÔºåÂèØÁü•ServiceËäÇÁÇπÂåÖÂê´‰∫ÜConnectorÂíåContainerÔºåÂÖ∂‰∏≠ConnectorÁõëÂê¨Áî®Êà∑ËØ∑Ê±ÇÔºåÂπ∂Ëß£ÊûêËØ∑Ê±ÇÂèÇÊï∞ÔºåContainerÊâßË°åÂÖ∑‰Ωì‰∏öÂä°ÈÄªËæë ConnectorConnectorÊòØËøûÊé•Âô®ÔºåÁî®‰∫éÊé•ÂèóËØ∑Ê±ÇÂπ∂Â∞ÜËØ∑Ê±ÇÂ∞ÅË£ÖÊàêRequestÂíåResponseÔºåÁÑ∂Âêé‰∫§ÁªôContainerËøõË°åÂ§ÑÁêÜÔºåContainerÂ§ÑÁêÜÂÆå‰πãÂêéÂÜç‰∫§ÁªôConnectorËøîÂõûÁªôÂÆ¢Êà∑Á´Ø ContainerTomcat‰∏≠ÁöÑServletÂÆπÂô®ÂøÖÈ°ªÂÆûÁé∞ContainerÊé•Âè£Ôºå‰πüÂ∞±ÊòØËØ¥ServletÂÆπÂô®ÈÉΩÊòØContainerÊé•Âè£ÁöÑÂÆû‰æãÔºåÊé•‰∏ãÊù•Â∞Ü‰ºö‰ªãÁªçÂõõÁßçÁ±ªÂûãÁöÑÂÆπÂô® Engine: Ë°®Á§∫Êï¥‰∏™ServletÂºïÊìé Host: Ë°®Á§∫ÂåÖÂê´‰∏Ä‰∏™ÊàñÂ§ö‰∏™ContextÂÆπÂô®ÁöÑËôöÊãü‰∏ªÊú∫ Contetx: Ë°®Á§∫‰∏Ä‰∏™WebÂ∫îÁî®Á®ãÂ∫è„ÄÇ‰∏Ä‰ªΩContextÂèØ‰ª•ÊúâÂ§ö‰∏™Wrapper Wrapper: Ë°®Á§∫‰∏Ä‰∏™Áã¨Á´ãÁöÑservlet ‰∏äËø∞ÁöÑÊØè‰∏Ä‰∏™Ê¶ÇÂøµÈÉΩÊòØÂÆûÁé∞‰∫Üorg.apache.catalina.ContainerÊé•Âè£ÁöÑÔºåËøôÂõõ‰∏™ÂÆûÁé∞ÁöÑÊ†áÂáÜÁ±ªÂàÜÂà´ÂØπÂ∫îStandardEngine,StandardHost,StandardContetx,StandardWrapper„ÄÇÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá‰∏ãÂõæÁêÜÊ∏ÖÂÆÉ‰ª¨ÁöÑÂ±ÇÊ¨°ÂÖ≥Á≥ª„ÄÇ‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÔºå‰∏Ä‰∏™ÂÆπÂô®ÂèØ‰ª•Êúâ0‰∏™ÊàñÂ§ö‰∏™‰ΩéÂ±ÇÊ¨°ÁöÑÂ≠êÂÆπÂô® EngineEngineÂÆπÂô®Ë°®Á§∫TomcatÁöÑÊï¥‰∏™servletÂºïÊìé„ÄÇÂ¶ÇÊûú‰ΩøÁî®‰∫ÜEngineÂÆπÂô®ÔºåÈÇ£‰πàÂÆÉÊÄªÊòØÂ§Ñ‰∫éÂÆπÂô®Â±ÇÁ∫ßÁöÑÊúÄÈ°∂Â±Ç„ÄÇÊ∑ªÂä†Âà∞EngineÂÆπÂô®‰∏≠ÁöÑÂ≠êÂÆπÂô®ÈÄöÂ∏∏ÊòØHostÊàñContextÁöÑÂÆûÁé∞„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåtomcat‰ºö‰ΩøÁî®EngineÂÆπÂô®ÔºåÂπ∂‰∏îÊúâ‰∏Ä‰∏™HostÂÆπÂô®‰Ωú‰∏∫ÂÖ∂Â≠êÂÆπÂô®„ÄÇ HostHostË°®Á§∫ËôöÊãü‰∏ªÊú∫ÔºåÂ¶ÇÊûú‰Ω†ÊÉ≥Âú®Âêå‰∏Ä‰∏™TomcatÈÉ®ÁΩ≤‰∏äËøêË°åÂ§ö‰∏™ContextÂÆπÂô®ÁöÑËØùÔºå‰Ω†Â∞±ÈúÄË¶Å‰ΩøÁî®HostÂÆπÂô®„ÄÇÁêÜËÆ∫‰∏äÔºåÂΩì‰Ω†Âè™Êúâ‰∏Ä‰∏™ContextÂÆû‰æãÊó∂Ôºå‰∏çÈúÄË¶Å‰ΩøÁî®HostÂÆû‰æã„ÄÇ‰ΩÜÊòØÂú®TomcatÁöÑÂÆûÈôÖÈÉ®ÁΩ≤‰∏≠ÔºåÊÄªÊòØ‰ºö‰ΩøÁî®‰∏Ä‰∏™HostÂÆπÂô® ContextÂØπÂ∫î‰∏Ä‰∏™Áã¨Á´ãÁöÑWebÂ∫îÁî®Á®ãÂ∫èÔºå‰πüÂ∞±ÊòØÂØπÂ∫îÊàë‰ª¨Êó•Â∏∏ÁºñÂÜôÁöÑÂçïÁã¨WebÂ∫îÁî® ContextÂÆπÂô®ÁöÑÁà∂ÂÆπÂô®ÈÄöÂ∏∏ÊòØHostÂÆπÂô®Ôºå‰πüÊúâÂèØËÉΩÊòØÂÖ∂‰ªñÂÆûÁé∞ÔºåÊàñÂàôÂ¶ÇÊûú‰∏çÂøÖË¶ÅÔºåÂ∞±ÂèØ‰ª•‰∏ç‰ΩøÁî®Áà∂ÂÆπÂô® WrapperWrapperÂ∞ÅË£Ö‰∫Ü‰∏Ä‰∏™ÂÖ∑‰ΩìÁöÑServlet Â∞æË®ÄÊú¨Êñá‰∏ªË¶ÅÂàÜÊûêËß£ËØª‰∫ÜtomcatÁöÑÊÄª‰ΩìËÆæËÆ°Êû∂ÊûÑÔºåtomcatÁöÑÊ∫êÁ†ÅÈùûÂ∏∏ÈùûÂ∏∏ÁöÑÂ§öÔºåÂ¶ÇÊûúÊàë‰ª¨‰∏çÂØπÂÖ∂Êï¥‰ΩìÊû∂ÊûÑÂ±ÇÊ¨°ËøõË°åÂàÜÊûêÔºåÁõ¥Êé•ËøõË°åÊ∫êÁ†ÅÈòÖËØªÔºå‰ºöÊÑüËßâ‰ªøËã•ÁΩÆË∫´Â§ßÊµ∑ÔºåÈùûÂ∏∏ÁöÑÊµ™Ë¥πÊó∂Èó¥„ÄÇÊâÄ‰ª•Ëã•Â§ßÂÆ∂ÊúâÊÉ≥Ê≥ïÈòÖËØªtomcatÊ∫êÁ†ÅÔºåËøòÊòØÊúâÂøÖË¶ÅÂÖàÁêÜÊ∏ÖÂÖ∂Êû∂ÊûÑ‰ΩìÁ≥ª]]></content>
      <categories>
        <category>webÂÆπÂô®</category>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java NIO Selector Â§öË∑ØÂ§çÁî®ÈÄâÊã©Âô®]]></title>
    <url>%2F2019%2F01%2F20%2FJava-NIO-Selector-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E9%80%89%E6%8B%A9%E5%99%A8%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏äÁØáÊñáÁ´†Êàë‰ª¨ÁÆÄÂçïÁöÑ‰ΩøÁî®‰∫ÜNIOÁöÑChannelÈÄöÈÅìÔºåÊú¨ÊúüÊàë‰ª¨‰∏ªË¶ÅÊù•‰ªãÁªç‰∏Ä‰∏ãÈÄâÊã©Âô®ÔºàSelectorÔºâÁöÑ‰ΩøÁî®ÔºåSelectorÊòØJava NIOÊ†∏ÂøÉÁªÑ‰ª∂‰∏≠ÁöÑ‰∏Ä‰∏™„ÄÇÂú®‰πãÂâç‰ªãÁªç5ÁßçI/OÊ®°ÂûãÁöÑÊó∂ÂÄôÔºåÊúâ‰ªãÁªçËøáÂ§öË∑ØÂ§çÁî®Ê®°Âûã„ÄÇÂ§öË∑ØÂ§çÁî®Ê®°Âûã‰ΩøÂæóÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®‰∏Ä‰∏™Á∫øÁ®ãÊù•ÁÆ°ÁêÜÊàêÂçÉ‰∏ä‰∏áÁöÑËøûÊé•ÔºåÈÅøÂÖç‰∫ÜÁ∫øÁ®ã‰∏ä‰∏ãÊñáÂàáÊç¢Â∏¶Êù•ÁöÑÂºÄÈîÄÔºå‰ΩøÂæóÊÄßËÉΩÂæóÂà∞ÊûÅÂ§ßÁöÑÊèêÂçá Âü∫Êú¨Ê®°ÂûãÈÄâÊã©Âô®Selector‰ΩøÁî®ÁöÑÂü∫Êú¨Ê®°ÂºèÔºåË∑ü‰º†ÁªüBIOÂ§ÑÁêÜÊ®°Âûã‰∏ç‰∏ÄÊ†∑„ÄÇ‰º†ÁªüBIOÂæÄÂæÄÊàë‰ª¨‰ºö‰ΩøÁî®Â§öÁ∫øÁ®ãÊù•ÊèêÂçáÂ§ÑÁêÜÊÄßËÉΩÔºå‰πüÂ∞±ÊòØËØ¥ÊØèÊé•ÂÖ•‰∏Ä‰∏™ClientÔºåServerÁ´ØÂ∞±‰ºö‰∏∫ÂÖ∂Êñ∞ÂºÄ‰∏Ä‰∏™Á∫øÁ®ãÔºå‰ª•Ê≠§Êù•ÊèêÂçáÂπ∂ÂèëÂêûÂêêÈáèÔºå‰ΩøÁî®ËøôÁßçÊ®°ÂºèÁöÑÂºäÁ´ØÂæàÊòéÊòæÔºåÂõ†‰∏∫Á∫øÁ®ãÊòØÁ≥ªÁªüÈùûÂ∏∏ÈáçË¶ÅÁöÑËµÑÊ∫êÔºåÂΩìÂπ∂ÂèëÈáèÂ∞ëÁöÑÊó∂ÂÄôÔºåÊÑüËßâ‰∏çÂà∞Ôºå‰∏ÄÊó¶Âπ∂ÂèëÈáè‰∏äÊù•ÔºåÂ∞±‰ºöÂá∫Áé∞Áì∂È¢à„ÄÇ ÂÜçÊù•ÁúãSelectorÊòØÂ¶Ç‰ΩïÂ§ÑÁêÜÁöÑÔºåÈ¶ñÂÖàÊØèÊé•ÂÖ•‰∏Ä‰∏™ClientÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáSelectorÈÄâÊã©Âô®Ê≥®ÂÜåÊÑüÂÖ¥Ë∂£ÁöÑ‰∫ã‰ª∂ÔºåÁÑ∂ÂêéÈÄöËøá‰∏Ä‰∏™Á∫øÁ®ãÂéª‰∏çÂÅúÁöÑËΩÆËØ¢Ê£ÄÊµãÂêÑ‰∏™ClientÊòØÂê¶ÊúâÊÑüÂÖ¥Ë∂£ÁöÑ‰∫ã‰ª∂ÂèëÁîüÔºåÊúâÂàôÈ°∫Â∫èÂ§ÑÁêÜËØ•ClientÂ∞±Áª™ÁöÑÂêÑ‰∏™‰∫ã‰ª∂„ÄÇ Selector ‰ΩøÁî®ÂÆû‰æãÊàë‰ª¨ÂÖàÊù•Áúã‰∏Ä‰∏™SelectorÈùûÂ∏∏Â∏∏ËßÅÁöÑ‰ΩøÁî®‰æãÂ≠ê 1234567891011121314151617181920212223242526272829303132333435363738394041424344try &#123; // ÊâìÂºÄ‰∏Ä‰∏™ÈÄöÈÅì ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); serverSocketChannel.socket().bind(new InetSocketAddress(8890)); // ÊâìÂºÄ ÈÄâÊã©Âô® selector Selector selector = Selector.open(); // ËÆæÁΩÆÈùûÈòªÂ°û serverSocketChannel.configureBlocking(false); // ‰∏∫ServerSocketChannelÊ≥®ÂÜå OP_ACCEPT ‰∫ã‰ª∂ÔºåËøîÂõû‰∏Ä‰∏™SelectionKey ÂØπË±° serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); while (true) &#123; // ËøîÂõûËá≥Â∞ëÊúâ‰∏Ä‰∏™‰∫ã‰ª∂Â∞±Áª™ÁöÑÈÄöÈÅìÊï∞ÔºåËØ•ÊñπÊ≥ïÊòØÈòªÂ°ûÁöÑ int readyNum = selector.select(); if (readyNum == 0) &#123; continue; &#125; // ËøîÂõûÂ∞±Áª™ÁöÑ SelectionKeyÈõÜÂêà Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iteratorKeys = selectionKeys.iterator(); // ÈÅçÂéÜÊâÄÊúâÂ∞±Áª™ÁöÑSelectionKeyÈõÜÂêà while (iteratorKeys.hasNext()) &#123; SelectionKey key = iteratorKeys.next(); iteratorKeys.remove(); // Âà§Êñ≠Â∞±Áª™ÁöÑÂÖ∑‰Ωì‰∫ã‰ª∂ if (key.isValid()) &#123; if (key.isAcceptable()) &#123; ServerSocketChannel serverChannel = (ServerSocketChannel) key.channel(); // Êé•Âèó‰∏Ä‰∏™Êñ∞ËøûÊé• SocketChannel channel = serverChannel.accept(); channel.configureBlocking(false); // ‰∏∫ËØ•ChannelÊ≥®ÂÜåÂèØËØª‰∫ã‰ª∂ channel.register(selector, SelectionKey.OP_READ); &#125; else if (key.isReadable()) &#123; ... &#125; &#125; &#125; &#125;&#125; catch (IOException e) &#123; e.printStackTrace();&#125; ÈÄöËøáÊü•Áúã‰∏äÈù¢ÁöÑ‰ª£Á†ÅÔºåÂèØÁü•Êàë‰ª¨ÈÄöËøáSelector.open()ÂàõÂª∫‰∫Ü‰∏Ä‰∏™ÈÄâÊã©Âô®ÔºåÂπ∂‰∏îÈÄöËøáSocketChannelÁöÑregisterÊñπÊ≥ïÊ≥®ÂÜå‰∫ÜÈÄâÊã©Âô®Âíå‰∫ã‰ª∂ÔºåÂÖ∂‰∏≠registerÊñπÊ≥ï‰ºöËøîÂõû‰∏Ä‰∏™SelectionKeyÂØπË±°ÔºåËØ•ÂØπË±°ÂÖ∂ÂÆûÂ∞±ÊòØÁª¥Êä§‰∫ÜChannelÂíåSelectorÁöÑÂØπÂ∫îÂÖ≥Á≥ª SelectionKey‰∏äÊñáÊàë‰ª¨ÊèêÂà∞SelectionKeyÂØπË±°Áª¥Êä§‰∫ÜChannelÂíåSelectorÁöÑÂØπÂ∫îÂÖ≥Á≥ªÔºåÁé∞Âú®Êàë‰ª¨Êù•Áúã‰∏ãSelectionKeyÂØπË±°ÂÜÖÈÉ®Âá†‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ï Â±ûÊÄß OP_READ OP_WRITE OP_CONNECT OP_ACCEPT ÂèØÊ≥®ÂÜåÁöÑÂõõ‰∏™ÊÑüÂÖ¥Ë∂£ÁöÑÈ°πÁõÆ interestOps ÊâÄÊúâÊÑüÂÖ¥Ë∂£ÁöÑÈõÜÂêà readyOps ÊâÄÊúâÂ∞±Áª™ÁöÑÂÖ¥Ë∂£ÈõÜÂêà ÊñπÊ≥ï boolean isValid() Âà§Êñ≠ËØ•SelectionKeyÊòØÂê¶ÊúâÊïà void cancel() ÂèñÊ∂àËØ•SelectionKey‰∏≠ ÈÄöÈÅì‰∏éÂÖ∂ÈÄâÊã©Âô® ÁöÑÊ≥®ÂÜå int interestOps() ËøîÂõûËØ•SelectionKeyÊâÄÂåÖÂê´ÁöÑÊâÄÊúâÂÖ¥Ë∂£ÔºàÂèØËØªÂèØÂÜôÔºâÈõÜÂêà SelectionKey interestOps(int ops) ËÆæÁΩÆ‰∏Ä‰∏™ÊÑüÂÖ¥Ë∂£ÁöÑÈ°πÁõÆ int readyOps() ËøîÂõûÂ∑≤ÁªèÂ∞±Áª™ÁöÑÂÖ¥Ë∂£ÈõÜÂêà boolean isWritable() Âà§Êñ≠ÊòØÂê¶ÂèØÂÜô boolean isReadable() Âà§Êñ≠ÊòØÂê¶ÂèØËØª boolean isConnectable() Âà§Êñ≠ÊòØÂê¶ÂèØËøûÊé• boolean isAcceptable() Âà§Êñ≠ÊòØÂê¶ÂèØÊé•Âèó Object attach(Object ob) Âú®ËØ•SelectionKey‰∏≠ÈôÑÂä†‰∏Ä‰∏™ÂØπË±°‰ø°ÊÅØ Object attachment() Ëé∑ÂèñÈôÑÂä†ÂØπË±°‰ø°ÊÅØ SelectorËÆ≤ÂÆåSelectionKeyÂíåSelectorÁöÑÂÖ≥Á≥ª‰πãÂêéÔºåÊàë‰ª¨ÂÜçÊ¨°ÂõûÂà∞SelectorÁ±ªÔºåÊàë‰ª¨È¶ñÂÖàÈúÄË¶ÅÁü•ÈÅìSelector‰∏≠3‰∏™ÈáçË¶ÅÁöÑSelectionKeyÈõÜÂêà keysÔºöÊâÄÊúâÊ≥®ÂÜåÂà∞SelectorÁöÑChannelÊâÄË°®Á§∫ÁöÑSelectionKeyÈÉΩ‰ºöÂ≠òÂú®‰∫éËØ•ÈõÜÂêà‰∏≠„ÄÇkeysÂÖÉÁ¥†ÁöÑÊ∑ªÂä†‰ºöÂú®ChannelÊ≥®ÂÜåÂà∞SelectorÊó∂ÂèëÁîü„ÄÇ selectedKeysÔºöËØ•ÈõÜÂêà‰∏≠ÁöÑÊØè‰∏™SelectionKeyÈÉΩÊòØÂÖ∂ÂØπÂ∫îÁöÑChannelÂú®‰∏ä‰∏ÄÊ¨°Êìç‰ΩúselectionÊúüÈó¥Ë¢´Ê£ÄÊü•Âà∞Ëá≥Â∞ëÊúâ‰∏ÄÁßçSelectionKey‰∏≠ÊâÄÊÑüÂÖ¥Ë∂£ÁöÑÊìç‰ΩúÂ∑≤ÁªèÂáÜÂ§áÂ•ΩË¢´Â§ÑÁêÜ„ÄÇËØ•ÈõÜÂêàÊòØkeysÁöÑ‰∏Ä‰∏™Â≠êÈõÜ„ÄÇ cancelledKeysÔºöÊâßË°å‰∫ÜÂèñÊ∂àÊìç‰ΩúÁöÑSelectionKey‰ºöË¢´ÊîæÂÖ•Âà∞ËØ•ÈõÜÂêà‰∏≠„ÄÇËØ•ÈõÜÂêàÊòØkeysÁöÑ‰∏Ä‰∏™Â≠êÈõÜ„ÄÇ Êé•‰∏ãÊù•Â∞Ü‰ºö‰ªãÁªç‰∏äÊñá‰æãÂ≠ê‰∏≠ÊâÄÁî®Âà∞ÁöÑÂá†‰∏™ÊñπÊ≥ï Selector.open()Ëøô‰∏™ÈùôÊÄÅÊñπÊ≥ïÂèØ‰ª•ÊâìÂºÄ‰∏Ä‰∏™SelectorÈÄâÊã©Âô® 123public static Selector open() throws IOException &#123; return SelectorProvider.provider().openSelector();&#125; ÈÄöËøáÊü•ÁúãÊ∫êÁ†ÅÂèØÁü•Âú®LinuxÁ≥ªÁªü‰∏ãÈªòËÆ§‰ºö‰ΩøÁî®EpollSelectorImplÊù•‰Ωú‰∏∫SelectorÂÆûÁé∞Á±ªÔºåÊ≥®ÊÑèÂêÑ‰∏™Á≥ªÁªü‰∏ãÈªòËÆ§ÁöÑÂÆûÁé∞Á±ªÊòØ‰∏çÂêåÁöÑ„ÄÇ selector.select()SelectorÁöÑselect()ÊñπÊ≥ï‰ºöËøîÂõû‰∫ã‰ª∂Â∞±Áª™ÁöÑSelectionKeyÊï∞ÁõÆÔºà‰πüÂ∞±ÊòØÂ∞±Áª™ÁöÑChannelÊï∞Ôºâ Âπ∂‰∏îËØ•ÊñπÊ≥ï‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÁõ¥Âà∞Ëá≥Â∞ë‰∏Ä‰∏™channelË¢´ÈÄâÊã©(Âç≥ÔºåËØ•channelÊ≥®ÂÜåÁöÑ‰∫ã‰ª∂ÂèëÁîü‰∫Ü)‰∏∫Ê≠¢ÔºåÈô§ÈùûÂΩìÂâçÁ∫øÁ®ãÂèëÁîü‰∏≠Êñ≠ÊàñËÄÖselectorÁöÑwakeupÊñπÊ≥ïË¢´Ë∞ÉÁî® ËØ•ÊñπÊ≥ïËøòÊúâ‰∏Ä‰∏™ÈáçËΩΩselect(long timeout)ÔºåÂèØ‰ª•Ëá™ÂÆö‰πâË∂ÖÊó∂Êó∂Èó¥ selector.selectNow()ËØ•ÊñπÊ≥ï‰∏é‰∏äÈù¢ÊñπÊ≥ïÁ±ª‰ººÔºå‰ΩÜËØ•ÊñπÊ≥ï‰∏ç‰ºöÂèëÁîüÈòªÂ°ûÔºåÂç≥‰ΩøÊ≤°Êúâ‰∏Ä‰∏™channelË¢´ÈÄâÊã©‰πü‰ºöÁ´ãÂç≥ËøîÂõû selector.selectedKeys()ËøîÂõûÂ∑≤Â∞±Áª™ÁöÑSelectionKeyÈõÜÂêàÔºåËØ•ÊñπÊ≥ïÂú®ÊâßË°å‰∫Üselector.select()ÂêéË∞ÉÁî®ÔºåÂõ†‰∏∫Âú®ÊâßË°åselector.select()ÂêéÂ∞±Ë°®Á§∫Ëá≥Â∞ëÊúâ‰∏Ä‰∏™SelectionKeyÂ∑≤ÁªèÂ∞±Áª™ Â∞æË®ÄÂ•Ω‰∫ÜÔºåÊú¨ÁØáÊñáÁ´†Â∞±‰ªãÁªçÂà∞ËøôÈáå‰∫ÜÔºåÁØáÂπÖÊúâÈôêÂä†‰∏äÊú¨‰∫∫ÂØπNIOÁöÑÁêÜËß£‰πüÊúâÂæÖÂä†Ê∑±ÔºåÂ∏åÊúõÂèØ‰ª•Âú®‰πãÂêéÊõ¥Ê∑±ÂÖ•ÁöÑÂØπJava NIOÁöÑÂÆûÁé∞ËøõË°åÂàÜÊûê„ÄÇ]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>NIO</category>
      </categories>
      <tags>
        <tag>NIO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Êó†ÂèÇreadËøîÂõûintÁ±ªÂûã‰∏∫‰ΩïË¶Å‰∏é‰∏ä0xff]]></title>
    <url>%2F2019%2F01%2F13%2F%E6%97%A0%E5%8F%82read%E8%BF%94%E5%9B%9Eint%E7%B1%BB%E5%9E%8B%E4%B8%BA%E4%BD%95%E8%A6%81%E4%B8%8E%E4%B8%8A0xff%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰ΩøÁî®java io ÂåÖÊó∂ÔºåInputStream Á±ª‰∏≠ÁöÑÊúâÂ•ΩÂá†‰∏™read()ÊñπÊ≥ïÔºåÂπ∂‰∏îËøîÂõûÂÄº‰πüÈÉΩÊòØintÁ±ªÂûãÔºåËøôÊ†∑Â∞±‰ΩøÂæóÂàùÂ≠¶ËÄÖÂæàÂÆπÊòìÊêûÊ∑∑ÔºåÂÖ∂ÂÆûËôΩÁÑ∂ËøîÂõûÂÄºÈÉΩÊòØintÁ±ªÂûãÔºå‰ΩÜÊâÄË°®Á§∫ÁöÑÊÑè‰πâÁ°ÆÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑ ÊúâÂèÇ read(byte b[], int off, int len)ÂÖàÁúãÊúâÂèÇÁöÑreadÊñπÊ≥ï„ÄÇÊúâÂèÇÁöÑreadÊØîËæÉÂ•ΩÁêÜËß£ÔºåÂ∞ÜËØªÂèñÂà∞ÁöÑÊï∞ÊçÆÂÜôÂÖ•Â≠óËäÇÊï∞ÁªÑ(‰ªéÂ≠óËäÇÊï∞ÁªÑÁöÑÊåáÂÆö‰ΩçÁΩÆÂºÄÂßãÂÜôÂÖ•) ‰∏â‰∏™ÂÖ•ÂèÇ b[] Â≠òÂÇ®ËØªÂèñÂà∞ÁöÑÊï∞ÊçÆÁöÑÂ≠óËäÇÊï∞ÁªÑ off ‰ªéÁõÆÊ†áÊï∞ÁªÑb[]ÁöÑoff‰ΩçÂºÄÂßãÂÜôÂÖ•Ôºå‰∏ÄËà¨ÈÉΩÊòØ‰ªé0ÂºÄÂßã len Ë¶ÅËØªÂèñÁöÑÂ≠óËäÇÁ†ÅÈïøÂ∫¶Ôºå‰∏ÄËà¨‰ºöÊòØÂ≠òÂÇ®Êï∞ÁªÑb[]ÁöÑÈïøÂ∫¶ ËøôÈáåÁöÑintÁ±ªÂûãÁöÑËøîÂõûÂÄºÊòØÂÆûÈôÖËØªÂèñÁöÑÂ≠óËäÇÊï∞ÔºåÂ¶ÇÊûúÊ£ÄÊµãÂà∞Êó†Êï∞ÊçÆÂèØËØªÊó∂‰ºöËøîÂõû -1 Êó†ÂèÇ read()123456/** * ‰ªéËæìÂÖ•ÊµÅËØªÂèñ‰∏ã‰∏Ä‰∏™Â≠óËäÇÁöÑÊï∞ÊçÆ„ÄÇËøîÂõûÂÄº‰∏∫`intÁ±ªÂûã`ÔºåÂÄºËåÉÂõ¥Âú®`0-255`‰πãÈó¥„ÄÇÂ¶ÇÊûúÁî±‰∫éÂà∞ËææÊµÅ * ÁöÑÊú´Â∞æËÄåÊ≤°ÊúâÂèØÁî®ÁöÑÂ≠óËäÇÔºåÂàôËøîÂõû`-1`„ÄÇÊ≠§ÊñπÊ≥ïÂ∞Ü‰∏ÄÁõ¥ÈòªÂ°ûÔºåÁõ¥Âà∞ËæìÂÖ•Êï∞ÊçÆÂèØÁî®„ÄÅÊ£ÄÊµãÂà∞ÊµÅÁöÑÁªì * Â∞æÊàñÂºïÂèëÂºÇÂ∏∏‰∏∫Ê≠¢ */public abstract int read() throws IOException; ‰ªéËæìÂÖ•ÊµÅËØªÂèñ‰∏ã‰∏Ä‰∏™Â≠óËäÇÁöÑÊï∞ÊçÆ„ÄÇËøîÂõûÂÄº‰∏∫intÁ±ªÂûãÔºåÂÄºËåÉÂõ¥Âú®0-255‰πãÈó¥„ÄÇÂ¶ÇÊûúÁî±‰∫éÂà∞ËææÊµÅÁöÑÊú´Â∞æËÄåÊ≤°ÊúâÂèØÁî®ÁöÑÂ≠óËäÇÔºåÂàôËøîÂõû-1„ÄÇÊ≠§ÊñπÊ≥ïÂ∞Ü‰∏ÄÁõ¥ÈòªÂ°ûÔºåÁõ¥Âà∞ËæìÂÖ•Êï∞ÊçÆÂèØÁî®„ÄÅÊ£ÄÊµãÂà∞ÊµÅÁöÑÁªìÂ∞æÊàñÂºïÂèëÂºÇÂ∏∏‰∏∫Ê≠¢ Êàë‰ª¨ÂÜçÊù•Áúã‰∏Ä‰∏ãËøô‰∏™ÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞ 1234567891011public int read() throws IOException &#123; if (eof) &#123; return -1; &#125; temp = new byte[1]; int n = read(temp, 0, 1); if (n &lt;= 0) &#123; return -1; &#125; return temp[0] &amp; 0xff;&#125; Âà∞ËøôÈáåÂ∞±ÂæàÂ•áÊÄ™‰∫ÜÔºåËøô‰∏™ÊñπÊ≥ïÊòØËøîÂõû‰∏ã‰∏Ä‰∏™Â≠óËäÇÁöÑÊï∞ÊçÆÔºåÂèØÊòØ‰∏∫‰ªÄ‰πàË¶ÅËøîÂõû‰∏Ä‰∏™intÁ±ªÂûãÔºåËÄå‰∏çÁõ¥Êé•ËøîÂõû byte Á±ªÂûãÔºüÂπ∂‰∏îËøîÂõûintÁ±ªÂûãÊó∂ËøòÊúâ‰∏Ä‰∏™&amp; 0xffÊìç‰ΩúÔºå‰∏∫‰ªÄ‰πàËøòË¶ÅÊâßË°åËøô‰∏™‰∏éÊìç‰ΩúÂë¢Ôºü‰∏ãÈù¢Â∞±ËÆ©Êàë‰ª¨Â•ΩÂ•ΩÂàÜÊûê‰∏Ä‰∏ãÔºå‰∏∫‰ΩïË¶ÅËøîÂõûintÁ±ªÂûãÔºåËÄå‰∏çÁõ¥Êé•ËøîÂõûbyteÁ±ªÂûãÔºå‰ª•Âèä‰∏∫‰Ωï‰ºöÂÖàÊâßË°å‰∏Ä‰∏™&amp; 0xffÊìç‰Ωú ‰∏∫‰ΩïË¶ÅËøîÂõûintÁ±ªÂûãÂú®ËØªÂèñÂ≠óËäÇÊó∂ÔºåÊàë‰ª¨ËÇØÂÆöÈúÄË¶Å‰∏Ä‰∏™Ê†áËØÜÊù•Ë°®Á§∫Â∑≤ÁªèËØªÂà∞‰∫ÜÂ≠óËäÇÊµÅÊú´Â∞æÔºå‰∏ÄËà¨‰ºöËøîÂõû-1Êù•Ê†áËØÜÔºå‰ΩÜÊòØÂ¶ÇÊûúÊòØËøîÂõûbyteÁ±ªÂûãÔºåÂ∞±Êó†Ê≥ïÊ†áËØÜÊòØÂê¶Âà∞‰∫ÜÊñá‰ª∂Êú´Â∞æ„ÄÇÊâÄ‰ª•ÂçïÂá≠ËøôÁÇπÔºåËøôÈáåÂ∞±‰∏çËÉΩËøîÂõûbyteÁ±ªÂûã ‰∏∫‰ΩïË¶ÅÊâßË°å‰∏éÊìç‰Ωú&amp; 0xffÂÜçËøîÂõûintÁ±ªÂûã‰∏äÈù¢Ëß£Èáä‰∫Ü‰∏∫‰ΩïË¶ÅËøîÂõûintÁ±ªÂûãÔºåÂèØÊòØË≤å‰ººËøîÂõûintÁ±ªÂûã‰πüÂπ∂Ê≤°ÊúâËß£ÂÜ≥ÈóÆÈ¢ò.. ÁúãËøô‰πà‰∏Ä‰∏™ÊÉÖÂÜµÔºå‰∏á‰∏ÄËøîÂõûÁöÑÂçï‰∏™Â≠óËäÇ‰ª•‰∫åËøõÂà∂Ë°®Á§∫ÊòØ1111 1111ÔºåËΩ¨Êç¢ÊàêintÁ±ªÂûã‰ºöÈ´ò‰ΩçË°•Á¨¶Âè∑‰Ωç1Ôºå‰πüÂ∞±ÊòØ1111 1111 1111 1111 1111 1111 1111 1111ÔºåÂàöÂ•ΩÊòØ-1(Java‰∏≠Êï∞Â≠óÊòØ‰ª•Ë°•Á†ÅÂΩ¢ÂºèÂ≠òÂÇ®ÁöÑ)ÔºåÊâÄ‰ª•ËøôÈáåÂ∞±‰ºö‰∫ßÁîüÊ∑∑‰π±ÔºåÊàë‰ª¨Êó†Ê≥ïÂå∫ÂàÜËøîÂõû-1ÊòØ‰∏çÊòØÂà∞‰∫ÜÂ≠óËäÇÊµÅÁöÑÊú´Â∞æ ÈÇ£‰πàËøô‰∏™ÈóÆÈ¢òËØ•ÊÄé‰πàËß£ÂÜ≥Âë¢ÔºüËøôÈáåË¶ÅËß£ÂÜ≥ÁöÑÈóÆÈ¢òÂÖ∂ÂÆûÂ∞±ÊòØÂΩìËøòÊ≤°ÊúâËØªÂà∞Â≠óËäÇÊµÅÊú´Â∞æÊó∂‰∏çËÉΩËøîÂõû-1ÔºåÂπ∂‰∏î‰∫åËøõÂà∂Â≠óËäÇÊµÅ‰πü‰∏çËÉΩÊîπÂèòÊâÄ‰ª•ËøôÈáåÂ∞±Âä†ÂÖ•‰∫Ü&amp; 0xffÊìç‰ΩúÔºåÊàë‰ª¨ÂÜçÊù•ÁúãÂâçÈù¢ËøîÂõû-1ÁöÑ‰æãÂ≠ê1111 1111È´ò‰ΩçËá™Âä®Ë°•1Âêé‰∏é‰∏ä0xff(0000 0000 0000 0000 0000 0000 1111 1111) 11111 1111 1111 1111 1111 1111 1111 1111 &amp; 0000 0000 0000 0000 0000 0000 1111 1111 = 0000 0000 0000 0000 0000 0000 1111 1111 ÂèØÁü•ÊâßË°å‰∫Ü&amp; 0xffÊìç‰ΩúÂêéÔºåÁõ∏ÂΩì‰∫éÊ∞∏Ëøú‰∏ç‰ºöËøîÂõûË¥üÊï∞‰∫ÜÔºå‰πüÂ∞±‰∏ç‰ºöÂ≠òÂú®ËøîÂõû-1ÂíåÂà∞Â≠óËäÇÊµÅÊú´Â∞æËøîÂõû-1ÂÜ≤Á™ÅÁöÑÊÉÖÂÜµÔºåÂπ∂‰∏îÂÆûÈôÖÁöÑ‰∫åËøõÂà∂ÁªìÊûÑ‰πüÊ≤°ÊúâÊîπÂèòÔºåÂèØ‰ª•ËØ¥ÊòØÂÆåÁæéÁöÑËß£ÂÜ≥‰∫ÜËøô‰∏™ÈóÆÈ¢ò„ÄÇ ‰∏äÈù¢ÁöÑ1111 1111‰ºöËá™Âä®È´ò‰ΩçË°•Á¨¶Âè∑‰ΩçÁöÑÂéüÂõ†ÊòØÔºåÂΩìJavaÊ£ÄÊµãÂà∞byteË¶ÅËΩ¨ÂåñÊàñÂ∞ÜË¶ÅËΩ¨Êç¢ÊàêÈ´ò‰ΩçÁ±ªÂûãÊó∂Ôºå‰ºöËá™Âä®Ë°•È´ò‰ΩçÁ¨¶Âè∑‰Ωç Ë°•Á¨¶Âè∑‰ΩçËøôÈáåÂÜçËß£Èáä‰∏Ä‰∏ãË°•Á¨¶Âè∑‰ΩçÊàë‰ª¨Áü•ÈÅìbyteÂç†‰∏Ä‰∏™Â≠óËäÇ8‰ΩçÔºåËÄåintÁ±ªÂûãÂç†4‰∏™Â≠óËäÇ32‰ΩçÔºåÊâÄ‰ª•byteÁ±ªÂûãÂêë‰∏äËΩ¨Êç¢ÊàêintÁ±ªÂûãÊó∂ÈúÄË¶ÅË°•Á¨¶Âè∑‰ΩçÔºåÊ≠£Êï∞Ë°•0ÔºåË¥üÊï∞Ë°•1„ÄÇÊàë‰ª¨Ë°•Á¨¶Âè∑‰ΩçÁöÑÁõÆÁöÑÊòØ‰∏∫‰∫ÜÁ±ªÂûãËΩ¨Êç¢ÂêéÂ§ßÂ∞èÂíåÁ¨¶Âè∑‰ΩçÈÉΩ‰øùÊåÅ‰∏çÂèò„ÄÇ ÊÄªÁªìÊú¨ÁØáÊñáÁ´†ËôΩÁÑ∂ÊòØ‰ªéIOÁöÑreadÊñπÊ≥ïÊé•ÂÖ•ÔºåÂÖ∂ÂÆûËøòÊòØË∑üJavaÂÜÖÈÉ®ÁöÑÁºñÁ†ÅÊ†ºÂºèÊúâÂÖ≥ÔºåÂ¶ÇÊï∞Â≠óÂú®JavaÂÜÖÂ≠ò‰∏≠ÊòØ‰ª•Ë°•Á†ÅÂ≠òÂÇ®ÁöÑÔºåÊï∞Â≠óÁ±ªÂûãËΩ¨Êç¢‰ºöÈ´ò‰ΩçË°•Á¨¶Âè∑‰ΩçÁ≠âÁ≠âÔºåË¶ÅÂΩªÂ∫ïÊêûÊáÇËøòÊòØË¶ÅËä±‰∫õÊó∂Èó¥ÁöÑ„ÄÇ]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>JDKÊ∫êÁ†Å</category>
      </categories>
      <tags>
        <tag>IO</tag>
        <tag>JDKÊ∫êÁ†Å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java NIO Channel ÈÄöÈÅì]]></title>
    <url>%2F2019%2F01%2F10%2FJava-NIO-Channel-%E9%80%9A%E9%81%93%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏ªË¶Å‰ªãÁªç‰∫ÜJava NIO BufferÁöÑ‰ΩøÁî®ÂèäÂÜÖÈÉ®ÂÆûÁé∞ÂéüÁêÜÔºåÊú¨ÊúüÊàë‰ª¨Â∞Ü‰ºöËÆ§ËØÜÂà∞Java NIO Âè¶‰∏Ä‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑÁâπÊÄßChannelÔºàÈÄöÈÅìÔºâ ÂØπÊØî‰º†ÁªüIOÊµÅÂú®ËÆ§ËØÜJava NIO ChannelÈÄöÈÅì‰πãÂâçÔºåÊàë‰ª¨ÊúâÂøÖË¶ÅÂØπÊØî‰∏Ä‰∏ãNIO Channel‰∏é‰º†ÁªüI/OÊµÅÁöÑÂå∫Âà´Ôºå‰ª•ÂèäÂÆÉÁöÑ‰ºòÂäøÂú®Âì™Èáå: Êó¢ÂèØ‰ª•‰ªéÈÄöÈÅì‰∏≠ËØªÂèñÊï∞ÊçÆÔºåÂèàÂèØ‰ª•ÂÜôÊï∞ÊçÆÂà∞ÈÄöÈÅì„ÄÇ‰ΩÜÊµÅÁöÑËØªÂÜôÈÄöÂ∏∏ÊòØÂçïÂêëÁöÑ„ÄÇ ÈÄöÈÅìÂèØ‰ª•ÂºÇÊ≠•Âú∞ËØªÂÜô„ÄÇÔºà‰∏ç‰ºöÈòªÂ°ûËøõÁ®ãÔºâ ÈÄöÈÅì‰∏≠ÁöÑÊï∞ÊçÆÊÄªÊòØË¶ÅÂÖàËØªÂà∞‰∏Ä‰∏™BufferÔºåÊàñËÄÖÊÄªÊòØË¶Å‰ªé‰∏Ä‰∏™Buffer‰∏≠ÂÜôÂÖ•(Èù¢ÂêëÁºìÂÜ≤Âå∫)„ÄÇ Channel ÂàÜÁ±ª‰∏ãÈù¢Âàó‰∏æÁöÑÊòØJAVA NIO ChannelÁöÑ‰∏Ä‰∫õ‰∏ªË¶ÅÂÆûÁé∞Ôºö FileChannel Êñá‰ª∂ÈÄöÈÅì SocketChannel ÈÄöËøáTCPËØªÂÜôÁΩëÁªú‰∏≠ÁöÑÊï∞ÊçÆ„ÄÇ ServerSocketChannel TCPÊúçÂä°Á´ØÔºåÂèØ‰ª•ËØªÂÜôÁΩëÁªú‰∏≠ÁöÑÊï∞ÊçÆÔºåÂèØ‰ª•ÁõëÂê¨Êñ∞ËøõÊù•ÁöÑTCPËøûÊé• DatagramChannel ÈÄöËøáUDPËØªÂÜôÁΩëÁªú‰∏≠ÁöÑÊï∞ÊçÆ Êé•‰∏ãÊù•ÊàëÂ∞Ü‰∏ªË¶ÅÂØπÊñá‰ª∂ÈÄöÈÅìÂíåSocketÈÄöÈÅìÁöÑ‰ΩøÁî®ÂÅöÂàÜÊûê Êñá‰ª∂ÈÄöÈÅì FileChannelÊàë‰ª¨Êó†Ê≥ïÁõ¥Êé•ÊâìÂºÄ‰∏Ä‰∏™FileChannelÔºåÈúÄË¶ÅÈÄöËøá‰ΩøÁî®‰∏Ä‰∏™InputStream„ÄÅOutputStreamÊàñRandomAccessFileÊù•Ëé∑Âèñ‰∏Ä‰∏™FileChannelÂÆû‰æã„ÄÇÂπ∂‰∏îFileChannelÊó†Ê≥ïËÆæÁΩÆ‰∏∫ÈùûÈòªÂ°ûÊ®°ÂºèÔºåÂÆÉÊÄªÊòØËøêË°åÂú®ÈòªÂ°ûÊ®°Âºè‰∏ã,‰πüÂ∞±ÊòØËØ¥FileChannelÁöÑread writeÊñπÊ≥ïÈÉΩÊòØÈòªÂ°ûÁöÑ„ÄÇ ËØªÂÜôÊï∞ÊçÆ‰∏ãÈù¢ÊòØÈÄöËøáRandomAccessFileÊâìÂºÄFileChannelËøõË°åÊï∞ÊçÆËØªÂÜôÁöÑÁ§∫‰æãÔºö ÂÜôÊï∞ÊçÆËá≥ÊåáÂÆöÊñá‰ª∂12345678910111213RandomAccessFile file = new RandomAccessFile(&quot;hello.txt&quot;, &quot;rw&quot;);FileChannel fileChannel = file.getChannel();ByteBuffer buffer = ByteBuffer.allocate(512);// Â∞ÜË¶ÅÂÜôÁöÑÊï∞ÊçÆÂÜôÂÖ•ÁºìÂÜ≤Âå∫buffer.put(&quot;ËßÅÂà∞‰Ω†ÁúüÂ•Ω&quot;.getBytes(&quot;utf-8&quot;));// ÂàáÊç¢ÁºìÂÜ≤Âå∫Ëá≥ÂèØËØªÊ®°Âºèbuffer.flip();// ÂºÄÂßãÂÜôÂÖ•Êñá‰ª∂fileChannel.write(buffer); // ËøîÂõûÂΩìÂâçÂÜôÂÖ•ÁöÑÂ≠óËäÇÊï∞file.close();fileChannel.close(); ‰ªéÊñá‰ª∂‰∏≠ËØªÂèñÊï∞ÊçÆ12345678910111213RandomAccessFile file = new RandomAccessFile(&quot;hello.txt&quot;, &quot;rw&quot;);FileChannel fileChannel = file.getChannel();ByteBuffer buffer = ByteBuffer.allocate(512);fileChannel.read(buffer);// ÂàáÊç¢ÁºìÂÜ≤Âå∫Ëá≥ÂèØÂÜôÊ®°Âºèbuffer.flip();byte data [] = new byte[buffer.limit()];// Â∞ÜÊï∞ÊçÆÂÜôËá≥ byteÊï∞ÁªÑbuffer.get(data);System.out.println(new String(data));file.close();fileChannel.close(); Socket ÈÄöÈÅìÂêåÊ†∑ÔºåÁõ∏ÂØπ‰∫é‰º†ÁªüBIOÁöÑSocketÔºåServerSocket„ÄÇNIO‰πüÊèê‰æõ‰∫ÜÂØπTCP/IPÂçèËÆÆÂ∞ÅË£ÖÁöÑÂ•óÊé•Â≠óÈÄöÈÅìÔºö SocketChannel ServerSocketChannal ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ãÂÆÉ‰ª¨ÁöÑÂü∫Êú¨‰ΩøÁî® SocketChannel ÊâìÂºÄÈÄöÈÅì12345// ÊâìÂºÄ‰∏Ä‰∏™ÈÄöÈÅìSocketChannel channel = SocketChannel.open();// ‰∏éServerÂª∫Á´ãËøûÊé•channel.connect(new InetSocketAddress(&quot;127.0.0.1&quot;, 8890)); ServerSocketChannel ÊâìÂºÄÈÄöÈÅìÊé•ÂèóËøûÊé•123456// ÊâìÂºÄÈÄöÈÅìServerSocketChannel serverSocketChannel = ServerSocketChannel.open();// ÁªëÂÆöÁ´ØÂè£serverSocketChannel.socket().bind(new InetSocketAddress(8890));// Êé•Âèó‰∏Ä‰∏™SocketËøûÊé• ÈªòËÆ§ÊòØÈòªÂ°ûÊ®°ÂºèSocketChannel channel = serverSocketChannel.accept(); Ë¶ÅÁÇπSocketChannel,ServerSocketChannel ‰πüÂèØ‰ª•ËÆæÁΩÆÊàêÈùûÈòªÂ°ûÊ®°ÂºèÔºåËÆæÁΩÆÊàêÈùûÈòªÂ°ûÊ®°ÂºèÁöÑËØùÔºåacceptÔºåreadÔºåwrite ÊñπÊ≥ï‰ºöÁ´ãÂç≥ËøîÂõûÔºå Âõ†Ê≠§ÈúÄË¶ÅÊàë‰ª¨Âú®‰ª£Á†Å‰∏çÊñ≠ÁöÑËΩÆËØ¢ÂéªÂà§Êñ≠ËøûÊé•ÂíåÊï∞ÊçÆÊòØÂê¶Â∞±Áª™ Â∞æË®ÄÊú¨ÁØáÊñáÁ´†‰∏ªË¶Å‰ªãÁªç‰∫ÜJava NIO‰∏≠Channel(ÈÄöÈÅì)ÁöÑ‰ΩøÁî®ÔºåÂÖ∂‰ΩøÁî®‰∏é‰º†ÁªüI/OÊµÅÁõ∏ÊØîÂÖ∂ÂÆûÊõ¥Âä†ÁöÑÊòìÁî®„ÄÇ‰∏ãÊúüÂ∞Ü‰ºö‰ªãÁªçJava NIOÁöÑÊ†∏ÂøÉSelectorÈÄâÊã©Âô®ÁöÑÂü∫Êú¨‰ΩøÁî®]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>NIO</category>
      </categories>
      <tags>
        <tag>NIO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java‰∏≠ÁöÑ‰π±Á†ÅÈóÆÈ¢ò]]></title>
    <url>%2F2018%2F12%2F30%2FJava%E4%B8%AD%E7%9A%84%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®ÂÜôJava‰ª£Á†ÅÁöÑÊó∂ÂÄôÔºåÂ§ßÂÆ∂Â∫îËØ•ÈÉΩÈÅáÂà∞ËøáÂêÑÁßç‰π±Á†ÅÈóÆÈ¢òÔºåÁÑ∂ÂêéÂºÄÂßãÊü•ËµÑÊñôÔºåÁªìÊûúÂéüÂõ†Êó†ÈùûÊòØÁºñÁ†ÅÊ†ºÂºè‰∏ç‰∏ÄËá¥ÊâÄÂØºËá¥ÁöÑ‰π±Á†ÅÔºåËß£ÂÜ≥ÊñπÂºè‰πüÊòØÂçÉÁØá‰∏ÄÂæãÔºåÁªü‰∏Ä‰ΩøÁî®UTF-8Â∞±OK‰∫Ü„ÄÇ ÊòØÁöÑËøô‰πàÂÅö‰π±Á†ÅÈóÆÈ¢òËÇØÂÆöÂèØ‰ª•Ëß£ÂÜ≥ÔºåÂèØÊàë‰ª¨‰ºº‰πéËøò‰∏çÂ§™Ê∏ÖÈô§ÊòØÂì™‰∏ÄÊ≠•ÁºñÁ†ÅËΩ¨ÂåñÈô§‰∫ÜÈóÆÈ¢òÂë¢Ôºü ÈòÖËØªÊú¨ÁØáÊñáÁ´†ÂâçÂª∫ËÆÆÂÖàÈòÖËØª ÊµÖÊûêËÆ°ÁÆóÊú∫Â≠óÁ¨¶ÈõÜÂíåÁºñÁ†ÅÔºåËÉΩÂ§üÂØπÁºñÁ†ÅÊúâ‰∏Ä‰∏™Â§ßÊ¶ÇÁöÑ‰∫ÜËß£ JavaÂ¶Ç‰ΩïÂ§ÑÁêÜÁºñÁ†ÅÈóÆÈ¢òÊàë‰ª¨Áü•ÈÅìJavaÊòØ‰ΩøÁî®‰∫ÜUnicodeÂ≠óÁ¨¶ÈõÜÔºåÂπ∂‰∏îÂ≠óÁ¨¶Âú®ÂÜÖÂ≠ò‰∏≠ÊòØ‰ª•UTF-16ÁºñÁ†ÅÊ†ºÂºèÊù•Â≠òÂÇ®ÁöÑÔºå‰ªÄ‰πàÊÑèÊÄùÂë¢ÔºåÂ∞±ÊòØÁ∫µÁÑ∂Â§ñÈÉ®ÊúâÂêÑÁßçUnicodeÁºñÁ†ÅÊ†ºÂºèÔºåÊàëJavaÂÜÖÈÉ®‰ΩøÁî®UTF-16ÁºñÁ†ÅÊòØ‰∏ç‰ºöÂèòÁöÑ„ÄÇ ‰ª•‰∏ã‰æãÂ≠êËØÅÊòéÂ≠óÁ¨¶Âú®ÂÜÖÂ≠ò‰∏≠ÊòØ‰ª•UTF-16ÁºñÁ†ÅÁöÑ 12345678char c = &apos;\u738b&apos;; // ÁéãÁöÑUTF-16ÁºñÁ†ÅÊòØ 738bSystem.out.println(c); // Áéã// ËæìÂá∫cÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑ16ËøõÂà∂Êï∞System.out.println(Integer.toHexString(c)); // 738b Êó¢ÁÑ∂JavaÂÜÖÈÉ®ÁºñÁ†ÅÔºàÂÜÖÁ†ÅÔºâÊ†ºÂºèÊòØUTF-16ÊòØ‰∏ç‰ºöÂèòÁöÑÔºåÈÇ£Êàë‰ª¨ËØªÂèñ‰∏çÂêåÁöÑÁºñÁ†ÅÊ†ºÂºèÊó∂ÔºåÂøÖÁÑ∂Ê∂âÂèäÂà∞‰∫ÜËΩ¨ÂåñËøáÁ®ãÔºå‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏™‰æãÂ≠ê 123456String s = &quot;Áéã&quot;;byte [] bytes = s.getBytes();System.out.println(bytes.length); // ËæìÂá∫ 3 ‰∏äÈù¢ÁöÑ‰æãÂ≠êÔºåÂèØ‰ª•ÁúãÂà∞Áõ∏ÂêåÁöÑÂ≠óÁ¨¶ÁéãÔºåÂ≠òÂÇ®Âú®char‰∏≠‰∏§‰∏™Â≠óËäÇÔºåËΩ¨Êç¢ÊàêÂ≠óËäÇÊµÅËæìÂá∫ÂêéÂèòÊàêÂç†Áî®3‰∏™Â≠óËäÇ‰∫Ü„ÄÇÈóÆÈ¢òÊù•‰∫ÜÔºåËøô‰∏™ËøáÁ®ãÂèëÁîü‰∫Ü‰ªÄ‰πà‰∫ÜÔºü ‰∏äÈù¢‰ª£Á†Å‰∏≠getBytes()ÊñπÊ≥ïÂÖ∂ÂÆûÊàë‰ª¨‰ΩøÁî®‰∫ÜÈªòËÆ§ÁöÑUTF-8ÁºñÁ†ÅÊ†ºÂºèÔºåÂÖ∂ÂÆûÂÆåÊï¥ÁöÑÂÜôÊ≥ïÂ∫îËØ•ÊòØbyte [] bytes = s.getBytes(&quot;UTF-8&quot;)ÔºåËøôÈáåÂÖ∂ÂÆûÂ∞±ÊòØËé∑Âèñ‰∫ÜUTF-8ÁºñÁ†ÅÊ†ºÂºèÁöÑÂ≠óËäÇÊµÅ„ÄÇÈÇ£‰πàËøôÈáåÂèàÊòØÂ¶Ç‰ΩïËé∑ÂèñÂà∞Â≠óËäÇÁéãÁöÑUTF-8ÁºñÁ†ÅÁöÑÂë¢Ôºü Áúã‰∏ãÂõæÔºåÂèØÁü•‰ªª‰ΩïÁºñÁ†ÅËΩ¨Êç¢ÈÉΩ‰ºöÁªèÁî±UnicodeÂ≠óÁ¨¶ÈõÜ‰∏≠ËΩ¨„ÄÇ‰æãÂ¶ÇÊàë‰ª¨ËØªÂèñUTF-8ÁºñÁ†ÅÁöÑÂ≠óÁ¨¶Ôºå‰ºöÂÖàËΩ¨ÂåñÊàêUnicodeÂ≠óÁ¨¶ÔºåÁÑ∂ÂêéÂÜçËΩ¨ÊàêUTF-16ÁºñÁ†ÅÂú®ÂÜÖÂ≠ò‰∏≠Â≠òÂÇ®„ÄÇÂèçËøáÊù•‰πüÊòØÁ±ª‰ºº ‰π±Á†ÅÈóÆÈ¢òÂá∫Áé∞Âú®Âì™‰∏ÄÊ≠•Áé∞Âú®Êàë‰ª¨ÂÜçÊù•ÁúãÂºïË®ÄÈáåÊâÄËØ¥ÊèêÂà∞ÁöÑ‰π±Á†ÅÈóÆÈ¢òÔºåÁúãÁúã‰π±Á†ÅÈóÆÈ¢ò‰∏ÄËà¨ÊòØÂá∫Áé∞Âú®‰∫ÜÂì™‰∏ÄÊ≠•„ÄÇ‰∏äÊñáÊèêÂà∞ÔºåÊàë‰ª¨ËØªÂèñÂ≠óÁ¨¶Êó∂Ôºå‰ºöÂÖàÂ∞ÜÂÜÖÂ≠ò‰∏≠‰ª•UTF-16ÁºñÁ†ÅÁöÑÂ≠óÁ¨¶ËΩ¨Êç¢ÊàêÊàë‰ª¨ÈúÄË¶ÅÁöÑÁºñÁ†ÅÊ†ºÂºèÔºåÂ¶ÇJavaÈªòËÆ§Â∞±ÊòØUTF-8ÔºåÈÇ£‰πàÂΩìÊàë‰ª¨‰ª•ÁâπÂÆöÁöÑÁºñÁ†ÅÊ†ºÂºè‰º†ËæìÂ≠óËäÇÊµÅÊó∂ÔºåÊé•Êî∂Á´Ø‰πüÂøÖÁÑ∂ÈúÄË¶Å‰ª•ÂêåÊ†∑ÁöÑÁºñÁ†ÅÊ†ºÂºèÂéªÊé•Êî∂Ôºå‰∏çÁÑ∂Â∞±Êó†Ê≥ïËß£ÊûêÂá∫Ê≠£Á°ÆÁöÑUnicodeÂ≠óÁ¨¶ÔºåËøõËÄå‰πüÊó†Ê≥ïËΩ¨Êç¢ÊàêÊ≠£Á°ÆÁöÑUTF-16ÁºñÁ†ÅÂú®JVMÂÜÖÂ≠ò‰∏≠Â≠òÂÇ®ÔºåÈÇ£‰πàÂøÖÁÑ∂‰ºöÂá∫Áé∞‰π±Á†ÅÈóÆÈ¢ò„ÄÇ ÊÄªÁªìÂÜôÊú¨ÁØáÊñáÁ´†ÁöÑÁõÆÁöÑÊòØ‰∏∫‰∫ÜÂä†Ê∑±Ëá™Â∑±ÂØπJavaÂÜÖÈÉ®ÁºñÁ†ÅÁöÑËÆ§ËØÜÔºå‰π±Á†ÅÈóÆÈ¢ò‰πüÊòØÂæàÂ§öÂàùÂ≠¶ËÄÖÈùûÂ∏∏ÁóõÊÅ®ÂíåÊÅêÊÉßÁöÑÔºåÂ∏åÊúõÊú¨ÁØáÊñáÁ´†‰πüÂèØ‰ª•ÂØπÊúâÁñëÊÉëÁöÑÂêåÂ≠¶ÊúâÊâÄÂ∏ÆÂä©]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>ÁºñÁ†Å</category>
      </categories>
      <tags>
        <tag>ÁºñÁ†Å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java NIO Buffer ÂàÜÊûê]]></title>
    <url>%2F2018%2F12%2F28%2FJava-NIO-Buffer-%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄJDK 1.4 ‰πãÂêéÂºïÂÖ•‰∫ÜNIOÔºàNew IOÊàñ Non Blocking IOÔºâÔºåÊàëËßâÁöÑÂèØ‰ª•Áß∞ÂÖ∂‰∏∫New IOÔºåÂõ†‰∏∫NIOÂü∫Êú¨ÈáçÂÜôÊâÄÊúâÊ†áÂáÜIOÁöÑAPIÔºåÂÆåÂÖ®ÂèØ‰ª•Êõø‰ª£Ê†áÂáÜÁöÑJava IO API„ÄÇÂπ∂‰∏îNIOÊîØÊåÅÈù¢ÂêëÁºìÂÜ≤Âå∫(Buffer)ÁöÑ„ÄÅÂü∫‰∫éÈÄöÈÅì(Channel)ÁöÑIOÊìç‰ΩúÔºåÂèØ‰ª•‰ª•Êõ¥Âä†È´òÊïàÁöÑÊñπÂºèËøõË°åÊñá‰ª∂ÁöÑËØªÂÜôÊìç‰Ωú„ÄÇ NIOÁöÑÊ†∏ÂøÉ‰∏ªË¶ÅÂåÖÊã¨3ÈÉ®ÂàÜ Buffer ÁºìÂÜ≤Âå∫ Channel ÈÄöÈÅì Êñá‰ª∂ÈÄöÈÅì SocketÈÄöÈÅì Selector ÈÄâÊã©Âô® Êú¨ÁØáÊñáÁ´†‰ºöÂØπNIOBufferÁºìÂÜ≤Âå∫ÁöÑ‰ΩøÁî®ÂèäÂÆûÁé∞ÂéüÁêÜÂÅöÂàÜÊûê ‰ΩìÁ≥ªJava NIO Êèê‰æõ‰∫Ü‰ª•‰∏ãÂá†ÁßçBufferÁ±ªÂûãÂèØ‰æõ‰ΩøÁî® ByteBuffer MappedByteBuffer CharBuffer DoubleBuffer FloatBuffer IntBuffer LongBuffer ShortBuffer Ëøô‰∫õBufferÁöÑÂêçÂ≠óÂ∑≤ÁªèÈùûÂ∏∏Ê∏ÖÊô∞ÁöÑÊåáÊòé‰∫ÜËøô‰∫õBufferÊâÄÂêÑËá™ÊâøËΩΩÁöÑ‰∏çÂêåÊï∞ÊçÆÁ±ªÂûã ‰∏ãÈù¢ÁöÑÂàÜÊûêÊàëÈÉΩÂ∞Ü‰ª•ByteBuffer‰∏∫‰æãÂ≠ê Âü∫Êú¨‰ΩøÁî®ByteBufferÁöÑ‰ΩøÁî®ÊØîËæÉÁÆÄÂçïÔºå‰ΩÜËã•‰∏çÁêÜËß£ÂÖ∂ÂÜÖÈÉ®ÂÆûÁé∞ÂéüÁêÜÔºå‰πüÈùûÂ∏∏ÂÆπÊòìÊêûÊ∑∑„ÄÇÊàë‰ª¨ÂÖàÊù•‰ªãÁªçÂÖ∂ÁÆÄÂçïÁöÑ‰ΩøÁî® ÂàõÂª∫ÁºìÂÜ≤Âå∫ÂàõÂª∫ÁºìÂÜ≤Âå∫‰∏ªË¶ÅÊúâ‰∏§ÁßçÂ∏∏Áî®ÊñπÂºè allocate ÂºÄËæüÊåáÂÆöÂ§ßÂ∞èÁöÑÁºìÂÜ≤Âå∫ wrap ‰ΩøÁî®Â≠óËäÇÊï∞ÁªÑÂºÄËæüÊñ∞ÁöÑÁºìÂÜ≤Âå∫ÔºåÂØπÁºìÂÜ≤Âå∫ÁöÑ‰øÆÊîπÂ∞ÜÂØºËá¥Êï∞ÁªÑË¢´‰øÆÊîπ„ÄÇÊñ∞ÁºìÂÜ≤Âå∫ÁöÑÂÆπÈáèÔºàpositionÔºâÂíåÈôêÂà∂ÔºàlimitÔºâÂ∞Ü‰∏∫ËØ•Êï∞ÁªÑÁöÑÈïøÂ∫¶ 123456// ÈÄöËøá allocate ÂàõÂª∫ByteBuffer byteBuffer = ByteBuffer.allocate(1024);// ÈÄöËøá wrap ÂàõÂª∫byte [] buf = new byte[1024];ByteBuffer.wrap(buf); ËØªÂÜôÊï∞ÊçÆ‰ΩøÁî®ByteBufferËØªÂÜôÊï∞ÊçÆÊØîËæÉÁÆÄÂçï ÂÜôÊï∞ÊçÆÂæÄBuffer‰∏≠ÂÜôÊï∞ÊçÆÂè™ÈúÄË¶ÅË∞ÉÁî®putÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÊúâÂ§ö‰∏™ÈáçËΩΩÔºåÂèØ‰ª•‰ª•‰∏çÂêåÁöÑÊñπÂºèÂÜôÊï∞ÊçÆËøôÈáåÂè™Âàó‰∏æ3‰∏™ put(byte b) Âú®ÂΩìÂâç‰ΩçÁΩÆÂ∞ÜÁªôÂÆöÂ≠óËäÇÂÜôÂÖ•Ê≠§ÁºìÂÜ≤Âå∫ put(int iÔºå byte b) Âú®ÊåáÂÆö‰ΩçÁΩÆÂ∞ÜÁªôÂÆöÂ≠óËäÇÂÜôÂÖ•Ê≠§ÁºìÂÜ≤Âå∫ put(byte[] src, int offset, int length) Â∞ÜÂ≠óËäÇ‰ªéÁªôÂÆöÊ∫êÊï∞ÁªÑ‰º†ËæìÂà∞Ê≠§ÁºìÂÜ≤Âå∫„ÄÇÂ¶ÇÊûú‰ªéÊï∞ÁªÑÂ§çÂà∂ÁöÑÂ≠óËäÇÊØîÊï∞Â§ß‰∫éÂâ©‰ΩôÁöÑÁºìÂÜ≤Âå∫ÂÆπÈáèÔºå‰ºöÊäõÂá∫BufferOverflowExceptionÂºÇÂ∏∏ ËØªÊï∞ÊçÆ‰ªéBuffer‰∏≠ËØªÂèñÊï∞ÊçÆÂè™ÈúÄË¶ÅË∞ÉÁî®getÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÂêåÊ†∑ÊúâÂ§ö‰∏™ÈáçËΩΩÔºåÂèØ‰ª•‰ª•‰∏çÂêåÁöÑÊñπÂºèËØªÊï∞ÊçÆ get() Ëé∑ÂèñÂΩìÂâç‰ΩçÁΩÆÁöÑÂçï‰∏™Â≠óËäÇ get(int i) Ëé∑ÂèñÊåáÂÆö‰ΩçÁΩÆÁöÑÂçï‰∏™Â≠óËäÇ get(byte[] dst, int offset, int length) ‰ªéÊ≠§ÁºìÂÜ≤Âå∫‰∏≠Ëé∑ÂèñÂ≠óËäÇÂπ∂‰º†ËæìÂà∞ÁªôÂÆöÁöÑÁõÆÊ†áÊï∞ÁªÑ‰∏≠ÔºåÂ¶ÇÊûúÁºìÂÜ≤Âå∫‰∏≠ÁöÑÂâ©‰ΩôÂ≠óËäÇÂ∞ë‰∫éÊª°Ë∂≥ËØ∑Ê±ÇÊâÄÈúÄÁöÑÂ≠óËäÇÊï∞Ôºå‰ºöÊäõÂá∫BufferUnderflowExceptionÂºÇÂ∏∏ ‰∏ãÈù¢ÊòØ‰∏Ä‰∏™ÊäõÂá∫BufferUnderflowExceptionÁöÑ‰æãÂ≠ê 123456ByteBuffer byteBuffer = ByteBuffer.allocate(1024);String s = &quot;hello&quot;;byteBuffer.put(s.getBytes());byteBuffer.flip(); // ÁøªËΩ¨ ‰∏ãÊñá‰ºöÊèêÂà∞byte [] bufs = new byte[9]; // ÁºìÂÜ≤Âå∫ÂÆûÈôÖÂè™Êúâ5‰∏™Â≠óËäÇÂ§ßÂ∞èÔºåÂ§ß‰∫éÊ≠§Â§ßÂ∞èÂ∞±‰ºöÊäõÂá∫ÂºÇÂ∏∏byteBuffer.get(bufs); // ÊäõÂá∫ÂºÇÂ∏∏ flip ÊñπÊ≥ï‰∏äÊñáÊäõÂá∫BufferUnderflowExceptionÁöÑ‰æãÂ≠êÔºå‰∏çÁü•ÈÅìÂ§ßÂÆ∂ÊúâÊ≤°ÂèëÁé∞ÔºåÊàë‰ª¨ÁöÑ‰ª£Á†ÅÂú®ËØªÂÜôËΩ¨Êç¢Êó∂Áî®‰∫ÜflipÊñπÊ≥ïÊù•ËøõË°åËØªÂÜôÊìç‰ΩúÁöÑËΩ¨Êç¢ÔºåÁºìÂÜ≤Âå∫Âú®ËøõË°åËØªÂÜôËΩ¨Êç¢ÁöÑÊó∂ÂÄôÂøÖÈ°ªË∞ÉÁî®flipÊñπÊ≥ïÔºåÈÇ£‰πà‰∏∫‰ΩïË¶ÅËøô‰πàÂÅöÂë¢Ôºü‰∏ãÈù¢ÊàëÂ∞Ü‰ºöÂØπflipÊñπÊ≥ïÁöÑÂÜÖÈÉ®ÂÆûÁé∞ÂéüÁêÜËøõË°åÂàÜÊûêÔºåÂú®ÂàÜÊûê‰πãÂâçÔºåÊàë‰ª¨ÊúâÂøÖË¶ÅÂÖàËÆ§ËØÜ‰∏Ä‰∏ãBufferÁöÑcapacity position limit markÂõõ‰∏™ÂèòÈáèÂ±ûÊÄß capacity Ë°®Á§∫ÁºìÂÜ≤Âå∫ÁöÑÂÆπÈáèÔºåÂ§ßÂ∞è‰∏çÂèØÂèò‰∏î‰∏çÂèØ‰∏∫Ë¥ü position ‰∏ã‰∏Ä‰∏™Ë¶ÅËØªÂèñÊàñÂÜôÂÖ•ÁöÑÂÖÉÁ¥†ÁöÑ‰ΩçÁΩÆÁ¥¢Âºï limit ‰∏ã‰∏Ä‰∏™‰∏çÂ∫îËØ•Ë¢´ËØªÂèñÊàñÂÜôÂÖ•ÁöÑÂÖÉÁ¥†ÁöÑ‰ΩçÁΩÆÁ¥¢Âºï mark Ê†áËÆ∞‰ΩçÔºåÂèØ‰ª•ÈÄöËøáËøô‰∏™Ê†áËÆ∞‰ΩçËøîÂõûÊ≠§‰ΩçÁΩÆ ÂõõËÄÖÁöÑÂ§ßÂ∞èÂÖ≥Á≥ª mark &lt;= position &lt;= limit &lt;= capacity Áü•ÈÅì‰∫ÜËøôÂõõ‰∏™ÂèòÈáèÁöÑÂê´‰πâ‰πãÂêéÔºåÊàë‰ª¨ÂÜçÊù•Ê†πÊçÆ‰æãÂ≠êÊù•ÁúãÁúã‰∏ÄÊ≠•‰∏ÄÊ≠•ÂæÄ‰∏ãÂàÜÊûêÂêß ‰∏Ä. È¶ñÂÖàÔºåÊàë‰ª¨ÈÄöËøáByteBuffer.allocate(6)ÂºÄËæü‰∏Ä‰∏™Â§ßÂ∞è‰∏∫6ÁöÑÁºìÂÜ≤Âå∫ 123456789101112// ÈÄöËøáallocate ÂºÄËæüÁºìÂÜ≤Âå∫public static ByteBuffer allocate(int capacity) &#123; if (capacity &lt; 0) throw new IllegalArgumentException(); return new HeapByteBuffer(capacity, capacity);&#125;// HeapByteBuffer ÂàùÂßãÂåñHeapByteBuffer(int cap, int lim) &#123; // package-private // ËøôÈáåÂâçÂõõ‰∏™ÂèÇÊï∞‰æùÊ¨°ÊòØ mark position limit capacity super(-1, 0, lim, cap, new byte[cap], 0);&#125; ÈÄöËøáÊü•ÁúãallocateÊñπÊ≥ïÁöÑÊ∫êÁ†ÅÔºåÂèØÁü•ÂÖ∂ÂÜÖÈÉ®ÂàùÂßãÁªìÊûÑÂ¶Ç‰∏ãÂõæ(BufferÂÜÖÈÉ®ÂÖ∂ÂÆûÊòØÊï∞ÁªÑÂÆûÁé∞Ôºå‰∏ãÊ†á‰ªé0ÂºÄÂßã) mark = -1 position = 0 limit = capacity = 6 ‰∫å. ÁÑ∂ÂêéÊàë‰ª¨Áé∞Âú®ÈÄöËøáputÊñπÊ≥ïÂä†ÂÖ•1‰∏™Â≠óËäÇÊï∞ÊçÆÊ≠§Êó∂ÁöÑÂÜÖÈÉ®ÁªìÊûÑÂ¶Ç‰∏ãÂõæ mark = -1 position = 1 limit = capacity = 6 ‰∏â. Âä†‰∏Ä‰∏™Â§™Â∞ë‰∫ÜÔºåÊàë‰ª¨ÂÜçÊ∑ªÂä†3‰∏™Â≠óËäÇÊï∞ÊçÆËá≥ÁºìÂÜ≤Âå∫‰∏≠Ê≠§Êó∂ÁöÑÂÜÖÈÉ®ÁªìÊûÑÂ¶Ç‰∏ãÂõæ mark = -1 position = 4 limit = capacity = 6 Âõõ. Áé∞Âú®Êï∞ÊçÆÂ∑≤ÁªèÂÖ®ÈÉ®Âä†ÂÆå‰∫ÜÔºåÊàë‰ª¨ÂáÜÂ§áËØªÊï∞ÊçÆ‰∫ÜÔºåÂøÖÈ°ªË¶ÅË∞ÉÁî®flipÊñπÊ≥ïÂÖàÊù•ÁúãÁúãflipÊñπÊ≥ïÁöÑÂÜÖÈÉ®ÂÆûÁé∞ 123456public final Buffer flip() &#123; limit = position; position = 0; mark = -1; return this;&#125; flipÂÜÖÈÉ®ÂÖ∂ÂÆûÊòØÂ∞Ü positionÁöÑÂÄºËµãÁªô‰∫ÜlimitÔºåÂπ∂Â∞Üposition‰ΩçÁΩÆÂΩí0ÔºåÂ¶Ç‰∏ãÂõæÊòæÁ§∫ ‰∫î. ÊàêÂäüÁøªËΩ¨‰πãÂêéÔºåÂ∞±ÂèØ‰ª•ÂæÄÂ§ñËØªÊï∞ÊçÆ‰∫ÜÔºåÂÅáËÆæÂæÄÂ§ñËØª4‰∏™Êï∞ÊçÆÊ≠§Êó∂ÂÜÖÈÉ®ÁªìÊûÑÂ¶Ç‰∏ãÂõæÔºåÂπ∂‰∏î position = limit‰∫ÜÔºåËææÂà∞‰∫ÜÊúÄÂ§ßÂèØËØªÂ≠óËäÇÊï∞ mark = -1 position = 4 limit = 4 capacity = 6 ÈÄöËøá‰∏äÈù¢Ëøô‰∏™‰æãÂ≠êÔºåÂØπflipÊñπÊ≥ïÁöÑÁøªËΩ¨ÈÄªËæëÂ∑≤ÁªèËøõË°å‰∫ÜÈùûÂ∏∏ËØ¶ÁªÜÁöÑÂàÜÊûêÔºåÂπ∂‰∏îÂèØ‰ª•ÂæóÂá∫ÁªìËÆ∫capacityÁöÑÊòØÁªùÂØπ‰∏çÂèòÁöÑÔºå‰∏ç‰ºöÈöèÁùÄËØªÂÜôÊìç‰ΩúËÄåÊîπÂèò„ÄÇmarkÂèòÈáèÁöÑÂÄº‰ºöÂú®‰∏ãÊñáreset mark ÊñπÊ≥ï‰∏≠Áî®Âà∞ reset mark ÊñπÊ≥ïÈ°æÂêçÊÄù‰πâÔºåmarkÂ∞±ÊòØÊâìÊ†áËÆ∞ÁöÑÊÑèÊÄùÔºåresetË°®Á§∫ÈáçÁΩÆÁöÑÊÑèÊÄù„ÄÇËøô‰∏§‰∏™ÊìçÂÅöÊòØÁ¥ßÂØÜËÅîÁ≥ªÁöÑÔºåÁî±mark()ÊñπÊ≥ïÂú®ÂΩìÂâçposition‰ΩçÁΩÆÂÅöÊ†áËÆ∞ÔºåÁÑ∂ÂêéÂú®ÈúÄË¶ÅÈáçÁΩÆÂà∞Ê†áËÆ∞‰ΩçÁΩÆÁöÑÊó∂ÂÄôÔºåË∞ÉÁî®resetÊñπÊ≥ïÈáçÁΩÆ Áúã‰∏Ä‰∏ãËøô‰∏§‰∏™ÊñπÊ≥ïÁöÑÂÜÖÈÉ®ÂÆûÁé∞ 1234567891011public final Buffer mark() &#123; mark = position; return this;&#125;public final Buffer reset() &#123; int m = mark; if (m &lt; 0) throw new InvalidMarkException(); position = m; return this;&#125; ÊñπÊ≥ïÁöÑÂÜÖÈÉ®ÂÆûÁé∞ÈùûÂ∏∏ÁÆÄÂçïÔºåÈÄöËøáÂØπÂèòÈáèmarkÁöÑÁºñËæëÊù•Ê†áËÆ∞ÂΩìÂâç‰ΩçÁΩÆÔºåÂú®ÈúÄË¶ÅÈáçÁΩÆÁöÑÊó∂ÂÄôÔºåÊääÂèòÈáèmarkÁöÑÂÄºËµãÁªôÂΩìÂâç‰∏ãÊ†áÁ¥¢ÂºïpositionÊù•ËææÂà∞ÈáçÁΩÆÁöÑÁõÆÁöÑ„ÄÇ clearclearÊñπÊ≥ïÊØîËæÉÁÆÄÂçïÔºåÂ∞Üposition = 0Ôºålimit = capacityÔºåmark = -1„ÄÇÊúâÁÇπÁ±ª‰ººÂàùÂßãÂåñÊó∂ÁöÑÊìç‰Ωú compactÊúÄÂêéÂÜçÊù•‰ªãÁªç‰∏Ä‰∏ãcompactÊñπÊ≥ïÔºåÈ¶ñÂÖàÊàë‰ª¨ÂÖàÊù•Áúã‰∏Ä‰∏™Âú∫ÊôØ 12345 while (in.read(buf) &gt;= 0 || buf.position != 0) &#123; buf.flip(); out.write(buf); buf.clear();&#125; ‰∏äÈù¢Ëøô‰∏™‰æãÂ≠êÔºåÂú®ÈùûÈòªÂ°ûÊ®°Âºè‰∏ãÊòØ‰ºöÊúâÈóÆÈ¢òÁöÑÔºåÂõ†‰∏∫writeÊñπÊ≥ïÊàë‰ª¨Âπ∂‰∏çÁü•ÈÅì‰∏ÄÊ¨°ÊÄßÂèØ‰ª•ÂÜôÂ§öÂ∞ë‰∏™Â≠óËäÇÔºåÊâÄ‰ª•ÊúâÂèØËÉΩËøòÊúâÊú™ÂÜôÂÖ•ÁöÑÂ≠óËäÇÊï∞ÊçÆÔºåËøôÊó∂ÂÄôÊàë‰ª¨Âç¥ÂèàÈáçÊñ∞ËØªÂèñ‰∫ÜÊñ∞ÁöÑÊï∞ÊçÆÔºåÂ∞±‰ºöÂØºËá¥Ë¶ÜÁõñ‰∫ÜÂéüÊúâËøòÊú™ÂÜôÂÖ•ÁöÑÊï∞ÊçÆ„ÄÇ Âè™ÈúÄË¶ÅÊîπÊàê‰ª•‰∏ãÁöÑÊñπÂºèÂç≥ÂèØÔºåËØ•ÊñπÊ≥ïÁöÑ‰ΩúÁî®ÊòØÂ∞Üposition‰∏élimit‰πãÈó¥ÁöÑÊï∞ÊçÆÂ§çÂà∂Âà∞bufferÁöÑÂºÄÂßã‰ΩçÁΩÆÔºåÂ§çÂà∂Âêéposition = limit -position,limit = capacity 12345 while (in.read(buf) &gt;= 0 || buf.position != 0) &#123; buf.flip(); out.write(buf); buf.compact();&#125; ÊÄªÁªìÊú¨ÁºñÊñáÁ´†ÊØîËæÉËØ¶ÁªÜÁöÑÂàÜÊûê‰∫ÜJava NIOBufferÁöÑÂü∫Êú¨‰ΩøÁî®ÂèäÂÜÖÈÉ®ÂÆûÁé∞ÂéüÁêÜ„ÄÇBufferÁöÑÂÜÖÈÉ®ÂÆûÁé∞ÂÖ∂ÂÆûÊØîËæÉÁÆÄÂçïÔºåÈúÄË¶ÅÁùÄÈáçÁêÜËß£ÁöÑÂÖ∂ÂÆûÂ∞±ÊòØcapacity position limit markËøôÂõõ‰∏™ÂèòÈáèÂ±ûÊÄß„ÄÇ]]></content>
      <categories>
        <category>Âü∫Á°Ä</category>
        <category>NIO</category>
      </categories>
      <tags>
        <tag>NIO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[I/OÊ®°ÂûãÁÆÄ‰ªã]]></title>
    <url>%2F2018%2F12%2F27%2FI-O%E6%A8%A1%E5%9E%8B%E7%AE%80%E4%BB%8B%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®Ê∑±ÂÖ•Â≠¶‰π†netty‰πãÂâçÔºåËøòÊòØÊúâÂøÖË¶ÅÂÖàÂõûÈ°æ‰∏ãI/OÊ®°ÂûãÔºåI/OÊ®°ÂûãÁêÜËß£Ëµ∑Êù•‰ºöÊØîËæÉÊäΩË±°ÔºåÁ¨¨‰∏ÄÊ¨°ÁêÜËß£ÈúÄË¶ÅÂÄüÂä©ÂõæÁâá‰ª•ÂèäÂÆûÈôÖ‰æãÂ≠êÂéªËÆ©Ëá™Â∑±Âä†Ê∑±Âç∞Ë±° Ê®°ÂûãÂàÜÁ±ªÂú®ÂºÄÂßã‰ªãÁªç‰πãÂâçÔºåÊàë‰ª¨ÂÖàÂàó‰∏æ‰∏Ä‰∏ãUnix‰∏ãÂèØÁî®ÁöÑ5ÁßçI/OÊ®°Âûã ÈòªÂ°ûÂºèI/O ÈùûÈòªÂ°ûÂºèI/O I/OÂ§çÁî® ‰ø°Âè∑È©±Âä®I/O ÂºÇÊ≠•I/O Êé•‰∏ãÊù•ÁöÑÊ®°Âûã‰ªãÁªçÈÉΩÊòØ‰ª•UDPÂÅö‰∏∫‰æãÂ≠êÔºåÂéüÂõ†ÊòØUDPÊòØ‰ª•Êï∞ÊçÆÊä•ÁöÑÊñπÂºèËøõË°åÊï∞ÊçÆ‰º†ËæìÔºåÊ¶ÇÂøµÊØîËæÉÁÆÄÂçïÔºàÊï¥‰∏™Êï∞ÊçÆË¶Å‰πàÊî∂Âà∞Ë¶Å‰πàÊ≤°ÊúâÊî∂Âà∞ÔºâÔºå‰æø‰∫éÊàë‰ª¨ÂéªÁêÜËß£I/OÊ®°ÂûãÁöÑÊ†∏ÂøÉÊ¶ÇÂøµ ÈòªÂ°ûÂºèI/O Êàë‰ª¨ÊúÄÁÜüÊÇâÁöÑI/OÊ®°ÂûãÂ∞±ÊòØÈòªÂ°ûÂºèI/OÊ®°ÂûãÔºåÂú®‰∏äÂõæ‰∏≠ÔºåÂ∫îÁî®ËøõÁ®ãÁ≥ªÁªüË∞ÉÁî®recvfromÊé•Êî∂Êï∞ÊçÆÔºå‰ΩÜÊòØÊ≠§Êó∂ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫‰∏≠Êï∞ÊçÆÊä•ËøòÊú™ÂáÜÂ§áÂ•ΩÔºåÊâÄ‰ª•Â∫îÁî®ËøõÁ®ã‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÁõ¥Âà∞ÂÜÖÊ†∏ÁºìÂÜ≤Âå∫ÊúâÊï∞ÊçÆÊä•Âà∞Ëææ‰∏îË¢´Â§çÂà∂Âà∞Â∫îÁî®ËøõÁ®ãÁºìÂÜ≤Âå∫ ËøôÈáåÊàë‰ª¨Êèê‰∏Ä‰∏ãËøôÈáåÁöÑÂÜÖÊ†∏ÁºìÂÜ≤Âå∫ÂíåÂ∫îÁî®ËøõÁ®ãÁºìÂÜ≤Âå∫ÊâÄÂ§ÑÁöÑÈò∂ÊÆµ‰∏Ä‰∏™ËæìÂÖ•Êìç‰ΩúÈÄöÂ∏∏ÂåÖÊã¨‰∏§‰∏™‰∏çÂêåÁöÑÈò∂ÊÆµ: Á≠âÂæÖÊï∞ÊçÆÊä•ÂáÜÂ§áÂ•Ω (ÈÄöÂ∏∏ÊòØÁ≠âÂæÖÊï∞ÊçÆ‰ªéÁΩëÁªú‰∏äÂà∞ËææÔºåÂΩìÊâÄÁ≠âÂæÖÁöÑÂàÜÁªÑÊï∞ÊçÆÂà∞ËææÂêéÔºå‰ºöË¢´Â§çÂà∂Âà∞ÂÜÖÊ†∏ÁöÑÊüê‰∏™ÁºìÂÜ≤Âå∫‰∏≠) ‰ªéÂÜÖÊ†∏ÂêëËøõÁ®ãÂ§çÂà∂Êï∞ÊçÆ (ÊääÊï∞ÊçÆ‰ªéÂÜÖÊ†∏ÁºìÂÜ≤Âå∫Â§çÂà∂Âà∞Â∫îÁî®ËøõÁ®ãÁºìÂÜ≤Âå∫‰∏≠) ‰æãÂ≠êÂïÜÂú∫ÊéíÈòüÂêÉÈ•≠ÔºåÂè™ËÉΩËÄÅËÄÅÂÆûÂÆûÊéíÈòüÔºåÂπ∂‰∏îÊéíÈòüÁöÑÊó∂ÂÄô‰∏çËÉΩÂÅöÂÖ∂‰ªñ‰∫ãÊÉÖ ÈùûÈòªÂ°ûÂºèI/OÂ¶ÇÊûú‰∏çÊÉ≥ËøõÁ®ã‰∏ÄÁõ¥ÈòªÂ°ûÂú®ÈÇ£ÈáåÁöÑËØùÔºåÊàë‰ª¨ÂèØ‰ª•ËÆæÁΩÆÊú¨Ê¨°Â•óÊé•Â≠óËøûÊé•‰∏∫ÈùûÈòªÂ°ûÁöÑ Êü•Áúã‰∏äÂõæÂèØÁü•ÔºåÂú®ËÆæÁΩÆËøûÊé•‰∏∫ÈùûÈòªÂ°ûÊó∂ÔºåÂΩìÂ∫îÁî®ËøõÁ®ãÁ≥ªÁªüË∞ÉÁî®recvfromÊ≤°ÊúâÊï∞ÊçÆËøîÂõûÊó∂ÔºåÂÜÖÊ†∏‰ºöÁ´ãÂç≥ËøîÂõû‰∏Ä‰∏™EWOULDBLOCKÈîôËØØÔºåËÄå‰∏ç‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÂà∞Êï∞ÊçÆÂáÜÂ§áÂ•Ω„ÄÇÂ¶Ç‰∏äÂõæÂú®Á¨¨ÂõõÊ¨°Ë∞ÉÁî®Êó∂Êúâ‰∏Ä‰∏™Êï∞ÊçÆÊä•ÂáÜÂ§áÂ•Ω‰∫ÜÔºåÊâÄ‰ª•ËøôÊó∂Êï∞ÊçÆ‰ºöË¢´Â§çÂà∂Âà∞Â∫îÁî®ËøõÁ®ãÁºìÂÜ≤Âå∫Ôºå‰∫éÊòØrecvfromÊàêÂäüËøîÂõûÊï∞ÊçÆ ÂΩì‰∏Ä‰∏™Â∫îÁî®ËøõÁ®ãËøôÊ†∑Âæ™ÁéØË∞ÉÁî®recvfromÊó∂ÔºåÊàë‰ª¨Áß∞‰πã‰∏∫ËΩÆËØ¢polling„ÄÇËøô‰πàÂÅöÂæÄÂæÄ‰ºöËÄóË¥πÂ§ßÈáèCPUÊó∂Èó¥ÔºåÂÆûÈôÖ‰ΩøÁî®ÂæàÂ∞ë ‰æãÂ≠êËøòÊòØÂïÜÂú∫ÂêÉÈ•≠ÔºåÂè™ÊòØÁé∞Âú®ÂèØ‰ª•ÂèñÂè∑‰∫Ü„ÄÇ‰∏çËøá‰ªçÁÑ∂ÈúÄË¶ÅÊó∂‰∏çÊó∂ÁöÑÂéªÁúã‰∏Ä‰∏ãÊúâÊ≤°ÊúâÂè´Âà∞Âè∑ I/O Â§çÁî® Linux I/OÂ§çÁî®Ê®°ÂûãÊèê‰æõ‰∫Üselect poll epoll‰∏âÁªÑÁ≥ªÁªüË∞ÉÁî®ÂèØÂÅöÈÄâÊã©ÔºåËøõÁ®ãÈÄöËøáÂ∞Ü‰∏Ä‰∏™ÊàñÂ§ö‰∏™Êñá‰ª∂ÊèèËø∞Á¨¶(fd)‰º†ÈÄíÁªôselectÊàñpollÊàñepollÁ≥ªÁªüË∞ÉÁî®ÔºåÈÄöËøáÂÆÉ‰ª¨Êù•ÁõëÊµãÂ§ö‰∏™fdÊòØÂê¶Â§Ñ‰∫éÂ∞±Áª™Áä∂ÊÄÅ„ÄÇselectÊàñpollÊòØÈ°∫Â∫èÊâ´ÊèèfdÊòØÂê¶Â∞±Áª™ÔºåËÄå‰∏îÊîØÊåÅÁöÑfdÊï∞ÈáèÊúâÈôêÔºåÂõ†Ê≠§‰ΩøÁî®‰∏äÊúâÂà∂Á∫¶„ÄÇepollË∞ÉÁî®Âü∫‰∫é‰∫ã‰ª∂È©±Âä®ÔºåÂõ†Ê≠§ÊÄßËÉΩÊõ¥È´òÔºåÂΩìfdÂ∞±Áª™Êó∂‰ºöÁ´ãÂç≥ÂõûË∞Érollback Ëß£Èáä‰∏Ä‰∏ãÊñá‰ª∂ÊèèËø∞Á¨¶ Linux ÂÜÖÊ†∏Â∞ÜÊâÄÊúâÂ§ñÈÉ®ËÆæÂ§áÈÉΩÁúãÂÅö‰∏Ä‰∏™Êñá‰ª∂Êù•Êìç‰ΩúÔºåÂØπ‰∏Ä‰∏™Êñá‰ª∂ÁöÑËØªÂÜôÊìç‰Ωú‰ºöË∞ÉÁî®ÂÜÖÊ†∏Êèê‰æõÁöÑÁ≥ªÁªüÂëΩ‰ª§ÔºåËøîÂõû‰∏Ä‰∏™file descriptor(fd Êñá‰ª∂ÊèèËø∞Á¨¶)„ÄÇËÄåÂØπ‰∏Ä‰∏™socketÁöÑËØªÂÜô‰πü‰ºöÊúâÁõ∏Â∫îÁöÑÊèèËø∞Á¨¶ÔºåÁß∞‰∏∫socket fd„ÄÇ Áé∞Âú®ÂÜçÊù•Áúã‰∏Ä‰∏ã‰∏äÂõæÔºå‰∏äÂõæ‰ª•select‰∏∫‰æã„ÄÇ‰∏çÈöæÂèëÁé∞ËøõÁ®ã‰ºöÈòªÂ°û‰∫éselectË∞ÉÁî®ÔºåÁõ¥Âà∞ÊâÄÂÖ≥Ê≥®ÁöÑÊüê‰∏Ä‰∏™Êñá‰ª∂ÊèèËø∞Á¨¶(Â•óÊé•Â≠ó)Âèò‰∏∫ÂèØËØªÁä∂ÊÄÅ ‰æãÂ≠êËøòÊòØÂïÜÂú∫ÂêÉÈ•≠Ôºå‰ΩÜÊòØÁé∞Âú®‰Ω†ÂèØ‰ª•Âú®ÊâãÊú∫APP‰∏äÂêåÊó∂Âè´Â§ö‰∏™Âè∑‰∫ÜÔºåÂè™Ë¶ÅÂ§ö‰∏™Âè∑ÈáåÈù¢Êúâ‰∏Ä‰∏™Âè∑Â•Ω‰∫ÜÂ∞±‰ºöÈÄöÁü•‰Ω†‰∫Ü ‰ø°Âè∑È©±Âä®I/O ‰ø°Âè∑È©±Âä®I/OÁöÑÊÑèÊÄùÂ∞±ÊòØÊàë‰ª¨Áé∞Âú®‰∏çÁî®ÂÇªÁ≠âÁùÄ‰∫ÜÔºå‰πü‰∏çÁî®ÂéªËΩÆËØ¢„ÄÇËÄåÊòØËÆ©ÂÜÖÊ†∏Âú®Êï∞ÊçÆÂ∞±Áª™Êó∂ÔºåÂèëÈÄÅ‰ø°Âè∑ÈÄöÁü•Êàë‰ª¨„ÄÇË∞ÉÁî®ÁöÑÊ≠•È™§ÊòØÔºåÊàë‰ª¨ÈÄöËøáÁ≥ªÁªüË∞ÉÁî®sigactionÔºåÂπ∂Ê≥®ÂÜå‰∏Ä‰∏™‰ø°Âè∑Â§ÑÁêÜÁöÑÂõûË∞ÉÂáΩÊï∞ÔºåËØ•Ë∞ÉÁî®‰ºöÁ´ãÂç≥ËøîÂõûÔºå‰ΩÜÊòØÂΩìÂÜÖÊ†∏Êï∞ÊçÆÂ∞±Áª™Êó∂ÔºåÂÜÖÊ†∏‰ºö‰∏∫ËØ•ËøõÁ®ã‰∫ßÁîü‰∏Ä‰∏™SIGIO‰ø°Âè∑ÔºåÂπ∂ÂõûË∞ÉÊàë‰ª¨Ê≥®ÂÜåÁöÑ‰ø°Âè∑ÂõûË∞ÉÂáΩÊï∞ÔºåËøôÊ†∑Êàë‰ª¨Â∞±ÂèØ‰ª•Âú®‰ø°Âè∑ÂõûË∞ÉÂáΩÊï∞‰∏≠Á≥ªÁªüË∞ÉÁî®recvfromËé∑ÂèñÊï∞ÊçÆ ‰æãÂ≠êÂïÜÂú∫ÂêÉÈ•≠ÔºåÂè™Ë¶ÅÂèñ‰∫ÜÂè∑Ôºå‰Ω†‰πü‰∏çÁî®Âéª‰∏ÄÁõ¥ÁúãÁúãÂ§ßÂ±èÂπïÊúâÊ≤°ÊúâÂ•Ω‰∫ÜÔºåË¶ÅÊòØÂè´Âà∞Âè∑‰∫ÜÔºå‰ºö‰∏ªÂä®ÂèëÊ∂àÊÅØÂëäËØâ‰Ω†‰∫Ü ÂºÇÊ≠•I/O ÂºÇÊ≠•I/O ‰∏é ‰ø°Âè∑È©±Âä®I/OÊúÄÂ§ßÂå∫Âà´Âú®‰∫éÔºå‰ø°Âè∑È©±Âä®ÊòØÂÜÖÊ†∏ÈÄöÁü•Êàë‰ª¨‰ΩïÊó∂ÂºÄÂßã‰∏Ä‰∏™I/OÊìç‰ΩúÔºåËÄåÂºÇÊ≠•I/OÊòØÁî±ÂÜÖÊ†∏ÈÄöÁü•Êàë‰ª¨I/OÊìç‰Ωú‰ΩïÊó∂ÂÆåÊàêÔºå‰∏§ËÄÖÊúâÊú¨Ë¥®Âå∫Âà´ ‰æãÂ≠êÈÉΩ‰∏çÁî®ÂéªÂïÜÂú∫ÂêÉÈ•≠‰∫ÜÔºåÁõ¥Êé•ÁÇπ‰∏™Â§ñÂçñÔºåÊääÁ≠âÂæÖ‰∏äËèúÁöÑÊó∂Èó¥‰πüÁªôÁúÅ‰∫Ü ÊÄªÁªìÊú¨ÁØáÊñáÁ´†‰∏ªË¶Å‰ªãÁªç‰∫Ü5ÁßçI/OÊ®°ÂûãÔºå‰æãÂ≠ê‰πüÊòØÂèÇËÄÉ‰∫ÜÁΩë‰∏ä‰∏™‰∫∫ËßâÂæóÊØîËæÉÂêàÁêÜÁöÑËß£ÈáäÔºåÂ∏åÊúõËÉΩÂØπÊ≠§ÊúâÁñëÊÉëÁöÑÂêåÂ≠¶ÊúâÊâÄÂ∏ÆÂä©„ÄÇÂè¶Â§ñÊñáÁ´†‰∏ªË¶ÅÂèÇËÄÉ‰∫ÜUnix ÁΩëÁªúÁºñÁ®ãËøôÊú¨‰π¶ÔºåÊúâÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶‰πüÂèØ‰ª•Ê∑±ÂÖ•‰∫ÜËß£]]></content>
      <categories>
        <category>Âü∫Á°Ä</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring IOC Ê∫êÁ†ÅËß£Êûê ÔºàÂæ™ÁéØ‰æùËµñÁöÑËß£ÂÜ≥Ôºâ]]></title>
    <url>%2F2018%2F12%2F21%2FSpring-IOC-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-%EF%BC%88%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E7%9A%84%E8%A7%A3%E5%86%B3%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰πãÂâçÁöÑÂá†ÁØáÂØπSpring IOCÊ∫êÁ†ÅÂàÜÊûêÁöÑÊñáÁ´†ÔºåÂ§ß‰Ωì‰∏äÊääIOCÂÆπÂô®ÂÜÖÈÉ®ÂÆûÁé∞ÂÅö‰∫ÜÂàÜÊûêÔºå‰ΩÜÂú®Êúâ‰∫õÁªÜËäÇ‰∏äÂπ∂Ê≤°ÊúâÂæàÊ∑±ÂÖ•ÁöÑÂéªÂàÜÊûê„ÄÇÊú¨ÁØáÊñáÁ´†‰∏ªË¶ÅÊòØÂàÜÊûêSpring IOCÂÆπÂô®ÂØπBean‰πãÈó¥ÁöÑÂæ™ÁéØ‰æùËµñÊòØÂ¶Ç‰ΩïËß£ÂÜ≥ÁöÑ ‰ªÄ‰πàÊòØÂæ™ÁéØ‰æùËµñÈÇ£‰πà‰ªÄ‰πàÊòØÂæ™ÁéØ‰æùËµñÂë¢ÔºüÁÆÄÂçïÁöÑÁêÜËß£‰∏Ä‰∏ãÔºåA‰æùËµñBÔºåBÂèà‰æùËµñAÔºåËøôÂ∞±ÊûÑÊàê‰∫Ü‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑÂæ™ÁéØ‰æùËµñÔºå‰∏∫‰∫ÜÂ∏ÆÂä©Â§ßÂÆ∂ÁêÜËß£ÔºåÊñ∞Âª∫‰∏§‰∏™‰∫íÁõ∏‰æùËµñÁöÑÁ±ªÔºàÂÑøÂ≠êÂíåÁà∏Áà∏‰∫íÁõ∏‰æùËµñÊ≤°ÊúâÈîôÂêß ..Ôºâ 123456789public class Father &#123; private String name; private Son son;&#125;public class Son &#123; private String name; private Father father;&#125; Ëøô‰∏§‰∏™bean‰∫§ÁªôSpringÁÆ°ÁêÜ 123456789&lt;bean id=&quot;son&quot; class=&quot;com.wangjn.demo.impl.Son&quot;&gt; &lt;property name=&quot;name&quot; value=&quot;son&quot;&gt;&lt;/property&gt; &lt;property name=&quot;father&quot; ref=&quot;father&quot;&gt;&lt;/property&gt;&lt;/bean&gt;&lt;bean id=&quot;father&quot; class=&quot;com.wangjn.demo.impl.Father&quot;&gt; &lt;property name=&quot;name&quot; value=&quot;father&quot;&gt;&lt;/property&gt; &lt;property name=&quot;son&quot; ref=&quot;son&quot;&gt;&lt;/property&gt;&lt;/bean&gt; ÂêØÂä®Spring IOCÂÆπÂô®ÔºåÁî®getBeanÊñπÊ≥ïÂèØ‰ª•ÊàêÂäüËé∑ÂèñsonÂØπË±°ÔºåÂπ∂‰∏î‰πüÊ≥®ÂÖ•‰∫ÜfatherÂØπË±°ÔºåÂèØËßÅSpring‰∏∫Êàë‰ª¨Ëß£ÂÜ≥‰∫ÜÂæ™ÁéØ‰æùËµñÁöÑÈóÆÈ¢ò„ÄÇÂèØÊòØÊåâÁÖßÊ≠£Â∏∏ÂàõÂª∫BeanÁöÑÊµÅÁ®ãÊù•ËØ¥ÔºåËøô‰∏™ËøáÁ®ãÂ∞Ü‰ºöÊòØ‰∏Ä‰∏™Ê≠ªÂæ™ÁéØÔºåÂõ†‰∏∫Âú®ÂàõÂª∫sonÂØπË±°‰∏∫sonÊ≥®ÂÖ•fatherÂ±ûÊÄßÊó∂ÔºåÂ∞±‰ºöÂéªËé∑ÂèñfatherÂØπË±°ÔºåËÄåÂú®Ëé∑ÂèñfatherÂØπË±°ËµãÂÄºsonÂ±ûÊÄßÁöÑÊó∂ÂÄôÔºåÂèà‰ºöÂéªËé∑ÂèñsonÂØπË±°Ôºå‰ªéËÄåÂ∞±Èô∑ÂÖ•‰∫ÜÊ≠ªÂæ™ÁéØÔºåÁÑ∂ÂêéÁ®ãÂ∫èÂ¥©Ê∫É„ÄÇ ÂèØÊòØÁªìÊûúÂπ∂‰∏çÊòØÊàë‰ª¨È¢ÑÊñôÁöÑÈÇ£Ê†∑ÔºåÊé•‰∏ãÊù•Â∞±Êù•ÂàÜÊûêSpringÊòØÂ¶Ç‰ΩïËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÁöÑ Spring Â¶Ç‰ΩïËß£ÂÜ≥Âæ™ÁéØ‰æùËµñ‰πãÂâçÂØπIOCÊ∫êÁ†ÅÂàÜÊûêÁöÑÊñáÁ´†‰∏≠ÊúâÂàÜÊûêËøáBeanÁöÑÂàõÂª∫ËøáÁ®ãÔºå‰∏ãÈù¢ÊàëÂ∞ÜÂØπÂæ™ÁéØ‰æùËµñÂÆûÁé∞ÁöÑÊüê‰∫õÁªÜËäÇ‰ΩúÂàÜÊûê Spring Áî®ÁºìÂ≠òËß£ÂÜ≥Âæ™ÁéØ‰æùËµñËÆ©Êàë‰ª¨ÂõûÂà∞AbstractBeanFactoryÁöÑdoGetBeanÊñπÊ≥ïÔºådoGetBeanÊñπÊ≥ïÂ∞±ÊòØÊàë‰ª¨ÈÄöËøáÂÆπÂô®getBeanÊñπÊ≥ïÂÆûÈôÖË∞ÉÁî®ÁöÑÈÄªËæëÔºåÊàë‰ª¨Âú®ËøôÈáåÁùÄÈáçÂÖ≥Ê≥®getSingletonÊñπÊ≥ïÔºå‰πãÂâçÁöÑÂàÜÊûê‰∏≠ÊúâÊèêÂà∞ÔºåË∞ÉÁî®getSingleton(beanName)ÊñπÊ≥ïÁöÑÁõÆÁöÑÊòØ‰∏∫‰∫Ü‰ªéÁºìÂ≠ò‰∏≠Áõ¥Êé•Ëé∑ÂèñÂ∑≤ÁªèÂàõÂª∫ÁöÑBeanÔºåËÄå‰∏çÂøÖÈáçÂ§çÂéªÂàõÂª∫„ÄÇÁé∞Âú®ËÆ©Êàë‰ª¨ËøõÂà∞getSingletonÊñπÊ≥ïÈáåÈù¢ÂéªÁúãÁúãÂÆÉÈÉΩÂÅö‰∫ÜÂï•Ôºå‰ªéÂì™‰∏™ÁºìÂ≠òÂèñÂà∞‰∫ÜBeanÂØπË±° 1234567891011protected &lt;T&gt; T doGetBean( final String name, final Class&lt;T&gt; requiredType, final Object[] args, boolean typeCheckOnly) throws BeansException &#123; final String beanName = transformedBeanName(name); Object bean; // ‰ªéÁºìÂ≠ò‰∏≠Ëé∑Âèñ bean Object sharedInstance = getSingleton(beanName); ... ÁúÅÁï•ÂÖ∂‰ªñÂàõÂª∫beanÁöÑ‰ª£Á†Å&#125; getSingletonÊñπÊ≥ï1234567891011121314151617181920212223242526272829public Object getSingleton(String beanName) &#123; // ÈªòËÆ§ÈÉΩÊòØÂÖÅËÆ∏ÊèêÂâçÊö¥Èú≤ÂØπË±° return getSingleton(beanName, true);&#125;protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123; // ‰ªéÂàõÂª∫ÂÆåÊàêÁöÑbeanÁºìÂ≠ò‰∏≠Ëé∑Âèñbean Object singletonObject = this.singletonObjects.get(beanName); // Âà§Êñ≠ËØ•beanÊòØÂê¶‰ªçÂú®ÂàõÂª∫‰∏≠ÔºåÊÑèÊÄùÊòØBeanÂ∑≤ÁªèÂÆåÊàêÂÆû‰æãÂåñÔºå‰ΩÜËøò‰∏çÂÆåÊï¥„ÄÇÂ±ûÊÄßËøòÊú™ÂÆåÂÖ®Ê≥®ÂÖ• if (singletonObject == null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123; synchronized (this.singletonObjects) &#123; // ‰ªéÊèêÂâçÊö¥Èú≤ÁöÑBeanÁºìÂ≠òÂÆπÂô®ÔºàearlySingletonObjectsÔºâ‰∏≠Ëé∑Âèñ singletonObject = this.earlySingletonObjects.get(beanName); // ‰ªçÊú™Ëé∑ÂèñÂà∞Âàô‰ªésingletonFactoriesÁºìÂ≠ò‰∏≠Ëé∑Âèñ if (singletonObject == null &amp;&amp; allowEarlyReference) &#123; ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName); if (singletonFactory != null) &#123; singletonObject = singletonFactory.getObject(); // Âä†ÂÖ•Âà∞ÊèêÂâçÊö¥Èú≤BeanÁºìÂ≠òÔºàearlySingletonObjectsÔºâ‰∏≠ this.earlySingletonObjects.put(beanName, singletonObject); // ‰ªésingletonFactoriesÁºìÂ≠ò‰∏≠ÁßªÈô§ this.singletonFactories.remove(beanName); &#125; &#125; &#125; &#125; // ËøîÂõûÂØπË±°ÔºåËøôÈáåËøîÂõûÁöÑ‰∏ç‰∏ÄÂÆöÊòØÂÆåÂÖ®ÂàõÂª∫ÁöÑÂØπË±° return (singletonObject != NULL_OBJECT ? singletonObject : null);&#125; ‰ªégetSingletonÊñπÊ≥ï‰∏≠Êàë‰ª¨ÈúÄË¶ÅÁùÄÈáçÂÖ≥Ê≥®Âá†‰∏™BeanÁöÑÁºìÂ≠òÔºåÊ†áÈ¢òÂ∑≤ÁªèËØ¥‰∫ÜÔºåÁºìÂ≠òÊòØËß£ÂÜ≥Âæ™ÁéØ‰æùËµñÁöÑÂÖ≥ÈîÆÔºå‰∏ãÈù¢Êàë‰ªãÁªç‰∏Ä‰∏ã‰∏äÈù¢‰ª£Á†Å‰∏≠ÊèêÂà∞‰∫Ü‰∏âÁßçÁºìÂ≠ò 12345678/** Cache of singleton objects: bean name --&gt; bean instance */private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;String, Object&gt;(256);/** Cache of singleton factories: bean name --&gt; ObjectFactory */private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap&lt;String, ObjectFactory&lt;?&gt;&gt;(16);/** Cache of early singleton objects: bean name --&gt; bean instance */private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap&lt;String, Object&gt;(16); singletonObjects Áî®‰∫éÂ≠òÊîæÂàõÂª∫ÂÆåÊàêÁöÑÂçï‰æãÂØπË±° singletonFactories Áî®‰∫éÂ≠òÊîæÂØπË±°Â∑•ÂéÇÁ±ªÔºåËøôÈáåÊòØËß£ÂÜ≥Âæ™ÁéØ‰æùËµñÁöÑ earlySingletonObjects Áî®‰∫éÂ≠òÊîæÊèêÂâçÊö¥Èú≤ÁöÑÂçï‰æãÂØπË±°„ÄÇÊåáÁöÑÊòØÂ∑≤ÁªèÂÆåÊàêBeanÁöÑÂÆû‰æãÂåñÔºå‰ΩÜËøòÊú™ÂÆåÊàêÂ±ûÊÄßÊ≥®ÂÖ•ÁöÑ‰∏çÂÆåÊï¥ÂØπË±° ÂÜçÊù•ËØ¥‰∏äÈù¢‰ª£Á†Å‰∏≠ÂèñÁºìÂ≠òÁöÑÊ≠•È™§ÔºåÈ¶ñÂÖàËÇØÂÆöÊòØ‰ªésingletonObjects‰∏≠Ëé∑ÂèñÂÆåÂÖ®ÂàõÂª∫ÂÆåÊàêÁöÑBeanÂØπË±°ÔºåÂ¶ÇÊûúËé∑Âèñ‰∏çÂà∞ÔºåÂàô‰ªéÊèêÂâçÊö¥Èú≤ÂØπË±°ÁºìÂ≠òÔºàearlySingletonObjectsÔºâ‰∏≠Ëé∑ÂèñÔºåËøòËé∑Âèñ‰∏çÂà∞ÂÜçÂà∞singletonFactories‰∏≠Ëé∑Âèñ Âà∞ËøôÈáå‰∏∫Ê≠¢ÔºåÊàë‰ª¨Âè™ÂàÜÊûê‰∫ÜÂèñBeanÁºìÂ≠òÁöÑËøáÁ®ãÔºåÊâÄ‰ª•Êé•‰∏ãÊù•Êàë‰ª¨Ë¶ÅÂàÜÊûêÁöÑÂ∞±ÊòØÊîæÁºìÂ≠òÁöÑËøáÁ®ã‰ª£Á†Å ÊèêÂâçÊö¥Èú≤BeanÁé∞Âú®ËÆ©Êàë‰ª¨ÂéªÂà∞ÂàõÂª∫BeanÁöÑËøáÁ®ã„ÄÇÂ¶ÇÊûúÁºìÂ≠òÊ≤°ÂèñÂà∞Ôºå‰ºöÊâßË°åÂàõÂª∫BeanÁöÑÈÄªËæëÔºåÊâæÂà∞AbstractAutowireCapableBeanFactoryÁ±ªÁöÑdoCreateBeanÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÂú®‰πãÂâçÁöÑÊñáÁ´†‰∏≠ÊúâÂÅöËøáÂàÜÊûêÔºå‰ΩÜÊ≤°ÊúâÂØπBeanÁºìÂ≠òÂ§ÑÁêÜÂÅöÂàÜÊûê„ÄÇËøôÈáåÊàë‰ª¨ÁùÄÈáçÁúã‰∏≠Èó¥Ëß£ÂÜ≥Âæ™ÁéØ‰æùËµñÁöÑÈÇ£ÈÉ®ÂàÜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106protected Object doCreateBean(final String beanName, final RootBeanDefinition mbd, final Object[] args) throws BeanCreationException &#123; // Instantiate the bean. // Â∞ÅË£ÖbeanÁöÑÂÆπÂô® BeanWrapper instanceWrapper = null; if (mbd.isSingleton()) &#123; instanceWrapper = this.factoryBeanInstanceCache.remove(beanName); &#125; if (instanceWrapper == null) &#123; // ËøôÈáåÊòØÂàõÂª∫ BeanWrapper instanceWrapper = createBeanInstance(beanName, mbd, args); &#125; final Object bean = (instanceWrapper != null ? instanceWrapper.getWrappedInstance() : null); Class&lt;?&gt; beanType = (instanceWrapper != null ? instanceWrapper.getWrappedClass() : null); mbd.resolvedTargetType = beanType; // Allow post-processors to modify the merged bean definition. synchronized (mbd.postProcessingLock) &#123; if (!mbd.postProcessed) &#123; try &#123; applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName); &#125; catch (Throwable ex) &#123; throw new BeanCreationException(mbd.getResourceDescription(), beanName, &quot;Post-processing of merged bean definition failed&quot;, ex); &#125; mbd.postProcessed = true; &#125; &#125; // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÊèêÂâçÊö¥Èú≤ÂØπË±°ÁöÑÂºïÁî®ÔºåÁî®‰∫éËß£ÂÜ≥Âæ™ÁéØ‰æùËµñ boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName)); if (earlySingletonExposure) &#123; if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Eagerly caching bean &apos;&quot; + beanName + &quot;&apos; to allow for resolving potential circular references&quot;); &#125; addSingletonFactory(beanName, new ObjectFactory&lt;Object&gt;() &#123; @Override public Object getObject() throws BeansException &#123; // ËøôÈáå‰ºö‰∏éAOPÁõ∏ÂÖ≥ return getEarlyBeanReference(beanName, mbd, bean); &#125; &#125;); &#125; // Initialize the bean instance. Object exposedObject = bean; try &#123; // ‰æùËµñÊ≥®ÂÖ•ÁöÑ‰∏ªÈÄªËæë populateBean(beanName, mbd, instanceWrapper); if (exposedObject != null) &#123; // ÊâßË°å‰∏Ä‰∫õÂàùÂßãÂåñÁöÑÊñπÊ≥ï exposedObject = initializeBean(beanName, exposedObject, mbd); &#125; &#125; catch (Throwable ex) &#123; if (ex instanceof BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123; throw (BeanCreationException) ex; &#125; else &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, &quot;Initialization of bean failed&quot;, ex); &#125; &#125; if (earlySingletonExposure) &#123; Object earlySingletonReference = getSingleton(beanName, false); if (earlySingletonReference != null) &#123; if (exposedObject == bean) &#123; exposedObject = earlySingletonReference; &#125; else if (!this.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123; String[] dependentBeans = getDependentBeans(beanName); Set&lt;String&gt; actualDependentBeans = new LinkedHashSet&lt;String&gt;(dependentBeans.length); for (String dependentBean : dependentBeans) &#123; if (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123; actualDependentBeans.add(dependentBean); &#125; &#125; if (!actualDependentBeans.isEmpty()) &#123; throw new BeanCurrentlyInCreationException(beanName, &quot;Bean with name &apos;&quot; + beanName + &quot;&apos; has been injected into other beans [&quot; + StringUtils.collectionToCommaDelimitedString(actualDependentBeans) + &quot;] in its raw version as part of a circular reference, but has eventually been &quot; + &quot;wrapped. This means that said other beans do not use the final version of the &quot; + &quot;bean. This is often the result of over-eager type matching - consider using &quot; + &quot;&apos;getBeanNamesOfType&apos; with the &apos;allowEagerInit&apos; flag turned off, for example.&quot;); &#125; &#125; &#125; &#125; // Register bean as disposable. try &#123; registerDisposableBeanIfNecessary(beanName, bean, mbd); &#125; catch (BeanDefinitionValidationException ex) &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, &quot;Invalid destruction signature&quot;, ex); &#125; return exposedObject;&#125; ÈÄöËøáÁúã‰ª£Á†ÅÔºåÂèØÁü•Âú®BeanÂÆåÊàêÂÆû‰æãÂåñ‰πãÂêéÔºåÊ≥®ÂÖ•Â±ûÊÄß‰πãÂâçÔºåSpringÂ∞±Â∞ÜËøô‰∏™‰∏çÂÆåÊï¥ÁöÑBeanÊîæÂà∞‰∫ÜsingletonFactoriesÁºìÂ≠ò‰∏≠Ôºå‰ªéËÄåËÆ©Ëøô‰∏™BeanÊèêÂâçËøõË°å‰∫ÜÊö¥Èú≤„ÄÇËøôÊ†∑Â≠êÂú®ÂêéÁª≠ÁöÑÂ±ûÊÄßÊ≥®ÂÖ•Êìç‰Ωú‰∏≠ÔºåÂ¶ÇÊûúÂ≠òÂú®Âæ™ÁéØ‰æùËµñÔºåÂ∞±‰ºö‰ªéÁºìÂ≠ò‰∏≠Ëé∑ÂèñÂà∞Ëøô‰∏™ÊèêÂâçÊö¥Èú≤ÁöÑBeanÔºå‰ªéËÄåÂèØ‰ª•È°∫Âà©ÂÆåÊàê‰æùËµñÊ≥®ÂÖ•„ÄÇ‰ΩÜÊòØË¶ÅÊ≥®ÊÑèËøôÊó∂ÂÄôÊ≥®ÂÖ•ÁöÑÂØπË±°ÊòØ‰∏çÂÆåÊï¥ÁöÑÔºå‰ΩÜÊòØÂõ†‰∏∫‰æùËµñÊñπÂ∑≤ÁªèÊåÅÊúâÂÆÉÁöÑÂºïÁî®ÔºåÊâÄ‰ª•ÂêéÁª≠ÂØπË±°ÁöÑÂÆåÊï¥ÊÄßÊòØÂèØ‰ª•‰øùËØÅÁöÑ ÊÄªÁªìÊú¨ÁØáÊñáÁ´†‰∏ªË¶Å‰ªéSpringÂØπBeanÁöÑÁºìÂ≠òÂ±ÇÈù¢ÂàÜÊûê‰∫ÜÂÖ∂ÂØπÂæ™ÁéØ‰æùËµñÁöÑËß£ÂÜ≥ÔºåËôΩÁÑ∂ÊòØSpringÂ∏ÆÊàë‰ª¨Ëß£ÂÜ≥‰∫ÜËøô‰∏™ÈóÆÈ¢òÔºå‰ΩÜÊòØÂØπ‰∫éÂÆûÁé∞ÁöÑÈÄªËæëÊàë‰ª¨‰ªçÁÑ∂Â∫îËØ•Âéª‰∫ÜËß£ÔºåË≠¨Â¶ÇÔºåÈÄöËøáÊü•ÁúãÊ∫êÁ†ÅÂèØÁü•Spring‰ªÖ‰ªÖÂØπÂçï‰æãÁ±ªÂûãÁöÑÂæ™ÁéØ‰æùËµñËøõË°åËß£ÂÜ≥ÔºåÂØπ‰∫éÊúâÁä∂ÊÄÅÁöÑBeanSpringÂπ∂Ê≤°ÊúâÂéªÂÅöÂ§ÑÁêÜÔºåËÄåÊòØÁõ¥Êé•Ë∑ëÂá∫ÂºÇÂ∏∏ÔºåËøô‰∫õÈÉΩÊòØÈúÄË¶ÅÊ≥®ÊÑèÁöÑ„ÄÇ]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaÁ∫øÁ®ãÊ±†ÂàÜÊûê]]></title>
    <url>%2F2018%2F12%2F20%2FJava%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®Âπ∂ÂèëÁºñÁ®ã‰∏≠ÔºåÊàë‰ª¨ÁªèÂ∏∏‰ºö‰ΩøÁî®Âà∞Á∫øÁ®ãÊ±†ÔºåÂΩìÁÑ∂Êàë‰ª¨‰πüÂèØ‰ª•ÊâãÂä®‰∏Ä‰∏™‰∏Ä‰∏™ÂàõÂª∫Á∫øÁ®ãÔºåÈÇ£‰πà‰∏∫‰ΩïÊàë‰ª¨ËøòÊòØÊé®Â¥áÂ§ßÂÆ∂‰ΩøÁî®Á∫øÁ®ãÊ±†ËøõË°åÂπ∂ÂèëÁºñÁ®ãÂë¢ÔºüÂÄüÁî®„ÄäJavaÂπ∂ÂèëÁºñÁ®ãÁöÑËâ∫ÊúØ„ÄãÊèêÂà∞ÁöÑÊù•ËØ¥‰∏Ä‰∏ã‰ΩøÁî®Á∫øÁ®ãÊ±†ÁöÑ‰ºòÁÇπÊúâ3‰∏™ Èôç‰ΩéËµÑÊ∫êÊ∂àËÄó„ÄÇÈÄöËøáÈáçÂ§çÂà©Áî®Â∑≤ÂàõÂª∫ÁöÑÁ∫øÁ®ãÈôç‰ΩéÁ∫øÁ®ãÂàõÂª∫ÂíåÈîÄÊØÅÈÄ†ÊàêÁöÑÊ∂àËÄó„ÄÇ ÊèêÈ´òÂìçÂ∫îÈÄüÂ∫¶„ÄÇÂΩì‰ªªÂä°Âà∞ËææÊó∂Ôºå‰ªªÂä°ÂèØ‰ª•‰∏çÈúÄË¶ÅÁöÑÁ≠âÂà∞Á∫øÁ®ãÂàõÂª∫Â∞±ËÉΩÁ´ãÂç≥ÊâßË°å„ÄÇ ÊèêÈ´òÁ∫øÁ®ãÁöÑÂèØÁÆ°ÁêÜÊÄß„ÄÇÁ∫øÁ®ãÊòØÁ®ÄÁº∫ËµÑÊ∫êÔºåÂ¶ÇÊûúÊó†ÈôêÂà∂ÁöÑÂàõÂª∫Ôºå‰∏ç‰ªÖ‰ºöÊ∂àËÄóÁ≥ªÁªüËµÑÊ∫êÔºåËøò‰ºöÈôç‰ΩéÁ≥ªÁªüÁöÑÁ®≥ÂÆöÊÄßÔºå‰ΩøÁî®Á∫øÁ®ãÊ±†ÂèØ‰ª•ËøõË°åÁªü‰∏ÄÁöÑÂàÜÈÖçÔºåË∞É‰ºòÂíåÁõëÊéß„ÄÇ ThreadPoolExecutorÁ±ªÂú®Êó•Â∏∏‰ΩøÁî®‰∏≠ÔºåÂ§ßÂ§öÊï∞ÊÉÖÂÜµÊàë‰ª¨ÈÉΩ‰ºö‰ΩøÁî®JDKÊèê‰æõÁöÑExecutorsÂéªÂàõÂª∫Á∫øÁ®ãÊ±†ÔºåExecutorsÂà©Áî®Â∑•ÂéÇÊ®°ÂºèÂêëÊàë‰ª¨Êèê‰æõ‰∫Ü4ÁßçÁ∫øÁ®ãÊ±†ÂÆûÁé∞ÊñπÂºèÔºå‰ΩÜÊòØÊúÄÊñ∞ÁöÑÈòøÈáåJavaÂºÄÂèëÊâãÂÜå‰∏≠ÊòéÁ°ÆËØ¥Êòé‰∫Ü‰∏çÂª∫ËÆÆ‰ΩøÁî®ExecutorsÂéªÂàõÂª∫Á∫øÁ®ãÊ±†ÔºåÂéüÂõ†ÊòØ‰ΩøÁî®ExecutorsÂàõÂª∫Á∫øÁ®ãÊ±†‰ºö‰ΩøÁî®ÂæàÂ§öÈªòËÆ§ÂÄºÔºåÈªòËÆ§‰ΩøÁî®ÁöÑÂèÇÊï∞ÊúâÊó∂ÂÄôÊòØ‰∏çÂêàÁêÜÔºå‰ΩÜÊòØÂºÄÂèëËÄÖÂæÄÂæÄ‰ºöÂøΩÁï•„ÄÇÊâÄ‰ª•Êàë‰ª¨Â∫îËØ•Â∞ΩÈáè‰ΩøÁî®ThreadPoolExecutorÁ±ªÊù•ÊòæÁ§∫ÁöÑÂàõÂª∫Á∫øÁ®ãÊ±†„ÄÇ ‰∏ãÈù¢Êàë‰ª¨ÂÖàÊù•Áúã‰∏ãThreadPoolExecutorÁ±ªÁöÑÁªßÊâøÁªìÊûÑ Ôøº ExecutorÊé•Âè£Âè™Âê´Êúâ‰∏Ä‰∏™execute(Runnable command)ÊñπÊ≥ïÔºåÂä†ÂÖ•‰∏Ä‰∏™Êñ∞ÁöÑÁ∫øÁ®ã ExecutorServiceÊé•Âè£Áõ∏ÊØîExecutorÂ§ö‰∏™Âá†‰∏™ÊñπÊ≥ï 123456789101112131415161718192021 public interface ExecutorService extends Executor &#123; void shutdown(); boolean isShutdown(); boolean isTerminated(); boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException; &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task); &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result); Future&lt;?&gt; submit(Runnable task); &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException; &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException; &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException; &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; Êàë‰ª¨Áõ¥Êé•ÁúãThreadPoolExecutorÊâÄÊèê‰æõÁöÑÊûÑÈÄ†ÊñπÊ≥ï 1234567public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) Áé∞Âú®Êàë‰ª¨Êù•Ëß£Èáä‰∏Ä‰∏ãÂêÑ‰∏™ÂèÇÊï∞ÁöÑÂê´‰πâ corePoolSize Ê†∏ÂøÉÊ±†ÁöÑÂ§ßÂ∞èÔºåËøô‰∏™ÂèÇÊï∞Ë∑üÂêéÈù¢ËÆ≤Ëø∞ÁöÑÁ∫øÁ®ãÊ±†ÁöÑÂÆûÁé∞ÂéüÁêÜÊúâÈùûÂ∏∏Â§ßÁöÑÂÖ≥Á≥ª maximumPoolSize Á∫øÁ®ãÊ±†ÊúÄÂ§ßÁ∫øÁ®ãÊï∞ keepAliveTime Á©∫Èó≤Á∫øÁ®ãÁöÑÂ≠òÊ¥ªÊó∂Èó¥ÔºåÈªòËÆ§Âè™ÊúâÂΩìÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÊï∞Â§ß‰∫écorePoolSizeÊó∂ÔºåkeepAliveTimeÊâç‰ºöËµ∑‰ΩúÁî® unit ÂèÇÊï∞keepAliveTimeÁöÑÊó∂Èó¥Âçï‰Ωç workQueue ‰∏Ä‰∏™ÈòªÂ°ûÈòüÂàóÔºåÁî®Êù•Â≠òÂÇ®Á≠âÂæÖÊâßË°åÁöÑ‰ªªÂä° threadFactory Á∫øÁ®ãÂ∑•ÂéÇÔºå‰∏ªË¶ÅÁî®Êù•ÂàõÂª∫Á∫øÁ®ã handler Ë°®Á§∫ÂΩìÊãíÁªùÂ§ÑÁêÜ‰ªªÂä°Êó∂ÁöÑÁ≠ñÁï•ÔºåÊúâ‰ª•‰∏ãÂõõÁßçÂèñÂÄº 1234ThreadPoolExecutor.AbortPolicy:‰∏¢ÂºÉ‰ªªÂä°Âπ∂ÊäõÂá∫RejectedExecutionExceptionÂºÇÂ∏∏„ÄÇ ThreadPoolExecutor.DiscardPolicyÔºö‰πüÊòØ‰∏¢ÂºÉ‰ªªÂä°Ôºå‰ΩÜÊòØ‰∏çÊäõÂá∫ÂºÇÂ∏∏„ÄÇ ThreadPoolExecutor.DiscardOldestPolicyÔºö‰∏¢ÂºÉÈòüÂàóÊúÄÂâçÈù¢ÁöÑ‰ªªÂä°ÔºåÁÑ∂ÂêéÈáçÊñ∞Â∞ùËØïÊâßË°å‰ªªÂä°ÔºàÈáçÂ§çÊ≠§ËøáÁ®ãÔºâThreadPoolExecutor.CallerRunsPolicyÔºöÁî±Ë∞ÉÁî®Á∫øÁ®ãÂ§ÑÁêÜËØ•‰ªªÂä° ‰∏ãÈù¢ÂÜçÁÆÄÂçïÂÜç‰ªãÁªç‰∏Ä‰∏ãThreadPoolExecutor‰∏≠Âá†‰∏™ÈáçË¶ÅÁöÑÊñπÊ≥ï execute Ëøô‰∏™ÊñπÊ≥ïÂÖ∂ÂÆûÂ∞±ÊòØÂØπExecutorÊé•Âè£ÁöÑÂÆûÁé∞Ôºå‰πüÊòØÊúÄÊ†∏ÂøÉÁöÑÊñπÊ≥ïÔºåÁî®‰∫éÂêëÁ∫øÁ®ãÊ±†‰∏≠Êèê‰∫§‰∏Ä‰∏™‰ªªÂä°ÊâßË°å submit ËØ•ÊñπÊ≥ï‰πüÊòØÁî®‰∫éÂêëÁ∫øÁ®ãÊ±†ÈáåÊèê‰∫§‰ªªÂä°ÔºåÂå∫Âà´Âú®‰∫ésubmitÊèê‰∫§ÂèØ‰ª•ÊúâËøîÂõûÂÄºÔºå‰ºöËøîÂõû‰∏Ä‰∏™FutrueÁ±ªÂûãÊù•ÂºÇÊ≠•Ëé∑ÂèñÊâßË°åÁªìÊûú shutdown Áî®‰∫éÂÖ≥Èó≠Á∫øÁ®ãÊ±† shutdownNow ‰πüÊòØÂÖ≥Èó≠Á∫øÁ®ãÊ±†Ôºå‰∏éshutdownÂå∫Âà´Âú®‰∫éshutdownNow‰ºöÂ∞ùËØïÂÖ≥Èó≠Ê≠£Âú®ÊâßË°åÁöÑÁ∫øÁ®ã‰ªªÂä° ÈÄöËøáÊ∫êÁ†ÅÂàÜÊûê ThreadPoolExecutor‰∏äÊñáÊàë‰ª¨ÁÆÄÂçïÁöÑÂàÜÊûê‰∫ÜThreadPoolExecutorÔºå‰∏ãÈù¢Êàë‰ª¨Â∞ÜÊ†πÊçÆÊ∫êÁ†ÅÊù•Ëøõ‰∏ÄÊ≠•ÂàÜÊûêThreadPoolExecutorÊ†∏ÂøÉÂäüËÉΩÁöÑÂÆûÁé∞ ÂÖà‰ªéÂÖ∂Ê†∏ÂøÉÊñπÊ≥ïexecuteÂºÄÂßãËß£ËØª 12345678910111213141516171819202122232425262728293031public void execute(Runnable command) &#123; // Â¶ÇÊûú‰º†ÂÖ•Á©∫ÂØπË±° ÂàôÊäõÂá∫Á©∫ÊåáÈíàÂºÇÂ∏∏ if (command == null) throw new NullPointerException(); int c = ctl.get(); /** * Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®ÊâßË°å‰ªªÂä°ÁöÑÁ∫øÁ®ãÊï∞Â∞è‰∫é corePoolSize */ if (workerCountOf(c) &lt; corePoolSize) &#123; if (addWorker(command, true)) return; c = ctl.get(); &#125; /** * Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®ÊâßË°å‰ªªÂä°ÁöÑÁ∫øÁ®ãÊï∞Â§ß‰∫écorePoolSizeÔºå‰∏îworkQueueÊú™Êª° */ if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; // ÈáçÂ§çÊ£ÄÊü•‰∏ÄÊ¨°ÔºåÈò≤Ê≠¢Ê≠£Â•ΩÊ≠§Êó∂Á∫øÁ®ãÊ±†Ë¢´shutdown int recheck = ctl.get(); if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); else if (workerCountOf(recheck) == 0) addWorker(null, false); &#125; /** * Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®ÊâßË°åÁöÑ‰ªªÂä°Á∫øÁ®ãÊï∞Â§ß‰∫écorePoolSizeÔºå‰∏îworkQueueÂ∑≤Êª°ÔºåÂàô‰ΩøÁî® * maximumPoolSizeÂèÇÊï∞ÂàõÂª∫Á∫øÁ®ãÔºåÂ¶ÇÊûúÂ∑≤ÁªèÂà∞‰∫ÜmaximumPoolSizeÊúÄÂ§ßÂÄºÔºåÂàôÂêØÁî®ÊãíÁªù * Á≠ñÁï• */ else if (!addWorker(command, false)) reject(command);&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÁÆÄÂçïÊÄªÁªì‰∏Ä‰∏ãÂ∞±ÊòØ ÂΩìÂâçÊ≠£Âú®ÊâßË°å‰ªªÂä°ÁöÑÁ∫øÁ®ãÊï∞Â∞è‰∫écorePoolSizeÊó∂ÔºåÊ≠£Â∏∏Âä†ÂÖ•ÊâßË°å ÂΩìÂâçÊ≠£Âú®ÊâßË°å‰ªªÂä°ÁöÑÁ∫øÁ®ãÊï∞Â§ß‰∫écorePoolSizeÔºå‰∏îworkQueueÊú™Êª°Êó∂ÔºåÂàôÂ∞Ü‰ªªÂä°Âä†ÂÖ•Á≠âÂæÖÈòüÂàóworkQueue‰∏≠ Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®ÊâßË°åÁöÑ‰ªªÂä°Á∫øÁ®ãÊï∞Â§ß‰∫écorePoolSizeÔºå‰∏îworkQueueÂ∑≤Êª°ÔºåÂàô‰ºö‰∏¥Êó∂Êâ©ÂÖÖÁ∫øÁ®ãÊï∞ÔºåÊ†πÊçÆmaximumPoolSizeÊúÄÂ§ßÁ∫øÁ®ãÊï∞ÂÄº Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®ÊâßË°åÁöÑ‰ªªÂä°Á∫øÁ®ãÊï∞Â§ß‰∫émaximumPoolSize ËøôÊó∂Â∑≤ÁªèË∂ÖÂá∫ÊúÄÂ§ßÂèØÊâøÂèóÁöÑÁ∫øÁ®ãÊï∞ÂÄº‰∫ÜÔºå‰ºöÂêØÁî®ÊãíÁªùÁ≠ñÁï•Ôºå‰πüÂ∞±ÊòØ‰∏äÊñáÊâÄÈÖçÁΩÆÁöÑÂõõÁßçÁ≠ñÁï•‰πã‰∏ÄÔºåÈªòËÆ§ÊòØÊäõÂá∫ÂºÇÂ∏∏ÔºåÂä†ÂÖ•‰ªªÂä°Â§±Ë¥• workQueue ‰ªªÂä°ÈòüÂàó‰∏äÊñáÊúâÊèêÂà∞‰ªªÂä°ÈòüÂàóÔºå‰πüÂ∞±ÊòØÂú®Á≠âÂæÖÊâßË°åÁöÑ‰ªªÂä°ÈòüÂàó„ÄÇworkQueueÁöÑÊú¨Ë¥®ÊòØ‰∏ÄÁßçÈòªÂ°ûÈòüÂàóBlockingQueueÔºåÂàó‰∏æ‰∏âÁßçÂ∏∏Áî®Á±ªÂûã Âü∫‰∫éÊï∞ÁªÑÁöÑÂÖàËøõÂÖàÂá∫ÈòüÂàóÔºåÊ≠§ÈòüÂàóÂàõÂª∫Êó∂ÂøÖÈ°ªÊåáÂÆöÂ§ßÂ∞è Âü∫‰∫éÈìæË°®ÁöÑÂÖàËøõÂÖàÂá∫ÈòüÂàó ÂêåÊ≠•ÈòüÂàó ËØ•ÈòüÂàó‰∏çÂ≠òÂÇ®ÂÖÉÁ¥†ÔºåÊØè‰∏™ÊèíÂÖ•Êìç‰ΩúÂøÖÈ°ªÁ≠âÂæÖÂè¶‰∏Ä‰∏™Á∫øÁ®ãË∞ÉÁî®ÁßªÈô§Êìç‰ΩúÔºåÂê¶ÂàôÊèíÂÖ•Êìç‰Ωú‰ºö‰∏ÄÁõ¥ÈòªÂ°û Ê†∏ÂøÉÂäüËÉΩÂàÜÊûê‰∏äÊñá‰∏≠Êàë‰ª¨ÈÄöËøáÊü•ÁúãÊ∫êÁ†ÅÁü•ÈÅì‰∫ÜÊñ∞‰ªªÂä°Âä†ÂÖ•Á∫øÁ®ãÊ±†ÁöÑÁ≠ñÁï•Ôºå‰∏ãÈù¢Êàë‰ª¨ÁªßÁª≠ÂæÄ‰∏ãÁúãÔºåÂÜçÂàÜÊûê‰πãÂâçÔºåÊàë‰ª¨ÂèØ‰ª•ÂÖàÊÄùËÄÉÂá†‰∏™ÈóÆÈ¢ò ‰ªªÂä°Á≠âÂæÖÈòüÂàóÊòØÂú®‰ΩïÊó∂Ë¢´ÊâßË°åÔºü Á∫øÁ®ãÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÈáçÂ§çÂà©Áî®ÁöÑÔºüÔºåÊØïÁ´üËøôÊòØÁ∫øÁ®ãÊ±†ÊúÄÈáçË¶ÅÁöÑÂäüËÉΩ‰∫Ü Á©∫Èó≤Á∫øÁ®ãÊ†πÊçÆkeepAliveTimeÂèÇÊï∞ÊòØÂú®Âì™ÈáåË¢´ÂõûÊî∂ÁöÑÔºü Êé•‰∏ãÊù•Êàë‰ª¨ÁªßÁª≠ÈÄöËøáÊ∫êÁ†ÅÊù•Ëß£ËØªËøô‰∏â‰∏™ÈóÆÈ¢òÊ†πÊçÆ‰∏äÊñáexecuteÊñπÊ≥ïÊ∫êÁ†ÅÔºåÂèØ‰ª•ÁúãÂà∞Ë∞ÉÁî®‰∫ÜaddWorkerÊñπÊ≥ï 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071private boolean addWorker(Runnable firstTask, boolean core) &#123; retry: for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty())) return false; for (;;) &#123; int wc = workerCountOf(c); // ËøôÈáåÂà§Êñ≠ÂΩìÂâçÁ∫øÁ®ãÊï∞ÊòØÂê¶Â§ß‰∫éÊúÄÂ§ßÂÄºÔºåÂ§ß‰∫é‰∫ÜÂàôËøîÂõûfalse if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; if (compareAndIncrementWorkerCount(c)) break retry; c = ctl.get(); // Re-read ctl if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; boolean workerStarted = false; boolean workerAdded = false; Worker w = null; try &#123; // Êñ∞Âª∫‰∫Ü‰∏Ä‰∏™ Worker w = new Worker(firstTask); final Thread t = w.thread; if (t != null) &#123; final ReentrantLock mainLock = this.mainLock; // Âä†ÈîÅ mainLock.lock(); try &#123; // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. int rs = runStateOf(ctl.get()); if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); // ÊääÂΩìÂâçËøô‰∏™Â∑•‰ΩúÁ∫øÁ®ãÂä†ÂÖ•Âà∞ workers ÈõÜÂêà‰∏≠ workers.add(w); int s = workers.size(); if (s &gt; largestPoolSize) largestPoolSize = s; workerAdded = true; &#125; &#125; finally &#123; mainLock.unlock(); &#125; if (workerAdded) &#123; // ÂºÄÂßãÊâßË°åÊ≠§worker t.start(); workerStarted = true; &#125; &#125; &#125; finally &#123; if (! workerStarted) addWorkerFailed(w); &#125; return workerStarted;&#125; Ê†πÊçÆÂèÇÊï∞core Âà§Êñ≠ÂΩìÂâçÁ∫øÁ®ãÊï∞ÊòØÂê¶Â∑≤ÁªèÂ§ß‰∫écorePoolSizeÊàñmaximumPoolSizeÔºåÂ§ß‰∫éÂàôÁõ¥Êé•ËøîÂõûfalse ÂàùÂßãÂåñ‰∫Ü‰∏Ä‰∏™WorkerÂØπË±°ÔºåÂπ∂‰∏îÂä†ÂÖ•Âà∞‰∫ÜworkersÈõÜÂêà‰∏≠ÔºåworkersÊòØ‰∏Ä‰∏™SetÁ±ªÂûãÁöÑÈõÜÂêà ÂêØÂä®ÂΩìÂâçËøô‰∏™WorkerÁ∫øÁ®ã‰ªªÂä° ÁªèËøá‰∏äÈù¢ÁöÑÂàÜÊûêÔºåÂèØËÉΩÂ§ßÊ¶Ç‰ºöÊúâÁñëÊÉëÔºåWorkerÂØπË±°ÊòØÂÅöÂï•ÁöÑÔºü‰∏ãÈù¢Êàë‰ª¨Â∞±Êù•Áúã‰∏ãWorkerÁ±ªÁöÑÂÆûÁé∞ 1234567891011121314151617181920212223242526272829private final class Worker extends AbstractQueuedSynchronizer implements Runnable&#123; /** Thread this worker is running in. Null if factory fails. */ final Thread thread; /** Initial task to run. Possibly null. */ Runnable firstTask; /** Per-thread task counter */ volatile long completedTasks; /** * Creates with given first task and thread from ThreadFactory. * @param firstTask the first task (null if none) */ Worker(Runnable firstTask) &#123; setState(-1); // inhibit interrupts until runWorker this.firstTask = firstTask; this.thread = getThreadFactory().newThread(this); &#125; /** Delegates main run loop to outer runWorker */ public void run() &#123; runWorker(this); &#125; ...&#125; WorkerÂÆûÁé∞‰∫ÜRunnableÊé•Âè£ ÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÈÄöËøáThreadFactoryÂàùÂßãÂåñ‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÁ∫øÁ®ãÂØπË±° run()ÊñπÊ≥ïË∞ÉÁî®‰∫ÜThreadPoolExecutorÁöÑrunWorker() ÈáçÁÇπÂú®runWorkerÊñπÊ≥ï‰∏≠ Á∫øÁ®ãÊ±†ÈáçÂ§çÂà©Áî®Êú∫Âà∂1234567891011121314151617181920212223242526272829303132333435363738394041424344454647final void runWorker(Worker w) &#123; Thread wt = Thread.currentThread(); // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™‰ªªÂä° Runnable task = w.firstTask; w.firstTask = null; w.unlock(); // allow interrupts boolean completedAbruptly = true; try &#123; // ‰ªé‰ªªÂä°ÈòüÂàó‰∏≠Âæ™ÁéØËé∑Âèñ‰ªªÂä°ÊâßË°å getTaskÊñπÊ≥ïÊúâÂèØËÉΩ‰ºöÈòªÂ°û while (task != null || (task = getTask()) != null) &#123; w.lock(); // If pool is stopping, ensure thread is interrupted; // if not, ensure thread is not interrupted. This // requires a recheck in second case to deal with // shutdownNow race while clearing interrupt if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; // Á©∫ÂÆûÁé∞ÔºåÂèØ‰ª•ÈÄöËøáÁªßÊâø`ThreadPoolExecutor`ÈáçÂÜôÊ≠§ÊñπÊ≥ï beforeExecute(wt, task); Throwable thrown = null; try &#123; // ÊâßË°å task.run(); &#125; catch (RuntimeException x) &#123; thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); &#125; &#125; finally &#123; task = null; w.completedTasks++; w.unlock(); &#125; &#125; completedAbruptly = false; &#125; finally &#123; processWorkerExit(w, completedAbruptly); &#125;&#125; ‰ª£Á†ÅËß£ÊûêÂà∞ËøôÈáåÔºåÂü∫Êú¨ÂèØ‰ª•ÂõûÁ≠î‰∏äÊñáÊâÄÊèêÂá∫ÁöÑ‰∏â‰∏™ÈóÆÈ¢ò‰∫Ü Âä†ÂÖ•Âà∞‰ªªÂä°ÈòüÂàóÁöÑ‰ªªÂä°‰ºöÂú®ËøôÈáåË¢´ÊâßË°åÔºåÂõ†‰∏∫WorkerÂØπË±°ÊâßË°åÂÆå‰∏Ä‰∏™‰ªªÂä°ÂêéÔºåÂπ∂‰∏ç‰ºöÁ´ãÂàªÁªìÊùüÔºåËÄåÊòØ‰ºöÈÄöËøáÂæ™ÁéØË∞ÉÁî®getTask()ÊñπÊ≥ï‰ªé‰ªªÂä°ÈòüÂàó‰∏≠Ëé∑ÂèñÊúÄÊñ∞‰ªªÂä°Êù•ÊâßË°åÔºåËøôÊ†∑Â≠êÂ∞±ÂÆûÁé∞‰∫ÜÁ∫øÁ®ãÁöÑÈáçÂ§çÂà©Áî®ÔºåËÄå‰∏çÂøÖÊØèÊ¨°ÈÉΩÈáçÊñ∞ÂàõÂª∫‰∏Ä‰∏™WorkerÂØπË±° ÂΩìgetTask()ÊñπÊ≥ïÊó†Ê≥ïËé∑ÂèñÂà∞ÊúÄÊñ∞ÁöÑ‰ªªÂä°ÂêéÔºåËØ•WorkerÁ∫øÁ®ãÊâç‰ºöË¢´ÂõûÊî∂„ÄÇÊâÄ‰ª•Á¨¨‰∏â‰∏™ÈóÆÈ¢òkeepAliveTimeÁöÑÊú∫Âà∂ÂøÖÁÑ∂ÊòØÂú®getTask()‰∏≠ÂÆûÁé∞ÁöÑ getTask Ë∂ÖÊó∂Á≠ñÁï•123456789101112131415161718192021222324252627282930313233343536373839private Runnable getTask() &#123; boolean timedOut = false; // Did the last poll() time out? for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) &#123; decrementWorkerCount(); return null; &#125; int wc = workerCountOf(c); // workersÂ§ß‰∫écorePoolSizeÔºåÊàñÂàôÂÖÅËÆ∏corePoolSizeËÆæÁΩÆÁ©∫Èó≤Ë∂ÖÊó∂Êó∂Èó¥ boolean timed = allowCoreThreadTimeOut || wc &gt; corePoolSize; // ÂΩìÂâçÁ∫øÁ®ãÊï∞Â∑≤ÁªèÂ§ß‰∫émaximumPoolSizeÊàñÂàôÂ∑≤ÁªèË∂ÖÊó∂Ëøá‰∏ÄÊ¨°ÔºåÂàôÁõ¥Êé•ËøîÂõûnull if ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut)) &amp;&amp; (wc &gt; 1 || workQueue.isEmpty())) &#123; if (compareAndDecrementWorkerCount(c)) return null; continue; &#125; try &#123; // Ëé∑Âèñ‰ªªÂä°ÔºåÂ¶ÇÊûútimed‰∏∫trueÔºåÂàôÁ≠âÂæÖ‰∏ÄÂÆöÊó∂Èó¥ÔºàkeepAliveTimeÔºâÊú™ËøîÂõûÁöÑËØùÔºå‰ºöËøîÂõûnullÔºåÂ¶ÇÊûútimedÊú™ËÆæÁΩÆ‰∏∫trueÔºåÂàô‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÔºåÁõ¥Âà∞ÊúâÊï∞ÊçÆ Runnable r = timed ? workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take(); if (r != null) return r; timedOut = true; &#125; catch (InterruptedException retry) &#123; timedOut = false; &#125; &#125;&#125; ÂÖàÂà§Êñ≠ÂΩìÂâçÁ∫øÁ®ãÊ±†Áä∂ÊÄÅÔºåÂ¶ÇÊûúrunStateÂ§ß‰∫éSHUTDOWNÔºàÂç≥‰∏∫STOPÊàñËÄÖTERMINATEDÔºâÔºåÂàôÁõ¥Êé•ËøîÂõûnull Âà§Êñ≠ÂΩìÂâçÁ∫øÁ®ãÊ±†ÁöÑÁ∫øÁ®ãÊï∞ÊòØÂê¶Â∑≤ÁªèÂ§ß‰∫éÊ†∏ÂøÉÊ±†Â§ßÂ∞ècorePoolSizeÊàñËÄÖÂÖÅËÆ∏‰∏∫Ê†∏ÂøÉÊ±†‰∏≠ÁöÑÁ∫øÁ®ãËÆæÁΩÆÁ©∫Èó≤Â≠òÊ¥ªÊó∂Èó¥ÔºåÂàôË∞ÉÁî®workQueue.poll(time,timeUnit)Êù•Âèñ‰ªªÂä°ÔºåËøô‰∏™ÊñπÊ≥ï‰ºöÈòªÂ°ûÁ≠âÂæÖ‰∏ÄÂÆöÁöÑÊó∂Èó¥ÔºåÂ¶ÇÊûúÂèñ‰∏çÂà∞‰ªªÂä°Â∞±ËøîÂõûnullÔºåÂê¶ÂàôÂàô‰ºöË∞ÉÁî®workQueue.take()Êù•Âèñ‰ªªÂä°ÔºåËøô‰∏™ÊñπÊ≥ï‰ºöwaitÈáäÊîæCPU‰∏ÄÁõ¥ÈòªÂ°û„ÄÇ ÊÄªÁªì‰∏Ä‰∏ãÔºåÂè™ÊúâÂΩìÊàë‰ª¨ËÆæÁΩÆallowCoreThreadTimeOutÔºàÊ†∏ÂøÉÊ±†Á∫øÁ®ãÁ©∫Èó≤Ë∂ÖÊó∂Êó∂Èó¥ÔºâÊàñÂàôÂΩìÂâçÁ∫øÁ®ãÊï∞Â§ß‰∫écorePoolSizeÊó∂ÔºåkeepAliveTimeÊú∫Âà∂Êâç‰ºöÁîüÊïà Êï¥‰∏™ÊµÅÁ®ãÂà∞ËøôÈáåÂ§ßÊ¶ÇÂ∞±ÂàÜÊûêÂÆå‰∫ÜÔºå‰∏ãÂõæÂü∫Êú¨ÁªòÂà∂‰∫ÜÁ∫øÁ®ãÊ±†Êèê‰∫§‰ªªÂä°ÔºåÊâßË°å‰ªªÂä°ÁöÑÊï¥‰∏™ÊµÅÁ®ã Executors ‰∏≠Âá†‰∏™Â∏∏Áî®ÁöÑÁ∫øÁ®ãÊ±†ËôΩÁÑ∂ÈòøÈáåJavaÂºÄÂèëËßÑÁ∫¶‰∏≠‰∏çÂª∫ËÆÆÊàë‰ª¨‰ΩøÁî®ExecutorsÁ±ªÁõ¥Êé•ÂàõÂª∫Á∫øÁ®ãÊ±†Ôºå‰ΩÜËøòÊòØÊúâÂøÖË¶ÅÁÆÄÂçï‰ªãÁªçÂá†‰∏™ÂÖ∂‰∏≠Â∏∏Áî®ÁöÑÊñπÊ≥ï Executors.newCachedThreadPool() ÂàõÂª∫‰∏Ä‰∏™ÁºìÂÜ≤Ê±†ÔºåÁºìÂÜ≤Ê±†ÂÆπÈáèÂ§ßÂ∞è‰∏∫Integer.MAX_VALUE. Â∞ÜcorePoolSizeËÆæÁΩÆ‰∏∫0ÔºåÂ∞ÜmaximumPoolSizeËÆæÁΩÆ‰∏∫Integer.MAX_VALUEÔºåworkQueue‰ΩøÁî®ÁöÑSynchronousQueueÔºå‰πüÂ∞±ÊòØËØ¥Êù•‰∫Ü‰ªªÂä°Â∞±ÂàõÂª∫Á∫øÁ®ãËøêË°åÔºåÂΩìÁ∫øÁ®ãÁ©∫Èó≤Ë∂ÖËøá60ÁßíÔºåÂ∞±ÈîÄÊØÅÁ∫øÁ®ã Executors.newSingleThreadExecutor() ÂàõÂª∫ÂÆπÈáè‰∏∫1ÁöÑÁºìÂÜ≤Ê±†ÔºåÂ∞ÜcorePoolSizeÂíåmaximumPoolSizeÈÉΩËÆæÁΩÆ‰∏∫1ÔºåworkQueue‰ΩøÁî®ÁöÑLinkedBlockingQueue Executors.newFixedThreadPool(int) ÂàõÂª∫Âõ∫ÂÆöÂÆπÈáèÂ§ßÂ∞èÁöÑÁºìÂÜ≤Ê±†ÔºåÁ©∫Èó≤Á∫øÁ®ã‰∏ç‰ºöÈîÄÊØÅ„ÄÇcorePoolSizeÂíåmaximumPoolSizeÂÄºÊòØÁõ∏Á≠âÁöÑÔºåworkQueue‰ΩøÁî®ÁöÑÊòØLinkedBlockingQueue ÊÄªÁªìÊú¨ÁØáÊñáÁ´†‰∏ªË¶Å‰ªéÂØπÁ∫øÁ®ãÊ±†ÁöÑÈÖçÁΩÆ‰ΩøÁî®Ôºå‰ª•ÂèäÊ∫êÁ†ÅÂÆûÁé∞ÂÅö‰∫ÜÂàÜÊûêÔºåÊÄª‰Ωì‰∏äÊØîËæÉÂÖ®Èù¢ÁöÑÂàÜÊûê‰∫ÜJavaÁ∫øÁ®ãÊ±†ÁöÑÂÆûÁé∞„ÄÇ]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>Âπ∂ÂèëÁºñÁ®ã</category>
      </categories>
      <tags>
        <tag>Âπ∂Âèë</tag>
        <tag>Á∫øÁ®ãÊ±†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring AOP Ê∫êÁ†ÅËß£Êûê‰∏âÔºà‰ª£ÁêÜÂØπË±°ÁöÑÂàõÂª∫Ôºâ]]></title>
    <url>%2F2018%2F12%2F15%2FSpring-AOP-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%89%EF%BC%88%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏äÊúüÊàë‰ª¨ÂØπAOPÊ†∏ÂøÉÊ¶ÇÂøµÂèäÊé•Âè£ÂÅö‰∫ÜÁ≤óÊµÖÁöÑÂàÜÊûêÔºåËøôÊúüÊàë‰ª¨‰∏ªË¶ÅÊù•Êé¢ËÆ®‰∏Ä‰∏ã‰ª£ÁêÜÂØπË±°ÁöÑÂàõÂª∫ËøáÁ®ã„ÄÇÂú®ÂºÄÂßã‰πãÂâçÔºåÂÖàÈóÆËá™Â∑±Âá†‰∏™ÈóÆÈ¢ò SpringÊòØÂ¶Ç‰ΩïÂ∏ÆÊàë‰ª¨ÂéªÈÄâÊã©ÂêàÈÄÇÁöÑAdviceÁöÑÔºüÊâæÂà∞‰∫ÜÂèàÊòØÈÄöËøá‰ΩïÁßçÊñπÂºèÂàõÂª∫‰ª£ÁêÜÂØπË±°ÁöÑÔºü Â•Ω‰∫ÜÔºåÁé∞Âú®Êàë‰ª¨ÂºÄÂßãÂàÜÊûê‰ª£ÁêÜÂØπË±°ÁöÑÂàõÂª∫ËøáÁ®ãÔºåÈ¶ñÂÖàÔºåÂÖàÊù•Áúã‰∏Ä‰∏ãAspectJAwareAdvisorAutoProxyCreator.classÁ±ªÁöÑÁªßÊâø‰ΩìÁ≥ª ÂèØ‰ª•ÁúãÂà∞AspectJAwareAdvisorAutoProxyCreator.class‰∏ªË¶ÅÂÆûÁé∞‰∫ÜËøôÂá†‰∏™Êé•Âè£ Aware BeanÂàõÂª∫Êó∂Ê≥®ÂÖ•‰∏Ä‰∫õÂÆπÂô®Â±ûÊÄßÁ≠â BeanPostProcessor IOC Êâ©Â±ïÁÇπ AopInfrastructureBean Ê†áËØÜÊ≠§Á±ªÊòØAOPÁ≥ªÁªüÁ±ªÔºå‰∏çËÉΩË¢´‰ª£ÁêÜ ËøôÈáåÊàë‰ª¨‰ªÖÈúÄË¶ÅÂÖ≥Ê≥®BeanPostProcessorÊé•Âè£ÁöÑÂÆûÁé∞ÔºåÂõ†‰∏∫‰ª£ÁêÜÁöÑÂàõÂª∫ÊòØÂú®BeanPostProcessorÊé•Âè£ÁöÑpostProcessAfterInitializationÊñπÊ≥ïÊâßË°åÊó∂ÂàõÂª∫ÁöÑÔºåpostProcessAfterInitializationÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÈÄªËæëÊòØÂú®ÊäΩË±°Áà∂Á±ªAbstractAutoProxyCreator‰∏≠ÂÆûÁé∞ÁöÑ ÂÖ•Âè£‰∏äÊñá‰∏≠ÊèêÂà∞AspectJAwareAdvisorAutoProxyCreator.classÊòØBeanPostProcessorÊé•Âè£ÁöÑÂÆûÁé∞ÔºåÁé∞Âú®Â∞±ËÆ©Êàë‰ª¨ÊâìÂºÄÂÆÉÁöÑÂÖ•Âè£Ê∫êÁ†ÅÊÖ¢ÊÖ¢ÂàÜÊûê 12345678910public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; if (bean != null) &#123; // ËøîÂõûÁî®ÂÅöÁºìÂ≠òÁöÑkeyÈîÆ Object cacheKey = getCacheKey(bean.getClass(), beanName); if (!this.earlyProxyReferences.contains(cacheKey)) &#123; return wrapIfNecessary(bean, beanName, cacheKey); &#125; &#125; return bean;&#125; 1234567891011121314151617181920212223242526272829protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) &#123; if (beanName != null &amp;&amp; this.targetSourcedBeans.contains(beanName)) &#123; return bean; &#125; if (Boolean.FALSE.equals(this.advisedBeans.get(cacheKey))) &#123; return bean; &#125; // Âà§Êñ≠ÂΩìÂâçÁöÑBeanÊòØÂê¶ÊòØAOPÊú¨Ë∫´ÁöÑÁ≥ªÁªüÁ±ªÔºåÊòØÁöÑËØùÂàôË∑≥ËøáÔºå‰∏çÂÅö‰ª£ÁêÜÊìç‰Ωú if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) &#123; this.advisedBeans.put(cacheKey, Boolean.FALSE); return bean; &#125; // ‰∏∫ËØ•BeanÊâæÂà∞‰∏Ä‰∏™ÂêàÈÄÇÁöÑ advisor Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null); // ËøîÂõû‰∏ç‰∏∫Á©∫ if (specificInterceptors != DO_NOT_PROXY) &#123; this.advisedBeans.put(cacheKey, Boolean.TRUE); // ÂàõÂª∫‰ª£ÁêÜÂØπË±° Object proxy = createProxy( bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean)); this.proxyTypes.put(cacheKey, proxy.getClass()); return proxy; &#125; // Ê≤°ÊúâÊâæÂà∞ÂêàÈÄÇÁöÑ advisor ÂàôÁõ¥Êé•ËøîÂõûÂéüÂßãBean this.advisedBeans.put(cacheKey, Boolean.FALSE); return bean;&#125; ÁúãÂÆåwrapIfNecessaryÊñπÊ≥ïÔºåËøôÈáåÂ∞±ÊòØÂàõÂª∫‰ª£ÁêÜÂØπË±°ÁöÑÂÖ®ËøáÁ®ã„ÄÇÂÖ∂ÂÆûÂú®Ëøô‰∏™ÊñπÊ≥ï‰∏≠‰∏ÄÂÖ±Â∞±ÂÅö‰∫Ü‰∏§‰ª∂‰∫ãÊÉÖ: getAdvicesAndAdvisorsForBeanÊñπÊ≥ï Á≠õÈÄâÂêàÈÄÇÁöÑAdvisorÂØπË±°ÔºåÂÖ∂ÂÆûÂ∞±ÊòØ‰∏∫ÂΩìÂâçÁõÆÊ†áÂØπË±°ÊâæÂà∞ÂêàÈÄÇÁöÑÈÄöÁü•(Advice) createProxyÊñπÊ≥ï Ê†πÊçÆÁ≠õÈÄâÂà∞ÁöÑÂàáÈù¢ÔºàAdvisorÔºâÈõÜÂêà‰∏∫ÁõÆÊ†áÂØπË±°ÂàõÂª∫‰ª£ÁêÜ ‰∏ãÈù¢Êàë‰ª¨ÂàÜÂà´ÂØπËøô‰∏§‰ª∂‰∫ãÊÉÖ‰ΩúÂàÜÊûê ÂØªÊâæÂêàÈÄÇÁöÑ AdvisorfindEligibleAdvisorsÊñπÊ≥ïÊòØÂú®Áà∂Á±ªAbstractAdvisorAutoProxyCreator‰∏≠Ôºå‰∏îÁõ¥Êé•Ë∞ÉÁî®‰∫ÜfindEligibleAdvisors ÊñπÊ≥ï 123456 List&lt;Advisor&gt; advisors = findEligibleAdvisors(beanClass, beanName); if (advisors.isEmpty()) &#123; return DO_NOT_PROXY; &#125; return advisors.toArray();&#125; 1234567891011protected List&lt;Advisor&gt; findEligibleAdvisors(Class&lt;?&gt; beanClass, String beanName) &#123; // ÊâæÂà∞ÂÆπÂô®‰∏≠ÁöÑÂÖ®ÈÉ®ÈÄöÁü• List&lt;Advisor&gt; candidateAdvisors = findCandidateAdvisors(); // Á≠õÈÄâÂêàÈÄÇÈÄöÁü•ÂØπË±°ÈõÜÂêà List&lt;Advisor&gt; eligibleAdvisors = findAdvisorsThatCanApply(candidateAdvisors, beanClass, beanName); extendAdvisors(eligibleAdvisors); if (!eligibleAdvisors.isEmpty()) &#123; eligibleAdvisors = sortAdvisors(eligibleAdvisors); &#125; return eligibleAdvisors;&#125; ËøôÈáå‰πüÊòØÂàÜÂºÄÂÅö‰∫Ü‰∏§‰ª∂‰∫ãÊÉÖ È¶ñÂÖà‰ªéSpring ÂÆπÂô®‰∏≠Ëé∑ÂèñÂà∞ÂÖ®ÈÉ®AdvisorsÈõÜÂêà ÊâßË°åÁ≠õÈÄâÈÄªËæëÔºåËé∑ÂèñÁ¨¶ÂêàÊù°‰ª∂ÁöÑAdvisorsÈõÜÂêà ÊâæÂà∞SpringÂÆπÂô®‰∏≠ÂÖ®ÈÉ® AdvisorËøôÈáåÊòØË∞ÉÁî®‰∫ÜBeanFactoryAdvisorRetrievalHelper.classÁöÑÊñπÊ≥ïÂéªËé∑ÂèñÂà∞Spring ÂÆπÂô®‰∏≠ÂÖ®ÈÉ®AdvisorÈõÜÂêàÁöÑÔºåËøôÈáåÈúÄË¶ÅÊ≥®ÊÑèBeanFactoryAdvisorRetrievalHelper.classÁ±ªÁöÑÂàùÂßãÂåñÊòØÂú®setBeanFactoryÊñπÊ≥ï‰∏≠ËøõË°åÁöÑ 123protected List&lt;Advisor&gt; findCandidateAdvisors() &#123; return this.advisorRetrievalHelper.findAdvisorBeans();&#125; BeanFactoryAdvisorRetrievalHelperÁöÑfindAdvisorBeansÊñπÊ≥ï 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public List&lt;Advisor&gt; findAdvisorBeans() &#123; // Determine list of advisor bean names, if not cached already. String[] advisorNames = null; synchronized (this) &#123; // Â∞ùËØï‰ªéÁºìÂ≠ò‰∏≠Ëé∑Âèñ Advisor Á±ªÂûãÁöÑBeanÂêçÁß∞ advisorNames = this.cachedAdvisorBeanNames; // if (advisorNames == null) &#123; // ‰ªéBeanFactory‰∏≠Ëé∑Âèñ Advisor Á±ªÂûãÁöÑÂÖ®ÈÉ®BeanÂêçÁß∞ÈõÜÂêàÔºåÂπ∂ËÆæÁΩÆÁºìÂ≠ò advisorNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors( this.beanFactory, Advisor.class, true, false); this.cachedAdvisorBeanNames = advisorNames; &#125; &#125; if (advisorNames.length == 0) &#123; return new LinkedList&lt;Advisor&gt;(); &#125; List&lt;Advisor&gt; advisors = new LinkedList&lt;Advisor&gt;(); // ÈÅçÂéÜ AdvisorÁ±ªÂûã BeanName ÈõÜÂêà for (String name : advisorNames) &#123; // Âà§Êñ≠ÊòØÂê¶ÂêàÊ≥ïÔºåËøôÈáåËøîÂõûÈÉΩÊòØtrue if (isEligibleBean(name)) &#123; // Âà§Êñ≠ËØ•BeanÊòØÂê¶Ê≠£Âú®ÂàõÂª∫‰∏≠ÔºåÂàõÂª∫‰∏≠ÂàôÁõ¥Êé•Ë∑≥Ëøá if (this.beanFactory.isCurrentlyInCreation(name)) &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Skipping currently created advisor '" + name + "'"); &#125; &#125; else &#123; try &#123; // Ê†πÊçÆBeanNameÂíåAdvisorÁ±ªÂûã‰ªéBeanFactory‰∏≠Ëé∑ÂèñBean advisors.add(this.beanFactory.getBean(name, Advisor.class)); &#125; catch (BeanCreationException ex) &#123; Throwable rootCause = ex.getMostSpecificCause(); if (rootCause instanceof BeanCurrentlyInCreationException) &#123; BeanCreationException bce = (BeanCreationException) rootCause; if (this.beanFactory.isCurrentlyInCreation(bce.getBeanName())) &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Skipping advisor '" + name + "' with dependency on currently created bean: " + ex.getMessage()); &#125; // Ignore: indicates a reference back to the bean we're trying to advise. // We want to find advisors other than the currently created bean itself. continue; &#125; &#125; throw ex; &#125; &#125; &#125; &#125; return advisors;&#125; findAdvisorBeansÊñπÊ≥ïÁöÑÁöÑÁõÆÁöÑÈùûÂ∏∏ÊòéÁ°ÆÔºåÂ∞±ÊòØÊâæÂà∞ÂÆπÂô®‰∏≠ÂÖ®ÈÉ®ÁöÑAdvisor ÂÖàÂ∞ùËØï‰ªéÁºìÂ≠ò‰∏≠Ëé∑ÂèñAdvisorÈõÜÂêà ÁºìÂ≠ò‰∏≠‰∏çÂ≠òÂú®ÔºåÂàôÊâßË°åËé∑ÂèñÈÄªËæë Ëé∑ÂèñÂà∞‰∫ÜÊâÄÊúâÁ±ªÂûã‰∏∫AdvisorÁöÑBeanÁöÑÂêçÁß∞ Ê†πÊçÆËé∑ÂèñÂà∞ÁöÑBeanNameËé∑ÂèñBean ‰∏∫ÂΩìÂâçBeanÂåπÈÖçÂêàÈÄÇÁöÑ AdvisorÂú®‰ª•‰∏äÁöÑÊ≠•È™§‰∏≠ÔºåÊàë‰ª¨Â∑≤ÁªèÊãøÂà∞‰∫ÜÂÆπÂô®‰∏≠ÊâÄÊúâÁöÑAdvisorÂØπË±°ÈõÜÂêàÔºå‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨Â∑≤ÁªèÊãøÂà∞‰∫ÜÂÆπÂô®‰∏≠ÊâÄÊúâÂ∑≤ÈÖçÁΩÆÁöÑAOPÂàáÈù¢„ÄÇÊé•‰∏ãÈáåÁöÑ‰∫ãÊÉÖÂ∞±ÊòØ‰∏∫ÂΩìÂâçÁöÑÁõÆÊ†áÂØπË±°Á≠õÈÄâÂá∫ÈÄÇÂêàÁöÑAdvisorÈõÜÂêàÔºåÁé∞Âú®Êàë‰ª¨ÂºÄÂßãÂàÜÊûêAbstractAdvisorAutoProxyCreator.classÁöÑfindAdvisorsThatCanApplyÊñπÊ≥ï 123456789101112protected List&lt;Advisor&gt; findAdvisorsThatCanApply( List&lt;Advisor&gt; candidateAdvisors, Class&lt;?&gt; beanClass, String beanName) &#123; ProxyCreationContext.setCurrentProxiedBeanName(beanName); try &#123; // Ë∞ÉÁî® AopUtils.findAdvisorsThatCanApply ‰∏∫ÂΩìÂâçBeanÁ≠õÈÄâÂêàÈÄÇÁöÑ Advisor return AopUtils.findAdvisorsThatCanApply(candidateAdvisors, beanClass); &#125; finally &#123; ProxyCreationContext.setCurrentProxiedBeanName(null); &#125;&#125; findAdvisorsThatCanApplyÊñπÊ≥ïÈáåË∞ÉÁî®‰∫ÜÂ∑•ÂÖ∑Á±ªAOPUtilsÁöÑfindAdvisorsThatCanApplyÊñπÊ≥ï 123456789101112131415161718192021222324public static List&lt;Advisor&gt; findAdvisorsThatCanApply(List&lt;Advisor&gt; candidateAdvisors, Class&lt;?&gt; clazz) &#123; if (candidateAdvisors.isEmpty()) &#123; return candidateAdvisors; &#125; List&lt;Advisor&gt; eligibleAdvisors = new LinkedList&lt;Advisor&gt;(); // ÂÖàÊâæÂá∫ IntroductionAdvisor Á±ªÂûãÁöÑAdvisor for (Advisor candidate : candidateAdvisors) &#123; if (candidate instanceof IntroductionAdvisor &amp;&amp; canApply(candidate, clazz)) &#123; eligibleAdvisors.add(candidate); &#125; &#125; boolean hasIntroductions = !eligibleAdvisors.isEmpty(); // ÂÜç‰ªé‰Ωô‰∏ãÁöÑAdvisor‰∏≠ÁªßÁª≠ÂåπÈÖç for (Advisor candidate : candidateAdvisors) &#123; if (candidate instanceof IntroductionAdvisor) &#123; // already processed continue; &#125; if (canApply(candidate, clazz, hasIntroductions)) &#123; eligibleAdvisors.add(candidate); &#125; &#125; return eligibleAdvisors;&#125; ‰ª•‰∏ä‰ª£Á†ÅÈÄªËæë‰ºöÂÖàÁ≠õÈÄâÂá∫IntroductionAdvisorÁ±ªÂûãÁöÑAdvisorÔºåÂÜçÁ≠õÈÄâ‰Ωô‰∏ãÁöÑÂÖ∂‰ªñAdvisor 123public static boolean canApply(Advisor advisor, Class&lt;?&gt; targetClass) &#123; return canApply(advisor, targetClass, false);&#125; 12345678910111213public static boolean canApply(Advisor advisor, Class&lt;?&gt; targetClass, boolean hasIntroductions) &#123; if (advisor instanceof IntroductionAdvisor) &#123; return ((IntroductionAdvisor) advisor).getClassFilter().matches(targetClass); &#125; else if (advisor instanceof PointcutAdvisor) &#123; PointcutAdvisor pca = (PointcutAdvisor) advisor; return canApply(pca.getPointcut(), targetClass, hasIntroductions); &#125; else &#123; // It doesn&apos;t have a pointcut so we assume it applies. return true; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536public static boolean canApply(Pointcut pc, Class&lt;?&gt; targetClass, boolean hasIntroductions) &#123; Assert.notNull(pc, &quot;Pointcut must not be null&quot;); // ÂÖàÂà§Êñ≠Á±ªÂûãÊòØÂê¶ÂåπÈÖç if (!pc.getClassFilter().matches(targetClass)) &#123; return false; &#125; // Ëé∑ÂèñÂàáÁÇπÊñπÊ≥ïÂåπÈÖçÂô® MethodMatcher methodMatcher = pc.getMethodMatcher(); if (methodMatcher == MethodMatcher.TRUE) &#123; // No need to iterate the methods if we&apos;re matching any method anyway... return true; &#125; IntroductionAwareMethodMatcher introductionAwareMethodMatcher = null; if (methodMatcher instanceof IntroductionAwareMethodMatcher) &#123; introductionAwareMethodMatcher = (IntroductionAwareMethodMatcher) methodMatcher; &#125; Set&lt;Class&lt;?&gt;&gt; classes = new LinkedHashSet&lt;Class&lt;?&gt;&gt;(ClassUtils.getAllInterfacesForClassAsSet(targetClass)); classes.add(targetClass); for (Class&lt;?&gt; clazz : classes) &#123; // Ëé∑ÂèñÂΩìÂâçÁõÆÊ†áclassÁöÑÊâÄÊúâÊñπÊ≥ï Method[] methods = ReflectionUtils.getAllDeclaredMethods(clazz); for (Method method : methods) &#123; // Ë∞ÉÁî® methodMatcher.matches Âà§Êñ≠ÂΩìÂâçÊñπÊ≥ïÊòØÂê¶ÂåπÈÖçËØ•ÂàáÁÇπ if ((introductionAwareMethodMatcher != null &amp;&amp; introductionAwareMethodMatcher.matches(method, targetClass, hasIntroductions)) || methodMatcher.matches(method, targetClass)) &#123; return true; &#125; &#125; &#125; return false;&#125; canApplyÊòØÁî®‰∫éÁ≠õÈÄâÊ†∏ÂøÉÊñπÊ≥ïÔºåÂú®‰∏äÊúüÂàÜÊûêËøûÊé•ÁÇπPointcutÊé•Âè£Êó∂ÔºåÊàë‰ª¨Áü•ÈÅìPointcutÊåÅÊúâClassFilterÂíåMethodMatcherÂØπË±°ÔºåÂÖ∑‰ΩìÁöÑÁ≠õÈÄâÈÄªËæëÂ∞±ÊòØÁî±ÂÆÉ‰ª¨ÂÆåÊàêÁöÑÔºåËá≥‰∫éÂú®ÂÆÉ‰ª¨ÂÖ∑‰ΩìÁöÑmacthesÊñπÊ≥ïÊòØÊòØÂ¶Ç‰ΩïÂÆûÁé∞Á≠õÈÄâÁöÑÔºåËøôÈáåÊàë‰πüÊ≤°ÊúâËøõË°åËøáÊ∑±ÂÖ•ÂàÜÊûêÔºåÊÑüÂÖ¥Ë∂£ÁöÑÂèØ‰ª•Âú®ÂÖ∂ÂÆûÁé∞Á±ªAspectJExpressionPointcut.class‰∏≠ÁªßÁª≠Êü•Áúã ÁîüÊàê‰ª£ÁêÜÂØπË±°Âú®‰∏äÊñáÁöÑÂàÜÊûêÁªìÊùüÂêéÔºåÊàë‰ª¨Â∑≤ÁªèÁ≠õÈÄâÂá∫Êù•‰∫ÜÂêàÈÄÇÁöÑ AdvisorÔºåAdvisorÊåÅÊúâAdvice(ÈÄöÁü•)ÔºåÊé•‰∏ãÊù•ÁöÑÊìç‰ΩúÂ∞±ÊòØÊ†πÊçÆÊàë‰ª¨ÈÖçÁΩÆÁöÑAdvice‰∏∫ÁõÆÊ†áÂØπË±°ÂàõÂª∫‰ª£ÁêÜÂØπË±°‰∫Ü 123456789101112131415161718192021222324252627282930313233343536protected Object createProxy( Class&lt;?&gt; beanClass, String beanName, Object[] specificInterceptors, TargetSource targetSource) &#123; if (this.beanFactory instanceof ConfigurableListableBeanFactory) &#123; AutoProxyUtils.exposeTargetClass((ConfigurableListableBeanFactory) this.beanFactory, beanName, beanClass); &#125; // È¶ñÂÖàÂàõÂª∫‰∏Ä‰∏™‰ª£ÁêÜÂàõÂª∫Â∑•ÂéÇÁ±ªÔºå‰πãÂêéÁöÑÊìç‰ΩúÈÉΩÊòØ‰∏∫Ê≠§Â∑•ÂéÇÈÖçÁΩÆÂ±ûÊÄß ProxyFactory proxyFactory = new ProxyFactory(); proxyFactory.copyFrom(this); // Âà§Êñ≠ÈÖçÁΩÆÂ±ûÊÄßproxy-target-class ÊòØÂê¶Á≠â‰∫éFalse if (!proxyFactory.isProxyTargetClass()) &#123; // Âà§Êñ≠ÁõÆÊ†á BeanDefinitionÊòØÂê¶ÈÖçÁΩÆpreserveTargetClass ‰∏∫ tureÔºåÊòØÁöÑËØùÈÖçÁΩÆCGLIBÂä®ÊÄÅ‰ª£ÁêÜ if (shouldProxyTargetClass(beanClass, beanName)) &#123; proxyFactory.setProxyTargetClass(true); &#125; else &#123; // ËÆæÁΩÆÁõÆÊ†áÁ±ªÊé•Âè£Âà∞proxyFactoryÔºåÂ¶ÇÊûúÊ≤°ÊúâÂÆûÁé∞Êé•Âè£Âàô‰ΩøÁî®CGLIB‰ª£ÁêÜ evaluateProxyInterfaces(beanClass, proxyFactory); &#125; &#125; Advisor[] advisors = buildAdvisors(beanName, specificInterceptors); // proxyFactory ËÆæÁΩÆ advisors proxyFactory.addAdvisors(advisors); // ËÆæÁΩÆÁõÆÊ†áÂØπË±°ËµÑÊ∫ê proxyFactory.setTargetSource(targetSource); customizeProxyFactory(proxyFactory); proxyFactory.setFrozen(this.freezeProxy); if (advisorsPreFiltered()) &#123; proxyFactory.setPreFiltered(true); &#125; // ÂàõÂª∫‰ª£ÁêÜ return proxyFactory.getProxy(getProxyClassLoader()); ÂàõÂª∫‰ª£ÁêÜÂØπË±°ÂâçÔºå‰ºöÊñ∞Âª∫‰∏Ä‰∏™‰ª£ÁêÜÂ∑•ÂéÇÂàõÂª∫Á±ªÔºåÂπ∂‰∏∫Ê≠§Â∑•ÂéÇÁ±ªÈÖçÁΩÆÁõ∏ÂÖ≥Â±ûÊÄßÔºå‰æãÂ¶Çproxy-target-classÁöÑÈÖçÁΩÆÔºåËôΩÁÑ∂ÈªòËÆ§ÈÖçÁΩÆÊòØfalse‰ºö‰ΩøÁî®JDKÂä®ÊÄÅ‰ª£ÁêÜÔºå‰ΩÜÂ¶ÇÊûúÊ≤°ÊúâÂÆûÁé∞Êé•Âè£Ôºå‰πü‰ºöËá™Âä®ËÆæÁΩÆproxy-target-class‰∏∫true‰ΩøÁî®CGLIBÂàõÂª∫‰ª£ÁêÜÂØπË±° ÂÆåÊàêProxyFactoryÁöÑÈÖçÁΩÆ‰πãÂêéÔºåÂ∞±ÂèØ‰ª•ÈÄöËøáÂÆÉÂàõÂª∫‰ª£ÁêÜÂØπË±°‰∫Ü123456/** * ÂàõÂª∫‰ª£ÁêÜÂØπË±° */public Object getProxy(ClassLoader classLoader) &#123; return createAopProxy().getProxy(classLoader);&#125; Ë∞ÉÁî®Áà∂Á±ªProxyCreatorSupportÁöÑcreateAopProxyÊñπÊ≥ïÔºåËé∑ÂèñÂà∞‰ª£ÁêÜÂàõÂª∫Â∑•ÂéÇÔºåÂ∑•ÂéÇÁ±ª(DefaultAopProxyFactory)ÊòØÂú®Áà∂Á±ªÁöÑÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÂàõÂª∫ÁöÑ 1234567protected final synchronized AopProxy createAopProxy() &#123; if (!this.active) &#123; activate(); &#125; // Ëé∑Âèñ‰ª£ÁêÜÂàõÂª∫Â∑•ÂéÇÁ±ª ÔºàDefaultAopProxyFactory.classÔºâÂàõÂª∫‰ª£ÁêÜÂØπË±° return getAopProxyFactory().createAopProxy(this);&#125; ÊúÄÁªàÂú®DefaultAopProxyFactoryÂ∑•ÂéÇÁ±ªcreateAopProxy‰∏≠ÂàõÂª∫‰ª£ÁêÜÂØπË±° 12345678910111213141516171819public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException &#123; // ËøôÈáå‰∏ªË¶ÅÊòØÂà§Êñ≠ proxy-target-class Â±ûÊÄßÊòØÂê¶‰∏∫true„ÄÇÈªòËÆ§ÊòØfalse if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) &#123; Class&lt;?&gt; targetClass = config.getTargetClass(); if (targetClass == null) &#123; throw new AopConfigException(&quot;TargetSource cannot determine target class: &quot; + &quot;Either an interface or a target is required for proxy creation.&quot;); &#125; if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) &#123; return new JdkDynamicAopProxy(config); &#125; // ‰ΩøÁî®CGLIBÂä®ÊÄÅ‰ª£ÁêÜ return new ObjenesisCglibAopProxy(config); &#125; else &#123; // ÈªòËÆ§‰ΩøÁî®JDKÂä®ÊÄÅÊâìÁêÜ return new JdkDynamicAopProxy(config); &#125;&#125; ÊúÄÁªàÁöÑ‰ª£ÁêÜÁöÑÂàõÂª∫ÊòØÂú®ObjenesisCglibAopProxyÊàñJdkDynamicAopProxy‰∏≠ÂÆåÊàêÁöÑÔºåËá≥‰∫éÊõ¥ÂÖ∑‰ΩìÁöÑÂàõÂª∫ÈÄªËæëÔºåÂõ†‰∏∫Ëøô‰∏ÄÁ≥ªÂàóÁöÑÊ∫êÁ†ÅÂàÜÊûêÂè™ÊòØ‰∏∫‰∫ÜËÉΩÂ§üÂØπAOPÁöÑÊï¥‰ΩìÈÄªËæëÊúâÊ∏ÖÊô∞ÁöÑËÆ§ËØÜÔºåÊâÄ‰ª•ËøôÈáåÂ∞±‰∏çÂÅöÊõ¥ËØ¶ÁªÜÁöÑÂàÜÊûê‰∫Ü„ÄÇ Â∞æË®ÄÊú¨ÁØáÊñáÁ´†ÂàÜÊûê‰∫ÜAOP‰ª£ÁêÜÂàõÂª∫ÁöÑÊï¥‰∏™ËøáÁ®ãÔºåÁ∫µËßÇÊï¥ÁØáÊñáÁ´†ÔºåÁØáÂπÖÊúâÈôêÔºåÂÖ∂‰∏≠ËøòÊúâÂæàÂ§öÁöÑÁÇπÊ≤°ÊúâËØ¶ÁªÜÂ±ïÂºÄÂàÜÊûêÔºåÂè™ÊòØÁ≤óÁï•ÁöÑÂàÜÊûê‰∫ÜAOP‰ª£ÁêÜÁöÑÂàõÂª∫ËøáÁ®ãÔºåÊÉ≠ÊÑß ‚Ä¶ „ÄÇÂàÜÊûêÊúâËØØÁöÑÂú∞ÊñπÔºåÂ∏åÊúõÂ§ßÂÆ∂ÂèØ‰ª•ÊåáÂá∫„ÄÇ]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring AOP Ê∫êÁ†ÅËß£Êûê‰∫å ÔºàAOPÊ†∏ÂøÉÊ¶ÇÂøµÂèäÊé•Âè£ÂàÜÊûêÔºâ]]></title>
    <url>%2F2018%2F12%2F10%2FSpring-AOP-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%BA%8C-%EF%BC%88AOP%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%8F%8A%E6%8E%A5%E5%8F%A3%E5%88%86%E6%9E%90%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä‰∏äÊúüÂØπSpring AOPÁöÑÈÖçÁΩÆÂÖ•Âè£ÂÅö‰∫Ü‰∏Ä‰∏™ÂæàÁÆÄÂçïÁöÑÊ∫êÁ†ÅËß£ËØªÔºåÁõ∏ÂΩì‰∫é‰∏ÄÈÅìÂºÄËÉÉËèúÔºåÊúâ‰∫õÊ¶ÇÂøµ‰πüÂπ∂Ê≤°ÊúâÁªÜËØ¥„ÄÇËøôÊúüÊàë‰ª¨‰∏ªË¶ÅÊù•ÁêÜ‰∏Ä‰∏ãAOPÁöÑÊï¥‰ΩìÊ¶ÇÂøµÔºå‰ª•ÂèäÁõ∏ÂÖ≥ÁöÑÊé•Âè£ÂàÜÊûê AOPÊ¶ÇÂøµÈù¢ÂêëÂàáÈù¢ÁºñÁ®ãAOPÂÖ∂ÂÆûÊòØÂØπOOPÁºñÁ®ãÊñπÂºèÁöÑ‰∏ÄÁßçË°•ÂÖÖÔºåOOP‰∏≠Ê®°ÂùóÂåñÁöÑÂÖ≥ÈîÆÂçïÂÖÉÊòØÁ±ªÔºåËÄåÂú®AOP‰∏≠ÔºåÊ®°ÂùóÂåñÂçïÂÖÉÂàôÊòØAspectÔºåÊàë‰ª¨ÂèàÊääÂÆÉÂè´ÂÅöÂàáÈù¢„ÄÇÂØπ‰∫éSpring IOCÊù•ËØ¥ÔºåSpring AOPÊòØÂØπIOCÁöÑÂº∫ÊúâÂäõÂ¢ûÂº∫„ÄÇ Êé•‰∏ãÊù•Êàë‰ª¨Â∞ÜÂØπAOPÁöÑÊ†∏ÂøÉÊé•Âè£ÂÅöËØ¶ÁªÜÁöÑÂàÜÊûê AOPÊ†∏ÂøÉÊé•Âè£Pointcut ÂàáÁÇπÂàáÂÖ•ÁÇπÔºåÈ°æÂêçÊÄù‰πâÔºåÂ∞±ÊòØÊàë‰ª¨Ë¶ÅÂàáÂÖ•Êüê‰∏™ÁÇπÁöÑÂÖ∑‰Ωì‰ΩçÁΩÆÔºåÂØπ‰∫éÂàáÂÖ•ÁÇπÁöÑ‰ΩçÁΩÆÈÄâÊã©ÔºåÊàë‰ª¨Â∏∏Áî®aspectË°®ËææÂºèÊù•ËøõË°åÂÆö‰Ωç„ÄÇÊàë‰ª¨ÂÖàÊù•Áúã‰∏Ä‰∏ãPointcutÊé•Âè£ÔºåÁúãÁúãÂÆÉÂÆö‰πâ‰∫ÜÂì™‰∫õ‰∏úË•ø 1234567891011121314151617public interface Pointcut &#123; /** * ËøîÂõû‰∏Ä‰∏™Á±ªÂûãËøáÊª§Âô® * @return the ClassFilter (never &#123;@code null&#125;) */ ClassFilter getClassFilter(); /** * ËøîÂõû‰∏Ä‰∏™ÊñπÊ≥ïÂåπÈÖçÂô® * @return the MethodMatcher (never &#123;@code null&#125;) */ MethodMatcher getMethodMatcher(); Pointcut TRUE = TruePointcut.INSTANCE;&#125; ÂèØ‰ª•ÁúãÂà∞PointcutÊé•Âè£ÂÆö‰πâ‰∫Ü‰∏§‰∏™ÊñπÊ≥ïÔºå‰∏Ä‰∏™Áî®‰∫éËøîÂõû‰∏Ä‰∏™Á±ªÂûãËøáÊª§Âô®Ôºå‰∏Ä‰∏™ËøîÂõû‰∫Ü‰∏Ä‰∏™ÊñπÊ≥ïÈÄâÊã©Âô®ÔºåÊàë‰ª¨ÂèØ‰ª•ÂÜçÂÖ∑‰ΩìÁöÑÁúã‰∏Ä‰∏ãËøô‰∏§‰∏™Êé•Âè£ÁöÑÂÜÖÂÆπ 12345678910111213141516171819202122232425262728293031public interface ClassFilter &#123; /** * Âà§Êñ≠ÂàáÂÖ•ÁÇπ‰∫éÁªôÂÆöÁöÑÊé•Âè£ÊàñÁõÆÊ†áÁ±ªÊòØÂê¶Á±ªÂûãÂåπÈÖç */ boolean matches(Class&lt;?&gt; clazz); ClassFilter TRUE = TrueClassFilter.INSTANCE;&#125;public interface MethodMatcher &#123; /** * Ê£ÄÊü•ÊòØÂê¶ÊúâÊ≠§ÊñπÊ≥ïÁöÑÈùôÊÄÅÂåπÈÖç */ boolean matches(Method method, Class&lt;?&gt; targetClass); /** * ÊòØÂê¶ËøêË°åÊó∂ */ boolean isRuntime(); /** * Ê£ÄÊü•ÊòØÂê¶ÊúâÊ≠§ÊñπÊ≥ïÁöÑËøêË°åÊó∂(Âä®ÊÄÅ)ÂåπÈÖç */ boolean matches(Method method, Class&lt;?&gt; targetClass, Object... args); MethodMatcher TRUE = TrueMethodMatcher.INSTANCE;&#125; ÂèØ‰ª•ÁúãÂà∞Ôºå‰∏äÈù¢‰∏§‰∏™Êé•Âè£ÁöÑÊ†∏ÂøÉÈÉΩÊòØmatchesÊñπÊ≥ïÔºåÈÉΩÊòØÁî®‰∫éÂà§Êñ≠ÁõÆÊ†áÁ±ªÂûãÊàñÁõÆÊ†áÊñπÊ≥ï‰∏éÊ≠§ÂàáÂÖ•ÁÇπÊòØÂê¶ÂåπÈÖç„ÄÇÂú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠Êàë‰ª¨ÊúâÊèêÂà∞‰∏Ä‰∏™PointcutÊé•Âè£ÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÔºåÔºàAspectJExpressionPointcut.classÔºâÔºåËøô‰∏™ÊòØÊàë‰ª¨ÊúÄÂ∏∏Áî®ÁöÑPointcutÊé•Âè£ÂÆûÁé∞ÔºåÈáåÈù¢Â∞ÅË£Ö‰∫ÜÂØπaspectË°®ËææÂºèÁî®‰∫éÂåπÈÖçÂàáÂÖ•ÁÇπÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞ Advice ÈÄöÁü•Advice ÈÄöÁü•ÔºåÁøªËØëÊàê‰∏≠ÊñáÊòØÂª∫ËÆÆÁöÑÊÑèÊÄùÔºåÂú®‰∏äÈù¢Êàë‰ª¨Áü•ÈÅì‰∫ÜpointcutÊòØÁî®Êù•ÈÄâÊã©ÂàáÂÖ•ÁÇπÁöÑÔºåÈÇ£ÈÄâÂÆö‰∫ÜÂàáÂÖ•ÁÇπ‰πãÂêéËá™ÁÑ∂Â∞±ÊòØË¶ÅÊâßË°åÂÖ∑‰ΩìÁªáÂÖ•ÁöÑAOPÈÄªËæëÔºåÂπ∂‰∏îËøòË¶ÅÂú®‰∏Ä‰∏™ÂêàÈÄÇÁöÑ‰ΩçÁΩÆÂéªÊâßË°åÔºåËÄåËøô‰∏™ÂêàÈÄÇÁöÑ‰ΩçÁΩÆÂ∞±ÊòØÊàë‰ª¨Â∏∏ËØ¥ÁöÑÂú®ÁõÆÊ†áÊñπÊ≥ïÂâç ÁõÆÊ†áÊñπÊ≥ïÂêéÊàñÂàôÁéØÁªïÈÄöÁü•ÊâßË°åÔºåÂ•Ω‰∫ÜÔºåËøòÊòØËÆ©Êàë‰ª¨Áúã‰∏Ä‰∏ãAdviceÊé•Âè£ÔºåÁúãÁúãSpring‰∏∫Êàë‰ª¨ÂÆö‰πâ‰∫ÜÂì™Âá†ÁßçÈÄöÁü•Á±ªÂûã Advice ÊòØ‰∏Ä‰∏™Á©∫Êé•Âè£ÔºåÂÖ∑‰ΩìÁöÑÁ±ªÂûãÂú®ÂÆûÁé∞‰∏≠123public interface Advice &#123;&#125; ‰∏äÁØáÊñáÁ´†ÊúâÊèêÂà∞AdviceÁöÑÂÖ∑‰ΩìÂÆûÁé∞Á±ªÂûãÔºåËøôÈáåÊàëÂ∞±Áõ¥Êé•ÊääÊØèÁßçÁ±ªÂûãÈÄöÁü•ÂØπÂ∫îÁöÑÂÆûÁé∞Á±ªÂàóÂá∫Êù•‰∫Ü ÂâçÁΩÆÈÄöÁü• AspectJMethodBeforeAdvice.class Âú®ÁõÆÊ†áÊñπÊ≥ïÊâßË°åÂâçÊâßË°å ÂêéÁΩÆÈÄöÁü• AspectJAfterAdvice.class Âú®ÁõÆÊ†áÊñπÊ≥ïÊâßË°åÂêéÊâßË°åÔºàÊó†ËÆ∫ÊòØÂê¶ÊäõÂºÇÂ∏∏ÈÉΩ‰ºöÊâßË°åÔºâ ÁéØÁªïÈÄöÁü• AspectJAroundAdvice.class Âú®ÁõÆÊ†áÊñπÊ≥ïÊâßË°åÂâçÂêéÊâßË°å ÂºÇÂ∏∏ÈÄöÁü• AspectJAfterThrowingAdvice.class ÁõÆÊ†áÊñπÊ≥ïÊâßË°åÂºÇÂ∏∏Êó∂ÊâßË°å ÂêéÁΩÆÊ≠£Â∏∏ËøîÂõûÈÄöÁü• AspectJAfterReturningAdvice.class ÁõÆÊ†áÊñπÊ≥ïÊ≠£Â∏∏ËøîÂõûÁªìÊûúÂêéÊâßË°å Aspect ÂàáÈù¢AspectÂàáÈù¢Ôºå‰ΩÜÁúãËøô‰∏™ÂçïËØçÂÖ∂ÂÆû‰∏çÂ•ΩÁêÜËß£Ôºå‰ΩÜÊòØÂΩìÊàë‰ª¨Áü•ÈÅì‰∫ÜPointcutÂíåAdviceÁöÑ‰ΩúÁî®‰πãÂêéÔºåÁêÜËß£ÂàáÈù¢Â∞±‰ºöÊ∏ÖÊô∞ÂæàÂ§ö„ÄÇÁÆÄÂçïÁöÑÁêÜËß£ÂàáÈù¢Â∞±ÊòØPointcutÂíåAdvice‰∏§ËÄÖÁöÑÁªìÂêàÔºåÊääÂàáÂÖ•ÁÇπÂíåÈÄöÁü•ËøûÊé•Ëµ∑Êù•Â∞±ÁªÑÊàê‰∫Ü‰∏Ä‰∏™ÂàáÈù¢„ÄÇËÄåÂú®Spring‰ª£Á†Å‰∏≠ÁöÑ‰ΩìÁé∞ÔºåÂàáÈù¢ÊåáÁöÑÂ∞±ÊòØAdvisorÊé•Âè£ÂèäÂÖ∂ÂÆûÁé∞ÔºåÊù•Áúã‰∏Ä‰∏ãAdvisorÊé•Âè£ÁöÑÂÜÖÂÆπ 12345public interface Advisor &#123; Advice getAdvice(); boolean isPerInstance();&#125; AdvisorÊé•Âè£getAdvice()ÊñπÊ≥ïËøîÂõû‰∫ÜËØ•ÂàáÈù¢ÂØπÂ∫îÁöÑÈÄöÁü• 12345678public interface PointcutAdvisor extends Advisor &#123; /** * Get the Pointcut that drives this advisor. */ Pointcut getPointcut();&#125; PointcutAdvisorÊé•Âè£ÁªßÊâø‰∫ÜAdvisorÊé•Âè£ÔºåÂπ∂‰∏îÊñ∞Â¢û‰∫ÜgetPointcut()`ÊñπÊ≥ïÔºåÈÄöËøáËøô‰∏™Êé•Âè£ÔºåÂ∞±ÊääÂàáÂÖ•ÁÇπÂíåÈÄöÁü•‰∏§ËÄÖËøûÊé•‰∫ÜËµ∑Êù•ÔºåÂÆåÊàê‰∫ÜÂàáÈù¢ÁöÑÈÖçÁΩÆ Weaving ÁªáÂÖ•ÂΩìÂÆåÊàê‰∫Ü‰ª•‰∏äÂ∑•‰Ωú‰πãÂêéÔºåÊàë‰ª¨ÂèØ‰ª•ËØ¥ÊòØ‰∏á‰∫ã‰ø±Â§áÔºåÂè™Ê¨†‰∏úÈ£éÔºåÂâ©‰∏ãÁöÑ‰∫ãÊÉÖÔºåÂ∞±ÊòØÊääÂÖ∑‰ΩìÁöÑÂàáÈù¢ÈÄªËæëÁªáÂÖ•Âà∞Êàë‰ª¨ÁöÑÂàáÂÖ•ÁÇπ‰∏≠ÂéªÔºåÈÇ£‰πàSpringÂØπ‰∫éAOP‰ª£ÁêÜÈÄªËæëÁªáÂÖ•ÊòØÊÄé‰πàÂÅöÁöÑÔºåÂèàÊòØÂú®‰ΩïÊó∂ÂÅöÁöÑÂë¢Ôºü ËøôÊó∂ÂÄôÂ∞±ÊòØSpring IOC ÂÆπÂô®Â§ßÂ±ïË∫´ÊâãÁöÑÊó∂ÂÄôÔºåÊàë‰ª¨Âú®‰πãÂâçÂàÜÊûêSpring IOCÂÆπÂô®ÁöÑÊó∂ÂÄôÊúâÊèêÂà∞ËøáÊâ©Â±ïÁÇπBeanPostProcessorÊé•Âè£Ôºå‰∏äÁØáÊñáÁ´†Êàë‰ª¨‰πüÊúâÊèêÂà∞‰∏Ä‰∏™‰ª£ÁêÜÂàõÂª∫ÁöÑÊ†∏ÂøÉÁ±ªAspectJAwareAdvisorAutoProxyCreatorÔºåÊàë‰ª¨Êù•Áúã‰∏Ä‰∏ãËøô‰∏™Á±ªÁöÑÁªìÊûÑ ÈÄöËøáÊü•ÁúãËØ•Á±ªÁöÑÊé•Âè£ÔºåÂèØ‰ª•Áü•ÈÅìAspectJAwareAdvisorAutoProxyCreatorÊòØBeanPostProcessorÊé•Âè£ÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÔºåÊâÄ‰ª•Êàë‰ª¨Áü•ÈÅì‰ª£ÁêÜÁ±ªÂàõÂª∫ÂøÖÂÆöÊòØÂú®BeanÂàõÂª∫ÂâçÂêéË¢´ÂàõÂª∫ÁöÑ„ÄÇÂÖ∑‰ΩìÁöÑÂàõÂª∫ÈÄªËæëÊòØÂú®BeanÂÆåÊàêÂàùÂßãÂåñÔºåÊâßË°åBeanPostProcessorÊé•Âè£ÁöÑpostProcessAfterInitializationÊñπÊ≥ïÊó∂ÊâßË°å ÊÄªÁªìÊú¨ÁØáÊñáÁ´†Êàë‰ª¨‰∏ªË¶Å‰ªéÊé•Âè£Â±ÇÈù¢ÂàÜÊûê‰∫ÜAOPÁöÑÂÆûÁé∞ÔºåÂπ∂Ê≤°ÊúâÊ∂âÂèäÂà∞ÂæàÂ§öÁöÑAOPÊ∫êÁ†ÅÔºå‰ΩÜÊòØËøô‰∫õÂü∫Êú¨ÁöÑÊé•Âè£ÊòØAOPÂÆûÁé∞ÁöÑÊ†∏ÂøÉÔºåÁêÜËß£Ëøô‰∫õÂØπ‰∫éAOPÊ∫êÁ†ÅÂàÜÊûêÊúâÂæàÂ§ßÁöÑÂ∏ÆÂä©„ÄÇ‰∏ãÁØáÊñáÁ´†ÊàëÂ∞Ü‰ºöÂØπ‰ª£ÁêÜÁöÑÂàõÂª∫(AspectJAwareAdvisorAutoProxyCreator.class)ÂÅöÂàÜÊûê]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring AOP Ê∫êÁ†ÅËß£Êûê‰∏Ä ÔºàAOPÂÖ•Âè£ÊµÖË∞àÔºâ]]></title>
    <url>%2F2018%2F11%2F30%2FSpring-AOP-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%80-%EF%BC%88AOP%E5%85%A5%E5%8F%A3%E6%B5%85%E8%B0%88%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®ËøõË°åaopÁöÑÊ∫êÁ†ÅËß£Êûê‰πãÂâçÔºåÊàë‰ª¨È¶ñÂÖàË¶ÅÁü•ÈÅìSpring AOPÊòØÊÄé‰πàÁî®ÁöÑÔºåÂè™ÊúâÁü•ÈÅìÊÄé‰πàÁî®ÁöÑÔºåÊàë‰ª¨ÊâçËÉΩÊõ¥Â•ΩÁöÑÁêÜËß£aopÔºåÊâçËÉΩËøõË°å‰∏ã‰∏ÄÊ≠•Ëß£Êûê ‰ΩøÁî®AOPÂ•Ω‰∫ÜÔºåÂ∫üËØù‰∏çÂ§öËØ¥ÔºåÊàë‰ª¨Áõ¥Êé•Âä®ÊâãÊù•Áî®‰∏Ä‰∏ãspringÁöÑAOPÂÆûÁé∞ È¶ñÂÖàÊñ∞Âª∫‰∏Ä‰∏™MyPointCutÊé•Âè£ÔºåÂπ∂‰∏îÂÆûÁé∞ÂÆÉ 12345678910/** * MyPointCut * * @author wangjn * @date 2018/12/7 */public interface MyPointCut &#123; void sayHello();&#125; 12345678910111213/** * MyPointCutImpl * * @author wangjn * @date 2018/12/10 */public class MyPointCutImpl implements MyPointCut &#123; @Override public void sayHello() &#123; System.out.println("hello world"); &#125;&#125; Êñ∞Âª∫‰∏Ä‰∏™MyAspectÊé•Âè£ÔºåÊé•Âè£ÈáåÁöÑÊñπÊ≥ïÊòØÊàë‰ª¨‰πãÂêéË¶ÅÂàáÂÖ•ÁöÑaopÈÄªËæëÊñπÊ≥ï 12345678/** * MyAspect */public interface MyAspect &#123; void logBefore(); void logAfter();&#125; 123456789101112131415/** * MyAspectImpl */public class MyAspectImpl implements MyAspect &#123; @Override public void logBefore() &#123; System.out.println(&quot;log before&quot;); &#125; @Override public void logAfter() &#123; System.out.println(&quot;log after&quot;); &#125;&#125; spring xml ÈÖçÁΩÆ 12345678910111213141516&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt; &lt;bean id=&quot;myPointCut&quot; class=&quot;com.wangjn.demo.impl.MyPointCutImpl&quot;&gt;&lt;/bean&gt; &lt;bean id=&quot;aspectTest&quot; class=&quot;com.wangjn.demo.MyAspectImpl&quot;/&gt; &lt;aop:config&gt; &lt;aop:aspect id=&quot;log&quot; ref=&quot;aspectTest&quot;&gt; &lt;aop:pointcut id=&quot;addAllMethod&quot; expression=&quot;execution(* com.wangjn.demo.MyPointCut.*(..))&quot; /&gt; &lt;aop:before method=&quot;logBefore&quot; pointcut-ref=&quot;addAllMethod&quot; /&gt; &lt;aop:after method=&quot;logAfter&quot; pointcut-ref=&quot;addAllMethod&quot; /&gt; &lt;/aop:aspect&gt; &lt;/aop:config&gt;&lt;/beans&gt; ÂÜô‰∏™mainÊñπÊ≥ï 12345678910111213/** * Start */public class Start &#123; public static void main(String[] args) throws IOException &#123; ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;&quot;spring.xml&quot;&#125;); context.start(); // ÂèñÂæóbean myPointCut MyPointCut myPointCut = (MyPointCut)context.getBean(&quot;myPointCut&quot;); myPointCut.sayHello(); &#125;&#125; ÊâßË°åÁªìÊûúËæìÂá∫ÔºåÂèØÁü•myPointCutÁöÑÊñπÊ°àÂâçÂêéÈÉΩÈ¢ùÂ§ñÊâßË°å‰∫ÜaopË¶ÅÁªáÂÖ•ÁöÑÈÄªËæëÔºåËøôÂ∞±ÊòØaopÁöÑÁ•ûÂ•á‰πãÂ§ÑÔºåÂèØ‰ª•Âú®Âéü‰ª£Á†ÅÊØ´Êó†ÊÑüÁü•ÁöÑÊÉÖÂÜµ‰∏ãÊâßË°åÈ¢ùÂ§ñÈÄªËæë 123log beforehello worldlog after ÈÄöËøá‰∏äÈù¢‰ª£Á†ÅÁÆÄÂçïÁöÑÊºîÁ§∫ÔºåÊàë‰ª¨Â§ßËá¥Áü•ÈÅì‰∫ÜaopÊòØÊÄé‰πà‰ΩøÁî®ÁöÑÔºå‰∏çËøáÊòæÁÑ∂Áü•ÈÅìÊÄé‰πàÁî®Âπ∂‰∏çÊòØÊàë‰ª¨ÊâÄË¶ÅËøΩÊ±ÇÁöÑÔºåÊé•‰∏ãÊù•Â∞±Êàë‰ª¨‰ªéaopÁöÑÊ∫êÁ†ÅÂÖ•Âè£‰∏ÄÊ≠•‰∏ÄÊ≠•ÁöÑËß£ÊûêÂÆÉÁöÑÂÆûÁé∞ÂéüÁêÜ AOPÊ∫êÁ†ÅÂÖ•Âè£Ë¶ÅÊÉ≥Áü•ÈÅìaopÁöÑÂÆûÁé∞ÂéüÁêÜÔºåÊàë‰ª¨È¶ñÂÖàË¶Å‰∫ÜËß£ÁöÑÂ∞±ÊòØspinng iocÂÆπÂô®ÊòØÊÄé‰πàËß£ÊûêÊàë‰ª¨ÁöÑaopÈÖçÁΩÆÁöÑÔºåËøôÈáåÊàë‰ª¨ÊöÇ‰∏îÂè™ÁúãxmlÂΩ¢ÂºèÁöÑÈÖçÁΩÆËß£Êûê Â•Ω‰∫ÜÔºåÂõûÂà∞‰∏äÈù¢ÁöÑspringÈÖçÁΩÆÊñá‰ª∂1234567&lt;aop:config&gt; &lt;aop:aspect id=&quot;log&quot; ref=&quot;aspectTest&quot;&gt; &lt;aop:pointcut id=&quot;addAllMethod&quot; expression=&quot;execution(* com.wangjn.demo.MyPointCut.*(..))&quot; /&gt; &lt;aop:before method=&quot;logBefore&quot; pointcut-ref=&quot;addAllMethod&quot; /&gt; &lt;aop:after method=&quot;logAfter&quot; pointcut-ref=&quot;addAllMethod&quot; /&gt; &lt;/aop:aspect&gt; &lt;/aop:config&gt; ÂèØ‰ª•ÁúãÂà∞ÈÉΩÊòØspring aopÁöÑËá™ÂÆö‰πâÊ†áÁ≠æÔºåÂú®‰πãÂâçËß£Êûêspring iocÊ∫êÁ†ÅÁöÑÊó∂ÂÄôÊàë‰ª¨Â∑≤ÁªèÁü•ÈÅìÔºåspringÊòØÊîØÊåÅËá™ÂÆö‰πâÁöÑÊ†áÁ≠æËß£ÊûêÁöÑÔºåËá™ÂÆö‰πâÊ†áÁ≠æÁöÑÂÖ•Âè£Êñá‰ª∂Âú®META-INF/spring.handlers‰∏≠ÔºåÊàë‰ª¨ÊâæÂà∞spring aopjarÂåÖ‰∏ãÁöÑËøô‰∏™ÁõÆÂΩïÔºåÊâìÂºÄËøô‰∏™Êñá‰ª∂ 1http\://www.springframework.org/schema/aop=org.springframework.aop.config.AopNamespaceHandler ÂèØ‰ª•ÁúãÂà∞ËøôÈáåÈÖçÁΩÆ‰∫Ü‰∏Ä‰∏™aopÂëΩÂêçÁ©∫Èó¥ÁöÑËß£ÊûêÂô® org.springframework.aop.config.AopNamespaceHandlerÔºåÁé∞Âú®Êàë‰ª¨Â∞±‰ªéËøô‰∏™ÂÖ•Âè£Êñá‰ª∂Êù•ËøõË°åÊ∫êÁ†ÅÂàÜÊûê AopNamespaceHandler1234567891011121314151617181920public class AopNamespaceHandler extends NamespaceHandlerSupport &#123; /** * Register the &#123;@link BeanDefinitionParser BeanDefinitionParsers&#125; for the * &apos;&#123;@code config&#125;&apos;, &apos;&#123;@code spring-configured&#125;&apos;, &apos;&#123;@code aspectj-autoproxy&#125;&apos; * and &apos;&#123;@code scoped-proxy&#125;&apos; tags. */ @Override public void init() &#123; // In 2.0 XSD as well as in 2.1 XSD. registerBeanDefinitionParser(&quot;config&quot;, new ConfigBeanDefinitionParser()); // ÊîØÊåÅ @AspectJ Â£∞ÊòéÂºèÈÖçÁΩÆ registerBeanDefinitionParser(&quot;aspectj-autoproxy&quot;, new AspectJAutoProxyBeanDefinitionParser()); registerBeanDefinitionDecorator(&quot;scoped-proxy&quot;, new ScopedProxyBeanDefinitionDecorator()); // Only in 2.0 XSD: moved to context namespace as of 2.1 registerBeanDefinitionParser(&quot;spring-configured&quot;, new SpringConfiguredBeanDefinitionParser()); &#125;&#125; ËøôÈáåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÂØπconfigÂ±ûÊÄßÁöÑËß£ÊûêÊòØÁî±ConfigBeanDefinitionParserÂÆåÊàêÁöÑ„ÄÇConfigBeanDefinitionParserÊòØBeanDefinitionParserÊé•Âè£ÁöÑÂÆûÁé∞ÔºåÂÖ∂‰∏≠ÁöÑparseÊñπÊ≥ïÂ∞ÅË£Ö‰∫ÜÂØπ&lt;aop:config&gt;Â±ûÊÄßÊ†áÁ≠æÁöÑËß£ÊûêÈÄªËæë ConfigBeanDefinitionParserÁöÑparseÊñπÊ≥ï123456789101112131415161718192021222324252627public BeanDefinition parse(Element element, ParserContext parserContext) &#123; CompositeComponentDefinition compositeDef = new CompositeComponentDefinition(element.getTagName(), parserContext.extractSource(element)); parserContext.pushContainingComponent(compositeDef); configureAutoProxyCreator(parserContext, element); List&lt;Element&gt; childElts = DomUtils.getChildElements(element); for (Element elt: childElts) &#123; String localName = parserContext.getDelegate().getLocalName(elt); // pointCutÊ†áÁ≠æ if (POINTCUT.equals(localName)) &#123; parsePointcut(elt, parserContext); &#125; // advisorÊ†áÁ≠æ else if (ADVISOR.equals(localName)) &#123; parseAdvisor(elt, parserContext); &#125; // aspectÊ†áÁ≠æ else if (ASPECT.equals(localName)) &#123; parseAspect(elt, parserContext); &#125; &#125; parserContext.popAndRegisterContainingComponent(); return null;&#125; ÂèØ‰ª•Ê∏ÖÊô∞ÁöÑÁúãÂà∞ÔºåËøôÈáåÂàÜÂà´ÂØπpointcut,advisor,aspect‰∏âÁßçÊ†áÁ≠æËøõË°åËß£Êûê configureAutoProxyCreator(parserContext, element)ËøôÈáåÈÖçÁΩÆ‰∫Ü‰ª£ÁêÜÂàõÂª∫Á±ªÔºåË∞ÉÁî®‰∫ÜAopNamespaceUtils.registerAspectJAutoProxyCreatorIfNecessaryÊñπÊ≥ïÂÆåÊàêÈÖçÁΩÆ 123private void configureAutoProxyCreator(ParserContext parserContext, Element element) &#123; AopNamespaceUtils.registerAspectJAutoProxyCreatorIfNecessary(parserContext, element);&#125; Êàë‰ª¨Êù•Áúã‰∏ã AopNamespaceUtils.registerAspectJAutoProxyCreatorIfNecessaryÁöÑÂÆûÁé∞ 1234567891011public static void registerAspectJAutoProxyCreatorIfNecessary( ParserContext parserContext, Element sourceElement) &#123; // Ëé∑Âèñ‰ª£ÁêÜÂàõÂª∫Á±ª AspectJAwareAdvisorAutoProxyCreatorÂπ∂ÂëΩÂêç‰∏∫org.springframework.aop.config.internalAutoProxyCreator BeanDefinition beanDefinition = AopConfigUtils.registerAspectJAutoProxyCreatorIfNecessary( parserContext.getRegistry(), parserContext.extractSource(sourceElement)); // Âà§Êñ≠ÊòØÂê¶‰ΩøÁî® CGLIB ÂàõÂª∫‰ª£ÁêÜÔºåÊåáÂÆöproxy-target-class=trueÂàô‰ΩøÁî®CGLIBÔºåÂê¶Âàô‰ΩøÁî®JDKÂä®ÊÄÅ‰ª£ÁêÜ useClassProxyingIfNecessary(parserContext.getRegistry(), sourceElement); // ÂæÄ spring ioc ÂÆπÂô®Ê≥®ÂÜåAspectJAwareAdvisorAutoProxyCreator‰ª£ÁêÜÂàõÂª∫Âô® registerComponentIfNecessary(beanDefinition, parserContext);&#125; ÂèØ‰ª•ÁúãÂà∞ËøôÊÆµ‰ª£Á†Å‰∏ªË¶ÅÂÅö‰∫Ü‰∏§‰ª∂‰∫ãÊÉÖ Ê≥®ÂÜå‰ª£ÁêÜÂàõÂª∫Âô® AspectJAwareAdvisorAutoProxyCreatorÔºåËøô‰∏™Á±ªÂæàÈáçË¶ÅÔºåÊòØ aopÁöÑÊ†∏ÂøÉÂÆûÁé∞Á±ª ÊåáÂÆöÂàõÂª∫‰ª£ÁêÜÁöÑÊñπÂºèÔºåÂÖ∂‰∏≠Â¶ÇÊûú&lt;aop:config&gt;ËäÇÁÇπÈÖçÁΩÆ‰∫Üproxy-target-class=trueÔºåÂàô‰ΩøÁî®CGLIBÂàõÂª∫‰ª£ÁêÜÔºåÂê¶ÂàôÈªòËÆ§‰ΩøÁî®JDK Âä®ÊÄÅ‰ª£ÁêÜ parsePointcutËß£ÊûêaopÁöÑÂàáÂÖ•ÁÇπÈÖçÁΩÆÔºåÂØπÂ∫î &lt;aop:pointcut&gt;Ê†áÁ≠æ12345678910111213141516171819202122232425262728293031323334private AbstractBeanDefinition parsePointcut(Element pointcutElement, ParserContext parserContext) &#123; // Ëé∑ÂèñÊàë‰ª¨ÈÖçÁΩÆÁöÑ pointCut ÂàáÂÖ•ÁÇπ id String id = pointcutElement.getAttribute(ID); // Ëé∑ÂèñË¶ÅÂàáÂÖ•ÁöÑ expression Ë°®ËææÂºè String expression = pointcutElement.getAttribute(EXPRESSION); AbstractBeanDefinition pointcutDefinition = null; try &#123; // ËÆ∞ÂΩïÂΩìÂâçÂ§ÑÁêÜËäÇÁÇπ this.parseState.push(new PointcutEntry(id)); // ÂàõÂª∫ AspectJExpressionPointcut Á±ªÂûãÁöÑ beanDefinitionÔºåÂπ∂‰∏îÊääexpressionÂ±ûÊÄßËµãÁªôÊ≠§bean pointcutDefinition = createPointcutDefinition(expression);// ËÆæÁΩÆÊ∫êÊï∞ÊçÆ pointcutDefinition.setSource(parserContext.extractSource(pointcutElement)); // ËÆæÁΩÆ beanÁöÑidÂêçÁß∞ String pointcutBeanName = id; if (StringUtils.hasText(pointcutBeanName)) &#123; // Ê≥®ÂÜåbeanDefinution Ëá≥springÂÆπÂô® parserContext.getRegistry().registerBeanDefinition(pointcutBeanName, pointcutDefinition); &#125; else &#123; pointcutBeanName = parserContext.getReaderContext().registerWithGeneratedName(pointcutDefinition); &#125; parserContext.registerComponent( new PointcutComponentDefinition(pointcutBeanName, pointcutDefinition, expression)); &#125; finally &#123; this.parseState.pop(); &#125; return pointcutDefinition;&#125; ËøôÈáå‰∏ªË¶ÅÊòØÈÖçÁΩÆ‰∫ÜaopÂàáÂÖ•ÁÇπÁöÑbean AspectJExpressionPointcut parseAspect1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859private void parseAspect(Element aspectElement, ParserContext parserContext) &#123; // Ëé∑ÂèñÂàáÈù¢id String aspectId = aspectElement.getAttribute(ID); // Ëé∑ÂèñÂàáÈù¢Ë¶ÅÊâßË°åÁöÑÂÖ∑‰ΩìÈÄªËæëÁ±ª Ëøô‰∏™ÊòØÂøÖÈ°ªËÆæÁΩÆÁöÑÂ±ûÊÄß String aspectName = aspectElement.getAttribute(REF); try &#123; this.parseState.push(new AspectEntry(aspectId, aspectName)); List&lt;BeanDefinition&gt; beanDefinitions = new ArrayList&lt;BeanDefinition&gt;(); List&lt;BeanReference&gt; beanReferences = new ArrayList&lt;BeanReference&gt;(); List&lt;Element&gt; declareParents = DomUtils.getChildElementsByTagName(aspectElement, DECLARE_PARENTS); for (int i = METHOD_INDEX; i &lt; declareParents.size(); i++) &#123; Element declareParentsElement = declareParents.get(i); beanDefinitions.add(parseDeclareParents(declareParentsElement, parserContext)); &#125; // We have to parse &quot;advice&quot; and all the advice kinds in one loop, to get the // ordering semantics right. // Ëß£ÊûêadviceÊ†áÁ≠æ NodeList nodeList = aspectElement.getChildNodes(); boolean adviceFoundAlready = false; for (int i = 0; i &lt; nodeList.getLength(); i++) &#123; Node node = nodeList.item(i); // Âà§Êñ≠ advice ÁöÑÁ±ªÂûãÊòØÂê¶ÊòØÈôêÂÆöÁöÑÂá†ÁßçÔºàafter before aroundÔºâ if (isAdviceNode(node, parserContext)) &#123; if (!adviceFoundAlready) &#123; adviceFoundAlready = true; // Â¶ÇÊûúÊ≤°ÊúâÈÖçÁΩÆ ref Â±ûÊÄßÔºåÊäõÂá∫ÂºÇÂ∏∏ if (!StringUtils.hasText(aspectName)) &#123; parserContext.getReaderContext().error( &quot;&lt;aspect&gt; tag needs aspect bean reference via &apos;ref&apos; attribute when declaring advices.&quot;, aspectElement, this.parseState.snapshot()); return; &#125; beanReferences.add(new RuntimeBeanReference(aspectName)); &#125; // ÂºÄÂßãËß£ÊûêadviceËäÇÁÇπ AbstractBeanDefinition advisorDefinition = parseAdvice( aspectName, i, aspectElement, (Element) node, parserContext, beanDefinitions, beanReferences); beanDefinitions.add(advisorDefinition); &#125; &#125; AspectComponentDefinition aspectComponentDefinition = createAspectComponentDefinition( aspectElement, aspectId, beanDefinitions, beanReferences, parserContext); parserContext.pushContainingComponent(aspectComponentDefinition); // Ëß£Êûê aspect Ê†áÁ≠æ‰∏≠ÁöÑ pointcut List&lt;Element&gt; pointcuts = DomUtils.getChildElementsByTagName(aspectElement, POINTCUT); for (Element pointcutElement : pointcuts) &#123; parsePointcut(pointcutElement, parserContext); &#125; parserContext.popAndRegisterContainingComponent(); &#125; finally &#123; this.parseState.pop(); &#125;&#125; parseAdviceparseAdviceËøôÊÆµ‰ª£Á†ÅÁöÑ‰∏ªË¶ÅÈÄªËæëÂÖ∂ÂÆûÂ∞±ÊòØËß£Êûê adviceÊ†áÁ≠æÔºåÂπ∂ÊúÄÁªàÂåÖË£ÖÊàêadvisor„ÄÇadvisorÂÖ∂ÂÆûÁõ∏ÂΩì‰∫éÊï¥Âêà‰∫Üadvice ÈÄöÁü•Âíåpointcut ÂàáÁÇπÔºåÁõ∏ÂΩì‰∫éÈÄöËøá advisorÊääÂàáÁÇπÂíåË¶ÅÊâßË°åÁöÑÂàáÈù¢ÈÄªËæëËøûÊé•‰∫ÜËµ∑Êù• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546private AbstractBeanDefinition parseAdvice( String aspectName, int order, Element aspectElement, Element adviceElement, ParserContext parserContext, List&lt;BeanDefinition&gt; beanDefinitions, List&lt;BeanReference&gt; beanReferences) &#123; try &#123; this.parseState.push(new AdviceEntry(parserContext.getDelegate().getLocalName(adviceElement))); // create the method factory bean // ÂàõÂª∫ÂàáÈù¢Â¢ûÂº∫ÊñπÊ≥ïÂØπÂ∫îÁöÑ methodDefinitionÔºåÂπ∂ËÆæÁΩÆ methodName targetBeanNameÂ±ûÊÄß RootBeanDefinition methodDefinition = new RootBeanDefinition(MethodLocatingFactoryBean.class); methodDefinition.getPropertyValues().add(&quot;targetBeanName&quot;, aspectName); methodDefinition.getPropertyValues().add(&quot;methodName&quot;, adviceElement.getAttribute(&quot;method&quot;)); methodDefinition.setSynthetic(true); // create instance factory definition // ÂàõÂª∫ÂàáÈù¢Á±ª FactoryBean RootBeanDefinition aspectFactoryDef = new RootBeanDefinition(SimpleBeanFactoryAwareAspectInstanceFactory.class); aspectFactoryDef.getPropertyValues().add(&quot;aspectBeanName&quot;, aspectName); aspectFactoryDef.setSynthetic(true); // register the pointcut // ÈÄâÊã©ÂêàÈÄÇÁöÑ advice Âπ∂Ê≥®ÂÜå pointcut AbstractBeanDefinition adviceDef = createAdviceDefinition( adviceElement, parserContext, aspectName, order, methodDefinition, aspectFactoryDef, beanDefinitions, beanReferences); // configure the advisor // ÈÖçÁΩÆ advisorÔºåÂØπÂ∫îÁöÑÁ±ªÂûãÊòØ AspectJPointcutAdvisor.class RootBeanDefinition advisorDefinition = new RootBeanDefinition(AspectJPointcutAdvisor.class); advisorDefinition.setSource(parserContext.extractSource(adviceElement)); advisorDefinition.getConstructorArgumentValues().addGenericArgumentValue(adviceDef); if (aspectElement.hasAttribute(ORDER_PROPERTY)) &#123; advisorDefinition.getPropertyValues().add( ORDER_PROPERTY, aspectElement.getAttribute(ORDER_PROPERTY)); &#125; // register the final advisor parserContext.getReaderContext().registerWithGeneratedName(advisorDefinition); return advisorDefinition; &#125; finally &#123; this.parseState.pop(); &#125;&#125; ËøôÈáåÂàí‰∏Ä‰∏ã‰∏äÈù¢‰ª£Á†ÅÊèêÂà∞ÁöÑÂá†‰∏™ÈáçË¶ÅÁöÑÁ±ª: Pointcut ÂØπÂ∫î AspectJExpressionPointcut.class Advice ÂØπÂ∫î AspectJMethodBeforeAdvice,AspectJAfterAdviceÔºå AspectJAfterReturningAdvice, AspectJAfterThrowingAdvice,AspectJAroundAdvice, ‰∫îÁßçÈÄöÁü•Á±ªÂûã Advisor ÂØπÂ∫î AspectJPointcutAdvisor.class ÊÄªÁªìÂà∞ËøôÈáåÔºåÂØπAOPÁöÑÈÖçÁΩÆ‰ø°ÊÅØÂ∑≤ÁªèËß£ÊûêÂÆåÊàêÔºåÂπ∂ÊàêÂäüÁöÑÊîæÂÖ•SpringÂÆπÂô®‰∏≠„ÄÇÁúãÂà∞ËøôÈáå‰πüËÆ∏Â§ßÂÆ∂ÂØπaopÁöÑÂÆûÁé∞ËøòÊòØÂæàÊ®°Á≥äÔºåÂπ∂Ê≤°Êúâ‰∏Ä‰∏™Êï¥‰ΩìÁöÑÊ¶ÇÂøµ„ÄÇÈÇ£ÊòØÂõ†‰∏∫Êàë‰ª¨ÂØπAspectÔºå Pointcut ÔºåAdviceÔºåAdvisorËøôÂá†‰∏™aopÁöÑ‰∏ªË¶ÅÊ¶ÇÂøµËøòÊ≤°Êúâ‰∏Ä‰∏™Á≥ªÁªüÁöÑËÆ§ËØÜÔºå‰∏ãÁØáÊñáÁ´†ÊàëÂ∞Ü‰ºöÂØπËøôÂá†‰∏™Ê¶ÇÂøµÂ•ΩÂ•ΩÁöÑËÅä‰∏Ä‰∏ã„ÄÇ]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring IOC Ê∫êÁ†ÅËß£Êûê‰∫îÔºàÈùûÂª∂ËøüÂä†ËΩΩbeanÁöÑÂàùÂßãÂåñÔºâ]]></title>
    <url>%2F2018%2F11%2F23%2FSpring-IOC-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%BA%94%EF%BC%88%E9%9D%9E%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BDbean%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä ‰∏äÊúüÂàÜÊûê‰∫ÜrefreshÊñπÊ≥ï‰∏≠Â§ßÈÉ®ÂàÜÔºåËøôÊúüÊàë‰ª¨Âè™ÂàÜÊûêfinishBeanFactoryInitialization(beanFactory)Ëøô‰∏Ä‰∏™ÊñπÊ≥ïÔºåÂàÜÊûêËøô‰∏™ÊñπÊ≥ïÁöÑËøáÁ®ã‰∏≠Êàë‰ª¨‰ºöÈ°∫Ëó§Êë∏ÁìúÊääbeanÂàùÂßãÂåñÁöÑÊï¥‰∏™ÊµÅÁ®ãÈÉΩÂàÜÊûê‰∏ÄÈÅç finishBeanFactoryInitialization(beanFactory)ÊèêÂâçÂàùÂßãÂåñ‰∏Ä‰∫õÈùûÂª∂ËøüÂä†ËΩΩÁöÑÂçï‰æãÁ±ªÂûãÁöÑbeanÔºåËøôÈáå‰∏ªË¶ÅÁúãÊúÄÂêé‰∏ÄË°å beanFactory.preInstantiateSingletons(),ËøôÈáåÊòØÂàùÂßãÂåñÈùûÂª∂ËøüÂä†ËΩΩÂçï‰æãÁöÑÂÖ•Âè£ 123456789101112131415161718192021222324252627282930313233343536protected void finishBeanFactoryInitialization(ConfigurableListableBeanFactory beanFactory) &#123; // ÂàùÂßãÂåñÁ±ªÂûãËΩ¨ÂåñÁöÑbean if (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp; beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123; beanFactory.setConversionService( beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)); &#125; // Register a default embedded value resolver if no bean post-processor // (such as a PropertyPlaceholderConfigurer bean) registered any before: // at this point, primarily for resolution in annotation attribute values. // Ê≥®ÂÜåÈªòËÆ§ÁöÑÂÄºËß£ÊûêÂô® if (!beanFactory.hasEmbeddedValueResolver()) &#123; beanFactory.addEmbeddedValueResolver(new StringValueResolver() &#123; @Override public String resolveStringValue(String strVal) &#123; return getEnvironment().resolvePlaceholders(strVal); &#125; &#125;); &#125; // Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early. String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, false, false); for (String weaverAwareName : weaverAwareNames) &#123; getBean(weaverAwareName); &#125; // Stop using the temporary ClassLoader for type matching. beanFactory.setTempClassLoader(null); // Allow for caching all bean definition metadata, not expecting further changes. beanFactory.freezeConfiguration(); // Instantiate all remaining (non-lazy-init) singletons. beanFactory.preInstantiateSingletons();&#125; preInstantiateSingletonsÊñπÊ≥ïÂú®DefaultListableBeanFactory‰∏≠ÔºåÁî®‰∫éÂàùÂßãÂåñÊâÄÊúâÈùûÂª∂ËøüÂä†ËΩΩÁöÑÂçï‰æã 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public void preInstantiateSingletons() throws BeansException &#123; if (this.logger.isDebugEnabled()) &#123; this.logger.debug("Pre-instantiating singletons in " + this); &#125; // ÊâÄÊúâÊ≥®ÂÜåÂÆåÊàêÁöÑ beanDefinitionNames List&lt;String&gt; beanNames = new ArrayList&lt;String&gt;(this.beanDefinitionNames); // ÈÅçÂéÜÊâÄÊúâÈùûÂª∂ËøüÂä†ËΩΩÁöÑÂçï‰æãÁ±ªÂûã for (String beanName : beanNames) &#123; RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName); if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123; // Âà§Êñ≠Á±ªÂûãÊòØÂê¶‰∏∫ FactoryBean if (isFactoryBean(beanName)) &#123; final FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) getBean(FACTORY_BEAN_PREFIX + beanName); boolean isEagerInit; if (System.getSecurityManager() != null &amp;&amp; factory instanceof SmartFactoryBean) &#123; isEagerInit = AccessController.doPrivileged(new PrivilegedAction&lt;Boolean&gt;() &#123; @Override public Boolean run() &#123; return ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit(); &#125; &#125;, getAccessControlContext()); &#125; else &#123; isEagerInit = (factory instanceof SmartFactoryBean &amp;&amp; ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit()); &#125; // ÊòØÂê¶ÈúÄË¶ÅÁ´ãÂç≥Âä†ËΩΩ if (isEagerInit) &#123; getBean(beanName); &#125; &#125; else &#123; getBean(beanName); &#125; &#125; &#125; // Trigger post-initialization callback for all applicable beans... for (String beanName : beanNames) &#123; Object singletonInstance = getSingleton(beanName); if (singletonInstance instanceof SmartInitializingSingleton) &#123; final SmartInitializingSingleton smartSingleton = (SmartInitializingSingleton) singletonInstance; if (System.getSecurityManager() != null) &#123; AccessController.doPrivileged(new PrivilegedAction&lt;Object&gt;() &#123; @Override public Object run() &#123; smartSingleton.afterSingletonsInstantiated(); return null; &#125; &#125;, getAccessControlContext()); &#125; else &#123; smartSingleton.afterSingletonsInstantiated(); &#125; &#125; &#125;&#125; ÂèØ‰ª•ÁúãÂà∞ËøôÊÆµ‰ª£Á†Å‰∏ªË¶ÅÂÅö‰∫Ü2‰∏™‰∫ãÊÉÖ Âà§Êñ≠beanÁöÑÁ±ªÂûãÊòØÂê¶ÊòØfactoryBeanÔºåÂ¶ÇÊûúÊòØÁöÑËØùÂà§Êñ≠Á±ªÂûãÊòØ‰∏çÊòØSmartFactoryBeanÔºåÂÜçËé∑ÂèñÊòØÂê¶ÈúÄË¶ÅÁ´ãÂç≥Âä†ËΩΩÁöÑisEagerInitÂ±ûÊÄßÔºåÊâßË°ågetBeanÊñπÊ≥ï Âú®Âçï‰æãbeanÈÉΩÂàùÂßãÂåñÂÆåÊàêÂêéÔºåÂæ™ÁéØÂà§Êñ≠beanÁöÑÁ±ªÂûãÊòØÂê¶ÊòØSmartInitializingSingletonÔºåÊòØÁöÑËØù‰ºöÂú®ËøôÊó∂ÂÄôÊâßË°åafterSingletonsInstantiatedÊñπÊ≥ï Êé•‰∏ãÊù•Â∞±ÊòØËé∑ÂèñbeanÁöÑÊµÅÁ®ã‰ª£Á†Å getBeangetBeanÊñπÊ≥ïÊúÄÁªàÈÉΩÊòØËµ∞ÁöÑdoGetBeanÊñπÊ≥ï 123public Object getBean(String name) throws BeansException &#123; return doGetBean(name, null, null, false);&#125; doGetBean123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165protected &lt;T&gt; T doGetBean( final String name, final Class&lt;T&gt; requiredType, final Object[] args, boolean typeCheckOnly) throws BeansException &#123; final String beanName = transformedBeanName(name); Object bean; // È¶ñÂÖàÊ£ÄÊü•ÁºìÂ≠òÊòØÂê¶ÊúâÔºåÊúâÂàôÁõ¥Êé•Âèñ Object sharedInstance = getSingleton(beanName); if (sharedInstance != null &amp;&amp; args == null) &#123; if (logger.isDebugEnabled()) &#123; if (isSingletonCurrentlyInCreation(beanName)) &#123; logger.debug("Returning eagerly cached instance of singleton bean '" + beanName + "' that is not fully initialized yet - a consequence of a circular reference"); &#125; else &#123; logger.debug("Returning cached instance of singleton bean '" + beanName + "'"); &#125; &#125; // ËøôÈáåÊòØÂèñFactoryBean bean = getObjectForBeanInstance(sharedInstance, name, beanName, null); &#125; // ÁºìÂ≠òÈáåÊ≤°Êúâ Á¨¨‰∏ÄÊ¨°ÂàùÂßãÂåñBean else &#123; // Âà§Êñ≠ÊòØ‰∏çÊòØÂ§Ñ‰∫éÂæ™ÁéØ‰æùËµñÂΩì‰∏≠ÔºåÊúâÂàôÁõ¥Êé•Êä•Èîô if (isPrototypeCurrentlyInCreation(beanName)) &#123; throw new BeanCurrentlyInCreationException(beanName); &#125; // Ê£ÄÊü•Áà∂ÂÆπÂô®ÊòØÂê¶Â≠òÂú®Ê≠§BeanÁöÑÂÆö‰πâ BeanFactory parentBeanFactory = getParentBeanFactory(); if (parentBeanFactory != null &amp;&amp; !containsBeanDefinition(beanName)) &#123; // Not found -&gt; check parent. // ËøîÂõûÂéüÂßãÁöÑÂêçÁß∞ Âä†‰∏äFactoryBeanÁ¨¶Âè∑ String nameToLookup = originalBeanName(name); if (args != null) &#123; // Delegation to parent with explicit args. return (T) parentBeanFactory.getBean(nameToLookup, args); &#125; else &#123; // No args -&gt; delegate to standard getBean method. return parentBeanFactory.getBean(nameToLookup, requiredType); &#125; &#125; if (!typeCheckOnly) &#123; // ÊääBeanÁöÑÁä∂ÊÄÅÊîπ‰∏∫Â∑≤ÂàõÂª∫ÔºåÂπ∂‰ªémergedBeanDefinitions ‰∏≠ÁßªÈô§ markBeanAsCreated(beanName); &#125; try &#123; // ÂêàÂπ∂BeanDefinitionËΩ¨ÂåñÊàêRootBeanDefinition final RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName); checkMergedBeanDefinition(mbd, beanName, args); // Ëé∑ÂèñÈÖçÁΩÆÁöÑ depends-On ‰æùËµñ,‰ºòÂÖàÂä†ËΩΩ String[] dependsOn = mbd.getDependsOn(); if (dependsOn != null) &#123; for (String dep : dependsOn) &#123; if (isDependent(beanName, dep)) &#123; throw new BeanCreationException(mbd.getResourceDescription(), beanName, "Circular depends-on relationship between '" + beanName + "' and '" + dep + "'"); &#125; registerDependentBean(dep, beanName); try &#123; // ÈÄíÂΩíËé∑Âèñ getBean(dep); &#125; catch (NoSuchBeanDefinitionException ex) &#123; throw new BeanCreationException(mbd.getResourceDescription(), beanName, "'" + beanName + "' depends on missing bean '" + dep + "'", ex); &#125; &#125; &#125; // Create bean instance. // Â¶ÇÊûúÊòØÂçï‰æã if (mbd.isSingleton()) &#123; // ËøôÈáå‰ºöÊääÂàõÂª∫ÂÆåÊàêÁöÑbeanÂä†ÂÖ•ÁºìÂ≠ò sharedInstance = getSingleton(beanName, new ObjectFactory&lt;Object&gt;() &#123; @Override public Object getObject() throws BeansException &#123; try &#123; // ÂàõÂª∫beanÁöÑ‰∏ªÈÄªËæë return createBean(beanName, mbd, args); &#125; catch (BeansException ex) &#123; // Explicitly remove instance from singleton cache: It might have been put there // eagerly by the creation process, to allow for circular reference resolution. // Also remove any beans that received a temporary reference to the bean. destroySingleton(beanName); throw ex; &#125; &#125; &#125;); bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd); &#125; // Âà§Êñ≠Á±ªÂûã prototype ÊúâÁä∂ÊÄÅÁöÑbean else if (mbd.isPrototype()) &#123; // It's a prototype -&gt; create a new instance. Object prototypeInstance = null; try &#123; beforePrototypeCreation(beanName); prototypeInstance = createBean(beanName, mbd, args); &#125; finally &#123; afterPrototypeCreation(beanName); &#125; bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd); &#125; else &#123; // ÂÖ∂‰ªñÁ±ªÂûãÁöÑscope String scopeName = mbd.getScope(); final Scope scope = this.scopes.get(scopeName); if (scope == null) &#123; throw new IllegalStateException("No Scope registered for scope name '" + scopeName + "'"); &#125; try &#123; Object scopedInstance = scope.get(beanName, new ObjectFactory&lt;Object&gt;() &#123; @Override public Object getObject() throws BeansException &#123; beforePrototypeCreation(beanName); try &#123; return createBean(beanName, mbd, args); &#125; finally &#123; afterPrototypeCreation(beanName); &#125; &#125; &#125;); bean = getObjectForBeanInstance(scopedInstance, name, beanName, mbd); &#125; catch (IllegalStateException ex) &#123; throw new BeanCreationException(beanName, "Scope '" + scopeName + "' is not active for the current thread; consider " + "defining a scoped proxy for this bean if you intend to refer to it from a singleton", ex); &#125; &#125; &#125; catch (BeansException ex) &#123; cleanupAfterBeanCreationFailure(beanName); throw ex; &#125; &#125; // Check if required type matches the type of the actual bean instance. // Â¶ÇÊûúÊúâÊåáÂÆöÁöÑÁ±ªÂûãÔºåÂàôÊ£ÄÊü•ÊòØÂê¶‰∏éÂÆûÈôÖbeanÂÆû‰æãÁöÑÁ±ªÂûãÂåπÈÖç if (requiredType != null &amp;&amp; bean != null &amp;&amp; !requiredType.isInstance(bean)) &#123; try &#123; return getTypeConverter().convertIfNecessary(bean, requiredType); &#125; catch (TypeMismatchException ex) &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Failed to convert bean '" + name + "' to required type '" + ClassUtils.getQualifiedName(requiredType) + "'", ex); &#125; throw new BeanNotOfRequiredTypeException(name, requiredType, bean.getClass()); &#125; &#125; return (T) bean;&#125; ÁúãÂÆå‰∏äÈù¢ÁöÑ‰ª£Á†ÅÔºåÊàë‰ª¨‰ΩúÊÄªÁªìÔºöÈ¶ñÂÖàÔºåÂàõÂª∫bean‰πãÂâç‰ºöÊ£ÄÊü•Âçï‰æãÁºìÂ≠òÈáåÊúâÊ≤°ÊúâÔºåÊúâÁöÑËØù‰ºöÁõ¥Êé•ËøîÂõû„ÄÇÁÑ∂Âêé‰ºöÊ£ÄÊü•Áà∂ÂÆπÂô®ÊòØÂê¶ÊúâËøô‰∏™beanÁöÑÂÆö‰πâÔºå‰∏ÄÁõ¥ÊâæÂà∞ÊúÄÈ°∂Â±ÇÁöÑÁà∂ÂÆπÂô®ÔºàÊúâÁÇπÁ±ªÂûãÂèå‰∫≤ÂßîÊ¥æÔºâÔºåÊúÄÂêé‰ºöÂú®Áà∂ÂÆπÂô®ÊâßË°åËøô‰∏™beanÁöÑËé∑ÂèñÔºå‰πãÂêéËé∑Âèñdepends-OnÂ¶ÇÊûúÊúâÈÖçÁΩÆÁöÑËØù‰ºö‰ºòÂÖàËé∑ÂèñÔºàÈÄíÂΩíËé∑ÂèñÁõ¥Âà∞‰æùËµñÁöÑÊâÄÊúâdepends-OnÔºâÔºåÊúÄÂêéÊâçÊòØÊ†πÊçÆscopeË∞ÉÁî®AbstractAutowireCapableBeanFactoryÁöÑcreateBeanÊñπÊ≥ï createBean12345678910111213141516171819202122232425262728293031323334353637383940414243protected Object createBean(String beanName, RootBeanDefinition mbd, Object[] args) throws BeanCreationException &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Creating instance of bean '" + beanName + "'"); &#125; RootBeanDefinition mbdToUse = mbd; // Make sure bean class is actually resolved at this point, and // clone the bean definition in case of a dynamically resolved Class // which cannot be stored in the shared merged bean definition. Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName); if (resolvedClass != null &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != null) &#123; mbdToUse = new RootBeanDefinition(mbd); mbdToUse.setBeanClass(resolvedClass); &#125; // Prepare method overrides. try &#123; mbdToUse.prepareMethodOverrides(); &#125; catch (BeanDefinitionValidationException ex) &#123; throw new BeanDefinitionStoreException(mbdToUse.getResourceDescription(), beanName, "Validation of method overrides failed", ex); &#125; try &#123; // Give BeanPostProcessors a chance to return a proxy instead of the target bean instance. // Êâ©Â±ïÁÇπÔºåÂèØ‰ª•ÈÄöËøáÂÆûÁé∞InstantiationAwareBeanPostProcessor Êé•Âè£‰∏Ä‰∏™ËøîÂõû‰ª£ÁêÜËÄå‰∏çÊòØÁõÆÊ†ábeanÂÆû‰æã Object bean = resolveBeforeInstantiation(beanName, mbdToUse); if (bean != null) &#123; return bean; &#125; &#125; catch (Throwable ex) &#123; throw new BeanCreationException(mbdToUse.getResourceDescription(), beanName, "BeanPostProcessor before instantiation of bean failed", ex); &#125; Object beanInstance = doCreateBean(beanName, mbdToUse, args); if (logger.isDebugEnabled()) &#123; logger.debug("Finished creating instance of bean '" + beanName + "'"); &#125; return beanInstance;&#125; ËøôÊÆµ‰ª£Á†Å‰∏ªË¶ÅÁúã‰∏Ä‰∏ãresolveBeforeInstantiation(beanName, mbdToUse)ÔºåËøôÈáåÊòØspringÊèê‰æõÁöÑ‰∏Ä‰∏™Êâ©Â±ïÁÇπÔºåÂèØ‰ª•ÈÄöËøáÂÆûÁé∞InstantiationAwareBeanPostProcessorÊé•Âè£Âú®ËøôÈáåËøîÂõûbeanÁöÑ‰ª£ÁêÜÁÑ∂ÂêéÂ∞±ÂèØ‰ª•Áõ¥Êé•ÁúãÊúÄÂêéÁöÑdoCreateBean(beanName, mbdToUse, args)ÊñπÊ≥ï doCreateBean123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105protected Object doCreateBean(final String beanName, final RootBeanDefinition mbd, final Object[] args) throws BeanCreationException &#123; // Instantiate the bean. // Â∞ÅË£ÖbeanÁöÑÂÆπÂô® BeanWrapper instanceWrapper = null; if (mbd.isSingleton()) &#123; instanceWrapper = this.factoryBeanInstanceCache.remove(beanName); &#125; if (instanceWrapper == null) &#123; // ËøôÈáåÊòØÂàõÂª∫ BeanWrapper instanceWrapper = createBeanInstance(beanName, mbd, args); &#125; final Object bean = (instanceWrapper != null ? instanceWrapper.getWrappedInstance() : null); Class&lt;?&gt; beanType = (instanceWrapper != null ? instanceWrapper.getWrappedClass() : null); mbd.resolvedTargetType = beanType; // Allow post-processors to modify the merged bean definition. synchronized (mbd.postProcessingLock) &#123; if (!mbd.postProcessed) &#123; try &#123; applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName); &#125; catch (Throwable ex) &#123; throw new BeanCreationException(mbd.getResourceDescription(), beanName, "Post-processing of merged bean definition failed", ex); &#125; mbd.postProcessed = true; &#125; &#125; // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÊèêÂâçÊö¥Èú≤ÂØπË±°ÁöÑÂºïÁî®ÔºåÁî®‰∫éËß£ÂÜ≥Âæ™ÁéØ‰æùËµñ boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName)); if (earlySingletonExposure) &#123; if (logger.isDebugEnabled()) &#123; logger.debug("Eagerly caching bean '" + beanName + "' to allow for resolving potential circular references"); &#125; addSingletonFactory(beanName, new ObjectFactory&lt;Object&gt;() &#123; @Override public Object getObject() throws BeansException &#123; return getEarlyBeanReference(beanName, mbd, bean); &#125; &#125;); &#125; // Initialize the bean instance. Object exposedObject = bean; try &#123; // ‰æùËµñÊ≥®ÂÖ•ÁöÑ‰∏ªÈÄªËæë populateBean(beanName, mbd, instanceWrapper); if (exposedObject != null) &#123; // ÊâßË°å‰∏Ä‰∫õÂàùÂßãÂåñÁöÑÊñπÊ≥ï exposedObject = initializeBean(beanName, exposedObject, mbd); &#125; &#125; catch (Throwable ex) &#123; if (ex instanceof BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123; throw (BeanCreationException) ex; &#125; else &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, "Initialization of bean failed", ex); &#125; &#125; if (earlySingletonExposure) &#123; Object earlySingletonReference = getSingleton(beanName, false); if (earlySingletonReference != null) &#123; if (exposedObject == bean) &#123; exposedObject = earlySingletonReference; &#125; else if (!this.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123; String[] dependentBeans = getDependentBeans(beanName); Set&lt;String&gt; actualDependentBeans = new LinkedHashSet&lt;String&gt;(dependentBeans.length); for (String dependentBean : dependentBeans) &#123; if (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123; actualDependentBeans.add(dependentBean); &#125; &#125; if (!actualDependentBeans.isEmpty()) &#123; throw new BeanCurrentlyInCreationException(beanName, "Bean with name '" + beanName + "' has been injected into other beans [" + StringUtils.collectionToCommaDelimitedString(actualDependentBeans) + "] in its raw version as part of a circular reference, but has eventually been " + "wrapped. This means that said other beans do not use the final version of the " + "bean. This is often the result of over-eager type matching - consider using " + "'getBeanNamesOfType' with the 'allowEagerInit' flag turned off, for example."); &#125; &#125; &#125; &#125; // Register bean as disposable. try &#123; registerDisposableBeanIfNecessary(beanName, bean, mbd); &#125; catch (BeanDefinitionValidationException ex) &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, "Invalid destruction signature", ex); &#125; return exposedObject;&#125; ËøôÊÆµ‰ª£Á†Å‰∏ªË¶ÅÁúãËøô‰∏â‰∏™ÊñπÊ≥ï createBeanInstance(beanName, mbd, args) ÂàõÂª∫bean populateBean(beanName, mbd, instanceWrapper) ÁªÑË£ÖbeanÁöÑ‰æùËµñ initializeBean(beanName, exposedObject, mbd) Ë∞ÉÁî®beanÁöÑ‰∏Ä‰∫õÂàùÂßãÂåñÊñπÊ≥ïÔºå‰ª•ÂèäÊâ©Â±ïÊé•Âè£ Êé•‰∏ãÊù•Êàë‰ª¨ÁùÄÈáçÊù•ÁúãËøô‰∏â‰∏™ÊñπÊ≥ï createBeanInstance123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, Object[] args) &#123; // Make sure bean class is actually resolved at this point. // Ëé∑Âèñbean class Class&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName); // ‰∏çÊòØ pullic Áõ¥Êé•ÊäõÂºÇÂ∏∏ if (beanClass != null &amp;&amp; !Modifier.isPublic(beanClass.getModifiers()) &amp;&amp; !mbd.isNonPublicAccessAllowed()) &#123; throw new BeanCreationException(mbd.getResourceDescription(), beanName, "Bean class isn't public, and non-public access not allowed: " + beanClass.getName()); &#125; // ‰ΩøÁî®Â∑•ÂéÇÊñπÊ≥ïÂÆû‰æãÂåñbean if (mbd.getFactoryMethodName() != null) &#123; return instantiateUsingFactoryMethod(beanName, mbd, args); &#125; // Shortcut when re-creating the same bean... // Âà§Êñ≠beanÊòØÂê¶ÂàõÂª∫Ëøá boolean resolved = false; boolean autowireNecessary = false; if (args == null) &#123; synchronized (mbd.constructorArgumentLock) &#123; if (mbd.resolvedConstructorOrFactoryMethod != null) &#123; resolved = true; autowireNecessary = mbd.constructorArgumentsResolved; &#125; &#125; &#125; // Â¶ÇÊûúÂ∑≤ÁªèÂä†ËΩΩËøá if (resolved) &#123; if (autowireNecessary) &#123; // ÊúâÂèÇÊûÑÈÄ†ÊñπÊ≥ï return autowireConstructor(beanName, mbd, null, null); &#125; else &#123; // ‰ΩøÁî®Êó†ÂèÇÊûÑÈÄ† return instantiateBean(beanName, mbd); &#125; &#125; // Need to determine the constructor... // ÂØªÊâæ‰∏Ä‰∏™ÂêàÈÄÇÁöÑÊûÑÈÄ†ÊñπÊ≥ï Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName); if (ctors != null || mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_CONSTRUCTOR || mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) &#123; return autowireConstructor(beanName, mbd, ctors, args); &#125; // No special handling: simply use no-arg constructor. return instantiateBean(beanName, mbd);&#125; Ëøô‰∏™ÊñπÊ≥ïÁöÑ‰∏ªË¶ÅÈÄªËæëÂÖ∂ÂÆûÂ∞±ÊòØÂú®Êâæ‰∏Ä‰∏™ÂêàÈÄÇÁöÑÂàùÂßãÂåñÊñπÊ≥ï È¶ñÂÖàÂà§Êñ≠RootBeanDefinitionÊòØÂê¶Âê´Êúâfactory-methodÈÖçÁΩÆÔºåÊúâÁöÑËØù‰ΩøÁî®Â∑•ÂéÇÊñπÊ≥ïÂÆû‰æãÂåñbean ‰πãÂêéÁöÑÈÄªËæëÂ∞±ÊòØÂØªÊâæ‰∏Ä‰∏™ÂêàÈÄÇÁöÑÊûÑÈÄ†ÊñπÊ≥ïÁî®‰∫ébeanÁöÑÂÆû‰æãÂåñ Â¶ÇÊûúÂà§Êñ≠ÊòØÊúâÂèÇÁöÑÊûÑÈÄ†ÊñπÊ≥ïÔºåÂàôÈÄöËøáautowireConstructorÂÆû‰æãÂåñÔºåÂàùÂßãÂåñÁöÑËøáÁ®ãÂæàÁπÅÁêêÔºåÂÖ∂‰∏≠ÂØπÊûÑÈÄ†ÊñπÊ≥ïÂèÇÊï∞ÁöÑ‰æùËµñ‰πüÊòØÈÄöËøáÈÄíÂΩígetBean()Êù•ÂÆûÁé∞ÁöÑ Êó†ÂèÇÁöÑÂàô‰ΩøÁî®instantiateBeanÂÆû‰æãÂåñ Âà∞ËøôÈáåÊâßË°åÂÆåbeanÂ∑≤ÁªèÂàõÂª∫‰∫Ü(springÈªòËÆ§ÊòØ‰ΩøÁî®CGLIB)Ôºå‰ΩÜÊòØËøôÊó∂ÂÄôÁöÑbeanÊòØ‰∏çÂÆåÊï¥ÁöÑÔºåÁõ∏ÂÖ≥ÁöÑ‰æùËµñÈ°πËøòÂπ∂Ê≤°ÊúâË¢´Ê≥®ÂÖ• populateBean(beanName, mbd, instanceWrapper)ÁªÑË£ÖbeanÁöÑÈÄªËæëÈÉΩÂú®ËøôÈáå 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182protected void populateBean(String beanName, RootBeanDefinition mbd, BeanWrapper bw) &#123; // Ëé∑ÂèñÁöÑÈÖçÁΩÆÁöÑproperty‰æùËµñ PropertyValues pvs = mbd.getPropertyValues(); if (bw == null) &#123; if (!pvs.isEmpty()) &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, "Cannot apply property values to null instance"); &#125; else &#123; // Skip property population phase for null instance. return; &#125; &#125; // Êâ©Â±ïÁÇπ ÊâßË°åÂÆûÁé∞‰∫ÜInstantiationAwareBeanPostProcessorsÊé•Âè£ÊñπÊ≥ï // Âú®ËÆæÁΩÆÂ±ûÊÄß‰æùËµñ‰πãÂâçÂèØ‰ª•ÊúâÊú∫‰ºö‰øÆÊîπbeanÁöÑÂ±ûÊÄßÈÖçÁΩÆ boolean continueWithPropertyPopulation = true; if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123; for (BeanPostProcessor bp : getBeanPostProcessors()) &#123; if (bp instanceof InstantiationAwareBeanPostProcessor) &#123; InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp; if (!ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) &#123; continueWithPropertyPopulation = false; break; &#125; &#125; &#125; &#125; // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÁªßÁª≠ÁªÑË£ÖbeanÂ±ûÊÄß if (!continueWithPropertyPopulation) &#123; return; &#125; // Âà§Êñ≠Ëá™Âä®ÈÖçÁöÑÁ±ªÂûãÔºàÊåâÂêçÁß∞ÂíåÊåâÁ±ªÂûãÔºâ if (mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_BY_NAME || mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_BY_TYPE) &#123; MutablePropertyValues newPvs = new MutablePropertyValues(pvs); // Add property values based on autowire by name if applicable. // ÊåâbeanÁöÑÂêçÁß∞Ê≥®ÂÖ• if (mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_BY_NAME) &#123; autowireByName(beanName, mbd, bw, newPvs); &#125; // Add property values based on autowire by type if applicable. // ÊåâbeanÁöÑÁ±ªÂûãÊ≥®ÂÖ• if (mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_BY_TYPE) &#123; autowireByType(beanName, mbd, bw, newPvs); &#125; pvs = newPvs; &#125; // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶Å‰æùËµñÊ£ÄÊü• boolean hasInstAwareBpps = hasInstantiationAwareBeanPostProcessors(); boolean needsDepCheck = (mbd.getDependencyCheck() != RootBeanDefinition.DEPENDENCY_CHECK_NONE); if (hasInstAwareBpps || needsDepCheck) &#123; PropertyDescriptor[] filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching); if (hasInstAwareBpps) &#123; for (BeanPostProcessor bp : getBeanPostProcessors()) &#123; if (bp instanceof InstantiationAwareBeanPostProcessor) &#123; InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp; pvs = ibp.postProcessPropertyValues(pvs, filteredPds, bw.getWrappedInstance(), beanName); if (pvs == null) &#123; return; &#125; &#125; &#125; &#125; if (needsDepCheck) &#123; // Ê£ÄÊü•‰æùËµñ checkDependencies(beanName, mbd, filteredPds, pvs); &#125; &#125; // ÁªÑË£ÖÂ±ûÊÄß applyPropertyValues(beanName, mbd, bw, pvs);&#125; ÈÄöËøáÊü•Áúã‰ª£Á†ÅÔºåÂèØÁü•‰∏äÈù¢‰∏çÊ≠¢ÂÅö‰∫ÜÁªÑË£ÖbeanËøô‰∏Ä‰ª∂‰∫ãÔºå‰∏ªË¶ÅÂÅö‰∫Ü‰∏ãÈù¢Âá†‰ª∂‰∫ãÊÉÖ: Ëé∑ÂèñspringÈÖçÁΩÆÈ°π‰∏≠ÈÖçÁΩÆÁöÑpropertyÂ±ûÊÄß‰æùËµñ ÊâßË°åÂÆûÁé∞‰∫ÜInstantiationAwareBeanPostProcessorsÊé•Âè£ÁöÑÊñπÊ≥ïÔºåËØ•Êé•Âè£ÂèØ‰ª•Âú®Â±ûÊÄßË¢´Ê≥®ÂÖ•ÂâçÂÅö‰∏Ä‰∫õ‰øÆÊîπÔºåÂπ∂‰∏îÂèØ‰ª•Áõ¥Êé•ËøîÂõûÔºå‰∏çÊâßË°å‰∏ãÈù¢ÁöÑÂ±ûÊÄßÊ≥®ÂÖ•ÈÄªËæë Âà§Êñ≠ÊòØÂê¶ÊúâÈÖçÁΩÆËá™Âä®Ê≥®ÂÖ•ÔºåÊúâÁöÑËØù‰ºöÊåâÈÖçÁΩÆÊâßË°åÊåâÂêçÁß∞ÔºàautowireByNameÊñπÊ≥ïÔºâÊàñÁ±ªÂûãÔºàautowireByTypeÊñπÊ≥ïÔºâÊ≥®ÂÖ• Âà§Êñ≠ÊòØÂê¶ÊâßË°å‰æùËµñÊ£ÄÊü•ÔºàÊåâÈÖçÁΩÆÁöÑ‰æùËµñÊ£ÄÊü•Á≠âÁ∫ßcheckÔºâ ÊúÄÂêéÊâßË°åbeanÂ±ûÊÄßÁöÑÊúÄÁªàË£ÖÈÖç ÔºàapplyPropertyValues(beanName, mbd, bw, pvs)Ôºâ Êàë‰ª¨ÂèØ‰ª•ÁÆÄÂçïÁúã‰∏Ä‰∏ã autowireByNameÁöÑÂÆûÁé∞ autowireByName123456789101112131415161718192021222324protected void autowireByName( String beanName, AbstractBeanDefinition mbd, BeanWrapper bw, MutablePropertyValues pvs) &#123; // ËøîÂõûÈúÄË¶ÅËá™Âä®‰æùËµñÊ≥®ÂÖ•ÁöÑÂ±ûÊÄßÂêçÁß∞ String[] propertyNames = unsatisfiedNonSimpleProperties(mbd, bw); for (String propertyName : propertyNames) &#123; if (containsBean(propertyName)) &#123; Object bean = getBean(propertyName); // Â∞ÜËé∑ÂèñÁöÑ‰æùËµñbeanÊîæÂõû ÂæÖË£ÖÈÖç pvs.add(propertyName, bean); registerDependentBean(propertyName, beanName); if (logger.isDebugEnabled()) &#123; logger.debug("Added autowiring by name from bean name '" + beanName + "' via property '" + propertyName + "' to bean named '" + propertyName + "'"); &#125; &#125; else &#123; if (logger.isTraceEnabled()) &#123; logger.trace("Not autowiring property '" + propertyName + "' of bean '" + beanName + "' by name: no matching bean found"); &#125; &#125; &#125;&#125; ÂèØÁü•Â¶ÇÊûúÊòØÊåânameÊ≥®ÂÖ•ÁöÑËØùÔºåÈ¶ñÂÖà‰ºöÂÖàËé∑ÂèñÈúÄË¶ÅËá™Âä®‰æùËµñÊ≥®ÂÖ•ÁöÑbeanÂêçÁß∞ÔºåÁÑ∂ÂêéÊòØÈÄöËøágetBean(beanName)Ëé∑Âèñ‰æùËµñÈ°πÁöÑ„ÄÇÂêåÁêÜautowireByType applyPropertyValuesÂú®ÊâßË°åapplyPropertyValuesÊñπÊ≥ï‰πãÂâçÔºåÊàë‰ª¨Â∑≤ÁªèÂáÜÂ§áÂ•Ω‰∫ÜÊâÄÊúâÁöÑ‰æùËµñÈ°π‰∫ÜÔºåÊé•‰∏ãÊù•ÁöÑ‰∫ãÊÉÖÂ∞±ÊòØÊääËøô‰∫õ‰æùËµñÈ°πË£ÖÈÖçÂà∞beanÂØπÂ∫îÁöÑÂ±ûÊÄß‰∏≠ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293protected void applyPropertyValues(String beanName, BeanDefinition mbd, BeanWrapper bw, PropertyValues pvs) &#123; // ÂæÖË£ÖÈÖçÁöÑÂ±ûÊÄß‰∏∫Á©∫ Áõ¥Êé•ËøîÂõû if (pvs == null || pvs.isEmpty()) &#123; return; &#125; MutablePropertyValues mpvs = null; List&lt;PropertyValue&gt; original; if (System.getSecurityManager() != null) &#123; if (bw instanceof BeanWrapperImpl) &#123; ((BeanWrapperImpl) bw).setSecurityContext(getAccessControlContext()); &#125; &#125; // if (pvs instanceof MutablePropertyValues) &#123; mpvs = (MutablePropertyValues) pvs; if (mpvs.isConverted()) &#123; // Shortcut: use the pre-converted values as-is. try &#123; bw.setPropertyValues(mpvs); return; &#125; catch (BeansException ex) &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, "Error setting property values", ex); &#125; &#125; original = mpvs.getPropertyValueList(); &#125; else &#123; original = Arrays.asList(pvs.getPropertyValues()); &#125; TypeConverter converter = getCustomTypeConverter(); if (converter == null) &#123; converter = bw; &#125; // Áî®‰∫éÂä†ËΩΩbeanDefinitionÊâÄÂØπÂ∫îÁöÑÂÄº BeanDefinitionValueResolver valueResolver = new BeanDefinitionValueResolver(this, beanName, mbd, converter); // ÂàõÂª∫‰∏Ä‰∏™PropertyValueÁöÑÊ∑±Êã∑Ë¥ù List&lt;PropertyValue&gt; deepCopy = new ArrayList&lt;PropertyValue&gt;(original.size()); boolean resolveNecessary = false; for (PropertyValue pv : original) &#123; if (pv.isConverted()) &#123; deepCopy.add(pv); &#125; else &#123; String propertyName = pv.getName(); Object originalValue = pv.getValue(); // Âä†ËΩΩÂØπÂ∫îÂ±ûÊÄßÂÄº value Object resolvedValue = valueResolver.resolveValueIfNecessary(pv, originalValue); Object convertedValue = resolvedValue; boolean convertible = bw.isWritableProperty(propertyName) &amp;&amp; !PropertyAccessorUtils.isNestedOrIndexedProperty(propertyName); if (convertible) &#123; convertedValue = convertForProperty(resolvedValue, propertyName, bw, converter); &#125; // Possibly store converted value in merged bean definition, // in order to avoid re-conversion for every created bean instance. if (resolvedValue == originalValue) &#123; if (convertible) &#123; pv.setConvertedValue(convertedValue); &#125; deepCopy.add(pv); &#125; else if (convertible &amp;&amp; originalValue instanceof TypedStringValue &amp;&amp; !((TypedStringValue) originalValue).isDynamic() &amp;&amp; !(convertedValue instanceof Collection || ObjectUtils.isArray(convertedValue))) &#123; pv.setConvertedValue(convertedValue); deepCopy.add(pv); &#125; else &#123; resolveNecessary = true; deepCopy.add(new PropertyValue(pv, convertedValue)); &#125; &#125; &#125; if (mpvs != null &amp;&amp; !resolveNecessary) &#123; mpvs.setConverted(); &#125; // Set our (possibly massaged) deep copy. try &#123; // ËÆæÁΩÆÂ±ûÊÄß‰ø°ÊÅØ bw.setPropertyValues(new MutablePropertyValues(deepCopy)); &#125; catch (BeansException ex) &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, "Error setting property values", ex); &#125;&#125; ËøôÊÆµ‰ª£Á†ÅÂÅöÁöÑ‰∏ªË¶Å‰∫ãÊÉÖÂ∞±ÊòØÈÄöËøáÈÖçÁΩÆÁöÑÂ±ûÊÄßÂéªÂä†ËΩΩÂ±ûÊÄßÂØπÂ∫îÁöÑÂÄºÔºåÁúüÊ≠£‰∏∫beanËÆæÁΩÆÂ±ûÊÄßÁöÑÈÄªËæëÂú®bw.setPropertyValues(new MutablePropertyValues(deepCopy))‰∏≠ÔºåËøôÈáåÂÖ∂ÂÆûÂ∞±ÊòØÈÄöËøáÂèçÂ∞ÑË∞ÉÁî®setÊñπÊ≥ïËøõË°åÂ±ûÊÄßÁöÑËÆæÁΩÆÁöÑ„ÄÇ‰ª£Á†ÅÊâßË°åÂà∞ËøôÈáåÔºåbeanÁöÑÂàõÂª∫Â∑≤ÁªèÂü∫Êú¨ÂÆåÊï¥‰∫Ü,populateBeanÊñπÊ≥ïÁöÑÂ∑•‰ΩúÂ∑≤ÁªèÂÆåÊàê‰∫ÜÔºå‰∏ãÈù¢Ë¶ÅÂÅöÁöÑÂ∞±ÊòØ‰∏Ä‰∫õÂàùÂßãÂåñÁöÑÂ∑•‰Ωú initializeBean(beanName, exposedObject, mbd)123456789101112131415161718192021222324252627282930313233343536373839protected Object initializeBean(final String beanName, final Object bean, RootBeanDefinition mbd) &#123; // ÂÆâÂÖ®ÁÆ°ÁêÜÂô® Âà§Êñ≠ÊâßË°åÊùÉÈôê if (System.getSecurityManager() != null) &#123; AccessController.doPrivileged(new PrivilegedAction&lt;Object&gt;() &#123; @Override public Object run() &#123; invokeAwareMethods(beanName, bean); return null; &#125; &#125;, getAccessControlContext()); &#125; else &#123; // ÊâßË°åÂÆûÁé∞‰∫Ü‰∏ÄÁ≥ªÂàóAwareÁöÑÊé•Âè£ÊñπÊ≥ï invokeAwareMethods(beanName, bean); &#125; Object wrappedBean = bean; if (mbd == null || !mbd.isSynthetic()) &#123; // ÊâßË°åBeanPostProcessorÊé•Âè£postProcessBeforeInitializationÊñπÊ≥ï wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName); &#125; try &#123; // ÂÖàÊâßË°åInitializingBeanÊé•Âè£afterPropertiesSetÊñπÊ≥ï // ÂÜçÊâßË°åËá™ÂÆö‰πâÈÖçÁΩÆÁöÑÂàùÂßãÂåñÊñπÊ≥ï(init-method) invokeInitMethods(beanName, wrappedBean, mbd); &#125; catch (Throwable ex) &#123; throw new BeanCreationException( (mbd != null ? mbd.getResourceDescription() : null), beanName, "Invocation of init method failed", ex); &#125; if (mbd == null || !mbd.isSynthetic()) &#123; // ÊâßË°åBeanPostProcessorÊé•Âè£postProcessAfterInitializationÊñπÊ≥ï wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName); &#125; return wrappedBean;&#125; ‰∏äËø∞‰ª£Á†ÅÂÅöÁöÑÈÉΩÊòØbeanÂàùÂßãÂåñÁöÑ‰∫ãÊÉÖ invokeAwareMethodsÊñπÊ≥ïÔºåÂ¶ÇÊûúÊúâbeanÂèàÂÆûÁé∞AwareÁõ∏ÂÖ≥ÁöÑÊé•Âè£ÔºåÂàôË∞ÉÁî®Ëøô‰∫õÊé•Âè£ÁöÑÊñπÊ≥ïÁªôbeanÊ≥®ÂÖ•‰∏Ä‰∫õ‰ø°ÊÅØ(beanNameÔºåBeanClassLoaderÔºåBeanFactory) applyBeanPostProcessorsBeforeInitialization ÊâßË°åBeanPostProcessorÊé•Âè£postProcessBeforeInitializationÊñπÊ≥ïÔºåBeanPostProcessorÊé•Âè£Âú®‰∏ä‰∏ÄÁØáËß£Êûê‰∏≠ÊúâËÆ≤Âà∞ËøáÔºåÊòØÂú®refreshÊñπÊ≥ïÁöÑregisterBeanPostProcessors(beanFactory)‰∏≠Ê≥®ÂÜåÁöÑÔºåÊòØspringÊèê‰æõÁöÑÈùûÂ∏∏ÈáçË¶ÅÁöÑ‰∏Ä‰∏™Ëá™ÂÆö‰πâÊâ©Â±ïÁÇπ invokeInitMethodsÊñπÊ≥ïÔºåËøôÈáåÊòØÂà§Êñ≠ÊòØÂê¶ÊúâÂÆûÁé∞InitializingBeanÊé•Âè£ÔºåÊúâÂàôÊâßË°åafterPropertiesSetÂàùÂßãÂåñÊñπÊ≥ïÔºåÂπ∂‰∏îÂ¶ÇÊûúÊúâÈÖçÁΩÆËá™ÂÆö‰πâÁöÑinit-methodÊñπÊ≥ïÂàô‰πü‰∏ÄÂπ∂ÊâßË°å applyBeanPostProcessorsBeforeInitialization ÊâßË°åBeanPostProcessorÊé•Âè£postProcessAfterInitializationÊñπÊ≥ï Â∞æË®Ä ÈöèÁùÄËß£ÊûêËøõË°åÂà∞ËøôÈáåÔºåÊàë‰ª¨Â∑≤ÁªèÊääbeanÁöÑÊï¥‰∏™ÁîüÂëΩÂë®ÊúüÈÉΩËµ∞‰∫Ü‰∏™Â§ßÊ¶Ç„ÄÇÁõ∏‰ø°Â§ßÂÆ∂ÂØπspring ioc ÁöÑÂÖ∑‰ΩìÂÆûÁé∞Â∑≤ÁªèÊúâ‰∫Ü‰∏™Âü∫Êú¨ÁöÑ‰∫ÜËß£‰∫Ü]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring IOC Ê∫êÁ†ÅËß£ÊûêÂõõÔºàÂä†ËΩΩÈùûÂª∂ËøüÂçï‰æãÂâçÁöÑÊìç‰ΩúÔºâ]]></title>
    <url>%2F2018%2F11%2F20%2FSpring-IOC-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E5%9B%9B%EF%BC%88%E5%8A%A0%E8%BD%BD%E9%9D%9E%E5%BB%B6%E8%BF%9F%E5%8D%95%E4%BE%8B%E5%89%8D%E7%9A%84%E6%93%8D%E4%BD%9C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä ‰∏ä‰∏ÄÊúüËÆ≤Ëø∞‰∫ÜBeanDefinitionsÁöÑËΩΩÂÖ•ÂíåÊ≥®ÂÜåÔºåbeanDefinitionÁõ∏ÂΩì‰∫éspringÂØπbeanÁöÑÊï∞ÊçÆÊäΩË±°ÂÆö‰πâÔºåËøô‰∏ÄÊúüÊàë‰ª¨ÁªßÁª≠È°∫ÁùÄÁöÑ refresh ÊñπÊ≥ïÂæÄ‰∏ãËÆ≤ ÂõûÂà∞refreshÊñπÊ≥ï‰∏ä‰∏ÄÊúüÂÖ∂ÂÆû‰∏ªË¶ÅÊòØ‰ªãÁªç‰∫ÜobtainFreshBeanFactory() Ëøô‰∏ÄÊ≠•ÔºåËøô‰∏ÄÊúüÊàë‰ª¨ÁªßÁª≠Êé•ÁùÄÂæÄ‰∏ãÁúã 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566@Overridepublic void refresh() throws BeansException, IllegalStateException &#123; synchronized (this.startupShutdownMonitor) &#123; // Prepare this context for refreshing. prepareRefresh(); // ÂàõÂª∫BeanFactory,Âπ∂ËΩΩÂÖ•BeanDefinitionsÔºàÈáçË¶ÅÔºâ ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // Prepare the bean factory for use in this context. prepareBeanFactory(beanFactory); try &#123; // Allows post-processing of the bean factory in context subclasses. postProcessBeanFactory(beanFactory); // ÊâßË°å BeanFactoryPostProcessorsÔºàÂÆû‰æãÂåñbeanÂâç‰øÆÊîπbeanÂÆö‰πâ‰ø°ÊÅØÔºâ invokeBeanFactoryPostProcessors(beanFactory); // Ê≥®ÂÜå BeanPostProcessorsÔºàÂàùÂßãÂåñbeanÂâçÂêéÊâßË°åÔºâ registerBeanPostProcessors(beanFactory); // Initialize message source for this context. // ÂõΩÈôÖÂåñÁõ∏ÂÖ≥ initMessageSource(); // Initialize event multicaster for this context. initApplicationEventMulticaster(); // Initialize other special beans in specific context subclasses. // ÂàùÂßãÂåñ‰∏ªÈ¢ò‰ø°ÊÅØ onRefresh(); // Check for listener beans and register them. registerListeners(); // ÊèêÂâçÂÆû‰æãÂåñÂåñÂÖ®ÈÉ®ÈùûÂª∂ËøüÂä†ËΩΩÁöÑÂçï‰æãÁ±ªÂûã finishBeanFactoryInitialization(beanFactory); // Last step: publish corresponding event. finishRefresh(); &#125; catch (BeansException ex) &#123; if (logger.isWarnEnabled()) &#123; logger.warn("Exception encountered during context initialization - " + "cancelling refresh attempt: " + ex); &#125; // Destroy already created singletons to avoid dangling resources. destroyBeans(); // Reset 'active' flag. cancelRefresh(ex); // Propagate exception to caller. throw ex; &#125; finally &#123; // Reset common introspection caches in Spring's core, since we // might not ever need metadata for singleton beans anymore... resetCommonCaches(); &#125; &#125;&#125; prepareBeanFactory(beanFactory)ÂÖàÁúã‰∏Ä‰∏ãprepareBeanFactoryÁöÑÊñπÊ≥ïÂÆûÁé∞ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546protected void prepareBeanFactory(ConfigurableListableBeanFactory beanFactory) &#123; // ÈÖçÁΩÆÂÆπÂô®ÁöÑ classLoader beanFactory.setBeanClassLoader(getClassLoader()); // ËøôÊòØ‰∏Ä‰∏™Ë°®ËææÊòØËØ≠Ë®ÄÂ§ÑÁêÜÂô® beanFactory.setBeanExpressionResolver(new StandardBeanExpressionResolver(beanFactory.getBeanClassLoader())); // Â±ûÊÄßÁºñËæëÂô® beanFactory.addPropertyEditorRegistrar(new ResourceEditorRegistrar(this, getEnvironment())); // ÈÖçÁΩÆ‰∫ÜBeanPostProcessorÁöÑ‰∏Ä‰∏™ÂÆûÁé∞Á±ª beanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this)); // ÈÖçÁΩÆË¢´ÂøΩÁï•ÁöÑ‰æùËµñÈ°πÔºàÂêÑÁßç Aware ÂÆûÁé∞Á±ªÔºâ beanFactory.ignoreDependencyInterface(EnvironmentAware.class); beanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class); beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class); beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class); beanFactory.ignoreDependencyInterface(MessageSourceAware.class); beanFactory.ignoreDependencyInterface(ApplicationContextAware.class); // ‰øÆÊ≠£‰æùËµñ beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory); beanFactory.registerResolvableDependency(ResourceLoader.class, this); beanFactory.registerResolvableDependency(ApplicationEventPublisher.class, this); beanFactory.registerResolvableDependency(ApplicationContext.class, this); // Register early post-processor for detecting inner beans as ApplicationListeners. // Ê≥®ÂÜåAOPÁõ∏ÂÖ≥ÁöÑ beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(this)); // Detect a LoadTimeWeaver and prepare for weaving, if found. if (beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123; beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory)); // Set a temporary ClassLoader for type matching. beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader())); &#125; // ÈÖçÁΩÆSpring ÈªòËÆ§ÁéØÂ¢ÉÂèòÈáèbean if (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) &#123; beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment()); &#125; if (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) &#123; beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties()); &#125; if (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) &#123; beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment()); &#125;&#125; Ëøô‰∏™ÊñπÊ≥ïÂÅö‰∫Ü‰ªÄ‰πà‰∫ãÊÉÖÂë¢ÔºåÊàë‰ª¨ÁÆÄÂçïÁöÑÊù•Áúã‰∏Ä‰∏ã È¶ñÂÖàÊòØÈÖçÁΩÆ‰∫ÜÂÆπÂô®ÁöÑÈªòËÆ§ classLoader ÈÖçÁΩÆ‰∫Ü‰∏Ä‰∏™ËØ≠Ë®ÄÂô®Âíå‰∏Ä‰∏™Â±ûÊÄßÁºñËæëÂô® Ê≥®ÂÜå‰∫Ü‰∏Ä‰∏™BeanPostProcessorÊé•Âè£ÁöÑ‰∏Ä‰∏™ÂÆûÁé∞Á±ªÔºåËøô‰∏™Êé•Âè£ÁöÑÂÖ∑‰ΩìÁî®Â§Ñ‰∏ãÈù¢È©¨‰∏ä‰ºöËÆ≤Âà∞ ÈÖçÁΩÆË¶ÅËá™Âä®Ê≥®ÂÖ•Êó∂Ë¶ÅË¢´ÂøΩÁï•ÁöÑbeanÁ±ªÂûãÔºåÂèØ‰ª•ÁúãÂà∞ËøôÈáåÈÖçÁΩÆÁöÑÈÉΩÊòØ‰∏Ä‰∫õAwareÂÆûÁé∞Á±ªÔºåËøô‰∫õ‰æùËµñÈ°πspringÂÆπÂô®‰ºöÁªü‰∏ÄËÆæÁΩÆ Ê≥®ÂÜåaopÁõ∏ÂÖ≥ÁöÑ ÈÖçÁΩÆSpringÈªòËÆ§ÁéØÂ¢ÉÂèòÈáèbean(systemProperties, systemEnvironment, environment) postProcessBeanFactory(beanFactory)ÊñπÊ≥ïÊØîËæÉÁÆÄÁü≠ÔºåÈÄöËøáÊü•Áúã‰ª£Á†ÅÔºåÂèØÁü•‰πüÊòØÂØπbeanFactoryÂÅö‰∏Ä‰∫õÈÖçÁΩÆÁöÑÂ∑•‰Ωú 1234567protected void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) &#123; beanFactory.addBeanPostProcessor(new ServletContextAwareProcessor(this.servletContext, this.servletConfig)); beanFactory.ignoreDependencyInterface(ServletContextAware.class); beanFactory.ignoreDependencyInterface(ServletConfigAware.class); WebApplicationContextUtils.registerWebApplicationScopes(beanFactory, this.servletContext); WebApplicationContextUtils.registerEnvironmentBeans(beanFactory, this.servletContext, this.servletConfig);&#125; invokeBeanFactoryPostProcessors(beanFactory)ÂèØ‰ª•ÁúãÂà∞‰∏ªË¶ÅÈÄªËæëÂú®ÔºåPostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors‰∏≠ÔºåËøôÈáåÂÖ∂ÂÆûÊòØspringÁïôÁöÑ‰∏Ä‰∏™Êâ©Â±ïÁÇπÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÂÆûÁé∞BeanFactoryPostProcessorÊù•ÂÆûÁé∞Âú® getBean‰πãÂâçÁöÑËá™ÂÆö‰πâÊâ©Â±ï„ÄÇÁé∞Âú®Êàë‰ª¨Â∞±Êù•ÁúãÁúãÂÆÉÊòØÂú®‰ªÄ‰πàÊó∂ÂÄôÊâßË°åÁöÑ 12345678910protected void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) &#123; PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors()); // Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime // (e.g. through an @Bean method registered by ConfigurationClassPostProcessor) if (beanFactory.getTempClassLoader() == null &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123; beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory)); beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader())); &#125;&#125; ÁªßÁª≠Êü•ÁúãPostProcessorRegistrationDelegate.class 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155public static void invokeBeanFactoryPostProcessors( ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors) &#123; // Â≠òÊîæÂ∑≤ÁªèÊâßË°åÁöÑ BeanFactoryPostProcessor beanÂêçÂ≠ó Set&lt;String&gt; processedBeans = new HashSet&lt;String&gt;(); // Âà§Êñ≠beanFactoryÁ±ªÂûãÊòØÂê¶‰∏∫BeanDefinitionRegistryÔºåÂè™ÊúâBeanDefinitionRegistryÁ±ªÂûãÁöÑÊâçÊîØÊåÅBeanDefinitionRegistryPostProcessorÁöÑÊ≥®ÂÜå if (beanFactory instanceof BeanDefinitionRegistry) &#123; BeanDefinitionRegistry registry = (BeanDefinitionRegistry) beanFactory; // Â≠òÊîæÊâãÂä®Âä†ÂÖ•ÁöÑ BeanFactoryPostProcessor List&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = new LinkedList&lt;BeanFactoryPostProcessor&gt;(); // Â≠òÊîæÊâãÂä®Âä†ÂÖ•ÁöÑ BeanDefinitionRegistryPostProcessor List&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = new LinkedList&lt;BeanDefinitionRegistryPostProcessor&gt;(); for (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) &#123; // Â¶ÇÊûúÊòØBeanDefinitionRegistryPostProcessorÁ±ªÂûã if (postProcessor instanceof BeanDefinitionRegistryPostProcessor) &#123; BeanDefinitionRegistryPostProcessor registryProcessor = (BeanDefinitionRegistryPostProcessor) postProcessor; // ÊâßË°å postProcessBeanDefinitionRegistry ÊñπÊ≥ï registryProcessor.postProcessBeanDefinitionRegistry(registry); // ÊîæÂÖ•ÂæÖÊâßË°åÂÆπÂô®‰∏≠Ôºå‰πãÂêé‰ºöÊâßË°åBeanFactoryPostProcessorÊé•Âè£ÁöÑpostProcessBeanFactoryÊñπÊ≥ï registryProcessors.add(registryProcessor); &#125; else &#123; // ÊîæÂÖ•ÂæÖÊâßË°åÂÆπÂô®‰∏≠Ôºå‰πãÂêéÁªü‰∏ÄÊâßË°å regularPostProcessors.add(postProcessor); &#125; &#125; // Do not initialize FactoryBeans here: We need to leave all regular beans // uninitialized to let the bean factory post-processors apply to them! // Separate between BeanDefinitionRegistryPostProcessors that implement // PriorityOrdered, Ordered, and the rest. // Áî®‰∫éÂ≠òÊîæÂΩìÂâçÈúÄË¶ÅÊâßË°åÁöÑ BeanDefinitionRegistryPostProcessor list List&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = new ArrayList&lt;BeanDefinitionRegistryPostProcessor&gt;(); // First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered. // ‰∏Ä ÂÖàÊâßË°åÁ±ªÂûã‰∏∫ PriorityOrdered ÁöÑBeanDefinitionRegistryPostProcessors String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false); for (String ppName : postProcessorNames) &#123; if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123; currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class)); processedBeans.add(ppName); &#125; &#125; // ÊéíÂ∫è sortPostProcessors(currentRegistryProcessors, beanFactory); // Â∞ÜÂΩìÂâçÈúÄË¶ÅÊâßË°åÂÖ®ÈÉ®ÊîæÂÖ• ÂæÖÊâßË°åÂÆπÂô® registryProcessors.addAll(currentRegistryProcessors); // ÊâßË°å invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry); // Ê∏ÖÁ©∫Â∑≤ÁªèÊâßË°åËøáÁöÑ currentRegistryProcessors.clear(); // Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered. // ‰∫å Âú®ÊâßË°åÁ±ªÂûã‰∏∫OrderedÁöÑBeanDefinitionRegistryPostProcessor postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false); for (String ppName : postProcessorNames) &#123; if (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) &#123; currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class)); processedBeans.add(ppName); &#125; &#125; sortPostProcessors(currentRegistryProcessors, beanFactory); registryProcessors.addAll(currentRegistryProcessors); invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry); currentRegistryProcessors.clear(); // Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear. // ÊúÄÂêéÊâßË°åÊôÆÈÄöÁöÑ BeanDefinitionRegistryPostProcessors boolean reiterate = true; // Âæ™ÁéØÁöÑÁõÆÁöÑÊòØÊú™‰∫ÜÈò≤Ê≠¢ÊâßË°åËøáÁ®ã‰∏≠ÊúâÊñ∞ÁöÑ postProcessorNames Âä†ÂÖ• while (reiterate) &#123; reiterate = false; postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, true, false); for (String ppName : postProcessorNames) &#123; if (!processedBeans.contains(ppName)) &#123; currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class)); processedBeans.add(ppName); reiterate = true; &#125; &#125; sortPostProcessors(currentRegistryProcessors, beanFactory); registryProcessors.addAll(currentRegistryProcessors); invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry); currentRegistryProcessors.clear(); &#125; // Now, invoke the postProcessBeanFactory callback of all processors handled so far. // ÊâßË°åÂæÖÊâßË°åÂÆπÂô®ÁöÑ‰∏≠ÁöÑ BeanFactoryPostProcessor invokeBeanFactoryPostProcessors(registryProcessors, beanFactory); invokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory); &#125; else &#123; // Invoke factory processors registered with the context instance. // Áõ¥Êé•ÊâßË°åÊâãÂä®Âä†ÂÖ•ÁöÑ BeanFactoryPostProcessor invokeBeanFactoryPostProcessors(beanFactoryPostProcessors, beanFactory); &#125; // ‰ª•‰∏äÊâßË°åÂÆåBeanDefinitionRegistryPostProcessorÔºåÁé∞Âú®ÂºÄÂßãÊâßË°åBeanFactoryPostProcessor String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanFactoryPostProcessor.class, true, false); // ÊâßË°åÈ°∫Â∫èÂíåBeanDefinitionRegistryPostProcessorÂü∫Êú¨‰∏ÄËá¥ÔºåÂÖàPriorityOrderedÔºåÂÜçOrderedÔºåÊúÄÂêéÊôÆÈÄöÁöÑ List&lt;BeanFactoryPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;BeanFactoryPostProcessor&gt;(); // Â≠òÊîæ PriorityOrderedÁ±ªÂûãÁöÑBeanFactoryPostProcessor List&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;String&gt;(); // Â≠òÊîæ OrderedÁ±ªÂûãÁöÑBeanFactoryPostProcessor List&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;String&gt;(); for (String ppName : postProcessorNames) &#123; if (processedBeans.contains(ppName)) &#123; // ËøôÈáåË∑≥ËøáÁöÑÊòØÂ∑≤ÁªèÊâßË°åËøáÁöÑ BeanDefinitionRegistryPostProcessor // skip - already processed in first phase above &#125; else if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123; priorityOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class)); &#125; else if (beanFactory.isTypeMatch(ppName, Ordered.class)) &#123; orderedPostProcessorNames.add(ppName); &#125; else &#123; nonOrderedPostProcessorNames.add(ppName); &#125; &#125; // First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered. // ÂÖàÊâßË°å PriorityOrdered sortPostProcessors(priorityOrderedPostProcessors, beanFactory); invokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory); // Next, invoke the BeanFactoryPostProcessors that implement Ordered. // ÂÜçÊâßË°å Ordered List&lt;BeanFactoryPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;BeanFactoryPostProcessor&gt;(); for (String postProcessorName : orderedPostProcessorNames) &#123; orderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class)); &#125; sortPostProcessors(orderedPostProcessors, beanFactory); invokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory); // Finally, invoke all other BeanFactoryPostProcessors. // ÊúÄÂêéÊâßË°åÊôÆÈÄöÁöÑ List&lt;BeanFactoryPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;BeanFactoryPostProcessor&gt;(); for (String postProcessorName : nonOrderedPostProcessorNames) &#123; nonOrderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class)); &#125; invokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory); // Clear cached merged bean definitions since the post-processors might have // modified the original metadata, e.g. replacing placeholders in values... beanFactory.clearMetadataCache();&#125; Ëøô‰∏™ÊñπÊ≥ï‰ª£Á†ÅÈùûÂ∏∏ÁöÑÂ§öÔºåÂ§πÊùÇÁùÄÂêÑÁßçÂà§Êñ≠ÔºåÁúãÁöÑÁúºËä±Áº≠‰π±„ÄÇÊàë‰ª¨ÁÆÄÂçïÁêÜ‰∏Ä‰∏ãÈÄªËæë BeanFactoryPostProcessorÊúâ‰∏Ä‰∏™Â≠êÊé•Âè£Âè´ÂÅöBeanDefinitionRegistryPostProcessorÔºåÂÆÉÁöÑ‰ºòÂÖàÁ∫ßÊòØÊØîBeanFactoryPostProcessorÈ´òÁöÑ ÊñπÊ≥ïÁöÑÂÖ•ÂèÇÈáåÊúâ‰∏Ä‰∏™List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessorsÔºåËøô‰∏™ÊòØÂÆπÂô®ÈÄöËøáaddBeanFactoryPostProcessorÊñπÊ≥ïÊâãÂä®Âä†ÂÖ•ÁöÑ„ÄÇËøôÈáåÁöÑBeanDefinitionRegistryPostProcessorÁ±ªÂûãÊòØ‰ºòÂÖàÁ∫ßÊúÄÈ´òÁöÑ ÂêåÊó∂BeanFactoryPostProcessorÂíåBeanDefinitionRegistryPostProcessorÂèØ‰ª•ÈÉΩÂÆûÁé∞‰∏§‰∏™Êé•Âè£(PriorityOrdered,Ordered)Áî®Êù•ÂÆö‰πâÊâßË°åÁöÑÈ°∫Â∫èÔºåÂÖ∂‰∏≠PriorityOrdered‰ºòÂÖàÁ∫ßÊúÄÈ´òÔºåÂÖ∂Ê¨°OrderedÔºåÊúÄÂêéÊòØÊ≤°ÊúâÂÆûÁé∞‰ªª‰ΩïOrderÊé•Âè£ÁöÑ Áªº‰∏ä‰∏âÁÇπÔºåÊàë‰ª¨ÊòØÂèØ‰ª•ÂæóÂá∫‰∏äÈù¢‰∏ÄÂ§ßÂù®‰ª£Á†ÅÁöÑÊâßË°åÈ°∫Â∫è‰∫Ü È¶ñÂÖàÊòØÊãøÂà∞ÊâãÂä®Âä†ÂÖ•ÁöÑBeanFactoryPostProcessorÔºåÊåëÂá∫ÈáåÈù¢ÁöÑBeanDefinitionRegistryPostProcessorÁ±ªÂûãÔºå‰ºòÂÖàÊâßË°å„ÄÇ ÂÜçÊãøÂà∞ÂÆπÂô®‰∏≠ÁöÑÂÖ®ÈÉ®BeanDefinitionRegistryPostProcessorsÔºåÊåâÁÖßÂÆûÁé∞ÁöÑÊéíÂ∫èÊé•Âè£È°∫Â∫èÊâßË°å ÊâßË°åBeanDefinitionRegistryPostProcessorsÁà∂Á±ªÂûãBeanFactoryPostProcessorÁöÑÊñπÊ≥ï ÊúÄÂêéÂÜçÊãøÂà∞ÂÆπÂô®‰∏≠ÂÖ®ÈÉ®BeanFactoryPostProcessorsÂπ∂ËøáÊª§Âà∞Â∑≤ÁªèÊâßË°åËøáÁöÑBeanDefinitionRegistryPostProcessorsÔºåÊåâÁÖßÈ°∫Â∫è‰æùÊ¨°ÊâßË°å registerBeanPostProcessors(beanFactory)ËøôÈáå‰πüÊòØspringÁöÑ‰∏Ä‰∏™Êâ©Â±ïÁÇπÔºåÈÄöËøáÂÆûÁé∞BeanPostProcessorÊé•Âè£Êù•ÂÆûÁé∞Ëá™ÂÆö‰πâÈÄªËæëÔºåÂÖ∑‰ΩìÁöÑÊâßË°åÊó∂Êú∫Ôºå‰ºöÂú®ÂàÜÊûêgetBaanÊó∂ËÆ≤Âà∞ÔºåËøôÈáåÁöÑÈÄªËæë‰ªÖ‰ªÖÊòØÂ∞ÜBeanPostProcessorÁî®Êà∑Ëá™ÂÆö‰πâÁöÑBeanPostProcessorÊ≥®ÂÜåÂà∞ÂÆπÂô® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public static void registerBeanPostProcessors( ConfigurableListableBeanFactory beanFactory, AbstractApplicationContext applicationContext) &#123; String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanPostProcessor.class, true, false); // Register BeanPostProcessorChecker that logs an info message when // a bean is created during BeanPostProcessor instantiation, i.e. when // a bean is not eligible for getting processed by all BeanPostProcessors. int beanProcessorTargetCount = beanFactory.getBeanPostProcessorCount() + 1 + postProcessorNames.length; beanFactory.addBeanPostProcessor(new BeanPostProcessorChecker(beanFactory, beanProcessorTargetCount)); // Separate between BeanPostProcessors that implement PriorityOrdered, // Ordered, and the rest. List&lt;BeanPostProcessor&gt; priorityOrderedPostProcessors = new ArrayList&lt;BeanPostProcessor&gt;(); List&lt;BeanPostProcessor&gt; internalPostProcessors = new ArrayList&lt;BeanPostProcessor&gt;(); List&lt;String&gt; orderedPostProcessorNames = new ArrayList&lt;String&gt;(); List&lt;String&gt; nonOrderedPostProcessorNames = new ArrayList&lt;String&gt;(); for (String ppName : postProcessorNames) &#123; if (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123; BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class); priorityOrderedPostProcessors.add(pp); if (pp instanceof MergedBeanDefinitionPostProcessor) &#123; internalPostProcessors.add(pp); &#125; &#125; else if (beanFactory.isTypeMatch(ppName, Ordered.class)) &#123; orderedPostProcessorNames.add(ppName); &#125; else &#123; nonOrderedPostProcessorNames.add(ppName); &#125; &#125; // First, register the BeanPostProcessors that implement PriorityOrdered. sortPostProcessors(priorityOrderedPostProcessors, beanFactory); registerBeanPostProcessors(beanFactory, priorityOrderedPostProcessors); // Next, register the BeanPostProcessors that implement Ordered. List&lt;BeanPostProcessor&gt; orderedPostProcessors = new ArrayList&lt;BeanPostProcessor&gt;(); for (String ppName : orderedPostProcessorNames) &#123; BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class); orderedPostProcessors.add(pp); if (pp instanceof MergedBeanDefinitionPostProcessor) &#123; internalPostProcessors.add(pp); &#125; &#125; sortPostProcessors(orderedPostProcessors, beanFactory); registerBeanPostProcessors(beanFactory, orderedPostProcessors); // Now, register all regular BeanPostProcessors. List&lt;BeanPostProcessor&gt; nonOrderedPostProcessors = new ArrayList&lt;BeanPostProcessor&gt;(); for (String ppName : nonOrderedPostProcessorNames) &#123; BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class); nonOrderedPostProcessors.add(pp); if (pp instanceof MergedBeanDefinitionPostProcessor) &#123; internalPostProcessors.add(pp); &#125; &#125; registerBeanPostProcessors(beanFactory, nonOrderedPostProcessors); // Finally, re-register all internal BeanPostProcessors. sortPostProcessors(internalPostProcessors, beanFactory); registerBeanPostProcessors(beanFactory, internalPostProcessors); // Re-register post-processor for detecting inner beans as ApplicationListeners, // moving it to the end of the processor chain (for picking up proxies etc). beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(applicationContext));&#125; ËøôÈáåÁöÑÈÄªËæëÂÖ∂ÂÆûË∑ü‰∏äÈù¢ÁöÑÈÄªËæëÈùûÂ∏∏ÁöÑÁõ∏‰ººÔºåÂÖ∂ÂÆû‰πüÈÉΩÂú®‰∏Ä‰∏™class‰∏≠ÔºåÂîØ‰∏ÄÁöÑÂå∫Âà´ÊòØËøôÈáåÂπ∂Ê≤°ÊúâÊâßË°åÔºå‰ªÖ‰ªÖÂè™ÊòØÂÅö‰∫Ü‰∏ãÊéíÂ∫èÂêéÂ∞±Ê≥®ÂÜåËøõ‰∫ÜÂÆπÂô®‰∏≠ÔºåÁïôÂà∞ÂêéÈù¢ÁöÑÊ≠•È™§‰∏≠Âú®ÊâßË°å„ÄÇËøôÈáå‰πüÁÆÄÂçïÁöÑÂàó‰∏Ä‰∏ãËøôÈáåÁöÑË¶ÅÁÇπ BeanPostProcessorÊúâ‰∏Ä‰∏™Â≠êÊé•Âè£MergedBeanDefinitionPostProcessor,Ëøô‰∏™ÊòØÊúÄÊôöË¢´Ê≥®ÂÜåËøõÂÆπÂô®ÁöÑ ÂêåÊ†∑ÂèØ‰ª•ÂÆûÁé∞(PriorityOrdered,Ordered)Êé•Âè£Áî®Êù•ÂÆö‰πâÊâßË°åÁöÑÈ°∫Â∫è initMessageSource()ÂõΩÈôÖÂåñÁõ∏ÂÖ≥ÔºåËøôÈáåÂ∞±‰∏çÂÅö‰ªîÁªÜÂàÜÊûê‰∫Ü initApplicationEventMulticaster()È°æÂêçÊÄù‰πâ„ÄÇÂ∞±ÊòØspringÁî®Êù•ÂàùÂßãÂåñ‰∫ãÊÉÖÂπøÊí≠Âô®ÁöÑ 12345678910111213141516171819protected void initApplicationEventMulticaster() &#123; ConfigurableListableBeanFactory beanFactory = getBeanFactory(); if (beanFactory.containsLocalBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME)) &#123; this.applicationEventMulticaster = beanFactory.getBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, ApplicationEventMulticaster.class); if (logger.isDebugEnabled()) &#123; logger.debug("Using ApplicationEventMulticaster [" + this.applicationEventMulticaster + "]"); &#125; &#125; else &#123; this.applicationEventMulticaster = new SimpleApplicationEventMulticaster(beanFactory); beanFactory.registerSingleton(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, this.applicationEventMulticaster); if (logger.isDebugEnabled()) &#123; logger.debug("Unable to locate ApplicationEventMulticaster with name '" + APPLICATION_EVENT_MULTICASTER_BEAN_NAME + "': using default [" + this.applicationEventMulticaster + "]"); &#125; &#125;&#125; Áúã‰∏Ä‰∏ãËøôÈáåÁöÑ‰ª£Á†ÅÊØîËæÉÁöÑÁÆÄÂçïÔºåÂ∞±ÊòØ‰∏Ä‰∏™ if elseÔºåÂÖàÂ∞ùËØïËé∑ÂèñÂêçÂ≠ó‰∏∫APPLICATION_EVENT_MULTICASTER_BEAN_NAMEÁ±ªÂûã‰∏∫ApplicationEventMulticasterÁöÑ beanÔºåÂ¶ÇÊûúÊ≤°ÊúâËé∑ÂèñÂà∞ÔºåÂàôÈÖçÁΩÆ‰∏Ä‰∏™ÈªòËÆ§ÁöÑbean (SimpleApplicationEventMulticaster) onRefresh()ËøôÈáåÊòØÁïôÁªôÂ≠êÁ±ªÂÆûÁé∞ÁöÑÔºåÊ≤°Êúâ‰ªÄ‰πàÈÄªËæë registerListeners()Ê≥®ÂÜå‰∏Ä‰∫õÁõëÂê¨Âô® 12345678910111213141516171819202122protected void registerListeners() &#123; // Register statically specified listeners first. for (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) &#123; getApplicationEventMulticaster().addApplicationListener(listener); &#125; // Do not initialize FactoryBeans here: We need to leave all regular beans // uninitialized to let post-processors apply to them! String[] listenerBeanNames = getBeanNamesForType(ApplicationListener.class, true, false); for (String listenerBeanName : listenerBeanNames) &#123; getApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName); &#125; // Publish early application events now that we finally have a multicaster... Set&lt;ApplicationEvent&gt; earlyEventsToProcess = this.earlyApplicationEvents; this.earlyApplicationEvents = null; if (earlyEventsToProcess != null) &#123; for (ApplicationEvent earlyEvent : earlyEventsToProcess) &#123; getApplicationEventMulticaster().multicastEvent(earlyEvent); &#125; &#125;&#125; Â∞æË®Ä ‰∏ãÁØá‰ºöËß£ÊûêfinishBeanFactoryInitializationÊñπÊ≥ïÔºåÂπ∂‰∏î‰ºöÁùÄÈáçËÆ≤Ëß£ÂàùÂßãÂåñbeanÁöÑÊï¥‰∏™ÁîüÂëΩÂë®Êúü]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Ê∫êÁ†ÅËß£Êûê‰∏âÔºàBeanDefinitionsÁöÑËΩΩÂÖ•Ê≥®ÂÜåÔºâ]]></title>
    <url>%2F2018%2F10%2F20%2FSpring-IOC-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%89%EF%BC%88BeanDefinitions%E7%9A%84%E8%BD%BD%E5%85%A5%E6%B3%A8%E5%86%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä ËøôÊúü‰∏ªË¶ÅÊòØËß£ÊûêBeanDefinitionsÁöÑËΩΩÂÖ•ÂíåÊ≥®ÂÜåÁöÑÊï¥‰∏™ËøáÁ®ãÔºåÊï¥‰∏™ËøáÁ®ãÁúã‰ººÈùûÂ∏∏Â§çÊùÇÔºåÂÖ∂ÂÆûÊàë‰ª¨ÂèØ‰ª•ÂàÜÊàêÂá†‰∏™ÈÉ®ÂàÜÂéªÁúã: 1.ËΩΩÂÖ• 2.Ê≥®ÂÜåÂíåËß£ÊûêÂ¶ÇÊûúÊ≤°ÊúâÁúãËøáÂâçÈù¢Âá†ÊúüÁöÑËØùÔºåÂª∫ËÆÆÂÖàËøá‰∏Ä‰∏ãÂâçÈù¢Âá†Êúü ‰∏∫‰∫ÜÂ∏ÆÂä©Â§ßÂÆ∂ÁêÜÊ∏ÖÊï¥‰∏™Ë∞ÉÁî®ËøáÁ®ãÔºåÁÆÄÂçïÁöÑÁîª‰∫Ü‰∏Ä‰∏™Âõæ ÂÖ≥ÈîÆÁ±ª XmlBeanDefinitionReader AbstractBeanDefinitionReader xmlÈÖçÁΩÆÂΩ¢ÂºèÁöÑBeanDefinitionÁöÑËØªÂèñÂô® XmlReaderContext Ëß£ÊûêËøáÁ®ãÁöÑ‰∏ä‰∏ãÊñáÂØπË±°ÔºåÂÆûÈôÖÊåÅÊúâBeanFactoryÂØπË±°Áî®‰∫éBeanDefinitionsÁöÑÂõûË∞ÉÊ≥®ÂÜå DefaultBeanDefinitionDocumentReader Ëß£ÊûêxmlÊñá‰ª∂ÊäΩË±°ÊàêDocmentÂØπË±° BeanDefinitionParserDelegate ‰∏ªË¶ÅËß£ÊûêËøáÁ®ã DefaultNamespaceHandlerResolver Ëá™ÂÆö‰πâÈÖçÁΩÆÊñá‰ª∂Ëß£ÊûêÂô®Âä†ËΩΩÂô® BeanDefinitionsÁöÑËΩΩÂÖ•loadBeanDefinitions(String‚Ä¶ locations) Ëøô‰∏™ÊñπÊ≥ïÊòØÊØîËæÉÁÆÄÂçïÂú®AbstractBeanDefinitionReader‰∏≠ÔºåÂè™ÊòØÊèê‰æõ‰∫Ü‰∏Ä‰∏™ÂÖ•Âè£ 1234567891011121314public int loadBeanDefinitions(String... locations) throws BeanDefinitionStoreException &#123; Assert.notNull(locations, "Location array must not be null"); int counter = 0; String[] var3 = locations; int var4 = locations.length; for(int var5 = 0; var5 &lt; var4; ++var5) &#123; String location = var3[var5]; // ÂºÄÂßãËΩΩÂÖ•ÈÖçÁΩÆ‰ø°ÊÅØ counter += this.loadBeanDefinitions(location); &#125; return counter;&#125; loadBeanDefinitions(String location, Set actualResources) Ëøô‰∏™ÊñπÊ≥ïÂêåÊ†∑Âú®AbstractBeanDefinitionReader‰∏≠Ë¢´Ë∞ÉÁî®ÔºåÁúã‰ª£Á†ÅÂèØÁü•Â∞±ÊòØËé∑ÂèñÊåÅÊúâÁöÑResourceLoaderÂØπË±°Âπ∂Ë∞ÉÁî®getResourcesÊñπÊ≥ï„ÄÇËøîÂõûÂèØ‰ª•Ë¢´BeanDefinitionReaderËß£ÊûêÁöÑResourceÁ±ªÂûã„ÄÇ ËøôÈáåË¶ÅÊ≥®ÊÑèÊåÅÊúâÁöÑResourceLoaderÂØπË±°ÊòØÂú®ÂàõÂª∫XmlBeanDefinitionReaderÊó∂ÊâÄ‰º†ÂÖ•ÁöÑÂÆπÂô®Êú¨Ë∫´ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public int loadBeanDefinitions(String location, Set&lt;Resource&gt; actualResources) throws BeanDefinitionStoreException &#123; // Ëé∑Âèñ ResourceLoader ResourceLoader resourceLoader = this.getResourceLoader(); if(resourceLoader == null) &#123; throw new BeanDefinitionStoreException("Cannot import bean definitions from location [" + location + "]: no ResourceLoader available"); &#125; else &#123; int loadCount; // Âà§Êñ≠ resourceLoader ÁöÑÁ±ªÂûãÊòØÂê¶Â±û‰∫éResourcePatternResolverÁ±ªÂûã if(!(resourceLoader instanceof ResourcePatternResolver)) &#123; Resource resource = resourceLoader.getResource(location); // Ë∞ÉÁî®Â≠êÁ±ªÁöÑ loadBeanDefinitions(resource) ÊñπÊ≥ï loadCount = this.loadBeanDefinitions((Resource)resource); if(actualResources != null) &#123; actualResources.add(resource); &#125; if(this.logger.isDebugEnabled()) &#123; this.logger.debug("Loaded " + loadCount + " bean definitions from location [" + location + "]"); &#125; return loadCount; &#125; else &#123; try &#123; Resource[] resources = ((ResourcePatternResolver)resourceLoader).getResources(location); // Âæ™ÁéØÈÅçÂéÜËΩΩÂÖ• loadCount = this.loadBeanDefinitions(resources); if(actualResources != null) &#123; Resource[] var6 = resources; int var7 = resources.length; for(int var8 = 0; var8 &lt; var7; ++var8) &#123; Resource resource = var6[var8]; actualResources.add(resource); &#125; &#125; if(this.logger.isDebugEnabled()) &#123; this.logger.debug("Loaded " + loadCount + " bean definitions from location pattern [" + location + "]"); &#125; return loadCount; &#125; catch (IOException var10) &#123; throw new BeanDefinitionStoreException("Could not resolve bean definition resource pattern [" + location + "]", var10); &#125; &#125; &#125;&#125; loadBeanDefinitions(EncodedResource encodedResource) Ëé∑ÂèñÂà∞XMLÊñá‰ª∂ÁöÑinputStreamÊµÅ 1234567891011121314151617181920212223242526272829303132333435363738394041public int loadBeanDefinitions(EncodedResource encodedResource) throws BeanDefinitionStoreException &#123; Assert.notNull(encodedResource, "EncodedResource must not be null"); if (logger.isInfoEnabled()) &#123; logger.info("Loading XML bean definitions from " + encodedResource.getResource()); &#125; Set&lt;EncodedResource&gt; currentResources = this.resourcesCurrentlyBeingLoaded.get(); if (currentResources == null) &#123; currentResources = new HashSet&lt;EncodedResource&gt;(4); this.resourcesCurrentlyBeingLoaded.set(currentResources); &#125; if (!currentResources.add(encodedResource)) &#123; throw new BeanDefinitionStoreException( "Detected cyclic loading of " + encodedResource + " - check your import definitions!"); &#125; try &#123; // Ëé∑ÂèñÂà∞XMLÊñá‰ª∂ÁöÑinputStreamÊµÅ InputStream inputStream = encodedResource.getResource().getInputStream(); try &#123; InputSource inputSource = new InputSource(inputStream); if (encodedResource.getEncoding() != null) &#123; inputSource.setEncoding(encodedResource.getEncoding()); &#125; // ËøõË°åÂÖ∑‰ΩìÁöÑxmlÊñá‰ª∂ÊµÅËß£Êûê return doLoadBeanDefinitions(inputSource, encodedResource.getResource()); &#125; finally &#123; inputStream.close(); &#125; &#125; catch (IOException ex) &#123; throw new BeanDefinitionStoreException( "IOException parsing XML document from " + encodedResource.getResource(), ex); &#125; finally &#123; currentResources.remove(encodedResource); if (currentResources.isEmpty()) &#123; this.resourcesCurrentlyBeingLoaded.remove(); &#125; &#125;&#125; doLoadBeanDefinitions(InputSource inputSource, Resource resource) doLoadDocument(inputSource, resource) Ëß£ÊûêËøîÂõûDocumentÂØπË±° registerBeanDefinitions(doc, resource) ‰ΩøÁî® ÂºÄÂßãÊ≥®ÂÜå BeanDefinitions ÁöÑËøáÁ®ã 12345678910111213141516171819202122232425262728293031323334class = org.springframework.beans.factory.xml.XmlBeanDefinitionReaderprotected int doLoadBeanDefinitions(InputSource inputSource, Resource resource) throws BeanDefinitionStoreException &#123; try &#123; // Ëß£ÊûêxmlÂπ∂ËøîÂõûDocumentÂØπË±°ÔºåËøôÈáåËß£ÊûêÁî±DefaultDocumentLoaderÂÆåÊàê Document doc = doLoadDocument(inputSource, resource); // Ëß£Êûê DocumentÂØπË±°Âπ∂Ê≥®ÂÜå return registerBeanDefinitions(doc, resource); &#125; catch (BeanDefinitionStoreException ex) &#123; throw ex; &#125; catch (SAXParseException ex) &#123; throw new XmlBeanDefinitionStoreException(resource.getDescription(), "Line " + ex.getLineNumber() + " in XML document from " + resource + " is invalid", ex); &#125; catch (SAXException ex) &#123; throw new XmlBeanDefinitionStoreException(resource.getDescription(), "XML document from " + resource + " is invalid", ex); &#125; catch (ParserConfigurationException ex) &#123; throw new BeanDefinitionStoreException(resource.getDescription(), "Parser configuration exception parsing XML from " + resource, ex); &#125; catch (IOException ex) &#123; throw new BeanDefinitionStoreException(resource.getDescription(), "IOException parsing XML document from " + resource, ex); &#125; catch (Throwable ex) &#123; throw new BeanDefinitionStoreException(resource.getDescription(), "Unexpected exception parsing XML document from " + resource, ex); &#125;&#125; BeanDefinitionsÁöÑËß£Êûê‰∏éÊ≥®ÂÜåregisterBeanDefinitions(doc, resource) ÂàõÂª∫ DefaultBeanDefinitionDocumentReaderÔºåËß£ÊûêxmlËµÑÊ∫êÊñá‰ª∂ ÂàõÂª∫ XmlReaderContext ‰∏ä‰∏ãÊñáÂØπË±°ÔºåÊåÅÊúâËµÑÊ∫êÊú¨Ë∫´ÔºåÊåÅÊúâDefaultNamespaceHandlerResolverÂØπË±°ÔºåÁî®Êù•Âä†ËΩΩËß£ÊûêÂá≠ÊçÆÔºàË¶ÅÊÄé‰πàËß£ÊûêÁî±Ëß£ÊûêÂá≠ÊçÆÔºàNamespaceHandlerÔºâÂÜ≥ÂÆöÔºâ 123456789101112131415161718192021222324252627282930313233343536class = org.springframework.beans.factory.xml.XmlBeanDefinitionReaderpublic int registerBeanDefinitions(Document doc, Resource resource) throws BeanDefinitionStoreException &#123; // ÂàõÂª∫ DefaultBeanDefinitionDocumentReader Ëß£ÊûêxmlËµÑÊ∫êÊñá‰ª∂ BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader(); int countBefore = getRegistry().getBeanDefinitionCount(); // ÂÖ∑‰ΩìÁöÑËß£ÊûêÂºÄÂßã documentReader.registerBeanDefinitions(doc, createReaderContext(resource)); return getRegistry().getBeanDefinitionCount() - countBefore;&#125;/** * ÂàõÂª∫‰∏ä‰∏ãÊñáÂØπË±° */public XmlReaderContext createReaderContext(Resource resource) &#123; // ÂàõÂª∫‰∏ä‰∏ãÊñáÂØπË±° ÊåÅÊúâXmlBeanDefinitionReader ÂØπË±° return new XmlReaderContext(resource, this.problemReporter, this.eventListener, this.sourceExtractor, this, getNamespaceHandlerResolver());&#125;/** * ÂàõÂª∫XMlÂëΩÂêçÁ©∫Èó¥Ëß£Êûê‰ª£ÁêÜÁ±ªÔºåËß£ÊûêXMLÊñá‰ª∂ÁöÑ‰æùÊçÆ„ÄÇÂèØ‰ª•Ëß£ÊûêËá™ÂÆö‰πâXMLÊñá‰ª∂ */public NamespaceHandlerResolver getNamespaceHandlerResolver() &#123; if (this.namespaceHandlerResolver == null) &#123; this.namespaceHandlerResolver = createDefaultNamespaceHandlerResolver(); &#125; return this.namespaceHandlerResolver;&#125;/** * ÂàõÂª∫ÈªòËÆ§ÁöÑÂëΩÂêçÁ©∫Èó¥Ëß£Êûê‰ª£ÁêÜÁ±ª */protected NamespaceHandlerResolver createDefaultNamespaceHandlerResolver() &#123; return new DefaultNamespaceHandlerResolver(getResourceLoader().getClassLoader());&#125; doRegisterBeanDefinitions(Element root) ÂàõÂª∫BeanDefinitionParserDelegate Ëß£ÊûêÂô®ÔºåÂπ∂Âä†ËΩΩÈªòËÆ§ÈÖçÁΩÆÔºàÔºâËß£ÊûêÂô®ÊåÅÊúâ‰∏ä‰∏ãÊñáÂØπË±° 123456789101112131415161718192021222324252627282930313233343536class = org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReaderpublic void registerBeanDefinitions(Document doc, XmlReaderContext readerContext) &#123; this.readerContext = readerContext; this.logger.debug("Loading bean definitions"); Element root = doc.getDocumentElement(); // Ëß£ÊûêÊ†πËäÇÁÇπ this.doRegisterBeanDefinitions(root);&#125;protected void doRegisterBeanDefinitions(Element root) &#123; BeanDefinitionParserDelegate parent = this.delegate; this.delegate = this.createDelegate(this.getReaderContext(), root, parent); // Âà§Êñ≠ËäÇÁÇπÊâÄÂ±ûÂëΩÂêçÁ©∫Èó¥ÊòØÂê¶‰∏∫springÈªòËÆ§(http://www.springframework.org/schema/beans) if(this.delegate.isDefaultNamespace(root)) &#123; String profileSpec = root.getAttribute("profile"); if(StringUtils.hasText(profileSpec)) &#123; String[] specifiedProfiles = StringUtils.tokenizeToStringArray(profileSpec, ",; "); if(!this.getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) &#123; if(this.logger.isInfoEnabled()) &#123; this.logger.info("Skipped XML bean definition file due to specified profiles [" + profileSpec + "] not matching: " + this.getReaderContext().getResource()); &#125; return; &#125; &#125; &#125; // Á©∫ÂÆûÁé∞ this.preProcessXml(root); // ÂºÄÂßãËß£ÊûêÊ†πËäÇÁÇπ this.parseBeanDefinitions(root, this.delegate); // Á©∫ÂÆûÁé∞ this.postProcessXml(root); // ËµãÂÄºÁîüÊàêÁöÑÁà∂ÂØπË±°„ÄÇÂê´ÊúâÈªòËÆ§ÈÖçÁΩÆ this.delegate = parent;&#125; parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) Âà§Êñ≠ÊòØÂê¶‰∏∫SpringÈªòËÆ§ÁöÑÂëΩÂêçÁ©∫Èó¥ÈÖçÁΩÆÔºåÂä†ËΩΩ‰∏çÂêåÁöÑËß£ÊûêÊñπÊ≥ï„ÄÇÈªòËÆ§ÂëΩÂêçÁ©∫Èó¥‰ºöÊâßË°åparseDefaultElementÊñπÊ≥ïÔºåÂ¶ÇÊûúÊòØÁî®Êà∑Ëá™ÂÆö‰πâÁöÑÂàô‰ºöÊâßË°å BeanDefinitionParserDelegateÁöÑ parseCustomElementÊñπÊ≥ï 1234567891011121314151617181920212223242526class = org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReaderprotected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) &#123; // Âà§Êñ≠ÊòØÂê¶‰∏∫ÈªòËÆ§ÂëΩÂêçÁ©∫Èó¥ if(delegate.isDefaultNamespace(root)) &#123; NodeList nl = root.getChildNodes(); for(int i = 0; i &lt; nl.getLength(); ++i) &#123; Node node = nl.item(i); if(node instanceof Element) &#123; Element ele = (Element)node; if(delegate.isDefaultNamespace(ele)) &#123; // ÈªòËÆ§Ëß£Êûê this.parseDefaultElement(ele, delegate); &#125; else &#123; // ÊâßË°åËá™ÂÆö‰πâËß£ÊûêÊñπÊ≥ï delegate.parseCustomElement(ele); &#125; &#125; &#125; &#125; else &#123; // ÊâßË°åËá™ÂÆö‰πâËß£ÊûêÊñπÊ≥ï delegate.parseCustomElement(root); &#125;&#125; ÈªòËÆ§Ëß£ÊûêparseDefaultElement spirngÈªòËÆ§ÁöÑËß£ÊûêËßÑÂàôÔºåÂèØ‰ª•ÁúãÂà∞ËøôÈáåÊúâÂæàÂ§öÊàë‰ª¨ÁÜüÊÇâÁöÑÊ†áÁ≠æÂÖÉÁ¥†ÔºåÊØîÂ¶Çbean, importÁ≠âÔºåÂØπÂ∫îËøô‰∫õÊ†áÁ≠æÔºåspringÈÉΩÊúâ‰∏ìÈó®ÁöÑËß£ÊûêËßÑÂàô„ÄÇbean Ê†áÁ≠æÁöÑËß£ÊûêÂ∞±Áî±processBeanDefinitionÊù•ÂÆåÊàêËß£ÊûêËøáÁ®ãÔºåËøôÈáåÊàë‰ª¨ÁùÄÈáçÊù•Áúã‰∏ãbeanÁöÑËß£Êûê 123456789101112131415161718class = org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReaderprivate void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) &#123; // Ëß£ÊûêimportÊ†áÁ≠æ if(delegate.nodeNameEquals(ele, "import")) &#123; this.importBeanDefinitionResource(ele); &#125; else if(delegate.nodeNameEquals(ele, "alias")) &#123; // Ëß£ÊûêaliasÊ†áÁ≠æ this.processAliasRegistration(ele); &#125; else if(delegate.nodeNameEquals(ele, "bean")) &#123; // Ëß£ÊûêbeanÊ†áÁ≠æ this.processBeanDefinition(ele, delegate); &#125; else if(delegate.nodeNameEquals(ele, "beans")) &#123; // Ëß£ÊûêbeansÊ†áÁ≠æ this.doRegisterBeanDefinitions(ele); &#125;&#125; processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) Ëß£ÊûêBeanDefinitionÂπ∂ËÆæÁΩÆÂà∞BeanDefinitionHolder‰∏≠Âéª Ê≥®ÂÜåÂà∞beanFactoryÁöÑBeanDefinitonÂÆπÂô®‰∏≠Âéª(ÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™map) 12345678910111213141516171819class = org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReaderprotected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) &#123; // Ëß£ÊûêÂπ∂ÂåÖË£ÖÊàêBeanDefinitionHolder BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele); if(bdHolder != null) &#123; bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder); try &#123; // ÂêëÂÆπÂô®Ê≥®ÂÜå BeanDefinitonÔºåXmlReaderContextÂÖ∂ÂÆûÊòØÊåÅÊúâÂÆπÂô®ÁöÑÂºïÁî®ÁöÑ BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, this.getReaderContext().getRegistry()); &#125; catch (BeanDefinitionStoreException var5) &#123; this.getReaderContext().error("Failed to register bean definition with name '" + bdHolder.getBeanName() + "'", ele, var5); &#125; this.getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder)); &#125;&#125; parseBeanDefinitionElement ÊÑüÂÖ¥Ë∂£ÁöÑÂêåÂ≠¶‰πüÂèØ‰ª•ÁªßÁª≠ÊääparseBeanDefinitionElementÁúã‰∏ÄÈÅçÔºåÂèØ‰ª•ÂèëÁé∞Â§ßÂ§öÊï∞ÈÉΩÊòØ‰∏éBeanÂÆö‰πâÁõ∏ÂÖ≥ÁöÑÊ†áÁ≠æËß£Êûê Ëá™ÂÆö‰πâËß£Êûê parseCustomElement ‰ªé‰∏ä‰∏ãÊñáËé∑Âèñ DefaultNamespaceHandlerResolver Âä†ËΩΩËá™ÂÆö‰πâËß£ÊûêÂá≠ÊçÆÁ±ª(NamespaceHandler)ÔºåDefaultNamespaceHandlerResolverÁ±ªÈÄöËøáÊü•ÁúãÊ∫êÁ†ÅÂèØÁü•ÂÖ∂‰ºöÂéªÊâÄÊúâMETA-INF/spring.handlersÁõÆÂΩï‰∏ãÂä†ËΩΩspring.handlersÊñá‰ª∂Ôºåspring.handlersÈÖçÁΩÆÁöÑÊòØÂØπÂ∫îÁöÑ‰∏çÂêåÂëΩÂêçÁ©∫Èó¥ÁöÑËß£ÊûêÁ±ª Ë∞ÉÁî®NamespaceHandlerÁöÑparseËß£ÊûêËá™ÂÆö‰πâxmlÈÖçÁΩÆ ÁúãÂà∞ËøôÈáåÂÖ∂ÂÆûÊàë‰ª¨Áü•ÈÅìspringÂú®ËøôÈáåÊòØÁïô‰∫Ü‰∏Ä‰∏™Êâ©Â±ïÁÇπÁöÑÔºåÂèØ‰ª•ÈÄöËøáËá™ÂÆö‰πâÈÖçÁΩÆÊñá‰ª∂Êù•ËøõË°åËá™ÂÆö‰πâËß£Êûê 12345678910111213141516171819class=org.springframework.beans.factory.xml.BeanDefinitionParserDelegatepublic BeanDefinition parseCustomElement(Element ele) &#123; return this.parseCustomElement(ele, (BeanDefinition)null);&#125;public BeanDefinition parseCustomElement(Element ele, BeanDefinition containingBd) &#123; // Ëé∑ÂèñÊâÄÂ±ûÁöÑÂëΩÂêçÁ©∫Èó¥Âú∞ÂùÄ String namespaceUri = this.getNamespaceURI(ele); // ‰∏ä‰∏ãÊñá‰∏≠Ëé∑ÂèñDefaultNamespaceHandlerResolver Âπ∂Ê†πÊçÆÂëΩÂêçÁ©∫Èó¥Âú∞ÂùÄËé∑ÂèñÂØπÂ∫îÁöÑ Handler NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri); if(handler == null) &#123; this.error("Unable to locate Spring NamespaceHandler for XML schema namespace [" + namespaceUri + "]", ele); return null; &#125; else &#123; // ÊâßË°åËß£ÊûêÔºàthis.readerContext ‰∏≠ÊåÅÊúâBeanFactoryÊ≥®ÂÜåÂØπË±°ÔºåÂèØ‰ª•ÂõûË∞ÉÊ≥®ÂÜåBeanDefinition‰ø°ÊÅØÔºâ return handler.parse(ele, new ParserContext(this.readerContext, this, containingBd)); &#125;&#125; Â∞æË®Ä BeanDefinitions Âà∞ËøôÈáå‰∏∫Ê≠¢Â∞±Ë¢´Ê≥®ÂÜåÂÆåÊàê‰∫ÜÔºå‰∏ãÊúüÂ∞±ÊòØSpringÈáçË¶ÅÁöÑ‰æùËµñÊ≥®ÂÖ•‰∫Ü]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Êï∞ÊçÆÂ∫ìËÆæËÆ°Ë¶ÅÊ≥®ÊÑèÁöÑÂá†‰∏™ÁÇπ]]></title>
    <url>%2F2018%2F08%2F17%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E5%87%A0%E4%B8%AA%E7%82%B9%2F</url>
    <content type="text"><![CDATA[Êï∞ÊçÆÂ∫ìËÆæËÆ°Â≠óÁ¨¶ÈõÜ Áªü‰∏Ä‰ΩøÁî®utf8mb4ÔºåMySQLÂú®5.5.3‰πãÂêéÂ¢ûÂä†‰∫Üutf8mb4Â≠óÁ¨¶ÁºñÁ†ÅÔºåÁÆÄÂçïÁöÑËØ¥utf8mb4ÊâçÊòØÁúüÊ≠£ÁöÑutf-8ÔºåÂõ†‰∏∫ÂÆÉÂèØ‰ª•ÊîØÊåÅ4‰∏™Â≠óËäÇÊØè‰∏™Â≠óÁ¨¶ÔºåpsÔºöÂΩìÊàë‰ª¨Ë¶ÅÂ≠òÂÇ®emojiË°®ÊÉÖÂ∞±ÂøÖÈ°ª‰ΩøÁî®utf8mb4ÔºåÊÄßËÉΩ‰∏ä‰∏ç‰ºöÊúâÊçüÂ§± Âª∫Ë°®ËßÑËåÉ Â≠óÊÆµÂêçÂøÖÈ°ª‰ΩøÁî®Â∞èÂÜôÂ≠óÊØç Â∞èÊï∞Á±ªÂûã‰∏∫decimalÔºåÁ¶ÅÊ≠¢‰ΩøÁî®floatÂíådoubleÔºà‰ºöÊúâÁ≤æÂ∫¶ÊçüÂ§±Ôºâ Â¶ÇÊûúÂ≠òÂÇ®ÁöÑÂ≠óÁ¨¶‰∏≤ÈïøÂ∫¶Âá†‰πéÁõ∏Á≠âÔºå‰ΩøÁî®charÂÆöÈïøÂ≠óÁ¨¶‰∏≤Á±ªÂûãÔºà‰∏évarcharÁöÑÂå∫Âà´Ôºå‰æãÂ¶ÇÔºåÂ≠òÂÇ®Â≠óÁ¨¶‰∏≤&#39;abc&#39;ÔºåÂØπ‰∫échar (10)ÔºåË°®Á§∫‰Ω†Â≠òÂÇ®ÁöÑÂ≠óÁ¨¶Â∞ÜÂç†10‰∏™Â≠óËäÇ(ÂåÖÊã¨7‰∏™Á©∫Â≠óÁ¨¶)ÔºåËÄåÂêåÊ†∑ÁöÑvarchar (10)ÂàôÂè™Âç†Áî®3‰∏™Â≠óËäÇÁöÑÈïøÂ∫¶Ôºå10Âè™ÊòØÊúÄÂ§ßÂÄºÔºåÂΩì‰Ω†Â≠òÂÇ®ÁöÑÂ≠óÁ¨¶Â∞è‰∫é10Êó∂ÔºåÊåâÂÆûÈôÖÈïøÂ∫¶Â≠òÂÇ®Ôºâ varchar ÊòØÂèØÂèòÈïøÂ≠óÁ¨¶‰∏≤Ôºå‰∏ç‰ºöÈ¢ÑÂÖàÂàÜÈÖçÂ≠òÂÇ®Á©∫Èó¥ÔºåÈïøÂ∫¶‰∏çË¶ÅË∂ÖËøá 5000ÔºåÂ¶ÇÊûúÂ≠òÂÇ®ÈïøÂ∫¶Â§ß‰∫éÊ≠§ÂÄºÔºåÂÆö‰πâÂ≠óÊÆµÁ±ªÂûã‰∏∫textÔºåÁã¨Á´ãÂá∫Êù•‰∏ÄÂº†Ë°®ÔºåÁî®‰∏ªÈîÆÊù•ÂØπÂ∫îÔºåÈÅøÂÖçÂΩ±ÂìçÂÖ∂ÂÆÉÂ≠óÊÆµÁ¥¢ ÂºïÊïàÁéá Ë°®ÂøÖÂ§á‰∏âÂ≠óÊÆµ:id, date_create, date_update ‰∏∫ÈÅøÂÖçÂÖ≥ËøûÊü•ËØ¢ÔºåÂ≠óÊÆµÂÖÅËÆ∏ÈÄÇÂΩìÂÜó‰ΩôÔºå‰ª•È´òÊü•ËØ¢ÊÄßËÉΩÔºå‰ΩÜÂøÖÈ°ªËÄÉËôëÊï∞ÊçÆ‰∏ÄËá¥„ÄÇÂÜó‰ΩôÂ≠óÊÆµÂ∫îÈÅµÂæ™ ‰∏çÊòØÈ¢ëÁπÅ‰øÆÊîπÁöÑÂ≠óÊÆµ ‰∏çÊòØ varchar Ë∂ÖÈïøÂ≠óÊÆµÔºåÊõ¥‰∏çËÉΩÊòØ text Â≠óÊÆµ ÂêàÈÄÇÁöÑÂ≠óÁ¨¶Â≠òÂÇ®ÈïøÂ∫¶ÔºåÊó†Ë¥üÊï∞ÁöÑÊÉÖÂÜµÈúÄË¶Å‰ΩøÁî®Êó†Á¨¶Âè∑‰ΩçÂ≠òÂÇ®ÔºåÊâ©Â§ßË°®Á§∫ËåÉÂõ¥ Á±ªÂûã | Ë°®Á§∫ËåÉÂõ¥ ‚Äî | ‚Äî unsigned tinyint | Êó†Á¨¶Âè∑‰Ωç 0-255 unsigned smallint | Êó†Á¨¶Âè∑‰Ωç 0-65535 unsigned int | Êó†Á¨¶Âè∑‰Ωç Á∫¶ 0-42.9‰∫ø unsigned bigint | Êó†Á¨¶Âè∑‰Ωç Á∫¶ 0-10ÁöÑ19Ê¨°Êñπ Á¥¢Âºï Âú®varcharÂ≠óÊÆµ‰∏äÂª∫Á´ãÁ¥¢ÂºïÊó∂ÔºåÂøÖÈ°ªÊåáÂÆöÁ¥¢ÂºïÈïøÂ∫¶ÔºåÊ≤°ÂøÖË¶ÅÂØπÂÖ®Â≠óÊÆµÂª∫Á´ãÁ¥¢ÂºïÔºåÊ†πÊçÆÂÆûÈôÖÊñáÊú¨Âå∫ÂàÜÂ∫¶ÂÜ≥ÂÆöÁ¥¢ÂºïÈïøÂ∫¶Âç≥ÂèØ ‰∏öÂä°‰∏äÂÖ∑ÊúâÂîØ‰∏ÄÁâπÊÄßÁöÑÂ≠óÊÆµÔºåÂç≥‰ΩøÊòØÂ§ö‰∏™Â≠óÊÆµÁöÑÁªÑÂêàÔºå‰πüÂøÖÈ°ªÂª∫ÊàêÂîØ‰∏ÄÁ¥¢Âºï Á¥¢ÂºïÂª∫Á´ãÈúÄË¶ÅÈÅµÂæ™ÊúÄÂ∑¶ÂåπÈÖçÂéüÂàô„ÄÇ‰æãÂ¶ÇÔºöÂª∫ÁªÑÂêàÁ¥¢ÂºïÁöÑÊó∂ÂÄôÔºåÂå∫ÂàÜÂ∫¶ÊúÄÈ´òÁöÑÂú®ÊúÄÂ∑¶Ëæπ SQLÊÄßËÉΩ‰ºòÂåñÁöÑÁõÆÊ†áÔºöËá≥Â∞ëË¶ÅËææÂà∞rangeÁ∫ßÂà´ÔºåË¶ÅÊ±ÇÊòØrefÁ∫ßÂà´ÔºåÂ¶ÇÊûúÂèØ‰ª•ÊòØconstsÊúÄÂ•Ω„ÄÇ consts ÂçïË°®‰∏≠ÊúÄÂ§öÂè™Êúâ‰∏Ä‰∏™ÂåπÈÖçË°åÔºà‰∏ªÈîÆÊàñËÄÖÂîØ‰∏ÄÁ¥¢ÂºïÔºâÔºåÂú®‰ºòÂåñÈò∂ÊÆµÂç≥ÂèØËØªÂèñÂà∞Êï∞ÊçÆ„ÄÇ ref ÊåáÁöÑÊòØ‰ΩøÁî®ÊôÆÈÄöÁöÑÁ¥¢ÂºïÔºànormal indexÔºâ „ÄÇ range ÂØπÁ¥¢ÂºïËøõË°åËåÉÂõ¥Ê£ÄÁ¥¢„ÄÇ explainÊù•Ëß£ÈáäÊâßË°åËÆ°ÂàíÔºåtypeÂàóÊåáÁöÑÊòØMySQLÂú®Ë°®‰∏≠ÊâæÂà∞ÊâÄÈúÄË°åÁöÑÊñπÂºè„ÄÇÂ∏∏ËßÅÁ±ªÂûãÂ¶Ç‰∏ãÔºö ALL | index | range |ref |eq_ref | const,system | NULL ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî ALLÊòØÂÖ®Ë°®Êâ´ÊèèÔºåMySQLË¶ÅÈÅçÂéÜÂÖ®Ë°®Êù•ÊâæÂà∞ÂåπÈÖçÁöÑË°å | Á¥¢ÂºïÂÖ®Êâ´ÊèèÔºåMySQLÈÅçÂéÜÊï¥‰∏™Á¥¢ÂºïÊù•ÊâæÂà∞ÂåπÈÖçÁöÑË°å | Á¥¢ÂºïËåÉÂõ¥Êâ´ÊèèÔºå‰∏ÄËà¨Áî®‰∫é&lt;„ÄÅ&gt;„ÄÅ&lt;=„ÄÅ&gt;=„ÄÅbetweenÊìç‰Ωú | ‰ΩøÁî®ÈùûÂîØ‰∏ÄÁ¥¢ÂºïÊâ´ÊèèÊàñËÄÖÂîØ‰∏ÄÁ¥¢ÂºïÁöÑÂâçÁºÄÊâ´ÊèèÔºåËøîÂõûÂåπÈÖçÂçïÁã¨ÂÄºÁöÑËÆ∞ÂΩïË°å | ÂîØ‰∏ÄÁ¥¢ÂºïÔºåÂØπ‰∫éÊØè‰∏™ÈîÆÂÄºÔºåË°®‰∏≠Âè™Êúâ‰∏ÄË°åËÆ∞ÂΩï‰∏é‰πãÂåπÈÖç | ÂçïË°®Âè™Êúâ‰∏Ä‰∏™ÂåπÈÖçË°åÔºå‰æãÂ¶ÇÊ†πÊçÆ‰∏ªÈîÆÊàñËÄÖÂîØ‰∏ÄÁ¥¢ÂºïËÆ∞ÊÄßÁöÑÊü•ËØ¢ ËåÉÂõ¥ÂàóÂèØ‰ª•Áî®Âà∞Á¥¢Âºï ËåÉÂõ¥Êù°‰ª∂ÊúâÔºö&lt;„ÄÅ&lt;=„ÄÅ&gt;„ÄÅ&gt;=„ÄÅbetweenÁ≠â„ÄÇ ËåÉÂõ¥ÂàóÂèØ‰ª•Áî®Âà∞Á¥¢ÂºïÔºå‰ΩÜÊòØËåÉÂõ¥ÂàóÂêéÈù¢ÁöÑÂàóÊó†Ê≥ïÁî®Âà∞Á¥¢ÂºïÔºåÁ¥¢ÂºïÊúÄÂ§öÁî®‰∫é‰∏Ä‰∏™ËåÉÂõ¥ÂàóÔºåÂ¶ÇÊûúÊü• ËØ¢Êù°‰ª∂‰∏≠Êúâ‰∏§‰∏™ËåÉÂõ¥ÂàóÂàôÊó†Ê≥ïÂÖ®Áî®Âà∞Á¥¢Âºï„ÄÇ ‰æãÂ¶Ç Âª∫Êúâ(a,b,c)ËÅîÂêàÁ¥¢Âºï where b&gt;0 and a&lt;9 Âè™ÊúâaÁ¥¢Âºï‰ºöÁîüÊïà where b&gt;0 and a=9 a,b Á¥¢ÂºïÁîüÊïà where a&lt;0 and b=9 Âè™ÊúâaÁ¥¢ÂºïÁîüÊïà where c&lt;0 and b=9 ‰∏çÁ¨¶ÂêàÊúÄÂ∑¶ÂéüÂàôÔºåÁ¥¢Âºï‰∏çÁîüÊïà ÂàÜÂ∫ìÂàÜË°® ÂçïË°®Ë°åÊï∞Ë∂ÖËøá500‰∏áË°åÊàñËÄÖÂçïË°®ÂÆπÈáèË∂ÖËøá2GBÔºåÊâçÊé®ËçêËøõË°åÂàÜÂ∫ìÂàÜË°®]]></content>
      <categories>
        <category>Êï∞ÊçÆÂ∫ì</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AVLÊ†ë]]></title>
    <url>%2F2018%2F07%2F25%2FAVL%E6%A0%91%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÂú®‰ªãÁªç‰∫åÂèâÂπ≥Ë°°Ê†ë‰πãÂâçÔºåÊúâÂøÖË¶ÅÂÖà‰∫ÜËß£‰∏ã‰∫åÂèâÊ†ëÔºå‰∏ãÈù¢ÊòØÂü∫‰∫éÁª¥Âü∫ÁôæÁßëÂØπ‰∫åÂèâÊ†ëÁöÑËß£Èáä ‰∫åÂèâÊ†ëÔºàËã±ËØ≠ÔºöBinary treeÔºâÊòØÊØè‰∏™ËäÇÁÇπÊúÄÂ§öÂè™Êúâ‰∏§‰∏™ÂàÜÊîØÔºàÂç≥‰∏çÂ≠òÂú®ÂàÜÊîØÂ∫¶Â§ß‰∫é2ÁöÑËäÇÁÇπÔºâÁöÑÊ†ëÁªìÊûÑ„ÄÇÈÄöÂ∏∏ÂàÜÊîØË¢´Áß∞‰Ωú‚ÄúÂ∑¶Â≠êÊ†ë‚ÄùÊàñ‚ÄúÂè≥Â≠êÊ†ë‚Äù„ÄÇ‰∫åÂèâÊ†ëÁöÑÂàÜÊîØÂÖ∑ÊúâÂ∑¶Âè≥Ê¨°Â∫èÔºå‰∏çËÉΩÈöèÊÑèÈ¢†ÂÄí ‰∫åÂèâÊ†ëÁöÑÁ¨¨iÂ±ÇËá≥Â§öÊã•Êúâ2^(i-1)‰∏™ËäÇÁÇπ„ÄÇÊ∑±Â∫¶‰∏∫kÁöÑ‰∫åÂèâÊ†ëËá≥Â§öÊÄªÂÖ±Êúâ2^(k+1) - 1‰∏™ËäÇÁÇπÔºàÂÆö‰πâÊ†πËäÇÁÇπÊâÄÂú®Ê∑±Â∫¶k0 = 0ÔºâÔºåËÄåÊÄªËÆ°Êã•ÊúâËäÇÁÇπÊï∞ÂåπÈÖçÁöÑÔºåÁß∞‰∏∫Êª°‰∫åÂèâÊ†ë Ê∑±Â∫¶‰∏∫kÊúân‰∏™ËäÇÁÇπÁöÑ‰∫åÂèâÊ†ëÔºåÂΩì‰∏î‰ªÖÂΩìÂÖ∂‰∏≠ÁöÑÊØè‰∏ÄËäÇÁÇπÔºåÈÉΩÂèØ‰ª•ÂíåÂêåÊ†∑Ê∑±Â∫¶kÁöÑÊª°‰∫åÂèâÊ†ëÔºåÂ∫èÂè∑‰∏∫1Âà∞nÁöÑËäÇÁÇπ‰∏ÄÂØπ‰∏ÄÂØπÂ∫îÊó∂ÔºåÁß∞‰∏∫ÂÆåÂÖ®‰∫åÂèâÊ†ë ‰∫åÂèâÊü•ÊâæÊ†ëÔºàËã±ËØ≠ÔºöBinary Search TreeÔºâÔºå‰πüÁß∞‰∏∫‰∫åÂèâÊêúÁ¥¢Ê†ë„ÄÅÊúâÂ∫è‰∫åÂèâÊ†ëÔºàordered binary treeÔºâÊàñÊéíÂ∫è‰∫åÂèâÊ†ëÔºàsorted binary treeÔºâÔºåÊòØÊåá‰∏ÄÊ£µÁ©∫Ê†ëÊàñËÄÖÂÖ∑Êúâ‰∏ãÂàóÊÄßË¥®ÁöÑ‰∫åÂèâÊ†ëÔºö Ëã•‰ªªÊÑèËäÇÁÇπÁöÑÂ∑¶Â≠êÊ†ë‰∏çÁ©∫ÔºåÂàôÂ∑¶Â≠êÊ†ë‰∏äÊâÄÊúâËäÇÁÇπÁöÑÂÄºÂùáÂ∞è‰∫éÂÆÉÁöÑÊ†πËäÇÁÇπÁöÑÂÄºÔºõ Ëã•‰ªªÊÑèËäÇÁÇπÁöÑÂè≥Â≠êÊ†ë‰∏çÁ©∫ÔºåÂàôÂè≥Â≠êÊ†ë‰∏äÊâÄÊúâËäÇÁÇπÁöÑÂÄºÂùáÂ§ß‰∫éÂÆÉÁöÑÊ†πËäÇÁÇπÁöÑÂÄºÔºõ ‰ªªÊÑèËäÇÁÇπÁöÑÂ∑¶„ÄÅÂè≥Â≠êÊ†ë‰πüÂàÜÂà´‰∏∫‰∫åÂèâÊü•ÊâæÊ†ëÔºõ Ê≤°ÊúâÈîÆÂÄºÁõ∏Á≠âÁöÑËäÇÁÇπ„ÄÇ ‰∫åÂèâÊü•ÊâæÊ†ëÁõ∏ÊØî‰∫éÂÖ∂‰ªñÊï∞ÊçÆÁªìÊûÑÁöÑ‰ºòÂäøÂú®‰∫éÊü•Êâæ„ÄÅÊèíÂÖ•ÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶ËæÉ‰ΩéÔºå‰∏∫O(log n)„ÄÇ‰ΩÜÊòØÔºå‰∏ÄÊó¶ËøôÊ£µ‰∫åÂèâÊü•ÊâæÊ†ëÊºîÂåñÊàê‰∫ÜÁ∫øÂûãÊ†ëÁöÑÊó∂ÂÄôÔºåÊ≠§Êó∂Êü•ËØ¢ÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶‰ºöÈôçËá≥O(n)„ÄÇ ËôΩÁÑ∂‰∫åÂèâÊü•ÊâæÊ†ëÁöÑÊúÄÂùèÊïàÁéáÊòØO(n)Ôºå‰ΩÜÊòØ‰ªñÊúâÂæàÂ§öÊîπËøõÁâàÁöÑ‰∫åÂèâÊü•ÊâæÊ†ëÂèØ‰ª•‰ΩøÊ†ëÈ´ò‰∏∫O(log n)Ôºå‰ªéËÄåÂ∞ÜÊúÄÂùèÊïàÁéáÈôçËá≥O(log n)„ÄÇÂ¶ÇAVLÊ†ë„ÄÅÁ∫¢ÈªëÊ†ëËøô‰∏§ÁßçÈÉΩÊòØÂπ≥Ë°°‰∫åÂèâÊ†ëÔºåÊú¨ÊúüÊàë‰ª¨ÂÜôÁöÑÂ∞±ÊòØAVLÊ†ë„ÄÇ ‰ªÄ‰πàÊòØAVLÊ†ëÂú®ËÆ°ÁÆóÊú∫ÁßëÂ≠¶‰∏≠ÔºåAVLÊ†ëÊòØÊúÄÊó©Ë¢´ÂèëÊòéÁöÑËá™Âπ≥Ë°°‰∫åÂèâÊü•ÊâæÊ†ë„ÄÇÂú®AVLÊ†ë‰∏≠Ôºå‰ªª‰∏ÄËäÇÁÇπÂØπÂ∫îÁöÑ‰∏§Ê£µÂ≠êÊ†ëÁöÑÊúÄÂ§ßÈ´òÂ∫¶Â∑Æ‰∏∫1ÔºàËøô‰∏™È´òÂ∫¶Â∑ÆÂ∞±ÊòØ‰∏ãÊñáË¶ÅÊèêÂà∞ÁöÑÂπ≥Ë°°Âõ†Â≠êÔºâÔºåÂõ†Ê≠§ÂÆÉ‰πüË¢´Áß∞‰∏∫È´òÂ∫¶Âπ≥Ë°°Ê†ë„ÄÇÊü•Êâæ„ÄÅÊèíÂÖ•ÂíåÂà†Èô§Âú®Âπ≥ÂùáÂíåÊúÄÂùèÊÉÖÂÜµ‰∏ãÁöÑÊó∂Èó¥Â§çÊùÇÂ∫¶ÈÉΩÊòØO(log n)„ÄÇÂ¢ûÂä†ÂíåÂà†Èô§ÂÖÉÁ¥†ÁöÑÊìç‰ΩúÂàôÂèØËÉΩÈúÄË¶ÅÂÄüÁî±‰∏ÄÊ¨°ÊàñÂ§öÊ¨°Ê†ëÊóãËΩ¨Ôºå‰ª•ÂÆûÁé∞Ê†ëÁöÑÈáçÊñ∞Âπ≥Ë°°„ÄÇ Âπ≥Ë°°Âõ†Â≠êËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠êÊòØÂÆÉÁöÑÂ∑¶Â≠êÊ†ëÁöÑÈ´òÂ∫¶ÂáèÂéªÂÆÉÁöÑÂè≥Â≠êÊ†ëÁöÑÈ´òÂ∫¶ÔºàÊúâÊó∂Áõ∏ÂèçÔºâ„ÄÇÂ∏¶ÊúâÂπ≥Ë°°Âõ†Â≠ê1„ÄÅ0Êàñ -1ÁöÑËäÇÁÇπË¢´ËÆ§‰∏∫ÊòØÂπ≥Ë°°ÁöÑ„ÄÇÂ∏¶ÊúâÂπ≥Ë°°Âõ†Â≠ê-2Êàñ2ÁöÑËäÇÁÇπË¢´ËÆ§‰∏∫ÊòØ‰∏çÂπ≥Ë°°ÁöÑÔºåÂπ∂ÈúÄË¶ÅÈáçÊñ∞Âπ≥Ë°°Ëøô‰∏™Ê†ë„ÄÇÂπ≥Ë°°Âõ†Â≠êÂèØ‰ª•Áõ¥Êé•Â≠òÂÇ®Âú®ÊØè‰∏™ËäÇÁÇπ‰∏≠ÔºåÊàñ‰ªéÂèØËÉΩÂ≠òÂÇ®Âú®ËäÇÁÇπ‰∏≠ÁöÑÂ≠êÊ†ëÈ´òÂ∫¶ËÆ°ÁÆóÂá∫Êù• AVL ÊóãËΩ¨ËøõË°åÊóãËΩ¨ÁöÑÂéüÂõ†Âõ†‰∏∫AVLÊ†ëÈúÄË¶ÅÁª¥ÊåÅËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠ê‰∏∫1Ôºå0Ôºå-1ÔºåÂõ∫ÂΩìÊèíÂÖ•Êñ∞ËäÇÁÇπÂØºËá¥Âπ≥Ë°°Âõ†Â≠ê‰∏çÊª°Ë∂≥Êó∂ÈúÄË¶ÅËøõË°åË∞ÉÊï¥‰ª•ÈáçÊñ∞Áª¥ÊåÅAVLÊ†ëÁöÑÂπ≥Ë°°Áä∂ÊÄÅÔºåËøô‰∏™Ë∞ÉÊï¥ËøáÁ®ãÂ∞±ÊòØÊóãËΩ¨ ÊóãËΩ¨ÂàÜÁ±ª ÂÆûÁé∞ÁÆÄÂçïÊèèËø∞Âú®Âπ≥Ë°°ÁöÑ‰∫åÂèâÊéíÂ∫èÊ†ëBBST (Balancing Binary Search Tree)‰∏äÊèíÂÖ•‰∏Ä‰∏™Êñ∞ÁöÑÊï∞ÊçÆÂÖÉÁ¥†eÁöÑÈÄíÂΩíÁÆóÊ≥ïÂèØÊèèËø∞Â¶Ç‰∏ãÔºö Ëã•BBST‰∏∫Á©∫Ê†ëÔºåÂàôÊèíÂÖ•‰∏Ä‰∏™Êï∞ÊçÆÂÖÉÁ¥†‰∏∫eÁöÑÊñ∞ËäÇÁÇπ‰Ωú‰∏∫BBSTÁöÑÊ†πËäÇÁÇπÔºåÊ†ëÁöÑÊ∑±Â∫¶Â¢û1Ôºõ Ëã•eÁöÑÂÖ≥ÈîÆÂ≠óÂíåBBSTÁöÑÊ†πËäÇÁÇπÁöÑÂÖ≥ÈîÆÂ≠óÁõ∏Á≠âÔºåÂàô‰∏çËøõË°åÔºõ Ëã•eÁöÑÂÖ≥ÈîÆÂ≠óÂ∞è‰∫éBBSTÁöÑÊ†πËäÇÁÇπÁöÑÂÖ≥ÈîÆÂ≠óÔºåËÄå‰∏îÂú®BBSTÁöÑÂ∑¶Â≠êÊ†ë‰∏≠‰∏çÂ≠òÂú®ÂíåeÊúâÁõ∏ÂêåÂÖ≥ÈîÆÂ≠óÁöÑËäÇÁÇπÔºåÂàôÂ∞ÜeÊèíÂÖ•Âú®BBSTÁöÑÂ∑¶Â≠êÊ†ë‰∏äÔºåÂπ∂‰∏îÂΩìÊèíÂÖ•‰πãÂêéÁöÑÂ∑¶Â≠êÊ†ëÊ∑±Â∫¶Â¢ûÂä†Ôºà+1ÔºâÊó∂ÔºåÂàÜÂà´Â∞±‰∏ãÂàó‰∏çÂêåÊÉÖÂÜµÂ§ÑÁêÜ‰πãÔºö BBSTÁöÑÊ†πËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠ê‰∏∫-1ÔºàÂè≥Â≠êÊ†ëÁöÑÊ∑±Â∫¶Â§ß‰∫éÂ∑¶Â≠êÊ†ëÁöÑÊ∑±Â∫¶ÔºåÂàôÂ∞ÜÊ†πËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠êÊõ¥Êîπ‰∏∫0ÔºåBBSTÁöÑÊ∑±Â∫¶‰∏çÂèòÔºõ BBSTÁöÑÊ†πËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠ê‰∏∫0ÔºàÂ∑¶„ÄÅÂè≥Â≠êÊ†ëÁöÑÊ∑±Â∫¶Áõ∏Á≠âÔºâÔºöÂàôÂ∞ÜÊ†πËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠êÊõ¥Êîπ‰∏∫1ÔºåBBSTÁöÑÊ∑±Â∫¶Â¢û1Ôºõ BBSTÁöÑÊ†πËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠ê‰∏∫1ÔºàÂ∑¶Â≠êÊ†ëÁöÑÊ∑±Â∫¶Â§ß‰∫éÂè≥Â≠êÊ†ëÁöÑÊ∑±Â∫¶ÔºâÔºöÂàôËã•BBSTÁöÑÂ∑¶Â≠êÊ†ëÊ†πËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠ê‰∏∫1ÔºöÂàôÈúÄËøõË°åÂçïÂêëÂè≥ÊóãÂπ≥Ë°°Â§ÑÁêÜÔºåÂπ∂‰∏îÂú®Âè≥ÊóãÂ§ÑÁêÜ‰πãÂêéÔºåÂ∞ÜÊ†πËäÇÁÇπÂíåÂÖ∂Âè≥Â≠êÊ†ëÊ†πËäÇÁÇπÁöÑÂπ≥Ë°°Âõ†Â≠êÊõ¥Êîπ‰∏∫0ÔºåÊ†ëÁöÑÊ∑±Â∫¶‰∏çÂèòÔºõ Ëã•eÁöÑÂÖ≥ÈîÆÂ≠óÂ§ß‰∫éBBSTÁöÑÊ†πËäÇÁÇπÁöÑÂÖ≥ÈîÆÂ≠óÔºåËÄå‰∏îÂú®BBSTÁöÑÂè≥Â≠êÊ†ë‰∏≠‰∏çÂ≠òÂú®ÂíåeÊúâÁõ∏ÂêåÂÖ≥ÈîÆÂ≠óÁöÑËäÇÁÇπÔºåÂàôÂ∞ÜeÊèíÂÖ•Âú®BBSTÁöÑÂè≥Â≠êÊ†ë‰∏äÔºåÂπ∂‰∏îÂΩìÊèíÂÖ•‰πãÂêéÁöÑÂè≥Â≠êÊ†ëÊ∑±Â∫¶Â¢ûÂä†Ôºà+1ÔºâÊó∂ÔºåÂàÜÂà´Â∞±‰∏çÂêåÊÉÖÂÜµÂ§ÑÁêÜ‰πã„ÄÇ Â∞æË®ÄÊú¨Êñá‰ªãÁªç‰∫ÜAVLËá™Âπ≥Ë°°‰∫åÂèâÊ†ëÔºåÊâÄÊúâÊìç‰ΩúÁöÑÊúÄÂùèÂ§çÊùÇÂ∫¶ÈÉΩÊòØÁöÑO(log n)„ÄÇ]]></content>
      <categories>
        <category>Êï∞ÊçÆÁªìÊûÑ</category>
      </categories>
      <tags>
        <tag>Êï∞ÊçÆÁªìÊûÑ</tag>
        <tag>Ê†ë</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Ê∫êÁ†ÅËß£Êûê‰∫åÔºàBeanFactoryÁöÑÂàõÂª∫Ôºâ]]></title>
    <url>%2F2018%2F03%2F09%2FSpring-IOC-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%BA%8C%EF%BC%88BeanFactory%E7%9A%84%E5%88%9B%E5%BB%BA%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä Âú®Á¨¨‰∫åÊúü‰ªãÁªçÂÆπÂô®ÁöÑrefreshÊñπÊ≥ïÂºÄÂßã‰πãÂâçÔºåÈ¶ñÂÖàÂ§ßÂÆ∂Â∫îËØ•ÂØπSpringÂÆπÂô®ÁöÑÊï¥‰∏™ÁªßÊâø‰ΩìÁ≥ªÊúâ‰∏™Â§ßÊ¶ÇÁöÑ‰∫ÜËß£Ôºå‰∏çÁÑ∂Â∞±‰ºöÊúâÈõæÈáåÁúãËä±ÁöÑÊÑüËßâ ‰∏∫‰∫ÜÂ∏ÆÂä©Â§ßÂÆ∂ÁêÜÊ∏ÖÊï¥‰∏™ÁªßÊâø‰ΩìÁ≥ªÔºåÊàëÂ∞ÜÊé•‰∏ãÊù•ÊâÄË¶ÅÊ∂âÂèäÂà∞ÁöÑÂá†‰∏™ÈáçË¶ÅÁ±ªÂèäÊé•Âè£ÁöÑÁªßÊâøÂÖ≥Á≥ªË¥¥‰∏äÊù•ÔºåÂú®ÈòÖËØª‰∏≠Â¶ÇÊúâÁñëÊÉëÁöÑËØùÔºåÂèØ‰ª•ÂõûËøáÂ§¥Êù•ÁúãÁúãËøôÂá†Âº†Âõæ XmlWebApplicationContextÁî±webÂÆπÂô®ÂêØÂä®ÁöÑSpringÂÆπÂô®Á±ªÔºåÊ≥®ÊÑè‰∏éDefaultListableBeanFactoryÁöÑÂå∫Âà´ DefaultListableBeanFactoryÂÆûÈôÖÂÆûÁé∞ÁöÑbeanÂ∑•ÂéÇÁ±ªÔºåËé∑ÂèñbeanÊìç‰ΩúÁöÑÊñπÊ≥ïÈÉΩÂú®ËøôÈáå XmlBeanDefinitionReaderËØªÂèñÊàë‰ª¨ÈÖçÁΩÆÊñá‰ª∂‰ø°ÊÅØ BeanFactory Êé•Âè£ÂèäÂÖ∂ÂÆûÁé∞Áî±‰ª•‰∏äÂõæ‰∏≠ÂèØ‰ª•ÁúãÂá∫ÔºåBeanFactory Êé•Âè£ÂÆö‰πâ‰∫ÜIOCÂÆπÂô®ÊúÄÂü∫Êú¨ÁöÑÂäüËÉΩËßÑËåÉÔºåÊòØÊØè‰∏Ä‰∏™IOCÂÆπÂô®ÈÉΩË¶ÅÈÅµÂÆàÁöÑÂü∫Êú¨ËßÑËåÉ„ÄÇÂÖ∂‰∏≠ÊúÄÈáçË¶ÅÁöÑÂ∞±ÊòØÂÆö‰πâ‰∫ÜgetBeanÊñπÊ≥ïÔºåËÆ©Êàë‰ª¨ÂèØ‰ª•‰ªéÂÆπÂô®‰∏≠Ê†πÊçÆÂêçÂ≠óÊãøÂà∞ÊâÄÈúÄË¶ÅÁöÑbean„ÄÇ ËÄåDefaultListableBeanFactoryÂ∞±ÊòØÂÖ∂‰∏Ä‰∏™ÈáçË¶ÅÂÆûÁé∞Ôºå‰∏éÊàë‰ª¨Êé•Ëß¶‰πüÊòØÊúÄÂ§öÁöÑÔºåËÄåXmlWebApplicationContextÂèØ‰ª•ÁêÜËß£‰∏∫‰∏Ä‰∏™Êõ¥È´òÁ∫ßÁöÑIOCÂÆπÂô®ÔºåÈô§ÊîØÊåÅBeanFactoryÁöÑÂü∫Êú¨ÂäüËÉΩÂ§ñÔºåËøòÊèê‰æõ‰∫ÜÂæàÂ§öÊâ©Â±ïÂäüËÉΩ ÂÆπÂô® refresh ÊñπÊ≥ïÊé•ÁùÄ‰∏äËäÇÁªßÁª≠ÂæÄ‰∏ãËÆ≤refresh ÊòØÊï¥‰∏™ÂÆπÂô®ÂêØÂä®ÁöÑÊ†∏ÂøÉÊñπÊ≥ïÔºåÂú®AbstractApplicationContext‰∏≠ÔºåÂÖ∂ÂÅöÁöÑ‰∫ãÊÉÖ‰∏ªË¶ÅÊúâ‰∏â‰∏™Ôºö BeanFactoryÁöÑÂàõÂª∫(DefaultListableBeanFactory) BeanDefinitionÁöÑResourceÂÆö‰ΩçÔºåËΩΩÂÖ•ÔºåÂíåÊ≥®ÂÜå Âú®ÂÆû‰æãÂåñBean‰πãÂâçÂØπBeanDefinitionËøõË°å‰øÆÊîπ(Ë∞ÉÁî®ÂÆûÁé∞‰∫ÜÊé•Âè£BeanFactoryPostProcessorÔºåBeanDefinitionRegistryPostProcessorÁöÑÁ±ª) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364@Overridepublic void refresh() throws BeansException, IllegalStateException &#123; synchronized (this.startupShutdownMonitor) &#123; // Prepare this context for refreshing. prepareRefresh(); // ÂàõÂª∫BeanFactory,Âπ∂ËΩΩÂÖ•BeanDefinitionsÔºàÈáçË¶ÅÔºâ ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // Prepare the bean factory for use in this context. prepareBeanFactory(beanFactory); try &#123; // Allows post-processing of the bean factory in context subclasses. postProcessBeanFactory(beanFactory); // ÊâßË°å BeanFactoryPostProcessors invokeBeanFactoryPostProcessors(beanFactory); // Ê≥®ÂÜå BeanPostProcessors registerBeanPostProcessors(beanFactory); // Initialize message source for this context. initMessageSource(); // Initialize event multicaster for this context. initApplicationEventMulticaster(); // Initialize other special beans in specific context subclasses. onRefresh(); // Check for listener beans and register them. registerListeners(); // ÊèêÂâçÂÆû‰æãÂåñÂåñÂÖ®ÈÉ®Âª∂ËøüÂä†ËΩΩÁöÑÂçï‰æãÁ±ªÂûã finishBeanFactoryInitialization(beanFactory); // Last step: publish corresponding event. finishRefresh(); &#125; catch (BeansException ex) &#123; if (logger.isWarnEnabled()) &#123; logger.warn(&quot;Exception encountered during context initialization - &quot; + &quot;cancelling refresh attempt: &quot; + ex); &#125; // Destroy already created singletons to avoid dangling resources. destroyBeans(); // Reset &apos;active&apos; flag. cancelRefresh(ex); // Propagate exception to caller. throw ex; &#125; finally &#123; // Reset common introspection caches in Spring&apos;s core, since we // might not ever need metadata for singleton beans anymore... resetCommonCaches(); &#125; &#125;&#125; obtainFreshBeanFactory()obtainFreshBeanFactory() ‰πüÂú® AbstractApplicationContextÁ±ª‰∏≠Ôºå‰∏ªË¶ÅÈÄªËæëÂú®refreshBeanFactory ÊñπÊ≥ï‰∏≠ 12345678protected ConfigurableListableBeanFactory obtainFreshBeanFactory() &#123; refreshBeanFactory(); ConfigurableListableBeanFactory beanFactory = getBeanFactory(); if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Bean factory for &quot; + getDisplayName() + &quot;: &quot; + beanFactory); &#125; return beanFactory;&#125; refreshBeanFactory() (AbstractRefreshableApplicationContext)ËøôÈáåÂÅöÁöÑ‰∫ãÊÉÖ‰∏ªË¶ÅÊúâ2‰∏™Ôºö 1.ÂàõÂª∫BeanFactory (createBeanFactory())2.ËΩΩÂÖ•BeanDefinitions (loadBeanDefinitions(beanFactory)) 123456789101112131415161718protected final void refreshBeanFactory() throws BeansException &#123; if (hasBeanFactory()) &#123; destroyBeans(); closeBeanFactory(); &#125; try &#123; DefaultListableBeanFactory beanFactory = createBeanFactory(); beanFactory.setSerializationId(getId()); customizeBeanFactory(beanFactory); loadBeanDefinitions(beanFactory); synchronized (this.beanFactoryMonitor) &#123; this.beanFactory = beanFactory; &#125; &#125; catch (IOException ex) &#123; throw new ApplicationContextException(&quot;I/O error parsing bean definition source for &quot; + getDisplayName(), ex); &#125;&#125; createBeanFactory()‰ªéËøôÈáåÂèØ‰ª•Áü•ÈÅìÂÆπÂô®ÊâÄ‰ΩøÁî®ÁöÑBeanFactoryÂÆûÁé∞Á±ªÊòØ DefaultListableBeanFactory123protected DefaultListableBeanFactory createBeanFactory() &#123; return new DefaultListableBeanFactory(getInternalParentBeanFactory());&#125; loadBeanDefinitions(beanFactory) (XmlWebApplicationContext)Ëøô‰∏™ÊñπÊ≥ïÊòØÂú®XmlWebApplicationContextÂÆûÁé∞ÁöÑÔºåSpringÈöèÂ§ÑÂèØËßÅÁà∂Á±ªË∞ÉÁî®Â≠êÁ±ªÁöÑËÆæËÆ°Ê®°ÂºèÔºàÊ®°ÊùøÊñπÊ≥ïËÆæËÆ°Ê®°ÂºèÔºâ Âú®Ëß£ÊûêloadBeanDefinitionsÊñπÊ≥ï‰πãÂâçÔºåÊúâÂøÖË¶ÅÂÖà‰∫ÜËß£BeanDefinitionÂú®Spring‰∏≠ÊâÄË°®Á§∫ÁöÑÊ¶ÇÂøµ ÔºàÈÄö‰øóÁöÑÁêÜËß£ÂèØ‰ª•ËØ¥ÊòØbeanÁöÑÊäΩË±°Êï∞ÊçÆÁªìÊûÑÔºåÂÆÉÂåÖÊã¨Â±ûÊÄßÂèÇÊï∞ÔºåÊûÑÈÄ†Âô®ÂèÇÊï∞Ôºå‰ª•ÂèäÂÖ∂‰ªñÂÖ∑‰ΩìÁöÑÂèÇÊï∞ÔºåÂ∞±ÊòØÊàë‰ª¨‰ªéÈÖçÁΩÆ‰ø°ÊÅØ‰∏≠ËØªÂá∫Êù•BeanÁöÑÊäΩË±°Êï∞ÊçÆÁªìÊûÑÔºâÊúâÂÖ¥Ë∂£ÁöÑÂèØ‰ª•ÂéªÁúãÁúãBeanDefinitionÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇ 123456789101112131415protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException &#123; // ÂàõÂª∫‰∏Ä‰∏™XmlBeanDefinitionReaderÔºåÁî®Êù•ËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÈÖçÁΩÆÁöÑBean‰ø°ÊÅØÔºåËß£ÊûêÊàêbeanDefinitionÔºåÂπ∂ÈÖçÁΩÆbeanFactory Êñπ‰æøÂõûË∞É XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory); // ÈÖçÁΩÆXmlBeanDefinitionReaderÁöÑ‰∏Ä‰∫õÂü∫Êú¨ÈÖçÁΩÆ beanDefinitionReader.setEnvironment(getEnvironment()); // ÈÖçÁΩÆResourceLoaderÔºàXmlWebApplicationContext ÊòØÂÆûÁé∞‰∫ÜResourceLoaderÊé•Âè£ÁöÑÔºå‰∏çÊ∏ÖÊ•öÁöÑÂèØ‰ª•‰∏äÂõæÁöÑÁªßÊâøÈìæÔºâ beanDefinitionReader.setResourceLoader(this); beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this)); // Allow a subclass to provide custom initialization of the reader, // ËøôÈáåÊ≤°ÂÅö‰ªª‰Ωï‰∫ãÊÉÖ initBeanDefinitionReader(beanDefinitionReader); loadBeanDefinitions(beanDefinitionReader);&#125; loadBeanDefinitions(XmlBeanDefinitionReader reader)XmlBeanDefinitionReader Ê†πÊçÆÈÖçÁΩÆÊñá‰ª∂‰ΩçÁΩÆË∞ÉÁî® loadBeanDefinitions12345678protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws IOException &#123; String[] configLocations = getConfigLocations(); if (configLocations != null) &#123; for (String configLocation : configLocations) &#123; reader.loadBeanDefinitions(configLocation); &#125; &#125;&#125; Â∞æË®Ä Âà∞ÁõÆÂâç‰∏∫Ê≠¢ÔºåÊàë‰ª¨Áü•ÈÅì‰∫ÜIOCÂÆπÂô®ÁöÑÂàõÂª∫Ôºå‰ª•ÂèäBeanDefinitionÊòØÂú®Âì™ÈáåË¢´Âä†ËΩΩÁöÑ„ÄÇÊé•‰∏ãÊù•Ë¶ÅËÆ≤ÁöÑËá™ÁÑ∂Â∞±ÊòØÈÖçÁΩÆ‰ø°ÊÅØÊòØÂ¶Ç‰ΩïË¢´Ëß£ÊûêÂä†ËΩΩÁöÑÔºå‰ª•ÂèäÂ¶Ç‰ΩïÊ≥®ÂÜåËøõBeanFactoryÁöÑ„ÄÇsee =&gt; ‰∏ãÊúü]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Ê∫êÁ†ÅËß£Êûê‰∏ÄÔºàIOCÂÆπÂô®ÁöÑÂàõÂª∫Ôºâ]]></title>
    <url>%2F2018%2F02%2F28%2FSpring-IOC-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B8%80%EF%BC%88IOC%E5%AE%B9%E5%99%A8%E7%9A%84%E5%88%9B%E5%BB%BA%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ÂºïË®Ä SpringÊ∫êÁ†ÅÂÄºÂæóÊØè‰∏Ä‰∏™Á®ãÂ∫èÂëòÂéªÁ†îËØªÔºå‰∏ç‰ªÖ‰ªÖÂõ†‰∏∫Â•πÊòØÊúÄÂ∏∏Áî®ÁöÑÊ°ÜÊû∂ÔºåÊõ¥Âõ†‰∏∫Â•πÊâÄ‰ΩìÁé∞ÁöÑÁºñÁ†ÅÊÄùÊÉ≥ Êú¨Êñá‰∏ªË¶Å‰ªãÁªçwebÂ∫îÁî®ÂêØÂä®Êó∂SpringÂÆπÂô®ÁöÑÂàõÂª∫ËøáÁ®ã Spring ÂêØÂä®ÁõëÂê¨ÊúÄÁªàÂÖ•Âè£ 123&lt;listener&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;&lt;/listener&gt; ContextLoaderListener(org.springframework.web.context.ContextLoaderListener) ËøôÈáåÁöÑcontextInitialized ÊñπÊ≥ï‰ºöÂú®webÂÆπÂô®ÂêØÂä®Êó∂Ë¢´Ë∞ÉÁî®Ôºå‰ªéËÄåÂêØÂä®Êï¥‰∏™springÂÆπÂô®ÁöÑÂàõÂª∫1234@Overridepublic void contextInitialized(ServletContextEvent event) &#123; initWebApplicationContext(event.getServletContext());&#125; ContextLoader(org.springframework.web.context.ContextLoader)‰∏ªË¶ÅÊúâ initWebApplicationContextÔºådetermineContextClassÔºåcreateWebApplicationContextÔºåconfigureAndRefreshWebApplicationContext ËøôÂõõ‰∏™ÊñπÊ≥ïÁöÑÊâßË°å initWebApplicationContextÂàùÂßãÂåñËøáÁ®ãÂÖ•Âè£Ôºà‰∏ªË¶ÅÊòØÂàõÂª∫ÂÆπÂô®ÁöÑËøáÁ®ãÔºâ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566public WebApplicationContext initWebApplicationContext(ServletContext servletContext) &#123; if (servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE) != null) &#123; throw new IllegalStateException( &quot;Cannot initialize context because there is already a root application context present - &quot; + &quot;check whether you have multiple ContextLoader* definitions in your web.xml!&quot;); &#125; Log logger = LogFactory.getLog(ContextLoader.class); servletContext.log(&quot;Initializing Spring root WebApplicationContext&quot;); if (logger.isInfoEnabled()) &#123; logger.info(&quot;Root WebApplicationContext: initialization started&quot;); &#125; long startTime = System.currentTimeMillis(); try &#123; // Store context in local instance variable, to guarantee that // it is available on ServletContext shutdown. if (this.context == null) &#123; this.context = createWebApplicationContext(servletContext); &#125; if (this.context instanceof ConfigurableWebApplicationContext) &#123; ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) this.context; if (!cwac.isActive()) &#123; // The context has not yet been refreshed -&gt; provide services such as // setting the parent context, setting the application context id, etc if (cwac.getParent() == null) &#123; // The context instance was injected without an explicit parent -&gt; // determine parent for root web application context, if any. ApplicationContext parent = loadParentContext(servletContext); cwac.setParent(parent); &#125; configureAndRefreshWebApplicationContext(cwac, servletContext); &#125; &#125; servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, this.context); ClassLoader ccl = Thread.currentThread().getContextClassLoader(); if (ccl == ContextLoader.class.getClassLoader()) &#123; currentContext = this.context; &#125; else if (ccl != null) &#123; currentContextPerThread.put(ccl, this.context); &#125; if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Published root WebApplicationContext as ServletContext attribute with name [&quot; + WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE + &quot;]&quot;); &#125; if (logger.isInfoEnabled()) &#123; long elapsedTime = System.currentTimeMillis() - startTime; logger.info(&quot;Root WebApplicationContext: initialization completed in &quot; + elapsedTime + &quot; ms&quot;); &#125; return this.context; &#125; catch (RuntimeException ex) &#123; logger.error(&quot;Context initialization failed&quot;, ex); servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, ex); throw ex; &#125; catch (Error err) &#123; logger.error(&quot;Context initialization failed&quot;, err); servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, err); throw err; &#125;&#125; createWebApplicationContextÂàõÂª∫ÂÆπÂô®ÔºåÈúÄË¶ÅÁü•ÈÅìÊàë‰ª¨ÈªòËÆ§ÂàõÂª∫ÁöÑspringÂÆπÂô®ÊòØÂì™‰∏™Ôºü Âú®determineContextClass‰∏≠Ëé∑Âèñ123456789protected WebApplicationContext createWebApplicationContext(ServletContext sc) &#123; // Ëé∑ÂèñÂÆπÂô®classÂØπË±° Class&lt;?&gt; contextClass = determineContextClass(sc); if (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) &#123; throw new ApplicationContextException(&quot;Custom context class [&quot; + contextClass.getName() + &quot;] is not of type [&quot; + ConfigurableWebApplicationContext.class.getName() + &quot;]&quot;); &#125; return (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);&#125; determineContextClassÂÖàÂ∞ùËØï‰ªéservlet‰∏ä‰∏ãÊñáËé∑ÂèñÂÆπÂô®Á±ªÂêçÔºå‰∏ÄËà¨Êàë‰ª¨ÈÉΩ‰∏ç‰ºöÂéªÈÖç„ÄÇÊâÄ‰ª•‰∏ÄËà¨ÈÉΩÂú®ËøôÈáåreturn ClassUtils.forName(contextClassName, ClassUtils.getDefaultClassLoader());Ëé∑ÂèñÂà∞ÂÆûÈôÖÁöÑÂÆπÂô®ÔºåËøôÈáåÂÆûÈôÖ‰∏ä‰ºöÂéªËØªÂèñÈÖçÁΩÆÊñá‰ª∂ContextLoader.propertiesÔºåÊâæÂà∞ÂÆûÈôÖÂêØÂä®ÁöÑÂÆπÂô®Á±ª‰∏∫org.springframework.web.context.support.XmlWebApplicationContext12345678910111213141516171819202122protected Class&lt;?&gt; determineContextClass(ServletContext servletContext) &#123; String contextClassName = servletContext.getInitParameter(CONTEXT_CLASS_PARAM); if (contextClassName != null) &#123; try &#123; return ClassUtils.forName(contextClassName, ClassUtils.getDefaultClassLoader()); &#125; catch (ClassNotFoundException ex) &#123; throw new ApplicationContextException( &quot;Failed to load custom context class [&quot; + contextClassName + &quot;]&quot;, ex); &#125; &#125; else &#123; contextClassName = defaultStrategies.getProperty(WebApplicationContext.class.getName()); try &#123; return ClassUtils.forName(contextClassName, ContextLoader.class.getClassLoader()); &#125; catch (ClassNotFoundException ex) &#123; throw new ApplicationContextException( &quot;Failed to load default context class [&quot; + contextClassName + &quot;]&quot;, ex); &#125; &#125;&#125; configureAndRefreshWebApplicationContextÁúãÂêçÂ≠óÔºåÈ°æÂêçÊÄù‰πâ„ÄÇËøô‰∏™ÊñπÊ≥ïÊòØÂú®ÂÆπÂô®ÂàõÂª∫ÂÆåÊàê‰πãÂêéÔºåËøõË°åÁõ∏ÂÖ≥ÈÖçÁΩÆÂπ∂ÂàùÂßãÂåñÂà∑Êñ∞ÂÆπÂô®„ÄÇÂÖ∂‰∏≠ÊúÄÈáçË¶ÅÁöÑÂ∞±ÊòØËé∑ÂèñÊàë‰ª¨Âú®web.xml‰∏≠ÈÖçÁΩÆÁöÑSpringÈÖçÁΩÆÊñá‰ª∂‰ø°ÊÅØÔºåÁÑ∂ÂêéÊâßË°å refresh ÊñπÊ≥ïÂà∑Êñ∞ÂÆπÂô®123456789101112131415161718192021222324252627282930313233protected void configureAndRefreshWebApplicationContext(ConfigurableWebApplicationContext wac, ServletContext sc) &#123; if (ObjectUtils.identityToString(wac).equals(wac.getId())) &#123; // The application context id is still set to its original default value // -&gt; assign a more useful id based on available information String idParam = sc.getInitParameter(CONTEXT_ID_PARAM); if (idParam != null) &#123; wac.setId(idParam); &#125; else &#123; // Generate default id... wac.setId(ConfigurableWebApplicationContext.APPLICATION_CONTEXT_ID_PREFIX + ObjectUtils.getDisplayString(sc.getContextPath())); &#125; &#125; wac.setServletContext(sc); // ÊâæÂà∞ÈÖçÁΩÆÊñá‰ª∂ Êàë‰ª¨Âú®web.xml‰∏≠ÈÖçÁΩÆÁöÑSpringÈÖçÁΩÆÊñá‰ª∂‰ΩçÁΩÆ String configLocationParam = sc.getInitParameter(CONFIG_LOCATION_PARAM); if (configLocationParam != null) &#123; wac.setConfigLocation(configLocationParam); &#125; // The wac environment&apos;s #initPropertySources will be called in any case when the context // is refreshed; do it eagerly here to ensure servlet property sources are in place for // use in any post-processing or initialization that occurs below prior to #refresh ConfigurableEnvironment env = wac.getEnvironment(); if (env instanceof ConfigurableWebEnvironment) &#123; ((ConfigurableWebEnvironment) env).initPropertySources(sc, null); &#125; customizeContext(sc, wac); wac.refresh();&#125; Â∞æË®Ä Âà∞ËøôÈáå‰∏∫Ê≠¢ÔºåÊàë‰ª¨Áü•ÈÅì‰∫ÜSpring ÂêØÂä®ÁöÑÂÆπÂô®Á±ªÊòØ XmlWebApplicationContextÔºåÂú®‰∏ã‰∏ÄËäÇÊàë‰ª¨‰ºöÁùÄÈáçËß£ÊûêÂÆπÂô®ÁöÑ refresh ÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÊòØÊï¥‰∏™spring iocÂÆπÂô®ÁöÑÁ≤æÈ´ìÊâÄÂú®]]></content>
      <categories>
        <category>javaÊ°ÜÊû∂</category>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊµÖÊûêËÆ°ÁÆóÊú∫Â≠óÁ¨¶ÈõÜÂíåÁºñÁ†Å]]></title>
    <url>%2F2017%2F09%2F14%2F%E6%B5%85%E6%9E%90%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E7%BC%96%E7%A0%81%2F</url>
    <content type="text"><![CDATA[‰ªÄ‰πàÊòØÂ≠óÁ¨¶ÈõÜÂë¢ÔºüÊàë‰ª¨Áü•ÈÅìÔºåÂú®ËÆ°ÁÆóÊú∫ÂÜÖÈÉ®ÔºåÊâÄÊúâ‰ø°ÊÅØÈÉΩÊòØ‰∫åËøõÂà∂Ë°®Á§∫ÁöÑÔºå‰∫åËøõÂà∂ÂØπ‰∫éËÆ°ÁÆóÊú∫Êù•ËØ¥ÊòØÊûÅ‰∏∫ÈáçË¶ÅÁöÑÔºåÂèØ‰ª•ÊÉ≥Ë±°Êàê‰∏Ä‰∏™ÂºÄÂÖ≥ÁöÑÈó≠ÂºÄ‰ø°Âè∑ÔºåÂè™Êúâ 0 1‰∏§ÁßçÁä∂ÊÄÅ„ÄÇËÆ°ÁÆóÊú∫‰∏≠ 8‰∏™‰∫åËøõÂà∂Ôºà8‰ΩçÔºâ‰ª£Ë°®‰∏Ä‰∏™Â≠óËäÇÔºå‰πüÂ∞±ÊòØËØ¥‰∏Ä‰∏™Â≠óËäÇÂèØ‰ª•‰ª£Ë°®256ÁßçÂèØËÉΩÔºå‰∫éÊòØ‰∏ä‰∏™‰∏ñÁ∫™60Âπ¥‰ª£ÔºåÁæéÂõΩÂà∂ÂÆö‰∫Ü‰∏ÄÂ•óÂ≠óÁ¨¶ÈõÜÔºåÂØπËã±ËØ≠Â≠óÁ¨¶‰∏é‰∫åËøõÂà∂‰Ωç‰πãÈó¥ÁöÑÂÖ≥Á≥ªÔºåÂÅö‰∫ÜÁªü‰∏ÄËßÑÂÆö„ÄÇËøôË¢´Áß∞‰∏∫ASCIIÁ†ÅÔºå‰∏ÄÁõ¥Ê≤øÁî®Ëá≥‰ªäÔºåASCIIÁ†Å‰∏ÄÂÖ±ËßÑÂÆö‰∫Ü128‰∏™Â≠óÁ¨¶ÁöÑÁºñÁ†ÅÔºåÊØîÂ¶ÇÁ©∫Ê†º‚ÄùSPACE‚ÄùÊòØ32Ôºà‰∫åËøõÂà∂00100000ÔºâÔºåÂ§ßÂÜôÁöÑÂ≠óÊØçAÊòØ65Ôºà‰∫åËøõÂà∂01000001Ôºâ„ÄÇËøô128‰∏™Á¨¶Âè∑ÔºàÂåÖÊã¨32‰∏™‰∏çËÉΩÊâìÂç∞Âá∫Êù•ÁöÑÊéßÂà∂Á¨¶Âè∑ÔºâÔºåÂè™Âç†Áî®‰∫Ü‰∏Ä‰∏™Â≠óËäÇÁöÑÂêéÈù¢7‰ΩçÔºåÊúÄÂâçÈù¢ÁöÑ1‰ΩçÁªü‰∏ÄËßÑÂÆö‰∏∫0„ÄÇ Ëã±ËØ≠Áî®128‰∏™Â≠óÁ¨¶Â∞±Â§ü‰∫ÜÔºå‰ΩÜÊòØ‰∏ñÁïå‰∏äËøòÊúâÂêÑÁßçÂêÑÊ†∑ÁöÑËØ≠Ë®ÄÂ≠óÁ¨¶ÔºåÂ¶Ç‰∏≠ÊñáÔºåÂ∞±Êúâ‰∏ä‰∏á‰∏™„ÄÇËøôÊ†∑Â≠êÔºåÂç≥‰ΩøÊòØ256‰∏™‰πü‰∏çÂ§üÁî®ÔºåËÄå‰∏î‰πüÊó†Ê≥ïÁªü‰∏Ä„ÄÇÊØîÂ¶ÇÔºå‰∏Ä‰∏™‰∫åËøõÂà∂Êï∞ÂèØËÉΩ‰ºöÂØπÂ∫îÁùÄÂêÑ‰∏™ÂõΩÂÆ∂‰∏çÂêåÁöÑÁ¨¶Âè∑ÔºåËøôÊ†∑Â≠êÊàë‰ª¨ÊâìÂºÄ‰∏Ä‰∏™Êñá‰ª∂ÔºåÂ¶ÇÊûú‰∏çÁü•ÈÅìËøô‰∏™Êñá‰ª∂ÁöÑÁºñÁ†ÅÊñπÂºèÔºåÈÇ£Â∞±‰ºö‰π±Á†ÅÔºåÂÆåÂÖ®Áúã‰∏çÊáÇ„ÄÇ ËøôÊ†∑Â≠êÔºåUnicode Â≠óÁ¨¶ÈõÜÂ∞±Âá∫Áé∞‰∫ÜÔºåÂÆÉÂ∞Ü‰∏ñÁïå‰∏äÊâÄÊúâÁöÑÂ≠óÁ¨¶ÈÉΩÁ∫≥ÂÖ•ÂÖ∂‰∏≠‰∫ÜÔºåÂú®unicodeÂ≠óÁ¨¶ÈõÜ‰∏≠ÔºåÊØè‰∏Ä‰∏™Á¨¶Âè∑ÈÉΩÂØπÂ∫îÁùÄ‰∏Ä‰∏™Áã¨‰∏ÄÊó†‰∫åÁöÑÁºñÁ†Å,Â¶Ç4E25Ë°®Á§∫Ê±âÂ≠ó‰∏• UnicodeÁöÑÈóÆÈ¢òÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåUnicodeÂè™ÊòØ‰∏Ä‰∏™Á¨¶Âè∑ÈõÜÔºåÂÆÉÂè™ËßÑÂÆö‰∫ÜÁ¨¶Âè∑ÁöÑ‰∫åËøõÂà∂‰ª£Á†ÅÔºåÂç¥Ê≤°ÊúâËßÑÂÆöËøô‰∏™‰∫åËøõÂà∂‰ª£Á†ÅÂ∫îËØ•Â¶Ç‰ΩïÂ≠òÂÇ®„ÄÇÊØîÂ¶ÇÔºåÊ±âÂ≠ó‰∏•ÁöÑunicodeÊòØÂçÅÂÖ≠ËøõÂà∂Êï∞4E25ÔºåËΩ¨Êç¢Êàê‰∫åËøõÂà∂Êï∞Ë∂≥Ë∂≥Êúâ15‰ΩçÔºà100111000100101ÔºâÔºå‰πüÂ∞±ÊòØËØ¥Ëøô‰∏™Á¨¶Âè∑ÁöÑË°®Á§∫Ëá≥Â∞ëÈúÄË¶Å2‰∏™Â≠óËäÇ„ÄÇË°®Á§∫ÂÖ∂‰ªñÊõ¥Â§ßÁöÑÁ¨¶Âè∑ÔºåÂèØËÉΩÈúÄË¶Å3‰∏™Â≠óËäÇÊàñËÄÖ4‰∏™Â≠óËäÇÔºåÁîöËá≥Êõ¥Â§ö„ÄÇËøôÈáåÂ∞±Êúâ‰∏§‰∏™‰∏•ÈáçÁöÑÈóÆÈ¢òÔºö Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÊòØÔºåÂ¶Ç‰ΩïÊâçËÉΩÂå∫Âà´UnicodeÂíåASCIIÔºüËÆ°ÁÆóÊú∫ÊÄé‰πàÁü•ÈÅì‰∏â‰∏™Â≠óËäÇË°®Á§∫‰∏Ä‰∏™Á¨¶Âè∑ÔºåËÄå‰∏çÊòØÂàÜÂà´Ë°®Á§∫‰∏â‰∏™Á¨¶Âè∑Âë¢Ôºü Á¨¨‰∫å‰∏™ÈóÆÈ¢òÊòØÔºåÊàë‰ª¨Â∑≤ÁªèÁü•ÈÅìÔºåËã±ÊñáÂ≠óÊØçÂè™Áî®‰∏Ä‰∏™Â≠óËäÇË°®Á§∫Â∞±Â§ü‰∫ÜÔºåÂ¶ÇÊûúUnicodeÁªü‰∏ÄËßÑÂÆöÔºåÊØè‰∏™Á¨¶Âè∑Áî®‰∏â‰∏™ÊàñÂõõ‰∏™Â≠óËäÇË°®Á§∫ÔºåÈÇ£‰πàÊØè‰∏™Ëã±ÊñáÂ≠óÊØçÂâçÈÉΩÂøÖÁÑ∂Êúâ‰∫åÂà∞‰∏â‰∏™Â≠óËäÇÊòØ0ÔºåËøôÂØπ‰∫éÂ≠òÂÇ®Êù•ËØ¥ÊòØÊûÅÂ§ßÁöÑÊµ™Ë¥πÔºåÊñáÊú¨Êñá‰ª∂ÁöÑÂ§ßÂ∞è‰ºöÂõ†Ê≠§Â§ßÂá∫‰∫å‰∏âÂÄçÔºåËøôÊòØÊó†Ê≥ïÊé•ÂèóÁöÑ„ÄÇ ÂÆÉ‰ª¨ÈÄ†ÊàêÁöÑÁªìÊûúÊòØÔºö Âá∫Áé∞‰∫ÜUnicodeÁöÑÂ§öÁßçÂ≠òÂÇ®ÊñπÂºèÔºå‰πüÂ∞±ÊòØËØ¥ÊúâËÆ∏Â§öÁßç‰∏çÂêåÁöÑ‰∫åËøõÂà∂Ê†ºÂºèÔºåÂèØ‰ª•Áî®Êù•Ë°®Á§∫Unicode„ÄÇ UnicodeÂú®ÂæàÈïø‰∏ÄÊÆµÊó∂Èó¥ÂÜÖÊó†Ê≥ïÊé®ÂπøÔºåÁõ¥Âà∞‰∫íËÅîÁΩëÁöÑÂá∫Áé∞„ÄÇ ÁºñÁ†ÅÂíåÂ≠óÁ¨¶ÈõÜÁöÑÂå∫Âà´Â¶Ç‰∏äÊñáÊâÄËØ¥ÔºåÁ¨¶Âè∑ÈõÜÂè™ËßÑÂÆö‰∫ÜÁ¨¶Âè∑ÁöÑ‰∫åËøõÂà∂‰ª£Á†ÅÔºåÂç¥Ê≤°ÊúâËßÑÂÆöËøô‰∏™‰∫åËøõÂà∂‰ª£Á†ÅÂ∫îËØ•Â¶Ç‰ΩïÂ≠òÂÇ®ÔºåËÄåÁºñÁ†ÅÂàôÂèØ‰ª•ËØ¥ÊòØÊåáÂÆöÂ≠óÁ¨¶ÈõÜÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÊñπÂºèÔºåÂ¶Ç UTF-8ÔºåUTF-16Â∞±ÊòØUnicodeÂ≠óÁ¨¶ÈõÜÁöÑÂÆûÁé∞ÊñπÂºè UTF-8‰∫íËÅîÁΩëÁöÑÊôÆÂèäÔºåÂº∫ÁÉàË¶ÅÊ±ÇÂá∫Áé∞‰∏ÄÁßçÁªü‰∏ÄÁöÑÁºñÁ†ÅÊñπÂºè„ÄÇUTF-8Â∞±ÊòØÂú®‰∫íËÅîÁΩë‰∏ä‰ΩøÁî®ÊúÄÂπøÁöÑ‰∏ÄÁßçUnicodeÁöÑÂÆûÁé∞ÊñπÂºè„ÄÇÂÖ∂‰ªñÂÆûÁé∞ÊñπÂºèËøòÂåÖÊã¨UTF-16ÔºàÂ≠óÁ¨¶Áî®‰∏§‰∏™Â≠óËäÇÊàñÂõõ‰∏™Â≠óËäÇË°®Á§∫ÔºâÂíåUTF-32ÔºàÂ≠óÁ¨¶Áî®Âõõ‰∏™Â≠óËäÇË°®Á§∫ÔºâÔºå‰∏çËøáÂú®‰∫íËÅîÁΩë‰∏äÂü∫Êú¨‰∏çÁî®„ÄÇÈáçÂ§ç‰∏ÄÈÅçÔºåËøôÈáåÁöÑÂÖ≥Á≥ªÊòØÔºåUTF-8ÊòØUnicodeÁöÑÂÆûÁé∞ÊñπÂºè‰πã‰∏Ä„ÄÇUTF-8ÊúÄÂ§ßÁöÑ‰∏Ä‰∏™ÁâπÁÇπÔºåÂ∞±ÊòØÂÆÉÊòØ‰∏ÄÁßçÂèòÈïøÁöÑÁºñÁ†ÅÊñπÂºè„ÄÇÂÆÉÂèØ‰ª•‰ΩøÁî®1~4‰∏™Â≠óËäÇË°®Á§∫‰∏Ä‰∏™Á¨¶Âè∑ÔºåÊ†πÊçÆ‰∏çÂêåÁöÑÁ¨¶Âè∑ËÄåÂèòÂåñÂ≠óËäÇÈïøÂ∫¶„ÄÇUTF-8ÁöÑÁºñÁ†ÅËßÑÂàôÂæàÁÆÄÂçïÔºåÂè™Êúâ‰∫åÊù°Ôºö ÂØπ‰∫éÂçïÂ≠óËäÇÁöÑÁ¨¶Âè∑ÔºåÂ≠óËäÇÁöÑÁ¨¨‰∏Ä‰ΩçËÆæ‰∏∫0ÔºåÂêéÈù¢7‰Ωç‰∏∫Ëøô‰∏™Á¨¶Âè∑ÁöÑunicodeÁ†Å„ÄÇÂõ†Ê≠§ÂØπ‰∫éËã±ËØ≠Â≠óÊØçÔºåUTF-8ÁºñÁ†ÅÂíåASCIIÁ†ÅÊòØÁõ∏ÂêåÁöÑ„ÄÇ ÂØπ‰∫énÂ≠óËäÇÁöÑÁ¨¶Âè∑Ôºàn&gt;1ÔºâÔºåÁ¨¨‰∏Ä‰∏™Â≠óËäÇÁöÑÂâçn‰ΩçÈÉΩËÆæ‰∏∫1ÔºåÁ¨¨n+1‰ΩçËÆæ‰∏∫0ÔºåÂêéÈù¢Â≠óËäÇÁöÑÂâç‰∏§‰Ωç‰∏ÄÂæãËÆæ‰∏∫10„ÄÇÂâ©‰∏ãÁöÑÊ≤°ÊúâÊèêÂèäÁöÑ‰∫åËøõÂà∂‰ΩçÔºåÂÖ®ÈÉ®‰∏∫Ëøô‰∏™Á¨¶Âè∑ÁöÑunicodeÁ†Å„ÄÇ ‰∏ãË°®ÊÄªÁªì‰∫ÜÁºñÁ†ÅËßÑÂàôÔºåÂ≠óÊØçxË°®Á§∫ÂèØÁî®ÁºñÁ†ÅÁöÑ‰Ωç„ÄÇ UnicodeÁ¨¶Âè∑ËåÉÂõ¥(ÂçÅÂÖ≠ËøõÂà∂) UTF-8ÁºñÁ†ÅÊñπÂºèÔºà‰∫åËøõÂà∂Ôºâ 0000 0000-0000 007F 0xxxxxxx 0000 0080-0000 07FF 110xxxxx 10xxxxxx 0000 0800-0000 FFFF 1110xxxx 10xxxxxx 10xxxxxx 0001 0000-0010 FFFF 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx Ë∑üÊçÆ‰∏äË°®ÔºåËß£ËØªUTF-8ÁºñÁ†ÅÈùûÂ∏∏ÁÆÄÂçï„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™Â≠óËäÇÁöÑÁ¨¨‰∏Ä‰ΩçÊòØ0ÔºåÂàôËøô‰∏™Â≠óËäÇÂçïÁã¨Â∞±ÊòØ‰∏Ä‰∏™Â≠óÁ¨¶ÔºõÂ¶ÇÊûúÁ¨¨‰∏Ä‰ΩçÊòØ1ÔºåÂàôËøûÁª≠ÊúâÂ§öÂ∞ë‰∏™1ÔºåÂ∞±Ë°®Á§∫ÂΩìÂâçÂ≠óÁ¨¶Âç†Áî®Â§öÂ∞ë‰∏™Â≠óËäÇ„ÄÇ‰∏ãÈù¢ÔºåËøòÊòØ‰ª•Ê±âÂ≠ó‰∏•‰∏∫‰æãÔºåÊºîÁ§∫Â¶Ç‰ΩïÂÆûÁé∞UTF-8ÁºñÁ†Å„ÄÇÂ∑≤Áü•‰∏•ÁöÑunicodeÊòØ4E25Ôºà100111000100101ÔºâÔºåÊ†πÊçÆ‰∏äË°®ÔºåÂèØ‰ª•ÂèëÁé∞4E25Â§ÑÂú®Á¨¨‰∏âË°åÁöÑËåÉÂõ¥ÂÜÖÔºà0000 0800-0000 FFFFÔºâÔºåÂõ†Ê≠§‰∏•ÁöÑUTF-8ÁºñÁ†ÅÈúÄË¶Å‰∏â‰∏™Â≠óËäÇÔºåÂç≥Ê†ºÂºèÊòØ1110xxxx 10xxxxxx 10xxxxxx„ÄÇÁÑ∂ÂêéÔºå‰ªé‰∏•ÁöÑÊúÄÂêé‰∏Ä‰∏™‰∫åËøõÂà∂‰ΩçÂºÄÂßãÔºå‰æùÊ¨°‰ªéÂêéÂêëÂâçÂ°´ÂÖ•Ê†ºÂºè‰∏≠ÁöÑxÔºåÂ§öÂá∫ÁöÑ‰ΩçË°•0„ÄÇËøôÊ†∑Â∞±ÂæóÂà∞‰∫ÜÔºå‰∏•ÁöÑUTF-8ÁºñÁ†ÅÊòØ11100100 10111000 10100101ÔºåËΩ¨Êç¢ÊàêÂçÅÂÖ≠ËøõÂà∂Â∞±ÊòØE4B8A5„ÄÇ Little endianÂíåBig endianUnicodeÁ†ÅÂèØ‰ª•ÈááÁî®‰∏§‰∏™Â≠óËäÇÊ†ºÂºèÁõ¥Êé•Â≠òÂÇ®„ÄÇ‰ª•Ê±âÂ≠ó‰∏•‰∏∫‰æãÔºåUnicodeÁ†ÅÊòØ4E25ÔºåÈúÄË¶ÅÁî®‰∏§‰∏™Â≠óËäÇÂ≠òÂÇ®Ôºå‰∏Ä‰∏™Â≠óËäÇÊòØ4EÔºåÂè¶‰∏Ä‰∏™Â≠óËäÇÊòØ25„ÄÇÂ≠òÂÇ®ÁöÑÊó∂ÂÄôÔºå4EÂú®ÂâçÔºå25Âú®ÂêéÔºåÂ∞±ÊòØBig endianÊñπÂºèÔºõ25Âú®ÂâçÔºå4EÂú®ÂêéÔºåÂ∞±ÊòØLittle endianÊñπÂºè„ÄÇÂõ†Ê≠§ÔºåÁ¨¨‰∏Ä‰∏™Â≠óËäÇÂú®ÂâçÔºåÂ∞±ÊòØ&quot;Â§ßÂ§¥ÊñπÂºè&quot;ÔºàBig endianÔºâÔºåÁ¨¨‰∫å‰∏™Â≠óËäÇÂú®ÂâçÂ∞±ÊòØ&quot;Â∞èÂ§¥ÊñπÂºè&quot;ÔºàLittle endianÔºâ„ÄÇÈÇ£‰πàÂæàËá™ÁÑ∂ÁöÑÔºåÂ∞±‰ºöÂá∫Áé∞‰∏Ä‰∏™ÈóÆÈ¢òÔºöËÆ°ÁÆóÊú∫ÊÄé‰πàÁü•ÈÅìÊüê‰∏Ä‰∏™Êñá‰ª∂Âà∞Â∫ïÈááÁî®Âì™‰∏ÄÁßçÊñπÂºèÁºñÁ†ÅÔºüUnicodeËßÑËåÉ‰∏≠ÂÆö‰πâÔºåÊØè‰∏Ä‰∏™Êñá‰ª∂ÁöÑÊúÄÂâçÈù¢ÂàÜÂà´Âä†ÂÖ•‰∏Ä‰∏™Ë°®Á§∫ÁºñÁ†ÅÈ°∫Â∫èÁöÑÂ≠óÁ¨¶ÔºàBOMÂ§¥ÔºâÔºåËøô‰∏™Â≠óÁ¨¶ÁöÑÂêçÂ≠óÂè´ÂÅö‚ÄùÈõ∂ÂÆΩÂ∫¶ÈùûÊç¢Ë°åÁ©∫Ê†º‚ÄùÔºàZERO WIDTH NO-BREAK SPACEÔºâÔºåÁî®FEFFË°®Á§∫„ÄÇËøôÊ≠£Â•ΩÊòØ‰∏§‰∏™Â≠óËäÇÔºåËÄå‰∏îFFÊØîFEÂ§ß1„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™ÊñáÊú¨Êñá‰ª∂ÁöÑÂ§¥‰∏§‰∏™Â≠óËäÇÊòØFE FFÔºåÂ∞±Ë°®Á§∫ËØ•Êñá‰ª∂ÈááÁî®Â§ßÂ§¥ÊñπÂºèÔºõÂ¶ÇÊûúÂ§¥‰∏§‰∏™Â≠óËäÇÊòØFF FEÔºåÂ∞±Ë°®Á§∫ËØ•Êñá‰ª∂ÈááÁî®Â∞èÂ§¥ÊñπÂºè„ÄÇ]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>ÁºñÁ†Å</category>
      </categories>
      <tags>
        <tag>ÁºñÁ†Å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CAS ÂçïÁÇπÁôªÂΩïÂéüÁêÜËß£Êûê]]></title>
    <url>%2F2017%2F05%2F19%2FCAS-%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄCASÊòØËÄ∂È≤ÅÂ§ßÂ≠¶ÂèëËµ∑ÁöÑ‰∏Ä‰∏™ÂºÄÊ∫êÂçïÁÇπÁôªÂΩïÈ°πÁõÆÔºå‰πüÊòØÁî®ÁöÑÊúÄ‰∏∫ÂπøÊ≥õÁöÑÂºÄÊ∫êÈ°πÁõÆ„ÄÇÂØπ‰∫éÂ≠¶‰π†SSOÊúâÈùûÂ∏∏Â•ΩÁöÑÂèÇËÄÉ‰ª∑ÂÄº ‰ªÄ‰πàÊòØÂçïÁÇπÁôªÂΩïÂçïÁÇπÁôªÂΩïÔºàSingle Sign OnÔºâÔºåÁÆÄÁß∞‰∏∫ SSO„ÄÇÂ§öÁî®‰∫éÂ§öÁ≥ªÁªüÂÖ±Â≠òÁöÑÁéØÂ¢É‰∏ãÔºåÁî®Êà∑Âú®‰∏ÄÂ§ÑÁôªÂΩïÂêéÔºåÂ∞±‰∏çÁî®Âú®ÂÖ∂‰ªñÁ≥ªÁªü‰∏≠ÁôªÂΩïÔºåÊúÄÁÆÄÂçïÁöÑÂçïÁÇπÁôªÂÖ•ÂÆûÁé∞ÂèØ‰ª•ÂÆåÂÖ®Âü∫‰∫écookieÔºåÈÄöËøáÂæÄÊµèËßàÂô®ÂÜôÂ∏¶ÊúâÁôªÂÖ•‰ø°ÊÅØÁöÑtokenÊù•ËææÂà∞Â§öÁÇπÁôªÂÖ•ÁöÑÁõÆÁöÑÔºåÊúâÂÖ¥Ë∂£ÁöÑÂèØ‰ª•Ëá™Â∑±Âä®ÊâãÂÆûÁé∞‰∏Ä‰∏™ CASÂçïÁÇπÁôªÂÖ•ÁöÑÂÆûÁé∞ÂÖàÁõó‰∏™Âõæ Ôºö ‰ªéÁªìÊûÑ‰∏äÁúãÔºåÂàÜÊàê‰∫Ü‰∏âÈÉ®ÂàÜÔºöCAS ClientÔºåCAS ServerÔºåÊµèËßàÂô® CAS Client ‰∏éÂèó‰øùÊä§ÁöÑÂÆ¢Êà∑Á´ØÂ∫îÁî®ÈÉ®ÁΩ≤Âú®‰∏ÄËµ∑Ôºå‰ª• Filter ÊñπÂºè‰øùÊä§ Web Â∫îÁî®ÁöÑÂèó‰øùÊä§ËµÑÊ∫êÔºåËøáÊª§‰ªéÂÆ¢Êà∑Á´ØËøáÊù•ÁöÑÊØè‰∏Ä‰∏™WebËØ∑Ê±Ç ‰∏ãÈù¢ÊàëÂ∞ÜÂàÜ‰∏∫‰∏§ÈÉ®ÂàÜÔºàÁî®Êà∑Á¨¨‰∏ÄÊ¨°ÁôªÂΩïÈ™åËØÅÂíå‰πãÂêéÁöÑÁôªÂΩïÈ™åËØÅÔºâËØ¶ÁªÜËß£ÊûêÂÖ∂ÁôªÂÖ•ÂéüÁêÜ Áî®Êà∑Á¨¨‰∏ÄÊ¨°ÁôªÂΩïËøáÁ®ãÂéüÁêÜ CAS Client ‰ºöÂÖàÊ†πÊçÆJSESSIONIDÔºàÂ≠òÂú®ÊµèËßàÂô®cookie‰∏≠Ôºâ Êù•Âà§Êñ≠ÂΩìÂâçËÆøÈóÆÁî®Êà∑ÊòØÂê¶Â∑≤ÁªèÁôªÂΩïÔºåÂ¶ÇÊûúÊ≤°ÊúâJSESSIONID ‰ºöÁªßÁª≠ÂàÜÊûê HTTP ËØ∑Ê±Ç‰∏≠ÊòØÂê¶ÂåÖÂê´ËØ∑Ê±Ç Service Ticket( ST ‰∏äÂõæ‰∏≠ÁöÑ Ticket) ÔºåÂ¶ÇÊûúÊ≤°ÊúâÔºåÂàôËØ¥ÊòéËØ•Áî®Êà∑ÊòØÊ≤°ÊúâÁªèËøáËÆ§ËØÅÁöÑÔºõ‰∫éÊòØ CAS Client ‰ºöÈáçÂÆöÂêëÁî®Êà∑ËØ∑Ê±ÇÂà∞ CAS Server ÔºåÂπ∂‰º†ÈÄí Service ÔºàË¶ÅËÆøÈóÆÁöÑÁõÆÁöÑËµÑÊ∫êÂú∞ÂùÄÔºâ ËøôÊó∂ËøòÊ≤°ÊúâÁôªÂΩïËøáCAS ServerÔºåËøõÂÖ•Áî®Êà∑ËÆ§ËØÅËøáÁ®ãÔºàËøîÂõûÁôªÂÖ•ÁïåÈù¢Ôºâ Â¶ÇÊûúÁî®Êà∑ËÆ§ËØÅÊàêÂäüÔºåCAS Server Â∞ÜÈöèÊú∫‰∫ßÁîü‰∏Ä‰∏™Áõ∏ÂΩìÈïøÂ∫¶„ÄÅÂîØ‰∏Ä„ÄÅ‰∏çÂèØ‰º™ÈÄ†ÁöÑ Service Ticket ÔºåÂπ∂ÁºìÂ≠ò‰ª•ÂæÖÂ∞ÜÊù•È™åËØÅÔºåÂπ∂‰∏îÈáçÂÆöÂêëÁî®Êà∑Âà∞ Service ÊâÄÂú®Âú∞ÂùÄÔºàÈôÑÂ∏¶ÂàöÊâç‰∫ßÁîüÁöÑ Service Ticket Ôºâ , Âπ∂‰∏∫ÂÆ¢Êà∑Á´ØÊµèËßàÂô®ËÆæÁΩÆ‰∏Ä‰∏™Ticket Granted CookieÔºà TGCÔºåËØ•CookieËÆæÁΩÆÁöÑÊòØSSO ServerÁöÑÂüüÂêçÔºâ CAS Client Âú®ÊãøÂà∞ Service ÂíåÊñ∞‰∫ßÁîüÁöÑ Ticket ËøáÂêéÔºå‰∏é CAS Server ÈÄöËøáÊãøÂà∞ÁöÑTicketËøõË°åË∫´‰ªΩÊ†∏ÂÆûÔºå‰ª•Á°Æ‰øù Service Ticket ÁöÑÂêàÊ≥ïÊÄß„ÄÇ ‰ª•‰∏äÊòØÁ¨¨‰∏ÄÊ¨°È™åËØÅÊó∂Âü∫Êú¨ÊµÅÁ®ã ÂΩìÁ¨¨‰∫åÊ¨°È™åËØÅÊó∂ÂàÜ‰∏§ÁßçÊÉÖÂÜµ Âêå‰∏Ä‰∏™ÊúçÂä°ÂÜçÊ¨°ÁôªÂΩïËøôÈáåÊµèËßàÂô®cookie‰∏≠‰ºöÊúâ sessionidÔºåÂá≠ÂÄüËøô‰∏™sessionidÂ∞±‰∏çÂÜçÈúÄË¶ÅÂéªCAS Server ÁªßÁª≠ËÆ§ËØÅ Âè¶Â§ñ‰∏Ä‰∏™Êú™ÁôªÂΩïËøáÁöÑÊúçÂä°ÁôªÂΩïÂú®‰∏äÈù¢Ê≠•È™§‰∏≠ÁöÑÁ¨¨‰∫åÊ≠©ÔºåÂõ†‰∏∫‰πãÂâçÂ∑≤ÁªèÂú®CAS Server ÁôªÂΩïÊàêÂäüËøáÔºåCAS Server ‰ºöËØªÂèñÊµèËßàÂô®‰∏≠ÁöÑ TGC ÔºàcookieÔºâÔºåË°®ÊòéÂ∑≤ÁªèÁôªÂÖ•ËøáÔºåÂ∞±‰∏çÈúÄË¶ÅÂéªËøîÂõûÁôªÂΩïÁïåÈù¢‰∫ÜÔºåÁõ¥Êé•ËøîÂõûCAS Client ‰∏Ä‰∏™ÂîØ‰∏Ä Á•®ÊçÆÔºàticketÔºâÔºåÂπ∂ËøõÂÖ•Á¨¨‰∏âÊ≠©„ÄÇËøôÊ†∑Â∞±ÂÆûÁé∞‰∫ÜÂçïÁÇπÁôªÂΩïÔºåÂ§öÁÇπÊó†ÈúÄÂÜçÊ¨°ÊâãÂä®ÁôªÂΩï ÂÖ≥‰∫éË∑®ÂüüÁöÑÂÆûÁé∞Ë∑®ÂüüÁöÑÂÖ≥ÈîÆÂú®‰∫éÊµèËßàÂô®Á´ØÁöÑCookie:TGCÔºåÂõ†‰∏∫Ëøô‰∏™CookieÊòØËÆæÁΩÆÂú®SSO ServerÁ´ØÁöÑÔºå‰πüÂ∞±‰øùËØÅ‰∫ÜÁªü‰∏ÄÁ•®ÊçÆÂíåClientÁ´ØÂüüÂêçÊó†ÂÖ≥„ÄÇ ÊÄªÁªìcas ÂçïÁÇπÁôªÂΩïÊ†∏ÂøÉÂ∞±ÊòØ Âçï‰∏™cookieÔºå N‰∏™session Âçï‰∏™cookieÔºàTGCÔºâÂú®cas‰∏∫ÂêÑÂ∫îÁî®ÁôªÂΩïÊó∂‰ΩøÁî®ÔºåÂÆûÁé∞‰∫ÜÂè™È°ª‰∏ÄÊ¨°ÂΩïÂÖ•Áî®Êà∑ÂØÜÁ†ÅÔºåÊ≠§cookieÂè™‰∫écas serverÁõ∏ÂÖ≥ÔºåËøô‰πüÊòØcasÂèØ‰ª•ÂÆûÁé∞Ë∑®ÂüüÁöÑÂÖ≥ÈîÆ N‰∏™sessionÂêÑÂ∫îÁî®‰ºöÂàõÂª∫Ëá™Â∑±ÁöÑsessionË°®Á§∫ÊòØÂê¶ÁôªÂΩïÔºåÂ¶ÇÂ∑≤ÁôªÂΩïÔºåÂ∞±‰∏ç‰ºöÂéªCAS Server ÂéªÈ™åËØÅTGC Âú®ËØ•ÂçèËÆÆ‰∏≠ÔºåÊâÄÊúâ‰∏é CAS Server ÁöÑ‰∫§‰∫íÂùáÈááÁî® SSL ÂçèËÆÆÔºå‰ª•Á°Æ‰øù ST Âíå TGC ÁöÑÂÆâÂÖ®ÊÄß„ÄÇ]]></content>
      <categories>
        <category>Á¨¨‰∏âÊñπÊ°ÜÊû∂</category>
        <category>SSO</category>
      </categories>
      <tags>
        <tag>SSO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂÖ≥‰∫éxmlÊñá‰ª∂ xsi:schemaLocation]]></title>
    <url>%2F2017%2F05%2F09%2F%E5%85%B3%E4%BA%8Exml%E6%96%87%E4%BB%B6-xsi-schemaLocation%2F</url>
    <content type="text"><![CDATA[Áõ∏‰ø°ÂæàÂ§ö‰∫∫ÂØπxml Â§¥‰∏ä‰∏ÄÂ§ßÂ†ÜÂæó‰∏úË•øÈÉΩÊòØÊãøÊù•‰∏ª‰πâÔºåcopyËøáÊù•Â∞±Ë°å‰∫ÜÔºåÂπ∂‰∏çÁêÜËß£ÈÇ£ÊòØ‰ªÄ‰πàÊÑèÊÄù ÂÖàÊù•‰∏ÄÊÆµ1234567891011121314151617&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:p=&quot;http://www.springframework.org/schema/p&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd&quot;&gt; &lt;context:component-scan base-package=&quot;com.pikaq&quot;/&gt; &lt;bean id=&quot;xxx&quot; class=&quot;xxx.xxx.xxx.Xxx&quot;&gt; &lt;property name=&quot;xxx&quot; value=&quot;xxxx&quot;/&gt;&lt;/bean&gt;&lt;/beans&gt; È¶ñÂÖàÁúãÂà∞ÁöÑÂ∞±ÊòØ xmlnsÔºå xmlnsXML ÊòØNamespaceÁöÑÁº©ÂÜôÔºåÂèØËØë‰∏∫‚ÄúXMLÂëΩÂêçÁ©∫Èó¥‚Äù ‰∏∫‰ªÄ‰πàÈúÄË¶ÅxmlnsÔºüÂõ†‰∏∫xmlÊñá‰ª∂ÊúâÊàêÂçÉ‰∏ä‰∏áÔºåË∞Å‰πü‰∏çËÉΩ‰øùËØÅ‰Ω†ÁöÑÊ†áÁ≠æÊòØÁã¨‰∏ÄÊó†‰∫åÁöÑÔºåÊÄªÊòØ‰ºöÂÜ≤Á™ÅÁöÑÔºåËøôÊó∂Â∞±ÈúÄË¶Åxmlns‰∫ÜÔºÅ ÊÄé‰πà‰ΩøÁî®xmlns Âë¢Ôºü‰ΩøÁî®ËØ≠Ê≥ïÔºö xmlns:namespace-prefix=&quot;namespaceURI&quot;„ÄÇÂÖ∂‰∏≠namespace-prefix‰∏∫Ëá™ÂÆö‰πâÂâçÁºÄÔºåÂè™Ë¶ÅÂú®Ëøô‰∏™XMLÊñáÊ°£‰∏≠‰øùËØÅÂâçÁºÄ‰∏çÈáçÂ§çÂç≥ÂèØÔºõnamespaceURIÊòØËøô‰∏™ÂâçÁºÄÂØπÂ∫îÁöÑXML NamespaceÁöÑÂÆö‰πâ„ÄÇ‰æãÂ¶ÇÔºö xmlns:context=‚Äùhttp://www.springframework.org/schema/context&quot; ËøôÈáåÁöÑÂÖÉÁ¥†Â∞±Êù•Ëá™Âà´Âêç‰∏∫contextÁöÑXML NamespaceÔºå‰πüÂ∞±ÊòØÂú®http://www.springframework.org/schema/context‰∏≠ÂÆö‰πâÁöÑ„ÄÇÂÖ∂ÂÆûÊàë‰ª¨ÂÆåÂÖ®ÂèØ‰ª•Â∞ÜÂâçÁºÄÂÆö‰πâ‰∏∫abcÔºö xmlns:abc=‚Äùhttp://www.springframework.org/schema/context&quot; Â•Ω‰∫ÜÔºåÁúãÂà∞ËøôÈáåÔºå‰Ω†‰πüËÆ∏‰ºöÈóÆ ÈÇ£ xmlns Âíåxmlns:context Êúâ‰ªÄ‰πàÂå∫Âà´Âë¢Ôºü xmlns Ê≤°ÊúâÂ∏¶Âà´ÂêçÔºåÂ∞±ÊòØË°®Á§∫ÈÇ£ÊòØÈªòËÆ§ÁöÑÔºåÂ¶Ç ËøôÈáåÁöÑbean Â±ûÊÄßÂ∞±Âá∫Ëá™Ëøô‰∏™ÈªòËÆ§ÂëΩÂêçÁ©∫Èó¥ xsi:schemaLocation ÊòØÂπ≤ÂòõÁöÑÔºüÁúãÂà∞ËøôÈáå‰πüËÆ∏‰Ω†Â∑≤ÁªèÁü•ÈÅì‰∫ÜÂÆÉÊòØÂπ≤ÂòõÁöÑ‰∫ÜschemaLocation‰∏çÂ∞±ÊòØ xsi ÂëΩÂêçÁ©∫Èó¥ÁöÑ‰∏Ä‰∏™Â±ûÊÄßÂêóÔºåÂ¶ÇÊûú‰πãÂâçÊàë‰ª¨Êääxmlns:xsi=‚Äùhttp://www.w3.org/2001/XMLSchema-instance&quot; ÁöÑÂà´ÂêçÊîπÊàêxmlns:sb=‚Äùhttp://www.w3.org/2001/XMLSchema-instance&quot; ËøôÈáåÂÖ∂ÂÆûÂ∞±ÂèòÊàê sb:schemaLocationÔºåËøôÈáåËÆ≤‰∏Ä‰∏ãËøô‰∏™Â±ûÊÄßÊòØÂπ≤ÂòõÁöÑÔºåËøô‰∏™Â±ûÊÄßÁöÑÂÄºÁî±‰∏Ä‰∏™ÊàñÂ§ö‰∏™URIÂºïÁî®ÂØπÁªÑÊàêÔºå‰∏§‰∏™URI‰πãÈó¥‰ª•Á©∫ÁôΩÁ¨¶ÂàÜÈöîÔºàÁ©∫Ê†ºÂíåÊç¢Ë°åÂùáÂèØÔºâÂÆÉÂÆö‰πâ‰∫ÜXML NamespaceÂíåÂØπÂ∫îÁöÑ XSDÔºàXml Schema DefinitionÔºâÊñáÊ°£ÁöÑ‰ΩçÁΩÆÁöÑÂÖ≥Á≥ªÔºåÊÑèÊÄùÂ∞±ÊòØ Ëøô‰∏™ÂëΩÂêçÁ©∫Èó¥ÂØπÂ∫îÁöÑÂÖ∑‰ΩìÊ®°ÊùøÊòØÂì™‰∏™ ‰æãÂ¶ÇÊàë‰ª¨ÊâìÂºÄ http://www.springframework.org/schema/mvc/ Ëøô‰∏™ ÂëΩÂêçÁ©∫Èó¥ÔºåÂèØ‰ª•ÁúãÂà∞ÊúâÂæàÂ§öÈÄâÊã©xsi:schemaLocation Ëøô‰∏™Â±ûÊÄßÂ∞±ÊòØË∑ü‰ªñËØ¥ÊàëË¶ÅÈÄâÊã©Âì™‰∏Ä‰∏™]]></content>
      <categories>
        <category>Âü∫Á°Ä</category>
        <category>xml</category>
      </categories>
      <tags>
        <tag>xml</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂÖ®Èù¢Ëß£ÊûêJSÈù¢ÂêëÂØπË±° ÂéüÂûãÈìæ]]></title>
    <url>%2F2017%2F05%2F04%2F%E5%85%A8%E9%9D%A2%E8%A7%A3%E6%9E%90JS%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1-%E5%8E%9F%E5%9E%8B%E9%93%BE%2F</url>
    <content type="text"><![CDATA[ÂØπjavascript ËøôÈó®ËØ≠Ë®ÄÊù•ËØ¥ÔºåÁõ∏‰ø°Â§ßÂÆ∂ÈÉΩ‰∏ç‰ºöÈôåÁîüÔºå‰ΩÜÊúÄËøëÂèëÁé∞ÂÖ∂ÂÆûÂ•ΩÂ§ö‰∫∫ÂØπJSÂØπË±°ÁöÑÊ¶ÇÂøµÂæàÊ®°Á≥äÔºåÁîöËá≥‰ºöÊÉäÂºÇ‰∫éJSÁ´üÁÑ∂‰πüÊúâÂØπË±° ÂÖ∂ÂÆûJSÊòØÂÆåÂÖ®Âü∫‰∫éÂØπË±°ÁöÑËØ≠Ë®ÄÔºåÊàë‰ª¨ÊâÄËÉΩÁúãÂà∞ÁöÑÈÉΩÊòØÂü∫‰∫éÂØπË±°ÔºåÂåÖÊã¨ js ÊñπÊ≥ïÂÖ∂ÂÆû‰πüÊòØ‰∏Ä‰∏™ÂØπË±° ‰ΩÜÊòØjsÁöÑÈù¢ÂêëÂØπË±°‰∏éÂÉèjavaÁöÑÈù¢ÂêëÂØπË±°Áõ∏ÊØî,ÂèàÊòØÊúâÁùÄÊûÅÂ§ßÁöÑ‰∏çÂêåÔºåjavaÔºåC#ÂÆåÂÖ®Èù¢ÂêëÂØπË±°ÁöÑËØ≠Ë®Ä ‰∏≠ÊúâÁ±ªËøô‰∏™Ê¶ÇÂøµÔºåËÄåjsÂØπË±°ÂàôÊòØ‰æùÈù† ÊûÑÈÄ†Âô®constructorÂà©Áî® ÂéüÂûãprototypeÊûÑÈÄ†Âá∫Êù•ÁöÑ„ÄÇ ÁÆÄÂçïÁöÑÁêÜËß£‰∏ãÔºåÁ±ªÁöÑÊ¶ÇÂøµÁõ∏ÂΩì‰∫é Ê®°ÊùøÔºåÂéüÂûãÁõ∏ÂΩì‰∫é ÂêÑ‰∏™ÂØπË±°ÁªÑÊàêÊñ∞ÁöÑÂØπË±° ÂÖàÊù•ÊÄªÁªì‰∏Ä‰∏ãÂàõÂª∫ÂØπË±°ÁöÑ3ÁßçÊñπÂºè ÂàõÂª∫ÂØπË±°ÁöÑ‰∏âÁßçÊñπÂºèÔºö1.ÈÄöËøáJSONÁ¨¶Âè∑ÂàõÂª∫1234567var dog = &#123; name: 'singledog', wangwang: function()&#123; console.log(this.name+"Êó∫Êó∫ÔºÅ"); &#125; &#125;; dog.wangwang();// singledogÊó∫Êó∫ÔºÅ 2.ÈÄöËøánew ÂÖ≥ÈîÆÂ≠óÂàõÂª∫12345678function Dog(name)&#123; this.name = name; &#125;; Dog.prototype.wangwang = function() &#123; console.log(this.name+"wangwang!!"); &#125;; var dog = new Dog("SingleDog:"); dog.wangwang();//SingleDog:wangwang!! 3.ÈÄöËøá ES5Êñ∞ÂºïËøõÁöÑ Object.create() ÊñπÊ≥ïÂàõÂª∫ 12345678var dog = &#123; name: 'singledog', wangwang: function()&#123; console.log(this.name+"Êó∫Êó∫ÔºÅ"); &#125; &#125;; var jDog = Object.create(dog);//ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂØπË±° jDog Âπ∂ÁªßÊâø dog ÂØπË±° jDog.wangwang();//singledogÊó∫Êó∫ÔºÅ ÂéüÂûãÔºàprototypeÔºâprototypeÔºàÂéüÂûãÔºâÊòØjsÈù¢ÂêëÂØπË±°‰∏≠ÈùûÂ∏∏ÈáçË¶ÅÁöÑ‰∏Ä‰∏™Ê¶ÇÂøµÔºåÊòØÊ∑±ÂÖ•Â≠¶‰π†jsÊòØÂøÖÈ°ªË¶ÅÁêÜËß£ÁöÑ‰∏Ä‰∏™Ê¶ÇÂøµÊØè‰∏™ÊñπÊ≥ï ÈÉΩÊúâ‰∏Ä‰∏™prototypeÂ±ûÊÄßÔºåÊàë‰ª¨ÂèØ‰ª•Âà©Áî®Ëøô‰∏™Â±ûÊÄßÊù•Â§ßÂÅöÊñáÁ´†‰πãÂâç‰ªãÁªç‰∫ÜÔºåÊàë‰ª¨ÁîüÊàê‰∏Ä‰∏™ÈúÄË¶ÅÁî®Âà∞ new ÂÖ≥ÈîÆÂ≠óÔºåÈÇ£‰πàËøô‰∏™new ÂÖ≥ÈîÆÂ≠ó‰∏éJAVA‰∏≠ÁöÑnew‰∏ÄÊ†∑ÂêóÔºü Á≠îÊ°àÊòØÂÆåÂÖ®‰∏ç‰∏ÄÊ†∑ ÂèØ‰ª•Áúã‰∏Ä‰∏™‰æãÂ≠êÔºö12345678910111213function Car(name)&#123; this.name = name &#125;; Car.prototype = &#123;//ÊåáÂÆö CarÁöÑÂéüÂûã ÂØπË±° driver: function()&#123; console.log(this.name+" driver!!"); &#125; &#125;; var obj = new Object(); obj.__proto__ = Car.prototype; Car.call(obj,"Benz"); obj.driver(); //Benz driver!! Âú®‰∏äÈù¢ÁöÑ‰ª£Á†Å‰∏≠ÔºåÊàë‰ª¨ÂèëÁé∞ var car = new Car();ËøôÂè•Ë¢´Êàë‰ª¨ÊõøÊç¢Êàê‰∫ÜËøô‰∏âÂè•Ôºö 123var obj = new Object(); obj.__proto__ = Car.prototype; Car.call(obj,"Benz"); ‰ª•‰∏ä‰ª£Á†Å‰∏≠ÔºåÊàë‰ª¨ÂÖàÊñ∞Âª∫‰∫Ü‰∏Ä‰∏™Á©∫ÁöÑObjectÂØπË±° objÔºåÁÑ∂ÂêéÂ∞ÜCarÁöÑÂéüÂûãËµãÁªô‰∫Ü objÂØπË±°ÁöÑ__proto__ÔºåËøôÊ†∑Â≠êobjÂØπË±°Â∞±ÁªßÊâø‰∫ÜCarÁöÑÂéüÂûãÂØπË±°ÔºåÊúÄÂêé‰∏ÄÊ≠•ÔºåÂú®objÂØπË±°‰∏äÊâßË°åÊûÑÈÄ†ÊñπÊ≥ïCarÔºåËøôÊ†∑Â≠ê obj ÂØπË±°Â∞±Áõ∏ÂΩì‰∫éÊãøÊù•‰∫Ü CarÊñπÊ≥ï‰∏≠ ÂÖ®ÈÉ®this. Â±ûÊÄßÊàñÊñπÊ≥ï Ëøô‰∏âÊ≠•ÂÖ∂ÂÆûÁ≠â‰∫énew Êìç‰Ωú Âü∫‰∫éÂéüÂûãÔºåÊàë‰ª¨ÂèØ‰ª•ÂÆûÁé∞ÂéüÂûãÈìæÁöÑÁªßÊâøÔºåÂõ†‰∏∫ÊØè‰∏Ä‰∏™ prototype ÈÉΩÊòØ‰∏Ä‰∏™ÂØπË±°ÔºåÊØè‰∏™ÂØπË±°ÈÉΩÈöêÂºèÁöÑÊã•Áî®‰∏Ä‰∏™ prototype ÂºïÁî® __proto__ Â±ûÊÄßÔºåËøôÊ†∑Â≠êÂΩìË∞ÉÁî®‰∏Ä‰∏™ÂØπË±°ÁöÑÊñπÊ≥ïÁöÑÊó∂ÂÄôÔºåÂ∞±‰ºöÈ°∫ÁùÄ__proto__Â±ûÊÄß‰∏ÄÂ±Ç‰∏ÄÂ±ÇÂæÄ‰∏äÊâæÔºåÁõ¥Âà∞ÊâæÂà∞‰∏∫Ê≠¢„ÄÇ ËØ¥Ëµ∑Êù•‰ºº‰πéÂæàÈöæÁêÜËß£ÔºåÁúã‰∏™‰æãÂ≠êÂ∏ÆÂä©Â§ßÂÆ∂ÁêÜËß£Ôºö1234567891011121314151617181920212223242526272829303132333435function Car()&#123; &#125;; Car.prototype = &#123;//ÊåáÂÆö CarÁöÑÂéüÂûã ÂØπË±° name : 'car', driver: function()&#123; console.log(this.name+" driver!!"); &#125; &#125;; function QqCar()&#123; this.name = 'QQ' &#125;; QqCar.prototype = new Car(); //ÊåáÂÆö QqCarÁöÑÂéüÂûã‰∏∫ new Car() var qqCar = new QqCar();//ÁªßÊâø‰∫Üdriver ÊñπÊ≥ï qqCar.driver(); // QQ driver!! function BigQqCar()&#123; this.name = 'BigQQ' &#125;; BigQqCar.prototype = qqCar; //ÊåáÂÆö BigQQCarÁöÑÂéüÂûã‰∏∫ qqCar var bigQqCar = new BigQqCar(); bigQqCar.driver = function()&#123;//ÈáçÂÜô‰∫ÜdriverÊñπÊ≥ï console.log(this.name+" flying!!"); &#125;; bigQqCar.driver();//BigQQ flying!! console.log(bigQqCar.__proto__===BigQqCar.prototype); //true console.log(BigQqCar.prototype === qqCar); //true console.log(BigQqCar.prototype.__proto__ === QqCar.prototype); //true // ‰ª•‰∏ä‰ª£Á†ÅÂ∞±ÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂéüÂûãÈìæ,ÊØè‰∏™ÊûÑÈÄ†ÊñπÊ≥ïÁîüÊàêÁöÑÂØπË±°ÈÉΩÊúâ‰∏Ä‰∏™ __proto__ ÊåáÂêë ÂÖ∂ÊûÑÈÄ†ÊñπÊ≥ïÁöÑprototype Â±ûÊÄß ‰ª•‰∏ä‰πüÂè™ÊòØ‰∏™‰∫∫ÂØπJSÈù¢ÂêëÂØπË±°ÁöÑÁêÜËß£ÔºåÊ¨¢ËøéÁïôË®ÄË°•ÂÖÖ]]></content>
      <categories>
        <category>ÂâçÁ´ØÊäÄÊúØ</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React + ES6 + webpack Âø´ÈÄüÊê≠Âª∫ÂºÄÂèëÁéØÂ¢É]]></title>
    <url>%2F2017%2F02%2F27%2FReact-ES6-webpack-%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[ËøëÊúüÔºåÁî±Áî®Âà∞‰∫Üreact.jsÊù•ÂÜôÂâçÁ´Ø‰ª£Á†ÅÔºåÊê≠Âª∫ÂºÄÂèëÁéØÂ¢ÉÂØπ‰∫é‰ªéÊù•Ê≤°ÊúâÂÜôËøáreactÁöÑÂêåÂ≠¶Êù•ËØ¥ÊúâÁÇπÂ§çÊùÇÔºåËøôÈáåÁÆÄÂçïËÆ∞ÂΩï‰∏Ä‰∏ãÊê≠Âª∫ËøáÁ®ãÔºàÊú¨‰∫∫‰πüÊòØÂâçÁ´ØÊ∏£Ê∏£ÔºåÂÜôÈîôÁöÑÂú∞ÊñπËøòÊúõÂ§ßÂÆ∂ÊåáÂá∫Ôºâ ÂÆâË£Öwebpack ÈúÄË¶ÅNode ÁéØÂ¢É ÂÖ®Â±ÄÂÆâË£Ö cnpm install -g webpack Êú¨È°πÁõÆÂÆâË£Ö cnpm install webpack ‚Äìsave-dev ÂÆâË£Ö react + es6 loaders cnpm install ‚Äìsave-dev babel-core babel-loader babel-preset-es2015 babel-preset-react ËøòÊúâcss loader cnpm install css-loader style-loader ‚Äìsave-dev ÈÖçÁΩÆwebpack.config.js Êñá‰ª∂123456789101112131415161718192021222324var path = require(&apos;path&apos;);module.exports = &#123; entry: &apos;./app/src/main.jsx&apos;, output: &#123; path: path.resolve(__dirname, &apos;./app/web&apos;), // ËæìÂá∫Êñá‰ª∂ÁöÑ‰øùÂ≠òË∑ØÂæÑ filename: &apos;bundle.js&apos; // ËæìÂá∫Êñá‰ª∂ÁöÑÂêçÁß∞ &#125;, module: &#123; loaders: [&#123; test: /\\.jsx?$/, loaders: &apos;babel-loader&apos;, query: &#123; presets: [&apos;react&apos;, &apos;es2015&apos;] &#125; &#125;, &#123; test: /\\.css$/, loader: &apos;style-loader!css-loader&apos; &#125; ]&#125;&#125;; Âà∞ËøôÈáåÂü∫Êú¨ÂºÄÂèëÁéØÂ¢ÉÊê≠Âª∫Â•Ω‰∫Ü ÂÆâË£Öreact Âíåreact-dom cnpm i react-dom ‚Äìsavecnpm i react ‚Äìsave ÂÆâË£ÖÂÆå‰πãÂêé‰ºöÂèëÁé∞package.json‰∏ãÂ§ö‰∫ÜËøô‰∏§‰∏™‰æùËµñÈ°π Âú®app/src ‰∏ãÊñ∞Âª∫‰∏Ä‰∏™main.jsxÂÖ•Âè£Êñá‰ª∂ÔºåÁÆÄÂçïÂÜô‰∏ãÂÜÖÂÆπ 1234567import React from &apos;react&apos;;import ReactDOM from &apos;react-dom&apos;;ReactDOM.render( &lt;h1&gt;Hello, world!&lt;/h1&gt;, document.getElementById(&apos;example&apos;)); ÁÑ∂ÂêéÂú®app/web‰∏ãÊñ∞Âª∫index.html ÔºåÈáåÈù¢ÈúÄË¶ÅÂºïÁî®bundle.jsÊñá‰ª∂ 1234567891011&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;webpack ÊïôÁ®ã&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div id=&quot;example&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;&lt;/html&gt; ÂÆåÊàêÊê≠Âª∫ÊâßË°åÂëΩ‰ª§ webpack ÊâßË°åÊàêÂäüÔºåÂèëÁé∞Âú®app/web ÁõÆÂΩï‰∏ãÂ§ö‰∫Ü‰∏™bundle.jsÊñá‰ª∂ Âú®ÊµèËßàÂô®ÊâìÂºÄindex.html Êñá‰ª∂„ÄÇÊ≠£Á°ÆÊòæÁ§∫hello world! cnpm install „Äêname„Äë‚Äìsave-dev ‰∏é cnpm install „Äêname„Äë‚ÄìsaveÁöÑÂå∫Âà´ÔºåÈÉΩÊòØÂÆâË£Ö‰∏Ä‰∫õÊ®°ÂùóÔºåÂîØ‰∏ÄÁöÑÂå∫Âà´ÊòØÂä†ÊúâdevÁöÑÊòØÂú®ÂºÄÂèëÊó∂ÊâÄ‰æùËµñÁöÑÊ®°ÂùóÔºåËÄå‰∏çÂä†ÁöÑÊòØËøêË°åÊó∂ÈúÄË¶ÅÁöÑÂü∫Êú¨Ê®°Âùó„ÄÇ ÈÇ£‰πàÊÄé‰πàÂÆûÊó∂Ë∞ÉËØïÂë¢Ôºü cnpm install ‚Äìsave-dev webpack-dev-server react-hot-loaderwebpack.config.js ÁöÑÂÜÖÂÆπÊõ¥Êñ∞Â¶Ç‰∏ã 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152var path = require(&apos;path&apos;);var webpack = require(&apos;webpack&apos;);module.exports = &#123; entry: &#123; index: [ &apos;./app/src/main.jsx&apos; ] &#125;, output: &#123; path: path.resolve(__dirname, &apos;./app/web&apos;), // ËæìÂá∫Êñá‰ª∂ÁöÑ‰øùÂ≠òË∑ØÂæÑ filename: &apos;bundle.js&apos; // ËæìÂá∫Êñá‰ª∂ÁöÑÂêçÁß∞ &#125;, module: &#123; loaders: [&#123; test: /\\.jsx?$/, loaders: &apos;babel-loader&apos;, query: &#123; presets: [&apos;react&apos;, &apos;es2015&apos;] &#125; &#125;, &#123; test: /\\.css$/, loader: &apos;style-loader!css-loader&apos; &#125;, &#123; test: /\\.js?$/, loaders: [&apos;react-hot&apos;], include: [path.join(__dirname, &apos;app/src&apos;)] &#125; ] &#125;, plugins: [ new webpack.HotModuleReplacementPlugin(), new webpack.NoErrorsPlugin(), new webpack.LoaderOptionsPlugin(&#123; options: &#123; postcss: function () &#123; return [precss, autoprefixer]; &#125;, devServer: &#123; historyApiFallback:true, hot:true, inline:true, progress:true &#125; &#125; &#125;)]&#125;; package.json Êñá‰ª∂ÈúÄË¶ÅÊ∑ªÂä†‰ª•‰∏ã ÊâßË°å npm run dev ËÆøÈóÆ localhost:8080 Âç≥ÂèØ ÂÜôÁöÑÂæàÁ≤óÊµÖ ÊÉ≠ÊÑßÔºå‰ª•ÂêéÊúâÊó∂Èó¥‰ºöÈáçÊñ∞Á†îÁ©∂‰∏Ä‰∏ãÂâçÁ´ØÁöÑÊûÑÂª∫ÂèäÊâìÂåÖ]]></content>
      <categories>
        <category>ÂâçÁ´ØÊäÄÊúØ</category>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MavenÁöÑÁîüÂëΩÂë®ÊúüÂèäÊèí‰ª∂ÁªëÂÆö]]></title>
    <url>%2F2016%2F12%2F21%2FMaven%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%8A%E6%8F%92%E4%BB%B6%E7%BB%91%E5%AE%9A%2F</url>
    <content type="text"><![CDATA[######‰Ωï‰∏∫ÁîüÂëΩÂë®ÊúüÔºü ‰∏Ä‰∏™ÂÆåÊï¥ÁöÑÈ°πÁõÆÊûÑÂª∫ËøáÁ®ãÈÄöÂ∏∏ÂåÖÊã¨Ê∏ÖÁêÜ„ÄÅÁºñËØë„ÄÅÊµãËØï„ÄÅÊâìÂåÖ„ÄÅÈõÜÊàêÊµãËØï„ÄÅÈ™åËØÅ„ÄÅÈÉ®ÁΩ≤Á≠âÊ≠•È™§ÔºåMaven‰ªé‰∏≠ÊäΩÂèñ‰∫Ü‰∏ÄÂ•óÂÆåÂñÑÁöÑ„ÄÅÊòìÊâ©Â±ïÁöÑÁîüÂëΩÂë®Êúü„ÄÇMavenÁöÑÁîüÂëΩÂë®ÊúüÊòØÊäΩË±°ÁöÑÔºåÂÖ∂‰∏≠ÁöÑÂÖ∑‰Ωì‰ªªÂä°ÈÉΩ‰∫§Áî±Êèí‰ª∂Êù•ÂÆåÊàê„ÄÇMaven‰∏∫Â§ßÂ§öÊï∞ÊûÑÂª∫‰ªªÂä°ÁºñÂÜôÂπ∂ÁªëÂÆö‰∫ÜÈªòËÆ§ÁöÑÊèí‰ª∂ÔºåÂ¶ÇÈíàÂØπÁºñËØëÁöÑÊèí‰ª∂Ôºömaven-compiler-plugin„ÄÇÁî®Êà∑‰πüÂèØËá™Ë°åÈÖçÁΩÆÊàñÁºñÂÜôÊèí‰ª∂„ÄÇ MavenÁöÑÁîüÂëΩÂë®ÊúüÊòØÊäΩË±°ÁöÑÔºåÊÑèÂë≥ÁùÄÁîüÂëΩÂë®ÊúüÊú¨Ë∫´‰∏çÂÅö‰ªª‰ΩïÂÆûÈôÖÂ∑•‰ΩúÔºåÂú®MavenÁöÑËÆæËÆ°‰∏≠ÔºåÂÆûÈôÖÁöÑÂ∑•‰ΩúÈÉΩ‰∫§Áî±Êèí‰ª∂Êù•ÂÆåÊàê MavenÂÆö‰πâ‰∫Ü‰∏âÂ•óÁîüÂëΩÂë®ÊúüÔºöclean„ÄÅdefault„ÄÅsiteÔºåÊØè‰∏™ÁîüÂëΩÂë®ÊúüÈÉΩÂåÖÂê´‰∫Ü‰∏Ä‰∫õÈò∂ÊÆµÔºàphaseÔºâ„ÄÇ‰∏âÂ•óÁîüÂëΩÂë®ÊúüÁõ∏‰∫íÁã¨Á´ãÔºå‰ΩÜÂêÑ‰∏™ÁîüÂëΩÂë®Êúü‰∏≠ÁöÑphaseÂç¥ÊòØÊúâÈ°∫Â∫èÁöÑÔºå‰∏îÂêéÈù¢ÁöÑphase‰æùËµñ‰∫éÂâçÈù¢ÁöÑphase„ÄÇÊâßË°åÊüê‰∏™phaseÊó∂ÔºåÂÖ∂ÂâçÈù¢ÁöÑphase‰ºö‰æùÈ°∫Â∫èÊâßË°åÔºå‰ΩÜ‰∏ç‰ºöËß¶ÂèëÂè¶Â§ñ‰∏§Â•óÁîüÂëΩÂë®Êúü‰∏≠ÁöÑ‰ªª‰Ωïphase„ÄÇ 1 . 1 cleanÁîüÂëΩÂë®Êúü 1 . 2 defaultÁîüÂëΩÂë®Êúü 1 . 3 siteÁîüÂëΩÂë®Êúü ######ÔºàÈò∂ÊÆµÔºâphase ÔºàÁõÆÊ†áÔºâgoalPhase ‰πãÂâçËØ¥ËøáÔºåÊåáÁöÑÂ∞±ÊòØÁîüÂëΩÂë®ÊúüÁöÑÂêÑ‰∏™Èò∂ÊÆµGoal Êåá‰æøÊòØ Êèí‰ª∂ÁöÑÁõÆÊ†áÔºàÈÄö‰øóÁöÑËØ¥Â∞±ÊòØÊèí‰ª∂ÊâÄÂÖ∑ÊúâÁöÑÂäüËÉΩÔºâ ######Ëá™ÂÆö‰πâÊèí‰ª∂ÈÖçÁΩÆ]]></content>
      <categories>
        <category>ÊûÑÂª∫Â∑•ÂÖ∑</category>
        <category>maven</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Maven Â≠¶‰π†ÊÄªÁªì]]></title>
    <url>%2F2016%2F12%2F20%2FMaven-%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[#Maven ÁÆÄ‰ªãMavenÊòØ‰ªÄ‰πàÔºü Maven Ëøô‰∏™ËØçÂèØ‰ª•ÁøªËØë‰∏∫‚ÄúÁü•ËØÜÁöÑÁßØÁ¥Ø‚ÄùÔºå‰πüÂèØ‰ª•ÁøªËØë‰∏∫‚Äú‰∏ìÂÆ∂‚ÄùÊàñ‚ÄúÂÜÖÊ∂µ‚Äù„ÄÇÊú¨ÊñáÂ∞Ü‰ªãÁªçmavenËøô‰∏ÄË∑®Âπ≥Âè∞ÁöÑÈ°πÁõÆÁÆ°ÁêÜ‰ΩøÁî®Â∑•ÂÖ∑„ÄÇÂÅö‰∏∫apacheÁªÑÁªá‰∏≠‰∏Ä‰∏™È¢á‰∏∫ÊàêÂäüÁöÑÂºÄÊ∫êÈ°πÁõÆÔºåmaven‰∏ªË¶ÅÊúçÂä°‰∫éÂü∫‰∫éjavaÂπ≥Âè∞ÁöÑÈ°πÁõÆÊûÑÂª∫Ôºå‰æùËµñÁÆ°ÁêÜÂíåÈ°πÁõÆ‰ø°ÊÅØÁÆ°ÁêÜÔºåÊó†ËÆ∫ÊòØÂ∞èÂûãÁöÑÂºÄÊ∫êÁ±ªÂ∫ìÈ°πÁõÆÔºåËøòÊòØÂ§ßÂûãÁöÑ‰ºÅ‰∏öÁ∫ßÂ∫îÁî®ÔºõÊó†ËÆ∫ÊòØ‰º†ÁªüÁöÑÁÄëÂ∏ÉÂºèÂºÄÂèëÔºåËøòÊòØÊµÅË°åÁöÑÊïèÊç∑Ê®°ÂºèÔºåMavenÈÉΩËÉΩÂ§ßÊòæË∫´Êâã ‚Äì mavenÂÆûÊàò #‰Ωï‰∏∫ÊûÑÂª∫Èô§‰∫ÜÁºñÂÜôÊ∫ê‰ª£Á†ÅÔºåÊàë‰ª¨ÊØèÂ§©ÊúâÁõ∏ÂΩì‰∏ÄÈÉ®ÂàÜÊó∂Èó¥Ëä±Âú®‰∫ÜÁºñËØë„ÄÅËøêË°åÂçïÂÖÉÊµãËØï„ÄÅÁîüÊàêÊñáÊ°£„ÄÅÊâìÂåÖÂíåÈÉ®ÁΩ≤Á≠âÁÉ¶Áêê‰∏î‰∏çËµ∑ÁúºÁöÑÂ∑•‰Ωú‰∏äÔºåËøôÂ∞±ÊòØÊûÑÂª∫Â¶ÇÊûúÊàë‰ª¨Áé∞Âú®ËøòÊâãÂ∑•ËøôÊ†∑ÂÅöÔºåÈÇ£ÊàêÊú¨‰πüÂ§™È´ò‰∫ÜÔºå‰∫éÊòØÊúâ‰∫∫Áî®ËΩØ‰ª∂ÁöÑÊñπÊ≥ïËÆ©Ëøô‰∏ÄÁ≥ªÂàóÂ∑•‰ΩúÂÆåÂÖ®Ëá™Âä®ÂåñÔºå‰ΩøÂæóËΩØ‰ª∂ÁöÑÊûÑÂª∫ÂèØ‰ª•ÂÉèÂÖ®Ëá™Âä®ÊµÅÊ∞¥Á∫ø‰∏ÄÊ†∑ÔºåÂè™ÈúÄË¶Å‰∏ÄÊù°ÁÆÄÂçïÁöÑÂëΩ‰ª§ÔºåÊâÄÊúâÁÉ¶ÁêêÁöÑÊ≠•È™§ÈÉΩËÉΩÂ§üËá™Âä®ÂÆåÊàêÔºåÂæàÂø´Â∞±ËÉΩÂæóÂà∞ÊúÄÁªàÁªìÊûú #maven‰∏ç‰ªÖ‰ªÖÊòØÊûÑÂª∫Â∑•ÂÖ∑‰æùËµñÁÆ°ÁêÜ #‰∏éantÁöÑÂå∫Âà´ÊàëÁúãÂà∞ÂæàÂ§öÈ°πÁõÆÁöÑantËÑöÊú¨‰∏≠ÁöÑÂëΩÂêçÂü∫Êú¨‰∏äÈÉΩÊòØ‰∏ÄËá¥ÁöÑÔºåÊØîÂ¶ÇÔºöÁºñËØë‰∏ÄËà¨Âè´buildÊàñËÄÖcompileÔºõÊâìÂåÖ‰∏ÄËà¨Âè´jarÊàñwarÔºõÁîüÊàêÊñáÊ°£‰∏ÄËà¨ÂëΩÂêç‰∏∫ javadocÊàñjavadocsÔºõ‰ΩÜÂÖ∂ÂÆûÊúÄÂ∏∏Áî®ÁöÑÂ∞±2Ôºå3‰∏™ÔºöÊØîÂ¶Çjavac javadoc jarÁ≠â„ÄÇ ËøôÊòØÂõ†‰∏∫AntÊâÄÊèê‰æõÁöÑÂèØÈáçÁî®ÁöÑtaskÁ≤íÂ∫¶Â§™Â∞èÔºåËôΩÁÑ∂ÁÅµÊ¥ªÊÄßÂæàÂº∫Ôºå‰ΩÜÊòØÊàë‰ª¨ÈúÄË¶ÅÁ∫†Áº†ÂæàÂ§öÁªÜËäÇÁöÑ‰∏úË•øANTÊòØÊ≤°Êúâ‰æùËµñÁÆ°ÁêÜÁöÑÔºåËÄåÂØπ‰∫éMavenÁî®Êà∑Êù•ËØ¥Ôºå‰æùËµñÁÆ°ÁêÜÊòØÁêÜÊâÄÂΩìÁÑ∂ÁöÑÔºåMaven‰∏ç‰ªÖÂÜÖÁΩÆ‰∫Ü‰æùËµñÁÆ°ÁêÜÔºåÊõ¥Êúâ‰∏Ä‰∏™ÂèØËÉΩÊã•ÊúâÂÖ®‰∏ñÁïåÊúÄÂ§öJavaÂºÄÊ∫êËΩØ‰ª∂ÂåÖÁöÑ‰∏≠Â§Æ‰ªìÂ∫ìÔºåMavenÁî®Êà∑Êó†È°ªËøõË°å‰ªª‰ΩïÈÖçÁΩÆÂ∞±ÂèØ‰ª•Áõ¥Êé•‰∫´Áî®„ÄÇ ##MavenÁöÑ‰ºòÁÇπÔºö 1.Êã•ÊúâÁ∫¶ÂÆöÔºåÁü•ÈÅì‰Ω†ÁöÑ‰ª£Á†ÅÂú®Âì™ÈáåÔºåÊîæÂà∞Âì™ÈáåÂéª2.Êã•Êúâ‰∏Ä‰∏™ÁîüÂëΩÂë®ÊúüÔºå‰æãÂ¶ÇÊâßË°å mvn installÂ∞±ÂèØ‰ª•Ëá™Âä®ÊâßË°åÁºñËØëÔºåÊµãËØïÔºåÊâìÂåÖÁ≠âÊûÑÂª∫ËøáÁ®ã3.Âè™ÈúÄË¶ÅÂÆö‰πâ‰∏Ä‰∏™pom.xml,ÁÑ∂ÂêéÊääÊ∫êÁ†ÅÊîæÂà∞ÈªòËÆ§ÁöÑÁõÆÂΩïÔºåMavenÂ∏Æ‰Ω†Â§ÑÁêÜÂÖ∂‰ªñ‰∫ãÊÉÖ4.Êã•Êúâ‰æùËµñÁÆ°ÁêÜÔºå‰ªìÂ∫ìÁÆ°ÁêÜ #Maven ÁöÑÂÆâË£ÖÈÖçÁΩÆ È¶ñÂÖàÂÆòÁΩë‰∏ãËΩΩ http://maven.apache.org/download.cgi ËØ¥ÊòéÈúÄË¶ÅJDK 1.7Âèä‰ª•‰∏äÔºåËøôÈáåÊàë‰ª¨‰ΩøÁî®JDK1.8 ËøôÈáåÊàë‰∏ãËΩΩÁöÑÊòØmaven 3.3.9 1.Â∞ÜÂÆâË£ÖÊñá‰ª∂Ëß£ÂéãÂà∞ÊåáÂÆöÁöÑÁõÆÂΩï‰∏≠ÔºåÂ¶ÇÔºö D:\maven\apache-maven-3.3.9 2.ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè Â∞ÜD:\maven\apache-maven-3.3.9\bin ËÆæËøõÁéØÂ¢ÉÂèòÈáè‰∏≠ ÊâìÂºÄcmd ÊâßË°å mvn -v Ê≥®ÊÑè‰∫ãÈ°π ËÆæÁΩÆMAVEN_OPTSÁéØÂ¢ÉÂèòÈáèÔºåÈÄöÂ∏∏ÈúÄË¶ÅËÆæÁΩÆMAVEN_OPTSÁöÑÂÄº‰∏∫-Xms128m-Xmx512mÔºåÂõ†‰∏∫JavaÈªòËÆ§ÁöÑÊúÄÂ§ßÂèØÁî®ÂÜÖÂ≠òÂæÄÂæÄ‰∏çËÉΩÂ§üÊª°Ë∂≥MavenËøêË°åÁöÑÈúÄË¶ÅÔºåÊØîÂ¶ÇÂú®È°πÁõÆËæÉÂ§ßÊó∂Ôºå‰ΩøÁî®MavenÁîüÊàêÈ°πÁõÆÁ´ôÁÇπÈúÄË¶ÅÂç†Áî®Â§ßÈáèÁöÑÂÜÖÂ≠òÔºåÂ¶ÇÊûúÊ≤°ÊúâËØ•ÈÖçÁΩÆÔºåÂàôÂæàÂÆπÊòìÂæóÂà∞java.lang.OutOfMemeoryError„ÄÇÂõ†Ê≠§Ôºå‰∏ÄÂºÄÂßãÂ∞±ÈÖçÁΩÆËØ•ÂèòÈáèÊòØÊé®ËçêÁöÑÂÅöÊ≥ï„ÄÇ #maven‰ΩøÁî®ÂÖ•Èó®‰∏Ä„ÄÅÁºñÂÜôpomÊñá‰ª∂Â∞±ÂÉèMakeÁöÑMakefile„ÄÅAntÁöÑbuild.xml‰∏ÄÊ†∑ÔºåMavenÈ°πÁõÆÁöÑÊ†∏ÂøÉÊòØpom.xml„ÄÇPOMÔºàProject Object ModelÔºåÈ°πÁõÆÂØπË±°Ê®°ÂûãÔºâÂÆö‰πâ‰∫ÜÈ°πÁõÆÁöÑÂü∫Êú¨‰ø°ÊÅØÔºåÁî®‰∫éÊèèËø∞È°πÁõÆÂ¶Ç‰ΩïÊûÑÂª∫ÔºåÂ£∞ÊòéÈ°πÁõÆ‰æùËµñÔºåÁ≠âÁ≠â„ÄÇÁé∞Âú®ÂÖà‰∏∫Hello WorldÈ°πÁõÆÁºñÂÜô‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑpom.xml„ÄÇ 12345678910&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.pikaq&lt;/groupId&gt; &lt;artifactId&gt;maventest&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;maventest&lt;/name&gt;&lt;/project&gt; ËøôÊÆµ‰ª£Á†Å‰∏≠ÊúÄÈáçË¶ÅÁöÑÊòØÂåÖÂê´groupId„ÄÅartifactIdÂíåversionÁöÑ‰∏âË°å„ÄÇËøô‰∏â‰∏™ÂÖÉÁ¥†ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™È°πÁõÆÂü∫Êú¨ÁöÑÂùêÊ†áÔºåÂú®MavenÁöÑ‰∏ñÁïåÔºå‰ªª‰ΩïÁöÑjar„ÄÅpomÊàñËÄÖwarÈÉΩÊòØ‰ª•Âü∫‰∫éËøô‰∫õÂü∫Êú¨ÁöÑÂùêÊ†áËøõË°åÂå∫ÂàÜÁöÑ„ÄÇgroupIdÂÆö‰πâ‰∫ÜÈ°πÁõÆÂ±û‰∫éÂì™‰∏™ÁªÑÔºåËøô‰∏™ÁªÑÂæÄÂæÄÂíåÈ°πÁõÆÊâÄÂú®ÁöÑÁªÑÁªáÊàñÂÖ¨Âè∏Â≠òÂú®ÂÖ≥ËÅî„ÄÇË≠¨Â¶ÇÂú®googlecode‰∏äÂª∫Á´ã‰∫Ü‰∏Ä‰∏™Âêç‰∏∫myappÁöÑÈ°πÁõÆÔºåÈÇ£‰πàgroupIdÂ∞±Â∫îËØ•ÊòØcom.googlecode.myappÔºåÂ¶ÇÊûú‰Ω†ÁöÑÂÖ¨Âè∏ÊòØmycomÔºåÊúâ‰∏Ä‰∏™È°πÁõÆ‰∏∫myappÔºåÈÇ£‰πàgroupIdÂ∞±Â∫îËØ•ÊòØcom.mycom.myapp„ÄÇÊú¨‰π¶‰∏≠ÊâÄÊúâÁöÑ‰ª£Á†ÅÈÉΩÂü∫‰∫égroupId com.juvenxu.mvnbook„ÄÇÊú¨‰π¶ÂÖ∂‰ªñÁ´†ËäÇ‰ª£Á†Å‰ºöÂàÜÈÖçÂÖ∂‰ªñÁöÑartifactId„ÄÇËÄåÂú®ÂâçÈù¢ÁöÑgroupId‰∏∫com.googlecode.myappÁöÑ‰æãÂ≠ê‰∏≠Ôºå‰Ω†ÂèØËÉΩ‰ºö‰∏∫‰∏çÂêåÁöÑÂ≠êÈ°πÁõÆÔºàÊ®°ÂùóÔºâÂàÜÈÖçartifactIdÔºåÂ¶Çmyapp-util„ÄÅmyapp-domain„ÄÅmyapp-webÁ≠âÈ°æÂêçÊÄù‰πâÔºåversionÊåáÂÆö‰∫ÜHello WorldÈ°πÁõÆÂΩìÂâçÁöÑÁâàÊú¨‚Äî‚Äî1.0-SNAPSHOT„ÄÇSNAPSHOTÊÑè‰∏∫Âø´ÁÖßÔºåËØ¥ÊòéËØ•È°πÁõÆËøòÂ§Ñ‰∫éÂºÄÂèë‰∏≠ÔºåÊòØ‰∏çÁ®≥ÂÆöÁöÑÁâàÊú¨„ÄÇÈöèÁùÄÈ°πÁõÆÁöÑÂèëÂ±ïÔºåversion‰ºö‰∏çÊñ≠Êõ¥Êñ∞ÔºåÂ¶ÇÂçáÁ∫ß‰∏∫1.0„ÄÅ1.1-SNAPSHOT„ÄÅ1.1„ÄÅ2.0Á≠â„ÄÇ6.5ËäÇ‰ºöËØ¶ÁªÜ‰ªãÁªçSNAPSHOTÔºåÁ¨¨13Á´†‰ºö‰ªãÁªçÂ¶Ç‰Ωï‰ΩøÁî®MavenÁÆ°ÁêÜÈ°πÁõÆÁâàÊú¨ÁöÑÂçáÁ∫ßÂèëÂ∏É„ÄÇÊúÄÂêé‰∏Ä‰∏™nameÂÖÉÁ¥†Â£∞Êòé‰∫Ü‰∏Ä‰∏™ÂØπ‰∫éÁî®Êà∑Êõ¥‰∏∫ÂèãÂ•ΩÁöÑÈ°πÁõÆÂêçÁß∞ÔºåËôΩÁÑ∂Ëøô‰∏çÊòØÂøÖÈ°ªÁöÑÔºå‰ΩÜËøòÊòØÊé®Ëçê‰∏∫ÊØè‰∏™POMÂ£∞ÊòénameÔºå‰ª•Êñπ‰æø‰ø°ÊÅØ‰∫§ÊµÅ„ÄÇ ##ÁºñÂÜô‰∏ª‰ª£Á†Å 123456789101112package com.pikaq.maventest;public class Helloworld&#123; public String sayHello()&#123; return &quot;hello&quot;; &#125; public static void main(String [] args)&#123; System.out.println(new Helloworld().sayHello()); &#125; &#125; ËøôÈáåÈúÄË¶ÅÊ≥®ÊÑèÔºåÂú®Â§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨Â∫îËØ•ÈÅµÂæ™mavenÁ∫¶ÂÆöÊää‰ª£Á†ÅÊîæÂú®src/main/java ÁõÆÂΩï‰∏ãÔºåÊó†ÈúÄÂÖ∂‰ªñÈÖçÁΩÆÔºåmavenÂ∞±‰ºöËá™Âä®ÂéªÊêúÂØª‰∏ª‰ª£Á†ÅÔºå‰ª£Á†ÅÁºñÂÜôÂÆå‰πãÂêéÔºå‰ΩøÁî® mvn clean compile ÁºñËØë ##ÁºñÂÜôÊµãËØï‰ª£Á†Å ÂíåÁºñÂÜô‰∏ª‰ª£Á†ÅÁ±ª‰ººÔºåÊµãËØï‰ª£Á†ÅÁöÑÁõÆÂΩïÂØπÂ∫îÁöÑÂ∫îËØ•Âú® src/test/java ‰∏ãÔºåÂõ†Ê≠§Â∫îËØ•ÂÖàÂàõÂª∫ÁõÆÂΩïÔºå‰øÆÊîπÈ°πÁõÆ pom Êñá‰ª∂ÔºåÂ¢ûÂä†Junit‰æùËµñ 1234567891011121314151617181920&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.pikaq&lt;/groupId&gt; &lt;artifactId&gt;maventest&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;maventest&lt;/name&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.7&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; ÁºñÂÜôÊµãËØïÁ±ª 1234567891011121314package com.pikaq.maventest;import static org.junit.Assert.assertEquals;import org.junit.Test;public class HelloworldTest&#123; @Test public void testSayHello()&#123; Helloworld h = new Helloworld(); String result = h.sayHello(); assertEquals(&quot;hello&quot;,result); &#125; &#125; ËøêË°å mvn clean test #ÊâìÂåÖÂíåËøêË°å mvn clean package maven Âú®ÊâìÂåÖ‰πãÂâçÊâßË°å‰∫ÜÁºñËØëÂíåÊµãËØïÊìç‰Ωú ‰ΩÜÊòØÂ¶Ç‰ΩïËÆ©ÂÖ∂‰ªñmaven È°πÁõÆÂºïÁî®Ëøô‰∏™jarÂåÖÂë¢Ôºö mvn clean install ÈÄöËøáÊâßË°åinstall ÂëΩ‰ª§Â∞Üjar ÂÆâË£ÖÂà∞‰∫ÜÊú¨Âú∞‰ªìÂ∫ì‰∏≠ #‰ΩøÁî®Archetype ÁîüÊàêÈ°πÁõÆÈ™®Êû∂ ÂâçÈù¢Êàë‰ª¨Âè™ÊòØ‰∏∫‰∫ÜÊàë‰ª¨Ëøõ‰∏ÄÊ≠•ÁÜüÊÇâmavenÔºåÁúüÊ≠£Áî®ÁöÑÊó∂ÂÄôÊàë‰ª¨ÂΩìÁÑ∂‰∏ç‰ºöËøô‰πàÂ§çÊùÇÔºå‰∏Ä‰∏™‰∏Ä‰∏™ÁõÆÂΩïÁöÑÂéªÂàõÂª∫ÔºåËøôÊòæÁÑ∂ÊòØÈáçÂ§çÂä≥Âä®ÔºÅÊàë‰ª¨Âè™ÈúÄË¶Å‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂëΩ‰ª§Â∞±ËÉΩÁîüÊàêÊàë‰ª¨Á∫¶ÂÆöÂ•ΩÁöÑÈ°πÁõÆÈ™®Êû∂ÔºÅ mvn archetype:generate Ê≥®ÊÑèËøôÈáåÊûÅÊúâÂèØËÉΩ‰ºöÂç°‰∏ªÔºåÂõ†‰∏∫Ëøô‰∏™ÂëΩ‰ª§‰ºöÈªòËÆ§ÂéªËøúÁ®ãËØ∑Ê±ÇÊâÄÊúâÁöÑÈ™®Êû∂ ÊâÄ‰ª•Êàë‰ª¨ËøôÈáåÂèØ‰ª•ÈÄâÊã© &gt;mvn archetype:generate -DarchetypeCatalog=internal Ëøô‰∏™ÂëΩ‰ª§ÊâßË°åÂè™‰ºöÂàóÂá∫Â∏∏Áî®ÁöÑ10‰∏™Êàë‰ª¨Âè™ÈúÄË¶ÅÊåâÁÖßÊèêÁ§∫ÈÄâÊã©‰∏Ä‰∏™Âç≥ÂèØÔºåÂπ∂‰æùÊ¨°ËæìÂÖ•groupIDÁ≠â ÊèêÁ§∫ÂàõÂª∫ÊàêÂäüÔºåÊàë‰ª¨ÂèëÁé∞Â∑≤ÁªèÁîüÊàê‰∫Ü‰∏Ä‰∏™mavenÈ°πÁõÆÔºåÊòØ‰∏çÊòØÈùûÂ∏∏ÁÆÄÂçïÔºÅ ####maven ÁöÑ‰æùËµñÁÆ°ÁêÜÈóÆÈ¢ò maven‰ºöËá™Âä®ÈÄâÊã©Ë∑ØÂæÑÊúÄÁü≠ÁöÑ]]></content>
      <categories>
        <category>ÊûÑÂª∫Â∑•ÂÖ∑</category>
        <category>maven</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[java ‰ΩøÁî®Ë°•Á†ÅËøêÁÆóÁöÑÂâç‰∏ñ‰ªäÁîü]]></title>
    <url>%2F2016%2F10%2F20%2Fjava-%E4%BD%BF%E7%94%A8%E8%A1%A5%E7%A0%81%E8%BF%90%E7%AE%97%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%2F</url>
    <content type="text"><![CDATA[Ââç‰∏ñ‰ªäÁîü‰ºóÊâÄÂë®Áü•ÔºåjavaÊòØ‰ΩøÁî®Ë°•Á†ÅÊù•Ë°®Á§∫Êï∞Â≠óÁöÑÔºà‰∏çÂåÖÊã¨Â≠óÁ¨¶ÂûãÔºâÔºåÊï∞Â≠óÁöÑËøêÁÆó‰πüÊòØ‰ª•Ë°•Á†ÅÂΩ¢ÂºèËøõË°åÁöÑÔºåÈÇ£‰πà‰∏∫‰ªÄ‰πàË¶ÅÁî®Ë°•Á†ÅË°®Á§∫Âë¢ÔºüË¶Å‰∫ÜËß£Ë°•Á†ÅÔºåÊàë‰ª¨È¶ñÂÖàË¶ÅÁü•ÈÅìËÆ°ÁÆóÊú∫ÂèØ‰ª•Áî®ÂéüÁ†Å ÂèçÁ†Å Ë°•Á†ÅËøô‰∏âÁßçÁºñÁ†ÅÊñπÂºèË°®Á§∫‰∏Ä‰∏™Êï∞ÂÖàÊù•ÁúãÁúãÊàë‰ª¨ÊòØÂ¶Ç‰ΩïÂÆö‰πâËøô‰∏âÁßçÁºñÁ†ÅÁöÑ Ê≠£Êï∞ÁöÑÂéüÁ†Å ÂèçÁ†Å Ë°•Á†ÅÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑ Ë¥üÊï∞ÁöÑÂèçÁ†ÅÊòØÈô§‰∫ÜÁ¨¶Âè∑‰ΩçÂÖ∂‰ªñÂèñÂèçÔºåË°•Á†ÅÊòØÂú®ÂèçÁ†Å‰∏äÂä†1 ÊâÄ‰ª•ÂØπ‰∫éÊ≠£Êï∞‰∏âÁ†ÅÂêà‰∏ÄÊ≤°Âï•ÂèØËØ¥ÁöÑÔºåËøôÈáå‰∏ªË¶ÅÊù•ËÅä‰∏Ä‰∏ãË¥üÊï∞ÔºåÂõ†‰∏∫ËÆ°ÁÆóÊú∫Âú®ËøõË°åËÆ°ÁÆóÁöÑÊó∂ÂÄôÔºåÂπ∂‰∏ç‰ºöÂÉè‰∫∫ËÑë‰∏ÄÊ†∑ËØÜÂà´ÂéüÁ†ÅÁöÑÁ¨¨‰∏Ä‰Ωç‰∏∫Á¨¶Âè∑‰ΩçÔºåËøõËÄå‰ºöÂéªÊ†πÊçÆÁ¨¶Âè∑‰ΩçÂØπÁúüÂÄºËøõË°åÂä†ÊàñÂáè„ÄÇÊâÄ‰ª•Êàë‰ª¨Ë¶ÅËÆ©ËÆ°ÁÆóÊú∫ÁöÑËøêÁÆóÂèòÁöÑÂ∞ΩÂèØËÉΩÁöÑÁÆÄÂçïÔºåÊØîÂ¶Ç‰∏§‰∏™Êï∞Áõ∏ÂáèÊàë‰ª¨ÂèØ‰ª•ÁúãÊàêÊòØÂä†‰∏ä‰∏Ä‰∏™Ë¥üÊï∞ÔºåÂπ∂‰∏îËÆ©Á¨¶Âè∑‰Ωç‰πüÂèÇ‰∏éËøêÁÆó ÂéüÁ†ÅÁöÑÂáèÊ≥ï 1210 + (-9) = 0000 1010(Âéü) + 1000 1001(Âéü) = 1001 0011(Âéü) = -19// Ê≠£Ëß£Â∫îËØ•ÊòØ 1Ôºå -19ÊòæÁÑ∂ÊòØÈîôËØØÁöÑ ‰æãÂ≠ê‰∏≠Ê≠£Ëß£Â∫îËØ•ÊòØ 1Ôºå -19ÊòæÁÑ∂ÊòØÈîôËØØÁöÑ„ÄÇËøôÂ∞±ÂºïÁî≥Âá∫‰∫ÜÂèçÁ†ÅÔºåË¥üÊï∞ÁöÑÂèçÁ†ÅÊòØÈô§‰∫ÜÁ¨¶Âè∑‰ΩçÔºåÂÖ∂‰ªñ‰ΩçÂèñÂèç ÂèçÁ†ÅÁöÑÂáèÊ≥ï 12310 + (-9) = 0000 1010(Âéü) + 1000 1001(Âéü) = 0000 1010(Âèç) + 1111 0110(Âèç) = 0000 0001(Âèç) = 0000 0001(Âéü)// ÁªìÊûúÊòØÊ≠£Á°ÆÁöÑ = 1 Áúã‰ººÂèçÁ†ÅË≤å‰ººËß£ÂÜ≥‰∫ÜÁ¨¶Âè∑‰ΩçÂèÇ‰∏éËøêÁÆóÁöÑÈóÆÈ¢òÔºåÂÖ∂ÂÆû‰∏çÁÑ∂ÔºåËÆ©Êàë‰ª¨ÂÜçÁúã‰∏Ä‰∏™ÁâπÊÆäÁöÑ‰æãÂ≠ê 1231 + (-1) = 0000 0001(Âéü) + 1000 0001(Âéü) = 0000 0001(Âèç) + 1111 1110(Âèç) = 1111 1111(Âèç) = 1000 0000(Âéü) = -0// ps: ÂèçÁ†ÅÁõ∏Âä†Á¨¶Âè∑‰ΩçÂèÇ‰∏éËøêÁÆóÔºå‰∏îËã•ÊúÄÈ´ò‰ΩçÁõ∏Âä†Âêé‰∫ßÁîüËøõ‰ΩçÔºåÊúÄÂêéÂæóÂà∞ÁöÑÁªìÊûúË¶ÅÂä†1// ÁªìÊûúÁúã‰ººÊòØÊ≠£Á°ÆÁöÑÔºå‰ΩÜÊòØÊòæÁÑ∂‰∏çÁ¨¶ÂêàÊàë‰ª¨ÁöÑÈ¢ÑÊúüÔºå0 Âíå -0 Â∫îËØ•ÊòØ‰∏Ä‰∏™Êï∞Â≠ó ‰∫éÊòØË°•Á†ÅÂ∞±ËøôÊ†∑Âá∫Áé∞‰∫Ü Ë°•Á†ÅÁöÑÂáèÊ≥ï 1231 + (-1) = 0000 0001(Âéü) + 1000 0001(Âéü) = 0000 0001(Âèç) + 1111 1110(Âèç) = 0000 0001(Ë°•) + 1111 1111(Ë°•) = 0000 0000(Âéü) = 0// ps: Ë°•Á†ÅËøêÁÆóÊúÄÈ´ò‰ΩçËøõ‰Ωç‰ºöËàçÂéª// ÁªìÊûúÂÆåÂÖ®Ê≠£Á°Æ ‰∏î -0 ‰∏çÂ≠òÂú®‰∫Ü ËøòÊúâ‰∏ÄÁÇπÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØ 1000 0000(Ë°•) Âπ∂Ê≤°ÊúâÁõ∏Â∫îÁöÑÂéüÁ†ÅÂíåÂèçÁ†ÅÔºå‰ªÖÁî®Êù•Ë°®Á§∫ -128 ÊúÄÂêéÂÜçÈôÑÂº†ÂπºÂÑøÁè≠Â∏∏Áî®Êï∞Â≠óËøõÂà∂Ë°® &lt;(Ôø£‚ñΩÔø£)/ 2ËøõÂà∂ 10 ËøõÂà∂ 16 ËøõÂà∂ 0000 0001 1 0x1 0000 0010 2 0x2 0000 0011 3 0x3 0000 0100 4 0x4 0000 0101 5 0x5 0000 0110 6 0x6 0000 0111 7 0x7 0000 1000 8 0x8 0000 1001 9 0x9 0000 1010 10 0xa 0000 1011 11 0xb 0000 1100 12 0xc 0000 1101 13 0xd 0000 1110 14 0xe 0000 1111 15 0xf 0001 0000 16 0x10 0001 0100 20 0x14 0001 1110 20 0x1e 0100 0000 64 0x40 0111 1111 127 0x7f 1111 1111 255 0xff]]></content>
      <categories>
        <category>javaÂü∫Á°Ä</category>
        <category>ÁºñÁ†Å</category>
      </categories>
      <tags>
        <tag>ÁºñÁ†Å</tag>
        <tag>Ë°•Á†Å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CSS ÁªùÂØπÂÆö‰Ωç ,ÊµÆÂä®,Ê∏ÖÈô§ÊµÆÂä®]]></title>
    <url>%2F2016%2F09%2F21%2FCSS-%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D-%E6%B5%AE%E5%8A%A8-%E6%B8%85%E9%99%A4%E6%B5%AE%E5%8A%A8%2F</url>
    <content type="text"><![CDATA[È¶ñÂÖàÔºöÊàë‰ª¨ÈúÄË¶ÅÁü•ÈÅìdivÂÖÉÁ¥†ÔºàÂùóÁ∫ßÂÖÉÁ¥†ÔºâÁã¨Âç†‰∏ÄË°å12345678910111213&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;1&quot; style=&quot;background:red;height:200px;padding:5px;position:relative&quot;&gt; &lt;div id=&quot;2&quot; style=&quot;background:green;height:50px;&quot;&gt;box1&lt;/div&gt; &lt;!-- divÂÖÉÁ¥†Áã¨Âç†‰∏ÄË°å --&gt; &lt;div id=&quot;3&quot; style=&quot;background:pink;height:50px;&quot;&gt;box2&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; Â¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºåbox1Âíåbox2Áã¨Âç†‰∏ÄË°åÔºåÂèØËßÅÂ¶ÇÊûúÊØè‰∏™divÈÉΩÁã¨Âç†‰∏ÄË°åÔºåÊàë‰ª¨Ê†πÊú¨Êó†Ê≥ïËøõË°åÂ∏ÉÂ±ÄÔºåÊâÄ‰ª•Êàë‰ª¨Â∞±ÈúÄË¶ÅÁªùÂØπÂÆö‰ΩçÂíåÊµÆÂä®Êù•Â∏ÆÂä©Êàë‰ª¨Â∏ÉÂ±ÄÔºÅ ÁªùÂØπÂÆö‰ΩçÁöÑÂèÇÁÖßÂÖ≥Á≥ªÁªùÂØπÂÆö‰Ωç‰ºö‰ª•ÊúÄËøëÁöÑËÆæÁΩÆ‰∫ÜpositionÂ±ûÊÄßÁöÑÁà∂Á∫ß‰∏∫ÂèÇÁÖßÁâ©ËøõË°åÂÆö‰ΩçÔºåÂ¶Ç‰∏ãÂõæbox2Â∞±‰ª•id‰∏∫1 ÁöÑdiv‰∏∫Áà∂Á∫ßÂèÇÁÖßËøõË°åÂÆö‰Ωç 123456789101112131415&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;0&quot; style=&quot;background:blue;padding:20px&quot;&gt;&lt;div id=&quot;1&quot; style=&quot;background:red;height:200px;padding:5px;position:relative&quot;&gt; &lt;div id=&quot;2&quot; style=&quot;background:black;width:50px;height:50px;&quot;&gt;box1&lt;/div&gt; &lt;!-- ÁªùÂØπÂÆö‰ΩçÁöÑÁà∂Á∫ßÂèÇÁÖßÁâ©ÊòØÊúÄËøëÁöÑËÆæÁΩÆ‰∫ÜpositionÁöÑÂÄºÁöÑÁà∂Á∫ßÂÖÉÁ¥†ÔºåËøôÈáå‰∏∫ ÂèÇÁÖßÁâ©‰∏∫1 --&gt; &lt;div id=&quot;3&quot; style=&quot;background:pink;width:50px;height:50px;position:absolute;left:50px;top:0px&quot;&gt;box2&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; ÊµÆÂä® Êó†ËÆ∫Â§ö‰πàÂ§çÊùÇÁöÑÂ∏ÉÂ±ÄÔºåÂÖ∂Âü∫Êú¨Âá∫ÂèëÁÇπÂùáÊòØÔºöÂ¶Ç‰ΩïÂú®‰∏ÄË°åÊòæÁ§∫Â§ö‰∏™divÂÖÉÁ¥†„ÄÇÊòæÁÑ∂Ê†áÂáÜÊµÅÂ∑≤ÁªèÊó†Ê≥ïÊª°Ë∂≥ÈúÄÊ±ÇÔºåËøôÂ∞±Ë¶ÅÁî®Âà∞ÊµÆÂä®„ÄÇÊµÆÂä®ÂèØ‰ª•ÁêÜËß£‰∏∫ËÆ©Êüê‰∏™divÂÖÉÁ¥†ËÑ±Á¶ªÊ†áÂáÜÊµÅÔºåÊºÇÊµÆÂú®Ê†áÂáÜÊµÅ‰πã‰∏äÔºåÂíåÊ†áÂáÜÊµÅ‰∏çÊòØ‰∏Ä‰∏™Â±ÇÊ¨°„ÄÇ Ê≠£Â∏∏ÁöÑdivÂ∏ÉÂ±ÄÂ∫îËØ•ÊòØÂÉè‰∏ãÂõæ‰∏ÄÊ†∑ÁöÑ 123456789&lt;body&gt;&lt;div id=&quot;1&quot; style=&quot;background:gray;height:500px;margin-top:5px&quot;&gt; &lt;div id=&quot;5&quot; style=&quot;background:blue;width:100px;height:50px;&quot;&gt;box1&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:yellow;width:60px;height:50px&quot;&gt;box2&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:green;width:70px;height:70px;&quot;&gt;box3&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:yellow;width:200px;height:50px;&quot;&gt;box4&lt;/div&gt;&lt;/div&gt;&lt;/body&gt; ÂÅáÂ¶ÇÊàë‰ª¨Â∞Übox2ËÆæÁΩÆÊµÆÂä® style‰∏≠Âä†‰∏äÂ±ûÊÄß float:left ÂêëÂ∑¶ÊµÆÂä®Êàë‰ª¨ÂèØ‰ª•ÂèëÁé∞Â¶Ç‰∏ãÂõæÁöÑÊ†∑Â≠ê ÂÖ∂‰∏≠box2ÊºÇÊµÆÂú®‰∫Übox3‰∏äÈù¢Ôºå‰ªéËÄåË¶ÜÁõñ‰∫Ü‰∏ÄÈÉ®ÂàÜÁöÑbox3Ôºå‰ªéËÄåÊàë‰ª¨ÂèØ‰ª•Áü•ÈÅìÊµÆÂä®ÁöÑÂÖÉÁ¥†ÊòØËÑ±Á¶ª‰∫ÜÊ†áÂáÜÊµÅÁöÑÔºÅ ‰πãÂêéÊàë‰ª¨Â∞Übox3‰πüËÆæÁΩÆ‰∏∫ÂêëÂ∑¶ÊµÆÂä®ÔºåÂèØ‰ª•ÂèëÁé∞box3Âíåbox2Âπ∂Êéí‰∫ÜÔºåÂπ∂ÊéíÂú®box2‰πãÂêéÔºåËÄå‰∏îbox2Âíåbox3ÈÉΩÊºÇÊµÆÂú®box4‰πã‰∏ä 123456&lt;div id=&quot;1&quot; style=&quot;background:gray;height:500px;margin-top:5px&quot;&gt; &lt;div id=&quot;5&quot; style=&quot;background:blue;width:100px;height:50px;&quot;&gt;box1&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:yellow;width:60px;height:50px;float:left&quot;&gt;box2&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:green;width:70px;height:70px;float:left&quot;&gt;box3&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:pink;width:200px;height:90px;&quot;&gt;box4&lt;/div&gt;&lt;/div&gt; clear Ê∏ÖÈô§ÊµÆÂä®Ê∏ÖÈô§ÊµÆÂä®ÁöÑÂÖ≥ÈîÆÂ≠óclear : none | left | right | both‰ªÄ‰πàÊó∂ÂÄôÈúÄË¶ÅÊ∏ÖÈô§ÊµÆÂä®Âë¢Ôºü ‰ª•‰∏äÈù¢ÁöÑ‰æãÂ≠ê ÔºåÂ¶ÇÊûúÊàë‰ª¨Â∏åÊúõbox4‰∏çË¢´Ëøô‰∫õÊºÇÊµÆÁöÑÂÖÉÁ¥†ÊâÄË¶ÜÁõñÔºåÈúÄË¶ÅÊÄé‰πàÂÅöÂë¢ÔºüËøôÊó∂ÂÄôÂ∞±ÈúÄË¶ÅÊ∏ÖÈô§ÊµÆÂä®‰∫Ü clear‰∫ÜÂè™ÈúÄË¶ÅÂú®box4 Ê∑ªÂä†CSSÂ±ûÊÄß clear:left ,Â∞±ÂèØ‰ª•Ê∏ÖÈô§ÂÖ∂Â∑¶ËæπÁöÑÊµÆÂä®ÂÖÉÁ¥†ÂΩ±ÂìçÔºå‰∏çË¢´‰ªñ‰ª¨ÊâÄË¶ÜÁõñ 123456&lt;div id=&quot;1&quot; style=&quot;background:gray;height:500px;margin-top:5px&quot;&gt; &lt;div id=&quot;5&quot; style=&quot;background:blue;width:100px;height:50px;&quot;&gt;box1&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:yellow;width:60px;height:50px;float:left&quot;&gt;box2&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:green;width:70px;height:70px;float:left&quot;&gt;box3&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:pink;width:200px;height:90px;clear:left&quot;&gt;box4&lt;/div&gt;&lt;/div&gt; ËøòÊúâÂΩìÊàë‰ª¨ÊµÆÂä®ÁöÑÂÖÉÁ¥†‰∏çÂ∏åÊúõË∑üÂú®ÂÖ∂‰ªñÊµÆÂä®ÂÖÉÁ¥†‰πãÂêéÊó∂Ôºå‰πüÂèØ‰ª•‰ΩøÁî®clear Â±ûÊÄßÊù•Âè¶Ëµ∑‰∏ÄË°å 12345&lt;div id=&quot;1&quot; style=&quot;background:gray;height:500px;margin-top:5px&quot;&gt; &lt;div id=&quot;5&quot; style=&quot;background:blue;width:100px;height:50px;&quot;&gt;box1&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:yellow;width:60px;height:50px;float:left&quot;&gt;box2&lt;/div&gt; &lt;div id=&quot;5&quot; style=&quot;background:green;width:70px;height:70px;float:left;clear:left&quot;&gt;box3&lt;/div&gt;&lt;/div&gt;]]></content>
      <categories>
        <category>ÂâçÁ´ØÊäÄÊúØ</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
</search>
